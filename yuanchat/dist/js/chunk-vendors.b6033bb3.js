(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[504],{33:function(e,t,r){"use strict";
/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
/*! #__NO_SIDE_EFFECTS__ */
function n(e){const t=Object.create(null);for(const r of e.split(","))t[r]=1;return e=>e in t}r.d(t,{$3:function(){return m},$H:function(){return U},BH:function(){return W},BX:function(){return re},Bm:function(){return T},C4:function(){return J},CE:function(){return f},CP:function(){return u},DY:function(){return D},Gv:function(){return S},J$:function(){return Z},Kg:function(){return I},MZ:function(){return i},Mp:function(){return c},NO:function(){return s},Oj:function(){return o},PT:function(){return N},Qd:function(){return k},Ro:function(){return F},SU:function(){return R},TF:function(){return l},Tg:function(){return P},Tn:function(){return M},Tr:function(){return Y},We:function(){return j},X$:function(){return d},Y2:function(){return ee},ZH:function(){return L},Zf:function(){return E},bB:function(){return B},cy:function(){return h},gd:function(){return y},pD:function(){return n},rU:function(){return V},tE:function(){return a},u3:function(){return ne},vM:function(){return g},v_:function(){return oe},yI:function(){return w},yL:function(){return b},yQ:function(){return q}});const i={},o=[],a=()=>{},s=()=>!1,c=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),u=e=>e.startsWith("onUpdate:"),d=Object.assign,l=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},p=Object.prototype.hasOwnProperty,m=(e,t)=>p.call(e,t),h=Array.isArray,f=e=>"[object Map]"===_(e),g=e=>"[object Set]"===_(e),v=e=>"[object Date]"===_(e),y=e=>"[object RegExp]"===_(e),M=e=>"function"===typeof e,I=e=>"string"===typeof e,T=e=>"symbol"===typeof e,S=e=>null!==e&&"object"===typeof e,b=e=>(S(e)||M(e))&&M(e.then)&&M(e.catch),C=Object.prototype.toString,_=e=>C.call(e),E=e=>_(e).slice(8,-1),k=e=>"[object Object]"===_(e),w=e=>I(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,R=n(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),A=e=>{const t=Object.create(null);return r=>{const n=t[r];return n||(t[r]=e(r))}},x=/-(\w)/g,N=A((e=>e.replace(x,((e,t)=>t?t.toUpperCase():"")))),O=/\B([A-Z])/g,P=A((e=>e.replace(O,"-$1").toLowerCase())),L=A((e=>e.charAt(0).toUpperCase()+e.slice(1))),V=A((e=>{const t=e?`on${L(e)}`:"";return t})),U=(e,t)=>!Object.is(e,t),D=(e,...t)=>{for(let r=0;r<e.length;r++)e[r](...t)},q=(e,t,r,n=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:n,value:r})},B=e=>{const t=parseFloat(e);return isNaN(t)?e:t},F=e=>{const t=I(e)?Number(e):NaN;return isNaN(t)?e:t};let G;const j=()=>G||(G="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:{});const H="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",W=n(H);function Y(e){if(h(e)){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=I(n)?z(n):Y(n);if(i)for(const e in i)t[e]=i[e]}return t}if(I(e)||S(e))return e}const K=/;(?![^(]*\))/g,Q=/:([^]+)/,$=/\/\*[^]*?\*\//g;function z(e){const t={};return e.replace($,"").split(K).forEach((e=>{if(e){const r=e.split(Q);r.length>1&&(t[r[0].trim()]=r[1].trim())}})),t}function J(e){let t="";if(I(e))t=e;else if(h(e))for(let r=0;r<e.length;r++){const n=J(e[r]);n&&(t+=n+" ")}else if(S(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const X="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Z=n(X);function ee(e){return!!e||""===e}function te(e,t){if(e.length!==t.length)return!1;let r=!0;for(let n=0;r&&n<e.length;n++)r=re(e[n],t[n]);return r}function re(e,t){if(e===t)return!0;let r=v(e),n=v(t);if(r||n)return!(!r||!n)&&e.getTime()===t.getTime();if(r=T(e),n=T(t),r||n)return e===t;if(r=h(e),n=h(t),r||n)return!(!r||!n)&&te(e,t);if(r=S(e),n=S(t),r||n){if(!r||!n)return!1;const i=Object.keys(e).length,o=Object.keys(t).length;if(i!==o)return!1;for(const r in e){const n=e.hasOwnProperty(r),i=t.hasOwnProperty(r);if(n&&!i||!n&&i||!re(e[r],t[r]))return!1}}return String(e)===String(t)}function ne(e,t){return e.findIndex((e=>re(e,t)))}const ie=e=>!(!e||!0!==e["__v_isRef"]),oe=e=>I(e)?e:null==e?"":h(e)||S(e)&&(e.toString===C||!M(e.toString))?ie(e)?oe(e.value):JSON.stringify(e,ae,2):String(e),ae=(e,t)=>ie(t)?ae(e,t.value):f(t)?{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,r],n)=>(e[se(t,n)+" =>"]=r,e)),{})}:g(t)?{[`Set(${t.size})`]:[...t.values()].map((e=>se(e)))}:T(t)?se(t):!S(t)||h(t)||k(t)?t:String(t),se=(e,t="")=>{var r;return T(e)?`Symbol(${null!=(r=e.description)?r:t})`:e}},34:function(e,t,r){"use strict";var n=r(4901);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},283:function(e,t,r){"use strict";var n=r(9504),i=r(9039),o=r(4901),a=r(9297),s=r(3724),c=r(350).CONFIGURABLE,u=r(3706),d=r(1181),l=d.enforce,p=d.get,m=String,h=Object.defineProperty,f=n("".slice),g=n("".replace),v=n([].join),y=s&&!i((function(){return 8!==h((function(){}),"length",{value:8}).length})),M=String(String).split("String"),I=e.exports=function(e,t,r){"Symbol("===f(m(t),0,7)&&(t="["+g(m(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!a(e,"name")||c&&e.name!==t)&&(s?h(e,"name",{value:t,configurable:!0}):e.name=t),y&&r&&a(r,"arity")&&e.length!==r.arity&&h(e,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?s&&h(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=l(e);return a(n,"source")||(n.source=v(M,"string"==typeof t?t:"")),e};Function.prototype.toString=I((function(){return o(this)&&p(this).source||u(this)}),"toString")},350:function(e,t,r){"use strict";var n=r(3724),i=r(9297),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),c=s&&"something"===function(){}.name,u=s&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},397:function(e,t,r){"use strict";var n=r(7751);e.exports=n("document","documentElement")},406:function(e,t){"use strict";var r=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)},n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?c(Array.isArray(e)?[]:{},e,t):e}function o(e,t,r){return e.concat(t).map((function(e){return i(e,r)}))}function a(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function s(e,t){try{return t in e}catch(e){return!1}}function c(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||r,n.cloneUnlessOtherwiseSpecified=i;var u=Array.isArray(t);return u===Array.isArray(e)?u?n.arrayMerge(e,t,n):function(e,t,r){var n={};return r.isMergeableObject(e)&&a(e).forEach((function(t){n[t]=i(e[t],r)})),a(t).forEach((function(o){(function(e,t){return s(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,o)||(n[o]=s(e,o)&&r.isMergeableObject(t[o])?function(e,t){if(!t.customMerge)return c;var r=t.customMerge(e);return"function"==typeof r?r:c}(o,r)(e[o],t[o],r):i(t[o],r))})),n}(e,t,n):i(t,n)}c.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return c(e,r,t)}),{})};var u=c;function d(e){var t=(e=e||{}).storage||window&&window.localStorage,r=e.key||"vuex";function n(e,t){var r=t.getItem(e);try{return"string"==typeof r?JSON.parse(r):"object"==typeof r?r:void 0}catch(e){}}function i(){return!0}function o(e,t,r){return r.setItem(e,JSON.stringify(t))}function a(e,t){return Array.isArray(t)?t.reduce((function(t,r){return function(e,t,r){return!/^(__proto__|constructor|prototype)$/.test(t)&&((t=t.split?t.split("."):t.slice(0)).slice(0,-1).reduce((function(e,t){return e[t]=e[t]||{}}),e)[t.pop()]=r),e}(t,r,(n=e,void 0===(n=((i=r).split?i.split("."):i).reduce((function(e,t){return e&&e[t]}),n))?void 0:n));var n,i}),{}):e}function s(e){return function(t){return e.subscribe(t)}}(e.assertStorage||function(){t.setItem("@@",1),t.removeItem("@@")})(t);var c,d=function(){return(e.getState||n)(r,t)};return e.fetchBeforeUse&&(c=d()),function(n){e.fetchBeforeUse||(c=d()),"object"==typeof c&&null!==c&&(n.replaceState(e.overwrite?c:u(n.state,c,{arrayMerge:e.arrayMerger||function(e,t){return t},clone:!1})),(e.rehydrated||function(){})(n)),(e.subscriber||s)(n)((function(n,s){(e.filter||i)(n)&&(e.setState||o)(r,(e.reducer||a)(s,e.paths),t)}))}}t.A=d},421:function(e){"use strict";e.exports={}},507:function(e,t,r){"use strict";var n=r(9565);e.exports=function(e,t,r){var i,o,a=r?e:e.iterator,s=e.next;while(!(i=n(s,a)).done)if(o=t(i.value),void 0!==o)return o}},616:function(e,t,r){"use strict";var n=r(9039);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},641:function(e,t,r){"use strict";r.d(t,{$u:function(){return oe},CE:function(){return Qt},Df:function(){return F},EW:function(){return Pr},FK:function(){return Ut},Gt:function(){return Ge},Gy:function(){return L},K9:function(){return dt},Lk:function(){return er},MZ:function(){return B},OW:function(){return q},Q3:function(){return ar},QP:function(){return U},WQ:function(){return je},Wv:function(){return $t},bF:function(){return tr},bo:function(){return R},dY:function(){return g},eW:function(){return or},g2:function(){return me},h:function(){return Lr},nI:function(){return gr},pI:function(){return ve},pM:function(){return G},qL:function(){return a},uX:function(){return jt},wB:function(){return Tt}});var n=r(953),i=r(33);function o(e,t,r,n){try{return n?e(...n):e()}catch(i){s(i,t,r)}}function a(e,t,r,n){if((0,i.Tn)(e)){const a=o(e,t,r,n);return a&&(0,i.yL)(a)&&a.catch((e=>{s(e,t,r)})),a}if((0,i.cy)(e)){const i=[];for(let o=0;o<e.length;o++)i.push(a(e[o],t,r,n));return i}}function s(e,t,r,a=!0){const s=t?t.vnode:null,{errorHandler:u,throwUnhandledErrorInProduction:d}=t&&t.appContext.config||i.MZ;if(t){let i=t.parent;const a=t.proxy,s=`https://vuejs.org/error-reference/#runtime-${r}`;while(i){const t=i.ec;if(t)for(let r=0;r<t.length;r++)if(!1===t[r](e,a,s))return;i=i.parent}if(u)return(0,n.C4)(),o(u,null,10,[e,a,s]),void(0,n.bl)()}c(e,r,s,a,d)}function c(e,t,r,n=!0,i=!1){if(i)throw e;console.error(e)}const u=[];let d=-1;const l=[];let p=null,m=0;const h=Promise.resolve();let f=null;function g(e){const t=f||h;return e?t.then(this?e.bind(this):e):t}function v(e){let t=d+1,r=u.length;while(t<r){const n=t+r>>>1,i=u[n],o=b(i);o<e||o===e&&2&i.flags?t=n+1:r=n}return t}function y(e){if(!(1&e.flags)){const t=b(e),r=u[u.length-1];!r||!(2&e.flags)&&t>=b(r)?u.push(e):u.splice(v(t),0,e),e.flags|=1,M()}}function M(){f||(f=h.then(C))}function I(e){(0,i.cy)(e)?l.push(...e):p&&-1===e.id?p.splice(m+1,0,e):1&e.flags||(l.push(e),e.flags|=1),M()}function T(e,t,r=d+1){for(0;r<u.length;r++){const t=u[r];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;0,u.splice(r,1),r--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function S(e){if(l.length){const e=[...new Set(l)].sort(((e,t)=>b(e)-b(t)));if(l.length=0,p)return void p.push(...e);for(p=e,m=0;m<p.length;m++){const e=p[m];0,4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}p=null,m=0}}const b=e=>null==e.id?2&e.flags?-1:1/0:e.id;function C(e){i.tE;try{for(d=0;d<u.length;d++){const e=u[d];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),o(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;d<u.length;d++){const e=u[d];e&&(e.flags&=-2)}d=-1,u.length=0,S(e),f=null,(u.length||l.length)&&C(e)}}let _=null,E=null;function k(e){const t=_;return _=e,E=e&&e.type.__scopeId||null,t}function w(e,t=_,r){if(!t)return e;if(e._n)return e;const n=(...r)=>{n._d&&Yt(-1);const i=k(t);let o;try{o=e(...r)}finally{k(i),n._d&&Yt(1)}return o};return n._n=!0,n._c=!0,n._d=!0,n}function R(e,t){if(null===_)return e;const r=xr(_),o=e.dirs||(e.dirs=[]);for(let a=0;a<t.length;a++){let[e,s,c,u=i.MZ]=t[a];e&&((0,i.Tn)(e)&&(e={mounted:e,updated:e}),e.deep&&(0,n.hV)(s),o.push({dir:e,instance:r,value:s,oldValue:void 0,arg:c,modifiers:u}))}return e}function A(e,t,r,i){const o=e.dirs,s=t&&t.dirs;for(let c=0;c<o.length;c++){const u=o[c];s&&(u.oldValue=s[c].value);let d=u.dir[i];d&&((0,n.C4)(),a(d,r,8,[e.el,u,e,t]),(0,n.bl)())}}const x=Symbol("_vte"),N=e=>e.__isTeleport;const O=Symbol("_leaveCb"),P=Symbol("_enterCb");function L(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ne((()=>{e.isMounted=!0})),ae((()=>{e.isUnmounting=!0})),e}const V=[Function,Array],U={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:V,onEnter:V,onAfterEnter:V,onEnterCancelled:V,onBeforeLeave:V,onLeave:V,onAfterLeave:V,onLeaveCancelled:V,onBeforeAppear:V,onAppear:V,onAfterAppear:V,onAppearCancelled:V};function D(e,t){const{leavingVNodes:r}=e;let n=r.get(t.type);return n||(n=Object.create(null),r.set(t.type,n)),n}function q(e,t,r,n,o){const{appear:s,mode:c,persisted:u=!1,onBeforeEnter:d,onEnter:l,onAfterEnter:p,onEnterCancelled:m,onBeforeLeave:h,onLeave:f,onAfterLeave:g,onLeaveCancelled:v,onBeforeAppear:y,onAppear:M,onAfterAppear:I,onAppearCancelled:T}=t,S=String(e.key),b=D(r,e),C=(e,t)=>{e&&a(e,n,9,t)},_=(e,t)=>{const r=t[1];C(e,t),(0,i.cy)(e)?e.every((e=>e.length<=1))&&r():e.length<=1&&r()},E={mode:c,persisted:u,beforeEnter(t){let n=d;if(!r.isMounted){if(!s)return;n=y||d}t[O]&&t[O](!0);const i=b[S];i&&Jt(e,i)&&i.el[O]&&i.el[O](),C(n,[t])},enter(e){let t=l,n=p,i=m;if(!r.isMounted){if(!s)return;t=M||l,n=I||p,i=T||m}let o=!1;const a=e[P]=t=>{o||(o=!0,C(t?i:n,[e]),E.delayedLeave&&E.delayedLeave(),e[P]=void 0)};t?_(t,[e,a]):a()},leave(t,n){const i=String(e.key);if(t[P]&&t[P](!0),r.isUnmounting)return n();C(h,[t]);let o=!1;const a=t[O]=r=>{o||(o=!0,n(),C(r?v:g,[t]),t[O]=void 0,b[i]===e&&delete b[i])};b[i]=e,f?_(f,[t,a]):a()},clone(e){const i=q(e,t,r,n,o);return o&&o(i),i}};return E}function B(e,t){6&e.shapeFlag&&e.component?(e.transition=t,B(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function F(e,t=!1,r){let n=[],i=0;for(let o=0;o<e.length;o++){let a=e[o];const s=null==r?a.key:String(r)+String(null!=a.key?a.key:o);a.type===Ut?(128&a.patchFlag&&i++,n=n.concat(F(a.children,t,s))):(t||a.type!==qt)&&n.push(null!=s?ir(a,{key:s}):a)}if(i>1)for(let o=0;o<n.length;o++)n[o].patchFlag=-2;return n}
/*! #__NO_SIDE_EFFECTS__ */function G(e,t){return(0,i.Tn)(e)?(()=>(0,i.X$)({name:e.name},t,{setup:e}))():e}function j(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function H(e,t,r,a,s=!1){if((0,i.cy)(e))return void e.forEach(((e,n)=>H(e,t&&((0,i.cy)(t)?t[n]:t),r,a,s)));if(W(a)&&!s)return void(512&a.shapeFlag&&a.type.__asyncResolved&&a.component.subTree.component&&H(e,t,r,a.component.subTree));const c=4&a.shapeFlag?xr(a.component):a.el,u=s?null:c,{i:d,r:l}=e;const p=t&&t.r,m=d.refs===i.MZ?d.refs={}:d.refs,h=d.setupState,f=(0,n.ux)(h),g=h===i.MZ?()=>!1:e=>(0,i.$3)(f,e);if(null!=p&&p!==l&&((0,i.Kg)(p)?(m[p]=null,g(p)&&(h[p]=null)):(0,n.i9)(p)&&(p.value=null)),(0,i.Tn)(l))o(l,d,12,[u,m]);else{const t=(0,i.Kg)(l),o=(0,n.i9)(l);if(t||o){const n=()=>{if(e.f){const r=t?g(l)?h[l]:m[l]:l.value;s?(0,i.cy)(r)&&(0,i.TF)(r,c):(0,i.cy)(r)?r.includes(c)||r.push(c):t?(m[l]=[c],g(l)&&(h[l]=m[l])):(l.value=[c],e.k&&(m[e.k]=l.value))}else t?(m[l]=u,g(l)&&(h[l]=u)):o&&(l.value=u,e.k&&(m[e.k]=u))};u?(n.id=-1,ut(n,r)):n()}else 0}}(0,i.We)().requestIdleCallback,(0,i.We)().cancelIdleCallback;const W=e=>!!e.type.__asyncLoader
/*! #__NO_SIDE_EFFECTS__ */;const Y=e=>e.type.__isKeepAlive;RegExp,RegExp;function K(e,t){return(0,i.cy)(e)?e.some((e=>K(e,t))):(0,i.Kg)(e)?e.split(",").includes(t):!!(0,i.gd)(e)&&(e.lastIndex=0,e.test(t))}function Q(e,t){z(e,"a",t)}function $(e,t){z(e,"da",t)}function z(e,t,r=fr){const n=e.__wdc||(e.__wdc=()=>{let t=r;while(t){if(t.isDeactivated)return;t=t.parent}return e()});if(ee(t,n,r),r){let e=r.parent;while(e&&e.parent)Y(e.parent.vnode)&&J(n,t,r,e),e=e.parent}}function J(e,t,r,n){const o=ee(t,e,n,!0);se((()=>{(0,i.TF)(n[t],o)}),r)}function X(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function Z(e){return 128&e.shapeFlag?e.ssContent:e}function ee(e,t,r=fr,i=!1){if(r){const o=r[e]||(r[e]=[]),s=t.__weh||(t.__weh=(...i)=>{(0,n.C4)();const o=Mr(r),s=a(t,r,e,i);return o(),(0,n.bl)(),s});return i?o.unshift(s):o.push(s),s}}const te=e=>(t,r=fr)=>{Cr&&"sp"!==e||ee(e,((...e)=>t(...e)),r)},re=te("bm"),ne=te("m"),ie=te("bu"),oe=te("u"),ae=te("bum"),se=te("um"),ce=te("sp"),ue=te("rtg"),de=te("rtc");function le(e,t=fr){ee("ec",e,t)}const pe="components";function me(e,t){return fe(pe,e,!0,t)||e}const he=Symbol.for("v-ndc");function fe(e,t,r=!0,n=!1){const o=_||fr;if(o){const r=o.type;if(e===pe){const e=Nr(r,!1);if(e&&(e===t||e===(0,i.PT)(t)||e===(0,i.ZH)((0,i.PT)(t))))return r}const a=ge(o[e]||r[e],t)||ge(o.appContext[e],t);return!a&&n?r:a}}function ge(e,t){return e&&(e[t]||e[(0,i.PT)(t)]||e[(0,i.ZH)((0,i.PT)(t))])}function ve(e,t,r,o){let a;const s=r&&r[o],c=(0,i.cy)(e);if(c||(0,i.Kg)(e)){const r=c&&(0,n.g8)(e);let i=!1;r&&(i=!(0,n.fE)(e),e=(0,n.qA)(e)),a=new Array(e.length);for(let o=0,c=e.length;o<c;o++)a[o]=t(i?(0,n.lJ)(e[o]):e[o],o,void 0,s&&s[o])}else if("number"===typeof e){0,a=new Array(e);for(let r=0;r<e;r++)a[r]=t(r+1,r,void 0,s&&s[r])}else if((0,i.Gv)(e))if(e[Symbol.iterator])a=Array.from(e,((e,r)=>t(e,r,void 0,s&&s[r])));else{const r=Object.keys(e);a=new Array(r.length);for(let n=0,i=r.length;n<i;n++){const i=r[n];a[n]=t(e[i],i,n,s&&s[n])}}else a=[];return r&&(r[o]=a),a}const ye=e=>e?Tr(e)?xr(e):ye(e.parent):null,Me=(0,i.X$)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>ye(e.parent),$root:e=>ye(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>we(e),$forceUpdate:e=>e.f||(e.f=()=>{y(e.update)}),$nextTick:e=>e.n||(e.n=g.bind(e.proxy)),$watch:e=>bt.bind(e)}),Ie=(e,t)=>e!==i.MZ&&!e.__isScriptSetup&&(0,i.$3)(e,t),Te={get({_:e},t){if("__v_skip"===t)return!0;const{ctx:r,setupState:o,data:a,props:s,accessCache:c,type:u,appContext:d}=e;let l;if("$"!==t[0]){const n=c[t];if(void 0!==n)switch(n){case 1:return o[t];case 2:return a[t];case 4:return r[t];case 3:return s[t]}else{if(Ie(o,t))return c[t]=1,o[t];if(a!==i.MZ&&(0,i.$3)(a,t))return c[t]=2,a[t];if((l=e.propsOptions[0])&&(0,i.$3)(l,t))return c[t]=3,s[t];if(r!==i.MZ&&(0,i.$3)(r,t))return c[t]=4,r[t];be&&(c[t]=0)}}const p=Me[t];let m,h;return p?("$attrs"===t&&(0,n.u4)(e.attrs,"get",""),p(e)):(m=u.__cssModules)&&(m=m[t])?m:r!==i.MZ&&(0,i.$3)(r,t)?(c[t]=4,r[t]):(h=d.config.globalProperties,(0,i.$3)(h,t)?h[t]:void 0)},set({_:e},t,r){const{data:n,setupState:o,ctx:a}=e;return Ie(o,t)?(o[t]=r,!0):n!==i.MZ&&(0,i.$3)(n,t)?(n[t]=r,!0):!(0,i.$3)(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(a[t]=r,!0))},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:o,propsOptions:a}},s){let c;return!!r[s]||e!==i.MZ&&(0,i.$3)(e,s)||Ie(t,s)||(c=a[0])&&(0,i.$3)(c,s)||(0,i.$3)(n,s)||(0,i.$3)(Me,s)||(0,i.$3)(o.config.globalProperties,s)},defineProperty(e,t,r){return null!=r.get?e._.accessCache[t]=0:(0,i.$3)(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};function Se(e){return(0,i.cy)(e)?e.reduce(((e,t)=>(e[t]=null,e)),{}):e}let be=!0;function Ce(e){const t=we(e),r=e.proxy,o=e.ctx;be=!1,t.beforeCreate&&Ee(t.beforeCreate,e,"bc");const{data:a,computed:s,methods:c,watch:u,provide:d,inject:l,created:p,beforeMount:m,mounted:h,beforeUpdate:f,updated:g,activated:v,deactivated:y,beforeDestroy:M,beforeUnmount:I,destroyed:T,unmounted:S,render:b,renderTracked:C,renderTriggered:_,errorCaptured:E,serverPrefetch:k,expose:w,inheritAttrs:R,components:A,directives:x,filters:N}=t,O=null;if(l&&_e(l,o,O),c)for(const n in c){const e=c[n];(0,i.Tn)(e)&&(o[n]=e.bind(r))}if(a){0;const t=a.call(r,r);0,(0,i.Gv)(t)&&(e.data=(0,n.Kh)(t))}if(be=!0,s)for(const n in s){const e=s[n],t=(0,i.Tn)(e)?e.bind(r,r):(0,i.Tn)(e.get)?e.get.bind(r,r):i.tE;0;const a=!(0,i.Tn)(e)&&(0,i.Tn)(e.set)?e.set.bind(r):i.tE,c=Pr({get:t,set:a});Object.defineProperty(o,n,{enumerable:!0,configurable:!0,get:()=>c.value,set:e=>c.value=e})}if(u)for(const n in u)ke(u[n],o,r,n);if(d){const e=(0,i.Tn)(d)?d.call(r):d;Reflect.ownKeys(e).forEach((t=>{Ge(t,e[t])}))}function P(e,t){(0,i.cy)(t)?t.forEach((t=>e(t.bind(r)))):t&&e(t.bind(r))}if(p&&Ee(p,e,"c"),P(re,m),P(ne,h),P(ie,f),P(oe,g),P(Q,v),P($,y),P(le,E),P(de,C),P(ue,_),P(ae,I),P(se,S),P(ce,k),(0,i.cy)(w))if(w.length){const t=e.exposed||(e.exposed={});w.forEach((e=>{Object.defineProperty(t,e,{get:()=>r[e],set:t=>r[e]=t})}))}else e.exposed||(e.exposed={});b&&e.render===i.tE&&(e.render=b),null!=R&&(e.inheritAttrs=R),A&&(e.components=A),x&&(e.directives=x),k&&j(e)}function _e(e,t,r=i.tE){(0,i.cy)(e)&&(e=Oe(e));for(const o in e){const r=e[o];let a;a=(0,i.Gv)(r)?"default"in r?je(r.from||o,r.default,!0):je(r.from||o):je(r),(0,n.i9)(a)?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>a.value,set:e=>a.value=e}):t[o]=a}}function Ee(e,t,r){a((0,i.cy)(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,r)}function ke(e,t,r,n){let o=n.includes(".")?Ct(r,n):()=>r[n];if((0,i.Kg)(e)){const r=t[e];(0,i.Tn)(r)&&Tt(o,r)}else if((0,i.Tn)(e))Tt(o,e.bind(r));else if((0,i.Gv)(e))if((0,i.cy)(e))e.forEach((e=>ke(e,t,r,n)));else{const n=(0,i.Tn)(e.handler)?e.handler.bind(r):t[e.handler];(0,i.Tn)(n)&&Tt(o,n,e)}else 0}function we(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:o,optionsCache:a,config:{optionMergeStrategies:s}}=e.appContext,c=a.get(t);let u;return c?u=c:o.length||r||n?(u={},o.length&&o.forEach((e=>Re(u,e,s,!0))),Re(u,t,s)):u=t,(0,i.Gv)(t)&&a.set(t,u),u}function Re(e,t,r,n=!1){const{mixins:i,extends:o}=t;o&&Re(e,o,r,!0),i&&i.forEach((t=>Re(e,t,r,!0)));for(const a in t)if(n&&"expose"===a);else{const n=Ae[a]||r&&r[a];e[a]=n?n(e[a],t[a]):t[a]}return e}const Ae={data:xe,props:Ve,emits:Ve,methods:Le,computed:Le,beforeCreate:Pe,created:Pe,beforeMount:Pe,mounted:Pe,beforeUpdate:Pe,updated:Pe,beforeDestroy:Pe,beforeUnmount:Pe,destroyed:Pe,unmounted:Pe,activated:Pe,deactivated:Pe,errorCaptured:Pe,serverPrefetch:Pe,components:Le,directives:Le,watch:Ue,provide:xe,inject:Ne};function xe(e,t){return t?e?function(){return(0,i.X$)((0,i.Tn)(e)?e.call(this,this):e,(0,i.Tn)(t)?t.call(this,this):t)}:t:e}function Ne(e,t){return Le(Oe(e),Oe(t))}function Oe(e){if((0,i.cy)(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function Pe(e,t){return e?[...new Set([].concat(e,t))]:t}function Le(e,t){return e?(0,i.X$)(Object.create(null),e,t):t}function Ve(e,t){return e?(0,i.cy)(e)&&(0,i.cy)(t)?[...new Set([...e,...t])]:(0,i.X$)(Object.create(null),Se(e),Se(null!=t?t:{})):t}function Ue(e,t){if(!e)return t;if(!t)return e;const r=(0,i.X$)(Object.create(null),e);for(const n in t)r[n]=Pe(e[n],t[n]);return r}function De(){return{app:null,config:{isNativeTag:i.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qe=0;function Be(e,t){return function(r,n=null){(0,i.Tn)(r)||(r=(0,i.X$)({},r)),null==n||(0,i.Gv)(n)||(n=null);const o=De(),s=new WeakSet,c=[];let u=!1;const d=o.app={_uid:qe++,_component:r,_props:n,_container:null,_context:o,_instance:null,version:Vr,get config(){return o.config},set config(e){0},use(e,...t){return s.has(e)||(e&&(0,i.Tn)(e.install)?(s.add(e),e.install(d,...t)):(0,i.Tn)(e)&&(s.add(e),e(d,...t))),d},mixin(e){return o.mixins.includes(e)||o.mixins.push(e),d},component(e,t){return t?(o.components[e]=t,d):o.components[e]},directive(e,t){return t?(o.directives[e]=t,d):o.directives[e]},mount(i,a,s){if(!u){0;const c=d._ceVNode||tr(r,n);return c.appContext=o,!0===s?s="svg":!1===s&&(s=void 0),a&&t?t(c,i):e(c,i,s),u=!0,d._container=i,i.__vue_app__=d,xr(c.component)}},onUnmount(e){c.push(e)},unmount(){u&&(a(c,d._instance,16),e(null,d._container),delete d._container.__vue_app__)},provide(e,t){return o.provides[e]=t,d},runWithContext(e){const t=Fe;Fe=d;try{return e()}finally{Fe=t}}};return d}}let Fe=null;function Ge(e,t){if(fr){let r=fr.provides;const n=fr.parent&&fr.parent.provides;n===r&&(r=fr.provides=Object.create(n)),r[e]=t}else 0}function je(e,t,r=!1){const n=fr||_;if(n||Fe){const o=Fe?Fe._context.provides:n?null==n.parent?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return r&&(0,i.Tn)(t)?t.call(n&&n.proxy):t}else 0}const He={},We=()=>Object.create(He),Ye=e=>Object.getPrototypeOf(e)===He;function Ke(e,t,r,i=!1){const o={},a=We();e.propsDefaults=Object.create(null),$e(e,t,o,a);for(const n in e.propsOptions[0])n in o||(o[n]=void 0);r?e.props=i?o:(0,n.Gc)(o):e.type.props?e.props=o:e.props=a,e.attrs=a}function Qe(e,t,r,o){const{props:a,attrs:s,vnode:{patchFlag:c}}=e,u=(0,n.ux)(a),[d]=e.propsOptions;let l=!1;if(!(o||c>0)||16&c){let n;$e(e,t,a,s)&&(l=!0);for(const o in u)t&&((0,i.$3)(t,o)||(n=(0,i.Tg)(o))!==o&&(0,i.$3)(t,n))||(d?!r||void 0===r[o]&&void 0===r[n]||(a[o]=ze(d,u,o,void 0,e,!0)):delete a[o]);if(s!==u)for(const e in s)t&&(0,i.$3)(t,e)||(delete s[e],l=!0)}else if(8&c){const r=e.vnode.dynamicProps;for(let n=0;n<r.length;n++){let o=r[n];if(wt(e.emitsOptions,o))continue;const c=t[o];if(d)if((0,i.$3)(s,o))c!==s[o]&&(s[o]=c,l=!0);else{const t=(0,i.PT)(o);a[t]=ze(d,u,t,c,e,!1)}else c!==s[o]&&(s[o]=c,l=!0)}}l&&(0,n.hZ)(e.attrs,"set","")}function $e(e,t,r,o){const[a,s]=e.propsOptions;let c,u=!1;if(t)for(let n in t){if((0,i.SU)(n))continue;const d=t[n];let l;a&&(0,i.$3)(a,l=(0,i.PT)(n))?s&&s.includes(l)?(c||(c={}))[l]=d:r[l]=d:wt(e.emitsOptions,n)||n in o&&d===o[n]||(o[n]=d,u=!0)}if(s){const t=(0,n.ux)(r),o=c||i.MZ;for(let n=0;n<s.length;n++){const c=s[n];r[c]=ze(a,t,c,o[c],e,!(0,i.$3)(o,c))}}return u}function ze(e,t,r,n,o,a){const s=e[r];if(null!=s){const e=(0,i.$3)(s,"default");if(e&&void 0===n){const e=s.default;if(s.type!==Function&&!s.skipFactory&&(0,i.Tn)(e)){const{propsDefaults:i}=o;if(r in i)n=i[r];else{const a=Mr(o);n=i[r]=e.call(null,t),a()}}else n=e;o.ce&&o.ce._setProp(r,n)}s[0]&&(a&&!e?n=!1:!s[1]||""!==n&&n!==(0,i.Tg)(r)||(n=!0))}return n}const Je=new WeakMap;function Xe(e,t,r=!1){const n=r?Je:t.propsCache,o=n.get(e);if(o)return o;const a=e.props,s={},c=[];let u=!1;if(!(0,i.Tn)(e)){const n=e=>{u=!0;const[r,n]=Xe(e,t,!0);(0,i.X$)(s,r),n&&c.push(...n)};!r&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}if(!a&&!u)return(0,i.Gv)(e)&&n.set(e,i.Oj),i.Oj;if((0,i.cy)(a))for(let l=0;l<a.length;l++){0;const e=(0,i.PT)(a[l]);Ze(e)&&(s[e]=i.MZ)}else if(a){0;for(const e in a){const t=(0,i.PT)(e);if(Ze(t)){const r=a[e],n=s[t]=(0,i.cy)(r)||(0,i.Tn)(r)?{type:r}:(0,i.X$)({},r),o=n.type;let u=!1,d=!0;if((0,i.cy)(o))for(let e=0;e<o.length;++e){const t=o[e],r=(0,i.Tn)(t)&&t.name;if("Boolean"===r){u=!0;break}"String"===r&&(d=!1)}else u=(0,i.Tn)(o)&&"Boolean"===o.name;n[0]=u,n[1]=d,(u||(0,i.$3)(n,"default"))&&c.push(t)}}}const d=[s,c];return(0,i.Gv)(e)&&n.set(e,d),d}function Ze(e){return"$"!==e[0]&&!(0,i.SU)(e)}const et=e=>"_"===e[0]||"$stable"===e,tt=e=>(0,i.cy)(e)?e.map(sr):[sr(e)],rt=(e,t,r)=>{if(t._n)return t;const n=w(((...e)=>tt(t(...e))),r);return n._c=!1,n},nt=(e,t,r)=>{const n=e._ctx;for(const o in e){if(et(o))continue;const r=e[o];if((0,i.Tn)(r))t[o]=rt(o,r,n);else if(null!=r){0;const e=tt(r);t[o]=()=>e}}},it=(e,t)=>{const r=tt(t);e.slots.default=()=>r},ot=(e,t,r)=>{for(const n in t)(r||"_"!==n)&&(e[n]=t[n])},at=(e,t,r)=>{const n=e.slots=We();if(32&e.vnode.shapeFlag){const e=t._;e?(ot(n,t,r),r&&(0,i.yQ)(n,"_",e,!0)):nt(t,n)}else t&&it(e,t)},st=(e,t,r)=>{const{vnode:n,slots:o}=e;let a=!0,s=i.MZ;if(32&n.shapeFlag){const e=t._;e?r&&1===e?a=!1:ot(o,t,r):(a=!t.$stable,nt(t,o)),s=t}else t&&(it(e,t),s={default:1});if(a)for(const i in o)et(i)||null!=s[i]||delete o[i]};function ct(){"boolean"!==typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&((0,i.We)().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1)}const ut=Vt;function dt(e){return lt(e)}function lt(e,t){ct();const r=(0,i.We)();r.__VUE__=!0;const{insert:o,remove:a,patchProp:s,createElement:c,createText:u,createComment:d,setText:l,setElementText:p,parentNode:m,nextSibling:h,setScopeId:f=i.tE,insertStaticContent:g}=e,v=(e,t,r,n=null,i=null,o=null,a=void 0,s=null,c=!!t.dynamicChildren)=>{if(e===t)return;e&&!Jt(e,t)&&(n=Z(e),Q(e,i,o,!0),e=null),-2===t.patchFlag&&(c=!1,t.dynamicChildren=null);const{type:u,ref:d,shapeFlag:l}=t;switch(u){case Dt:M(e,t,r,n);break;case qt:I(e,t,r,n);break;case Bt:null==e&&b(t,r,n,a);break;case Ut:L(e,t,r,n,i,o,a,s,c);break;default:1&l?E(e,t,r,n,i,o,a,s,c):6&l?V(e,t,r,n,i,o,a,s,c):(64&l||128&l)&&u.process(e,t,r,n,i,o,a,s,c,re)}null!=d&&i&&H(d,e&&e.ref,o,t||e,!t)},M=(e,t,r,n)=>{if(null==e)o(t.el=u(t.children),r,n);else{const r=t.el=e.el;t.children!==e.children&&l(r,t.children)}},I=(e,t,r,n)=>{null==e?o(t.el=d(t.children||""),r,n):t.el=e.el},b=(e,t,r,n)=>{[e.el,e.anchor]=g(e.children,t,r,n,e.el,e.anchor)},C=({el:e,anchor:t},r,n)=>{let i;while(e&&e!==t)i=h(e),o(e,r,n),e=i;o(t,r,n)},_=({el:e,anchor:t})=>{let r;while(e&&e!==t)r=h(e),a(e),e=r;a(t)},E=(e,t,r,n,i,o,a,s,c)=>{"svg"===t.type?a="svg":"math"===t.type&&(a="mathml"),null==e?k(t,r,n,i,o,a,s,c):N(e,t,i,o,a,s,c)},k=(e,t,r,n,a,u,d,l)=>{let m,h;const{props:f,shapeFlag:g,transition:v,dirs:y}=e;if(m=e.el=c(e.type,u,f&&f.is,f),8&g?p(m,e.children):16&g&&R(e.children,m,null,n,a,pt(e,u),d,l),y&&A(e,null,n,"created"),w(m,e,e.scopeId,d,n),f){for(const e in f)"value"===e||(0,i.SU)(e)||s(m,e,null,f[e],u,n);"value"in f&&s(m,"value",null,f.value,u),(h=f.onVnodeBeforeMount)&&lr(h,n,e)}y&&A(e,null,n,"beforeMount");const M=ht(a,v);M&&v.beforeEnter(m),o(m,t,r),((h=f&&f.onVnodeMounted)||M||y)&&ut((()=>{h&&lr(h,n,e),M&&v.enter(m),y&&A(e,null,n,"mounted")}),a)},w=(e,t,r,n,i)=>{if(r&&f(e,r),n)for(let o=0;o<n.length;o++)f(e,n[o]);if(i){let r=i.subTree;if(t===r||Lt(r.type)&&(r.ssContent===t||r.ssFallback===t)){const t=i.vnode;w(e,t,t.scopeId,t.slotScopeIds,i.parent)}}},R=(e,t,r,n,i,o,a,s,c=0)=>{for(let u=c;u<e.length;u++){const c=e[u]=s?cr(e[u]):sr(e[u]);v(null,c,t,r,n,i,o,a,s)}},N=(e,t,r,n,o,a,c)=>{const u=t.el=e.el;let{patchFlag:d,dynamicChildren:l,dirs:m}=t;d|=16&e.patchFlag;const h=e.props||i.MZ,f=t.props||i.MZ;let g;if(r&&mt(r,!1),(g=f.onVnodeBeforeUpdate)&&lr(g,r,t,e),m&&A(t,e,r,"beforeUpdate"),r&&mt(r,!0),(h.innerHTML&&null==f.innerHTML||h.textContent&&null==f.textContent)&&p(u,""),l?O(e.dynamicChildren,l,u,r,n,pt(t,o),a):c||F(e,t,u,null,r,n,pt(t,o),a,!1),d>0){if(16&d)P(u,h,f,r,o);else if(2&d&&h.class!==f.class&&s(u,"class",null,f.class,o),4&d&&s(u,"style",h.style,f.style,o),8&d){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t],i=h[n],a=f[n];a===i&&"value"!==n||s(u,n,i,a,o,r)}}1&d&&e.children!==t.children&&p(u,t.children)}else c||null!=l||P(u,h,f,r,o);((g=f.onVnodeUpdated)||m)&&ut((()=>{g&&lr(g,r,t,e),m&&A(t,e,r,"updated")}),n)},O=(e,t,r,n,i,o,a)=>{for(let s=0;s<t.length;s++){const c=e[s],u=t[s],d=c.el&&(c.type===Ut||!Jt(c,u)||70&c.shapeFlag)?m(c.el):r;v(c,u,d,null,n,i,o,a,!0)}},P=(e,t,r,n,o)=>{if(t!==r){if(t!==i.MZ)for(const a in t)(0,i.SU)(a)||a in r||s(e,a,t[a],null,o,n);for(const a in r){if((0,i.SU)(a))continue;const c=r[a],u=t[a];c!==u&&"value"!==a&&s(e,a,u,c,o,n)}"value"in r&&s(e,"value",t.value,r.value,o)}},L=(e,t,r,n,i,a,s,c,d)=>{const l=t.el=e?e.el:u(""),p=t.anchor=e?e.anchor:u("");let{patchFlag:m,dynamicChildren:h,slotScopeIds:f}=t;f&&(c=c?c.concat(f):f),null==e?(o(l,r,n),o(p,r,n),R(t.children||[],r,p,i,a,s,c,d)):m>0&&64&m&&h&&e.dynamicChildren?(O(e.dynamicChildren,h,r,i,a,s,c),(null!=t.key||i&&t===i.subTree)&&ft(e,t,!0)):F(e,t,r,p,i,a,s,c,d)},V=(e,t,r,n,i,o,a,s,c)=>{t.slotScopeIds=s,null==e?512&t.shapeFlag?i.ctx.activate(t,r,n,a,c):U(t,r,n,i,o,a,c):D(e,t,c)},U=(e,t,r,n,i,o,a)=>{const s=e.component=hr(e,n,i);if(Y(e)&&(s.ctx.renderer=re),_r(s,!1,a),s.asyncDep){if(i&&i.registerDep(s,q,a),!e.el){const e=s.subTree=tr(qt);I(null,e,t,r)}}else q(s,e,t,r,i,o,a)},D=(e,t,r)=>{const n=t.component=e.component;if(Nt(e,t,r)){if(n.asyncDep&&!n.asyncResolved)return void B(n,t,r);n.next=t,n.update()}else t.el=e.el,n.vnode=t},q=(e,t,r,o,a,s,c)=>{const u=()=>{if(e.isMounted){let{next:t,bu:r,u:n,parent:o,vnode:d}=e;{const r=vt(e);if(r)return t&&(t.el=d.el,B(e,t,c)),void r.asyncDep.then((()=>{e.isUnmounted||u()}))}let l,p=t;0,mt(e,!1),t?(t.el=d.el,B(e,t,c)):t=d,r&&(0,i.DY)(r),(l=t.props&&t.props.onVnodeBeforeUpdate)&&lr(l,o,t,d),mt(e,!0);const h=Rt(e);0;const f=e.subTree;e.subTree=h,v(f,h,m(f.el),Z(f),e,a,s),t.el=h.el,null===p&&Pt(e,h.el),n&&ut(n,a),(l=t.props&&t.props.onVnodeUpdated)&&ut((()=>lr(l,o,t,d)),a)}else{let n;const{el:c,props:u}=t,{bm:d,m:l,parent:p,root:m,type:h}=e,f=W(t);if(mt(e,!1),d&&(0,i.DY)(d),!f&&(n=u&&u.onVnodeBeforeMount)&&lr(n,p,t),mt(e,!0),c&&ie){const t=()=>{e.subTree=Rt(e),ie(c,e.subTree,e,a,null)};f&&h.__asyncHydrate?h.__asyncHydrate(c,e,t):t()}else{m.ce&&m.ce._injectChildStyle(h);const n=e.subTree=Rt(e);0,v(null,n,r,o,e,a,s),t.el=n.el}if(l&&ut(l,a),!f&&(n=u&&u.onVnodeMounted)){const e=t;ut((()=>lr(n,p,e)),a)}(256&t.shapeFlag||p&&W(p.vnode)&&256&p.vnode.shapeFlag)&&e.a&&ut(e.a,a),e.isMounted=!0,t=r=o=null}};e.scope.on();const d=e.effect=new n.X2(u);e.scope.off();const l=e.update=d.run.bind(d),p=e.job=d.runIfDirty.bind(d);p.i=e,p.id=e.uid,d.scheduler=()=>y(p),mt(e,!0),l()},B=(e,t,r)=>{t.component=e;const i=e.vnode.props;e.vnode=t,e.next=null,Qe(e,t.props,i,r),st(e,t.children,r),(0,n.C4)(),T(e),(0,n.bl)()},F=(e,t,r,n,i,o,a,s,c=!1)=>{const u=e&&e.children,d=e?e.shapeFlag:0,l=t.children,{patchFlag:m,shapeFlag:h}=t;if(m>0){if(128&m)return void j(u,l,r,n,i,o,a,s,c);if(256&m)return void G(u,l,r,n,i,o,a,s,c)}8&h?(16&d&&X(u,i,o),l!==u&&p(r,l)):16&d?16&h?j(u,l,r,n,i,o,a,s,c):X(u,i,o,!0):(8&d&&p(r,""),16&h&&R(l,r,n,i,o,a,s,c))},G=(e,t,r,n,o,a,s,c,u)=>{e=e||i.Oj,t=t||i.Oj;const d=e.length,l=t.length,p=Math.min(d,l);let m;for(m=0;m<p;m++){const n=t[m]=u?cr(t[m]):sr(t[m]);v(e[m],n,r,null,o,a,s,c,u)}d>l?X(e,o,a,!0,!1,p):R(t,r,n,o,a,s,c,u,p)},j=(e,t,r,n,o,a,s,c,u)=>{let d=0;const l=t.length;let p=e.length-1,m=l-1;while(d<=p&&d<=m){const n=e[d],i=t[d]=u?cr(t[d]):sr(t[d]);if(!Jt(n,i))break;v(n,i,r,null,o,a,s,c,u),d++}while(d<=p&&d<=m){const n=e[p],i=t[m]=u?cr(t[m]):sr(t[m]);if(!Jt(n,i))break;v(n,i,r,null,o,a,s,c,u),p--,m--}if(d>p){if(d<=m){const e=m+1,i=e<l?t[e].el:n;while(d<=m)v(null,t[d]=u?cr(t[d]):sr(t[d]),r,i,o,a,s,c,u),d++}}else if(d>m)while(d<=p)Q(e[d],o,a,!0),d++;else{const h=d,f=d,g=new Map;for(d=f;d<=m;d++){const e=t[d]=u?cr(t[d]):sr(t[d]);null!=e.key&&g.set(e.key,d)}let y,M=0;const I=m-f+1;let T=!1,S=0;const b=new Array(I);for(d=0;d<I;d++)b[d]=0;for(d=h;d<=p;d++){const n=e[d];if(M>=I){Q(n,o,a,!0);continue}let i;if(null!=n.key)i=g.get(n.key);else for(y=f;y<=m;y++)if(0===b[y-f]&&Jt(n,t[y])){i=y;break}void 0===i?Q(n,o,a,!0):(b[i-f]=d+1,i>=S?S=i:T=!0,v(n,t[i],r,null,o,a,s,c,u),M++)}const C=T?gt(b):i.Oj;for(y=C.length-1,d=I-1;d>=0;d--){const e=f+d,i=t[e],p=e+1<l?t[e+1].el:n;0===b[d]?v(null,i,r,p,o,a,s,c,u):T&&(y<0||d!==C[y]?K(i,r,p,2):y--)}}},K=(e,t,r,n,i=null)=>{const{el:a,type:s,transition:c,children:u,shapeFlag:d}=e;if(6&d)return void K(e.component.subTree,t,r,n);if(128&d)return void e.suspense.move(t,r,n);if(64&d)return void s.move(e,t,r,re);if(s===Ut){o(a,t,r);for(let e=0;e<u.length;e++)K(u[e],t,r,n);return void o(e.anchor,t,r)}if(s===Bt)return void C(e,t,r);const l=2!==n&&1&d&&c;if(l)if(0===n)c.beforeEnter(a),o(a,t,r),ut((()=>c.enter(a)),i);else{const{leave:e,delayLeave:n,afterLeave:i}=c,s=()=>o(a,t,r),u=()=>{e(a,(()=>{s(),i&&i()}))};n?n(a,s,u):u()}else o(a,t,r)},Q=(e,t,r,n=!1,i=!1)=>{const{type:o,props:a,ref:s,children:c,dynamicChildren:u,shapeFlag:d,patchFlag:l,dirs:p,cacheIndex:m}=e;if(-2===l&&(i=!1),null!=s&&H(s,null,r,e,!0),null!=m&&(t.renderCache[m]=void 0),256&d)return void t.ctx.deactivate(e);const h=1&d&&p,f=!W(e);let g;if(f&&(g=a&&a.onVnodeBeforeUnmount)&&lr(g,t,e),6&d)J(e.component,r,n);else{if(128&d)return void e.suspense.unmount(r,n);h&&A(e,null,t,"beforeUnmount"),64&d?e.type.remove(e,t,r,re,n):u&&!u.hasOnce&&(o!==Ut||l>0&&64&l)?X(u,t,r,!1,!0):(o===Ut&&384&l||!i&&16&d)&&X(c,t,r),n&&$(e)}(f&&(g=a&&a.onVnodeUnmounted)||h)&&ut((()=>{g&&lr(g,t,e),h&&A(e,null,t,"unmounted")}),r)},$=e=>{const{type:t,el:r,anchor:n,transition:i}=e;if(t===Ut)return void z(r,n);if(t===Bt)return void _(e);const o=()=>{a(r),i&&!i.persisted&&i.afterLeave&&i.afterLeave()};if(1&e.shapeFlag&&i&&!i.persisted){const{leave:t,delayLeave:n}=i,a=()=>t(r,o);n?n(e.el,o,a):a()}else o()},z=(e,t)=>{let r;while(e!==t)r=h(e),a(e),e=r;a(t)},J=(e,t,r)=>{const{bum:n,scope:o,job:a,subTree:s,um:c,m:u,a:d}=e;yt(u),yt(d),n&&(0,i.DY)(n),o.stop(),a&&(a.flags|=8,Q(s,e,t,r)),c&&ut(c,t),ut((()=>{e.isUnmounted=!0}),t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},X=(e,t,r,n=!1,i=!1,o=0)=>{for(let a=o;a<e.length;a++)Q(e[a],t,r,n,i)},Z=e=>{if(6&e.shapeFlag)return Z(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=h(e.anchor||e.el),r=t&&t[x];return r?h(r):t};let ee=!1;const te=(e,t,r)=>{null==e?t._vnode&&Q(t._vnode,null,null,!0):v(t._vnode||null,e,t,null,null,null,r),t._vnode=e,ee||(ee=!0,T(),S(),ee=!1)},re={p:v,um:Q,m:K,r:$,mt:U,mc:R,pc:F,pbc:O,n:Z,o:e};let ne,ie;return t&&([ne,ie]=t(re)),{render:te,hydrate:ne,createApp:Be(te,ne)}}function pt({type:e,props:t},r){return"svg"===r&&"foreignObject"===e||"mathml"===r&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:r}function mt({effect:e,job:t},r){r?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function ht(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function ft(e,t,r=!1){const n=e.children,o=t.children;if((0,i.cy)(n)&&(0,i.cy)(o))for(let i=0;i<n.length;i++){const e=n[i];let t=o[i];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=o[i]=cr(o[i]),t.el=e.el),r||-2===t.patchFlag||ft(e,t)),t.type===Dt&&(t.el=e.el)}}function gt(e){const t=e.slice(),r=[0];let n,i,o,a,s;const c=e.length;for(n=0;n<c;n++){const c=e[n];if(0!==c){if(i=r[r.length-1],e[i]<c){t[n]=i,r.push(n);continue}o=0,a=r.length-1;while(o<a)s=o+a>>1,e[r[s]]<c?o=s+1:a=s;c<e[r[o]]&&(o>0&&(t[n]=r[o-1]),r[o]=n)}}o=r.length,a=r[o-1];while(o-- >0)r[o]=a,a=t[a];return r}function vt(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:vt(t)}function yt(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const Mt=Symbol.for("v-scx"),It=()=>{{const e=je(Mt);return e}};function Tt(e,t,r){return St(e,t,r)}function St(e,t,r=i.MZ){const{immediate:o,deep:s,flush:c,once:u}=r;const d=(0,i.X$)({},r);const l=t&&o||!t&&"post"!==c;let p;if(Cr)if("sync"===c){const e=It();p=e.__watcherHandles||(e.__watcherHandles=[])}else if(!l){const e=()=>{};return e.stop=i.tE,e.resume=i.tE,e.pause=i.tE,e}const m=fr;d.call=(e,t,r)=>a(e,m,t,r);let h=!1;"post"===c?d.scheduler=e=>{ut(e,m&&m.suspense)}:"sync"!==c&&(h=!0,d.scheduler=(e,t)=>{t?e():y(e)}),d.augmentJob=e=>{t&&(e.flags|=4),h&&(e.flags|=2,m&&(e.id=m.uid,e.i=m))};const f=(0,n.wB)(e,t,d);return Cr&&(p?p.push(f):l&&f()),f}function bt(e,t,r){const n=this.proxy,o=(0,i.Kg)(e)?e.includes(".")?Ct(n,e):()=>n[e]:e.bind(n,n);let a;(0,i.Tn)(t)?a=t:(a=t.handler,r=t);const s=Mr(this),c=St(o,a.bind(n),r);return s(),c}function Ct(e,t){const r=t.split(".");return()=>{let t=e;for(let e=0;e<r.length&&t;e++)t=t[r[e]];return t}}const _t=(e,t)=>"modelValue"===t||"model-value"===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${(0,i.PT)(t)}Modifiers`]||e[`${(0,i.Tg)(t)}Modifiers`];function Et(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||i.MZ;let o=r;const s=t.startsWith("update:"),c=s&&_t(n,t.slice(7));let u;c&&(c.trim&&(o=r.map((e=>(0,i.Kg)(e)?e.trim():e))),c.number&&(o=r.map(i.bB)));let d=n[u=(0,i.rU)(t)]||n[u=(0,i.rU)((0,i.PT)(t))];!d&&s&&(d=n[u=(0,i.rU)((0,i.Tg)(t))]),d&&a(d,e,6,o);const l=n[u+"Once"];if(l){if(e.emitted){if(e.emitted[u])return}else e.emitted={};e.emitted[u]=!0,a(l,e,6,o)}}function kt(e,t,r=!1){const n=t.emitsCache,o=n.get(e);if(void 0!==o)return o;const a=e.emits;let s={},c=!1;if(!(0,i.Tn)(e)){const n=e=>{const r=kt(e,t,!0);r&&(c=!0,(0,i.X$)(s,r))};!r&&t.mixins.length&&t.mixins.forEach(n),e.extends&&n(e.extends),e.mixins&&e.mixins.forEach(n)}return a||c?((0,i.cy)(a)?a.forEach((e=>s[e]=null)):(0,i.X$)(s,a),(0,i.Gv)(e)&&n.set(e,s),s):((0,i.Gv)(e)&&n.set(e,null),null)}function wt(e,t){return!(!e||!(0,i.Mp)(t))&&(t=t.slice(2).replace(/Once$/,""),(0,i.$3)(e,t[0].toLowerCase()+t.slice(1))||(0,i.$3)(e,(0,i.Tg)(t))||(0,i.$3)(e,t))}function Rt(e){const{type:t,vnode:r,proxy:n,withProxy:o,propsOptions:[a],slots:c,attrs:u,emit:d,render:l,renderCache:p,props:m,data:h,setupState:f,ctx:g,inheritAttrs:v}=e,y=k(e);let M,I;try{if(4&r.shapeFlag){const e=o||n,t=e;M=sr(l.call(t,e,p,m,f,h,g)),I=u}else{const e=t;0,M=sr(e.length>1?e(m,{attrs:u,slots:c,emit:d}):e(m,null)),I=t.props?u:At(u)}}catch(S){Ft.length=0,s(S,e,1),M=tr(qt)}let T=M;if(I&&!1!==v){const e=Object.keys(I),{shapeFlag:t}=T;e.length&&7&t&&(a&&e.some(i.CP)&&(I=xt(I,a)),T=ir(T,I,!1,!0))}return r.dirs&&(T=ir(T,null,!1,!0),T.dirs=T.dirs?T.dirs.concat(r.dirs):r.dirs),r.transition&&B(T,r.transition),M=T,k(y),M}const At=e=>{let t;for(const r in e)("class"===r||"style"===r||(0,i.Mp)(r))&&((t||(t={}))[r]=e[r]);return t},xt=(e,t)=>{const r={};for(const n in e)(0,i.CP)(n)&&n.slice(9)in t||(r[n]=e[n]);return r};function Nt(e,t,r){const{props:n,children:i,component:o}=e,{props:a,children:s,patchFlag:c}=t,u=o.emitsOptions;if(t.dirs||t.transition)return!0;if(!(r&&c>=0))return!(!i&&!s||s&&s.$stable)||n!==a&&(n?!a||Ot(n,a,u):!!a);if(1024&c)return!0;if(16&c)return n?Ot(n,a,u):!!a;if(8&c){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const r=e[t];if(a[r]!==n[r]&&!wt(u,r))return!0}}return!1}function Ot(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const o=n[i];if(t[o]!==e[o]&&!wt(r,o))return!0}return!1}function Pt({vnode:e,parent:t},r){while(t){const n=t.subTree;if(n.suspense&&n.suspense.activeBranch===e&&(n.el=e.el),n!==e)break;(e=t.vnode).el=r,t=t.parent}}const Lt=e=>e.__isSuspense;function Vt(e,t){t&&t.pendingBranch?(0,i.cy)(e)?t.effects.push(...e):t.effects.push(e):I(e)}const Ut=Symbol.for("v-fgt"),Dt=Symbol.for("v-txt"),qt=Symbol.for("v-cmt"),Bt=Symbol.for("v-stc"),Ft=[];let Gt=null;function jt(e=!1){Ft.push(Gt=e?null:[])}function Ht(){Ft.pop(),Gt=Ft[Ft.length-1]||null}let Wt=1;function Yt(e,t=!1){Wt+=e,e<0&&Gt&&t&&(Gt.hasOnce=!0)}function Kt(e){return e.dynamicChildren=Wt>0?Gt||i.Oj:null,Ht(),Wt>0&&Gt&&Gt.push(e),e}function Qt(e,t,r,n,i,o){return Kt(er(e,t,r,n,i,o,!0))}function $t(e,t,r,n,i){return Kt(tr(e,t,r,n,i,!0))}function zt(e){return!!e&&!0===e.__v_isVNode}function Jt(e,t){return e.type===t.type&&e.key===t.key}const Xt=({key:e})=>null!=e?e:null,Zt=({ref:e,ref_key:t,ref_for:r})=>("number"===typeof e&&(e=""+e),null!=e?(0,i.Kg)(e)||(0,n.i9)(e)||(0,i.Tn)(e)?{i:_,r:e,k:t,f:!!r}:e:null);function er(e,t=null,r=null,n=0,o=null,a=(e===Ut?0:1),s=!1,c=!1){const u={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Xt(t),ref:t&&Zt(t),scopeId:E,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:_};return c?(ur(u,r),128&a&&e.normalize(u)):r&&(u.shapeFlag|=(0,i.Kg)(r)?8:16),Wt>0&&!s&&Gt&&(u.patchFlag>0||6&a)&&32!==u.patchFlag&&Gt.push(u),u}const tr=rr;function rr(e,t=null,r=null,o=0,a=null,s=!1){if(e&&e!==he||(e=qt),zt(e)){const n=ir(e,t,!0);return r&&ur(n,r),Wt>0&&!s&&Gt&&(6&n.shapeFlag?Gt[Gt.indexOf(e)]=n:Gt.push(n)),n.patchFlag=-2,n}if(Or(e)&&(e=e.__vccOpts),t){t=nr(t);let{class:e,style:r}=t;e&&!(0,i.Kg)(e)&&(t.class=(0,i.C4)(e)),(0,i.Gv)(r)&&((0,n.ju)(r)&&!(0,i.cy)(r)&&(r=(0,i.X$)({},r)),t.style=(0,i.Tr)(r))}const c=(0,i.Kg)(e)?1:Lt(e)?128:N(e)?64:(0,i.Gv)(e)?4:(0,i.Tn)(e)?2:0;return er(e,t,r,o,a,c,s,!0)}function nr(e){return e?(0,n.ju)(e)||Ye(e)?(0,i.X$)({},e):e:null}function ir(e,t,r=!1,n=!1){const{props:o,ref:a,patchFlag:s,children:c,transition:u}=e,d=t?dr(o||{},t):o,l={__v_isVNode:!0,__v_skip:!0,type:e.type,props:d,key:d&&Xt(d),ref:t&&t.ref?r&&a?(0,i.cy)(a)?a.concat(Zt(t)):[a,Zt(t)]:Zt(t):a,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:c,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ut?-1===s?16:16|s:s,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:u,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ir(e.ssContent),ssFallback:e.ssFallback&&ir(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return u&&n&&B(l,u.clone(l)),l}function or(e=" ",t=0){return tr(Dt,null,e,t)}function ar(e="",t=!1){return t?(jt(),$t(qt,null,e)):tr(qt,null,e)}function sr(e){return null==e||"boolean"===typeof e?tr(qt):(0,i.cy)(e)?tr(Ut,null,e.slice()):zt(e)?cr(e):tr(Dt,null,String(e))}function cr(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:ir(e)}function ur(e,t){let r=0;const{shapeFlag:n}=e;if(null==t)t=null;else if((0,i.cy)(t))r=16;else if("object"===typeof t){if(65&n){const r=t.default;return void(r&&(r._c&&(r._d=!1),ur(e,r()),r._c&&(r._d=!0)))}{r=32;const n=t._;n||Ye(t)?3===n&&_&&(1===_.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=_}}else(0,i.Tn)(t)?(t={default:t,_ctx:_},r=32):(t=String(t),64&n?(r=16,t=[or(t)]):r=8);e.children=t,e.shapeFlag|=r}function dr(...e){const t={};for(let r=0;r<e.length;r++){const n=e[r];for(const e in n)if("class"===e)t.class!==n.class&&(t.class=(0,i.C4)([t.class,n.class]));else if("style"===e)t.style=(0,i.Tr)([t.style,n.style]);else if((0,i.Mp)(e)){const r=t[e],o=n[e];!o||r===o||(0,i.cy)(r)&&r.includes(o)||(t[e]=r?[].concat(r,o):o)}else""!==e&&(t[e]=n[e])}return t}function lr(e,t,r,n=null){a(e,t,7,[r,n])}const pr=De();let mr=0;function hr(e,t,r){const o=e.type,a=(t?t.appContext:e.appContext)||pr,s={uid:mr++,vnode:e,type:o,parent:t,appContext:a,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new n.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(a.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Xe(o,a),emitsOptions:kt(o,a),emit:null,emitted:null,propsDefaults:i.MZ,inheritAttrs:o.inheritAttrs,ctx:i.MZ,data:i.MZ,props:i.MZ,attrs:i.MZ,slots:i.MZ,refs:i.MZ,setupState:i.MZ,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=t?t.root:s,s.emit=Et.bind(null,s),e.ce&&e.ce(s),s}let fr=null;const gr=()=>fr||_;let vr,yr;{const e=(0,i.We)(),t=(t,r)=>{let n;return(n=e[t])||(n=e[t]=[]),n.push(r),e=>{n.length>1?n.forEach((t=>t(e))):n[0](e)}};vr=t("__VUE_INSTANCE_SETTERS__",(e=>fr=e)),yr=t("__VUE_SSR_SETTERS__",(e=>Cr=e))}const Mr=e=>{const t=fr;return vr(e),e.scope.on(),()=>{e.scope.off(),vr(t)}},Ir=()=>{fr&&fr.scope.off(),vr(null)};function Tr(e){return 4&e.vnode.shapeFlag}let Sr,br,Cr=!1;function _r(e,t=!1,r=!1){t&&yr(t);const{props:n,children:i}=e.vnode,o=Tr(e);Ke(e,n,o,t),at(e,i,r);const a=o?Er(e,t):void 0;return t&&yr(!1),a}function Er(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Te);const{setup:a}=r;if(a){(0,n.C4)();const r=e.setupContext=a.length>1?Ar(e):null,c=Mr(e),u=o(a,e,0,[e.props,r]),d=(0,i.yL)(u);if((0,n.bl)(),c(),!d&&!e.sp||W(e)||j(e),d){if(u.then(Ir,Ir),t)return u.then((r=>{kr(e,r,t)})).catch((t=>{s(t,e,0)}));e.asyncDep=u}else kr(e,u,t)}else wr(e,t)}function kr(e,t,r){(0,i.Tn)(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:(0,i.Gv)(t)&&(e.setupState=(0,n.Pr)(t)),wr(e,r)}function wr(e,t,r){const o=e.type;if(!e.render){if(!t&&Sr&&!o.render){const t=o.template||we(e).template;if(t){0;const{isCustomElement:r,compilerOptions:n}=e.appContext.config,{delimiters:a,compilerOptions:s}=o,c=(0,i.X$)((0,i.X$)({isCustomElement:r,delimiters:a},n),s);o.render=Sr(t,c)}}e.render=o.render||i.tE,br&&br(e)}{const t=Mr(e);(0,n.C4)();try{Ce(e)}finally{(0,n.bl)(),t()}}}const Rr={get(e,t){return(0,n.u4)(e,"get",""),e[t]}};function Ar(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,Rr),slots:e.slots,emit:e.emit,expose:t}}function xr(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy((0,n.Pr)((0,n.IG)(e.exposed)),{get(t,r){return r in t?t[r]:r in Me?Me[r](e):void 0},has(e,t){return t in e||t in Me}})):e.proxy}function Nr(e,t=!0){return(0,i.Tn)(e)?e.displayName||e.name:e.name||t&&e.__name}function Or(e){return(0,i.Tn)(e)&&"__vccOpts"in e}const Pr=(e,t)=>{const r=(0,n.EW)(e,t,Cr);return r};function Lr(e,t,r){const n=arguments.length;return 2===n?(0,i.Gv)(t)&&!(0,i.cy)(t)?zt(t)?tr(e,null,[t]):tr(e,t):tr(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):3===n&&zt(r)&&(r=[r]),tr(e,t,r))}const Vr="3.5.13"},679:function(e,t,r){"use strict";var n=r(1625),i=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new i("Incorrect invocation")}},713:function(e,t,r){"use strict";var n=r(9565),i=r(9306),o=r(8551),a=r(1767),s=r(9462),c=r(6319),u=s((function(){var e=this.iterator,t=o(n(this.next,e)),r=this.done=!!t.done;if(!r)return c(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return o(this),i(e),new u(a(this),{mapper:e})}},741:function(e){"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},757:function(e,t,r){"use strict";var n=r(7751),i=r(4901),o=r(1625),a=r(7040),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return i(t)&&o(t.prototype,s(e))}},953:function(e,t,r){"use strict";r.d(t,{C4:function(){return _},EW:function(){return De},Gc:function(){return ye},IG:function(){return Ee},IJ:function(){return xe},KR:function(){return Ae},Kh:function(){return ve},Pr:function(){return Ve},R1:function(){return Pe},X2:function(){return d},bl:function(){return E},fE:function(){return be},g8:function(){return Te},hV:function(){return He},hZ:function(){return U},i9:function(){return Re},ju:function(){return Ce},lJ:function(){return ke},qA:function(){return q},u4:function(){return V},uY:function(){return s},ux:function(){return _e},wB:function(){return je},yC:function(){return a}});var n=r(33);
/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let i,o;class a{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=i,!e&&i&&(this.index=(i.scopes||(i.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=i;try{return i=this,e()}finally{i=t}}else 0}on(){i=this}off(){i=this.parent}stop(e){if(this._active){let t,r;for(this._active=!1,t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}function s(e){return new a(e)}function c(){return i}const u=new WeakSet;class d{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,i&&i.active&&i.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,u.has(this)&&(u.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||h(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,k(this),v(this);const e=o,t=b;o=this,b=!0;try{return this.fn()}finally{0,y(this),o=e,b=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)T(e);this.deps=this.depsTail=void 0,k(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?u.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){M(this)&&this.run()}get dirty(){return M(this)}}let l,p,m=0;function h(e,t=!1){if(e.flags|=8,t)return e.next=p,void(p=e);e.next=l,l=e}function f(){m++}function g(){if(--m>0)return;if(p){let e=p;p=void 0;while(e){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;while(l){let r=l;l=void 0;while(r){const n=r.next;if(r.next=void 0,r.flags&=-9,1&r.flags)try{r.trigger()}catch(t){e||(e=t)}r=n}}if(e)throw e}function v(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function y(e){let t,r=e.depsTail,n=r;while(n){const e=n.prevDep;-1===n.version?(n===r&&(r=e),T(n),S(n)):t=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=e}e.deps=t,e.depsTail=r}function M(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(I(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function I(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===w)return;e.globalVersion=w;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!M(e))return void(e.flags&=-3);const r=o,i=b;o=e,b=!0;try{v(e);const r=e.fn(e._value);(0===t.version||(0,n.$H)(r,e._value))&&(e._value=r,t.version++)}catch(a){throw t.version++,a}finally{o=r,b=i,y(e),e.flags&=-3}}function T(e,t=!1){const{dep:r,prevSub:n,nextSub:i}=e;if(n&&(n.nextSub=i,e.prevSub=void 0),i&&(i.prevSub=n,e.nextSub=void 0),r.subs===e&&(r.subs=n,!n&&r.computed)){r.computed.flags&=-5;for(let e=r.computed.deps;e;e=e.nextDep)T(e,!0)}t||--r.sc||!r.map||r.map.delete(r.key)}function S(e){const{prevDep:t,nextDep:r}=e;t&&(t.nextDep=r,e.prevDep=void 0),r&&(r.prevDep=t,e.nextDep=void 0)}let b=!0;const C=[];function _(){C.push(b),b=!1}function E(){const e=C.pop();b=void 0===e||e}function k(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=o;o=void 0;try{t()}finally{o=e}}}let w=0;class R{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class A{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!o||!b||o===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==o)t=this.activeLink=new R(o,this),o.deps?(t.prevDep=o.depsTail,o.depsTail.nextDep=t,o.depsTail=t):o.deps=o.depsTail=t,x(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=o.depsTail,t.nextDep=void 0,o.depsTail.nextDep=t,o.depsTail=t,o.deps===t&&(o.deps=e)}return t}trigger(e){this.version++,w++,this.notify(e)}notify(e){f();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{g()}}}function x(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)x(e)}const r=e.dep.subs;r!==e&&(e.prevSub=r,r&&(r.nextSub=e)),e.dep.subs=e}}const N=new WeakMap,O=Symbol(""),P=Symbol(""),L=Symbol("");function V(e,t,r){if(b&&o){let t=N.get(e);t||N.set(e,t=new Map);let n=t.get(r);n||(t.set(r,n=new A),n.map=t,n.key=r),n.track()}}function U(e,t,r,i,o,a){const s=N.get(e);if(!s)return void w++;const c=e=>{e&&e.trigger()};if(f(),"clear"===t)s.forEach(c);else{const o=(0,n.cy)(e),a=o&&(0,n.yI)(r);if(o&&"length"===r){const e=Number(i);s.forEach(((t,r)=>{("length"===r||r===L||!(0,n.Bm)(r)&&r>=e)&&c(t)}))}else switch((void 0!==r||s.has(void 0))&&c(s.get(r)),a&&c(s.get(L)),t){case"add":o?a&&c(s.get("length")):(c(s.get(O)),(0,n.CE)(e)&&c(s.get(P)));break;case"delete":o||(c(s.get(O)),(0,n.CE)(e)&&c(s.get(P)));break;case"set":(0,n.CE)(e)&&c(s.get(O));break}}g()}function D(e){const t=_e(e);return t===e?t:(V(t,"iterate",L),be(e)?t:t.map(ke))}function q(e){return V(e=_e(e),"iterate",L),e}const B={__proto__:null,[Symbol.iterator](){return F(this,Symbol.iterator,ke)},concat(...e){return D(this).concat(...e.map((e=>(0,n.cy)(e)?D(e):e)))},entries(){return F(this,"entries",(e=>(e[1]=ke(e[1]),e)))},every(e,t){return j(this,"every",e,t,void 0,arguments)},filter(e,t){return j(this,"filter",e,t,(e=>e.map(ke)),arguments)},find(e,t){return j(this,"find",e,t,ke,arguments)},findIndex(e,t){return j(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return j(this,"findLast",e,t,ke,arguments)},findLastIndex(e,t){return j(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return j(this,"forEach",e,t,void 0,arguments)},includes(...e){return W(this,"includes",e)},indexOf(...e){return W(this,"indexOf",e)},join(e){return D(this).join(e)},lastIndexOf(...e){return W(this,"lastIndexOf",e)},map(e,t){return j(this,"map",e,t,void 0,arguments)},pop(){return Y(this,"pop")},push(...e){return Y(this,"push",e)},reduce(e,...t){return H(this,"reduce",e,t)},reduceRight(e,...t){return H(this,"reduceRight",e,t)},shift(){return Y(this,"shift")},some(e,t){return j(this,"some",e,t,void 0,arguments)},splice(...e){return Y(this,"splice",e)},toReversed(){return D(this).toReversed()},toSorted(e){return D(this).toSorted(e)},toSpliced(...e){return D(this).toSpliced(...e)},unshift(...e){return Y(this,"unshift",e)},values(){return F(this,"values",ke)}};function F(e,t,r){const n=q(e),i=n[t]();return n===e||be(e)||(i._next=i.next,i.next=()=>{const e=i._next();return e.value&&(e.value=r(e.value)),e}),i}const G=Array.prototype;function j(e,t,r,n,i,o){const a=q(e),s=a!==e&&!be(e),c=a[t];if(c!==G[t]){const t=c.apply(e,o);return s?ke(t):t}let u=r;a!==e&&(s?u=function(t,n){return r.call(this,ke(t),n,e)}:r.length>2&&(u=function(t,n){return r.call(this,t,n,e)}));const d=c.call(a,u,n);return s&&i?i(d):d}function H(e,t,r,n){const i=q(e);let o=r;return i!==e&&(be(e)?r.length>3&&(o=function(t,n,i){return r.call(this,t,n,i,e)}):o=function(t,n,i){return r.call(this,t,ke(n),i,e)}),i[t](o,...n)}function W(e,t,r){const n=_e(e);V(n,"iterate",L);const i=n[t](...r);return-1!==i&&!1!==i||!Ce(r[0])?i:(r[0]=_e(r[0]),n[t](...r))}function Y(e,t,r=[]){_(),f();const n=_e(e)[t].apply(e,r);return g(),E(),n}const K=(0,n.pD)("__proto__,__v_isRef,__isVue"),Q=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(n.Bm));function $(e){(0,n.Bm)(e)||(e=String(e));const t=_e(this);return V(t,"has",e),t.hasOwnProperty(e)}class z{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if("__v_skip"===t)return e["__v_skip"];const i=this._isReadonly,o=this._isShallow;if("__v_isReactive"===t)return!i;if("__v_isReadonly"===t)return i;if("__v_isShallow"===t)return o;if("__v_raw"===t)return r===(i?o?he:me:o?pe:le).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const a=(0,n.cy)(e);if(!i){let e;if(a&&(e=B[t]))return e;if("hasOwnProperty"===t)return $}const s=Reflect.get(e,t,Re(e)?e:r);return((0,n.Bm)(t)?Q.has(t):K(t))?s:(i||V(e,"get",t),o?s:Re(s)?a&&(0,n.yI)(t)?s:s.value:(0,n.Gv)(s)?i?Me(s):ve(s):s)}}class J extends z{constructor(e=!1){super(!1,e)}set(e,t,r,i){let o=e[t];if(!this._isShallow){const t=Se(o);if(be(r)||Se(r)||(o=_e(o),r=_e(r)),!(0,n.cy)(e)&&Re(o)&&!Re(r))return!t&&(o.value=r,!0)}const a=(0,n.cy)(e)&&(0,n.yI)(t)?Number(t)<e.length:(0,n.$3)(e,t),s=Reflect.set(e,t,r,Re(e)?e:i);return e===_e(i)&&(a?(0,n.$H)(r,o)&&U(e,"set",t,r,o):U(e,"add",t,r)),s}deleteProperty(e,t){const r=(0,n.$3)(e,t),i=e[t],o=Reflect.deleteProperty(e,t);return o&&r&&U(e,"delete",t,void 0,i),o}has(e,t){const r=Reflect.has(e,t);return(0,n.Bm)(t)&&Q.has(t)||V(e,"has",t),r}ownKeys(e){return V(e,"iterate",(0,n.cy)(e)?"length":O),Reflect.ownKeys(e)}}class X extends z{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const Z=new J,ee=new X,te=new J(!0),re=e=>e,ne=e=>Reflect.getPrototypeOf(e);function ie(e,t,r){return function(...i){const o=this["__v_raw"],a=_e(o),s=(0,n.CE)(a),c="entries"===e||e===Symbol.iterator&&s,u="keys"===e&&s,d=o[e](...i),l=r?re:t?we:ke;return!t&&V(a,"iterate",u?P:O),{next(){const{value:e,done:t}=d.next();return t?{value:e,done:t}:{value:c?[l(e[0]),l(e[1])]:l(e),done:t}},[Symbol.iterator](){return this}}}}function oe(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function ae(e,t){const r={get(r){const i=this["__v_raw"],o=_e(i),a=_e(r);e||((0,n.$H)(r,a)&&V(o,"get",r),V(o,"get",a));const{has:s}=ne(o),c=t?re:e?we:ke;return s.call(o,r)?c(i.get(r)):s.call(o,a)?c(i.get(a)):void(i!==o&&i.get(r))},get size(){const t=this["__v_raw"];return!e&&V(_e(t),"iterate",O),Reflect.get(t,"size",t)},has(t){const r=this["__v_raw"],i=_e(r),o=_e(t);return e||((0,n.$H)(t,o)&&V(i,"has",t),V(i,"has",o)),t===o?r.has(t):r.has(t)||r.has(o)},forEach(r,n){const i=this,o=i["__v_raw"],a=_e(o),s=t?re:e?we:ke;return!e&&V(a,"iterate",O),o.forEach(((e,t)=>r.call(n,s(e),s(t),i)))}};(0,n.X$)(r,e?{add:oe("add"),set:oe("set"),delete:oe("delete"),clear:oe("clear")}:{add(e){t||be(e)||Se(e)||(e=_e(e));const r=_e(this),n=ne(r),i=n.has.call(r,e);return i||(r.add(e),U(r,"add",e,e)),this},set(e,r){t||be(r)||Se(r)||(r=_e(r));const i=_e(this),{has:o,get:a}=ne(i);let s=o.call(i,e);s||(e=_e(e),s=o.call(i,e));const c=a.call(i,e);return i.set(e,r),s?(0,n.$H)(r,c)&&U(i,"set",e,r,c):U(i,"add",e,r),this},delete(e){const t=_e(this),{has:r,get:n}=ne(t);let i=r.call(t,e);i||(e=_e(e),i=r.call(t,e));const o=n?n.call(t,e):void 0,a=t.delete(e);return i&&U(t,"delete",e,void 0,o),a},clear(){const e=_e(this),t=0!==e.size,r=void 0,n=e.clear();return t&&U(e,"clear",void 0,void 0,r),n}});const i=["keys","values","entries",Symbol.iterator];return i.forEach((n=>{r[n]=ie(n,e,t)})),r}function se(e,t){const r=ae(e,t);return(t,i,o)=>"__v_isReactive"===i?!e:"__v_isReadonly"===i?e:"__v_raw"===i?t:Reflect.get((0,n.$3)(r,i)&&i in t?r:t,i,o)}const ce={get:se(!1,!1)},ue={get:se(!1,!0)},de={get:se(!0,!1)};const le=new WeakMap,pe=new WeakMap,me=new WeakMap,he=new WeakMap;function fe(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ge(e){return e["__v_skip"]||!Object.isExtensible(e)?0:fe((0,n.Zf)(e))}function ve(e){return Se(e)?e:Ie(e,!1,Z,ce,le)}function ye(e){return Ie(e,!1,te,ue,pe)}function Me(e){return Ie(e,!0,ee,de,me)}function Ie(e,t,r,i,o){if(!(0,n.Gv)(e))return e;if(e["__v_raw"]&&(!t||!e["__v_isReactive"]))return e;const a=o.get(e);if(a)return a;const s=ge(e);if(0===s)return e;const c=new Proxy(e,2===s?i:r);return o.set(e,c),c}function Te(e){return Se(e)?Te(e["__v_raw"]):!(!e||!e["__v_isReactive"])}function Se(e){return!(!e||!e["__v_isReadonly"])}function be(e){return!(!e||!e["__v_isShallow"])}function Ce(e){return!!e&&!!e["__v_raw"]}function _e(e){const t=e&&e["__v_raw"];return t?_e(t):e}function Ee(e){return!(0,n.$3)(e,"__v_skip")&&Object.isExtensible(e)&&(0,n.yQ)(e,"__v_skip",!0),e}const ke=e=>(0,n.Gv)(e)?ve(e):e,we=e=>(0,n.Gv)(e)?Me(e):e;function Re(e){return!!e&&!0===e["__v_isRef"]}function Ae(e){return Ne(e,!1)}function xe(e){return Ne(e,!0)}function Ne(e,t){return Re(e)?e:new Oe(e,t)}class Oe{constructor(e,t){this.dep=new A,this["__v_isRef"]=!0,this["__v_isShallow"]=!1,this._rawValue=t?e:_e(e),this._value=t?e:ke(e),this["__v_isShallow"]=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this["__v_isShallow"]||be(e)||Se(e);e=r?e:_e(e),(0,n.$H)(e,t)&&(this._rawValue=e,this._value=r?e:ke(e),this.dep.trigger())}}function Pe(e){return Re(e)?e.value:e}const Le={get:(e,t,r)=>"__v_raw"===t?e:Pe(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return Re(i)&&!Re(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function Ve(e){return Te(e)?e:new Proxy(e,Le)}class Ue{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new A(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=w-1,this.next=void 0,this.effect=this,this["__v_isReadonly"]=!t,this.isSSR=r}notify(){if(this.flags|=16,!(8&this.flags||o===this))return h(this,!0),!0}get value(){const e=this.dep.track();return I(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function De(e,t,r=!1){let i,o;(0,n.Tn)(e)?i=e:(i=e.get,o=e.set);const a=new Ue(i,o,r);return a}const qe={},Be=new WeakMap;let Fe;function Ge(e,t=!1,r=Fe){if(r){let t=Be.get(r);t||Be.set(r,t=[]),t.push(e)}else 0}function je(e,t,r=n.MZ){const{immediate:i,deep:o,once:a,scheduler:s,augmentJob:u,call:l}=r,p=e=>o?e:be(e)||!1===o||0===o?He(e,1):He(e);let m,h,f,g,v=!1,y=!1;if(Re(e)?(h=()=>e.value,v=be(e)):Te(e)?(h=()=>p(e),v=!0):(0,n.cy)(e)?(y=!0,v=e.some((e=>Te(e)||be(e))),h=()=>e.map((e=>Re(e)?e.value:Te(e)?p(e):(0,n.Tn)(e)?l?l(e,2):e():void 0))):h=(0,n.Tn)(e)?t?l?()=>l(e,2):e:()=>{if(f){_();try{f()}finally{E()}}const t=Fe;Fe=m;try{return l?l(e,3,[g]):e(g)}finally{Fe=t}}:n.tE,t&&o){const e=h,t=!0===o?1/0:o;h=()=>He(e(),t)}const M=c(),I=()=>{m.stop(),M&&M.active&&(0,n.TF)(M.effects,m)};if(a&&t){const e=t;t=(...t)=>{e(...t),I()}}let T=y?new Array(e.length).fill(qe):qe;const S=e=>{if(1&m.flags&&(m.dirty||e))if(t){const e=m.run();if(o||v||(y?e.some(((e,t)=>(0,n.$H)(e,T[t]))):(0,n.$H)(e,T))){f&&f();const r=Fe;Fe=m;try{const r=[e,T===qe?void 0:y&&T[0]===qe?[]:T,g];l?l(t,3,r):t(...r),T=e}finally{Fe=r}}}else m.run()};return u&&u(S),m=new d(h),m.scheduler=s?()=>s(S,!1):S,g=e=>Ge(e,!1,m),f=m.onStop=()=>{const e=Be.get(m);if(e){if(l)l(e,4);else for(const t of e)t();Be.delete(m)}},t?i?S(!0):T=m.run():s?s(S.bind(null,!0),!0):m.run(),I.pause=m.pause.bind(m),I.resume=m.resume.bind(m),I.stop=I,I}function He(e,t=1/0,r){if(t<=0||!(0,n.Gv)(e)||e["__v_skip"])return e;if(r=r||new Set,r.has(e))return e;if(r.add(e),t--,Re(e))He(e.value,t,r);else if((0,n.cy)(e))for(let n=0;n<e.length;n++)He(e[n],t,r);else if((0,n.vM)(e)||(0,n.CE)(e))e.forEach((e=>{He(e,t,r)}));else if((0,n.Qd)(e)){for(const n in e)He(e[n],t,r);for(const n of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,n)&&He(e[n],t,r)}return e}},1072:function(e,t,r){"use strict";var n=r(1828),i=r(8727);e.exports=Object.keys||function(e){return n(e,i)}},1181:function(e,t,r){"use strict";var n,i,o,a=r(8622),s=r(4576),c=r(34),u=r(6699),d=r(9297),l=r(7629),p=r(6119),m=r(421),h="Object already initialized",f=s.TypeError,g=s.WeakMap,v=function(e){return o(e)?i(e):n(e,{})},y=function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw new f("Incompatible receiver, "+e+" required");return r}};if(a||l.state){var M=l.state||(l.state=new g);M.get=M.get,M.has=M.has,M.set=M.set,n=function(e,t){if(M.has(e))throw new f(h);return t.facade=e,M.set(e,t),t},i=function(e){return M.get(e)||{}},o=function(e){return M.has(e)}}else{var I=p("state");m[I]=!0,n=function(e,t){if(d(e,I))throw new f(h);return t.facade=e,u(e,I,t),t},i=function(e){return d(e,I)?e[I]:{}},o=function(e){return d(e,I)}}e.exports={set:n,get:i,has:o,enforce:v,getterFor:y}},1291:function(e,t,r){"use strict";var n=r(741);e.exports=function(e){var t=+e;return t!==t||0===t?0:n(t)}},1625:function(e,t,r){"use strict";var n=r(9504);e.exports=n({}.isPrototypeOf)},1698:function(e,t,r){"use strict";var n=r(6518),i=r(4204),o=r(4916);n({target:"Set",proto:!0,real:!0,forced:!o("union")},{union:i})},1701:function(e,t,r){"use strict";var n=r(6518),i=r(713),o=r(6395);n({target:"Iterator",proto:!0,real:!0,forced:o},{map:i})},1767:function(e){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1828:function(e,t,r){"use strict";var n=r(9504),i=r(9297),o=r(5397),a=r(9617).indexOf,s=r(421),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,d=[];for(r in n)!i(s,r)&&i(n,r)&&c(d,r);while(t.length>u)i(n,r=t[u++])&&(~a(d,r)||c(d,r));return d}},2106:function(e,t,r){"use strict";var n=r(283),i=r(4913);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),i.f(e,t,r)}},2195:function(e,t,r){"use strict";var n=r(9504),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},2211:function(e,t,r){"use strict";var n=r(9039);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},2360:function(e,t,r){"use strict";var n,i=r(8551),o=r(6801),a=r(8727),s=r(421),c=r(397),u=r(4055),d=r(6119),l=">",p="<",m="prototype",h="script",f=d("IE_PROTO"),g=function(){},v=function(e){return p+h+l+e+p+"/"+h+l},y=function(e){e.write(v("")),e.close();var t=e.parentWindow.Object;return e=null,t},M=function(){var e,t=u("iframe"),r="java"+h+":";return t.style.display="none",c.appendChild(t),t.src=String(r),e=t.contentWindow.document,e.open(),e.write(v("document.F=Object")),e.close(),e.F},I=function(){try{n=new ActiveXObject("htmlfile")}catch(t){}I="undefined"!=typeof document?document.domain&&n?y(n):M():y(n);var e=a.length;while(e--)delete I[m][a[e]];return I()};s[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(g[m]=i(e),r=new g,g[m]=null,r[f]=e):r=I(),void 0===t?r:o.f(r,t)}},2475:function(e,t,r){"use strict";var n=r(6518),i=r(8527),o=r(4916),a=!o("isSupersetOf",(function(e){return!e}));n({target:"Set",proto:!0,real:!0,forced:a},{isSupersetOf:i})},2529:function(e){"use strict";e.exports=function(e,t){return{value:e,done:t}}},2777:function(e,t,r){"use strict";var n=r(9565),i=r(34),o=r(757),a=r(5966),s=r(4270),c=r(8227),u=TypeError,d=c("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var r,c=a(e,d);if(c){if(void 0===t&&(t="default"),r=n(c,e,t),!i(r)||o(r))return r;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},2787:function(e,t,r){"use strict";var n=r(9297),i=r(4901),o=r(8981),a=r(6119),s=r(2211),c=a("IE_PROTO"),u=Object,d=u.prototype;e.exports=s?u.getPrototypeOf:function(e){var t=o(e);if(n(t,c))return t[c];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof u?d:null}},2796:function(e,t,r){"use strict";var n=r(9039),i=r(4901),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r===d||r!==u&&(i(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},u=a.NATIVE="N",d=a.POLYFILL="P";e.exports=a},2839:function(e,t,r){"use strict";var n=r(4576),i=n.navigator,o=i&&i.userAgent;e.exports=o?String(o):""},3392:function(e,t,r){"use strict";var n=r(9504),i=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},3440:function(e,t,r){"use strict";var n=r(7080),i=r(4402),o=r(9286),a=r(5170),s=r(3789),c=r(8469),u=r(507),d=i.has,l=i.remove;e.exports=function(e){var t=n(this),r=s(e),i=o(t);return a(t)<=r.size?c(t,(function(e){r.includes(e)&&l(i,e)})):u(r.getIterator(),(function(e){d(t,e)&&l(i,e)})),i}},3650:function(e,t,r){"use strict";var n=r(7080),i=r(4402),o=r(9286),a=r(3789),s=r(507),c=i.add,u=i.has,d=i.remove;e.exports=function(e){var t=n(this),r=a(e).getIterator(),i=o(t);return s(r,(function(e){u(t,e)?d(i,e):c(i,e)})),i}},3706:function(e,t,r){"use strict";var n=r(9504),i=r(4901),o=r(7629),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},3717:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},3724:function(e,t,r){"use strict";var n=r(9039);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},3751:function(e,t,r){"use strict";r.d(t,{D$:function(){return z},Ef:function(){return re},Jo:function(){return K},jR:function(){return X}});var n=r(641),i=r(33);r(953);
/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
let o;const a="undefined"!==typeof window&&window.trustedTypes;if(a)try{o=a.createPolicy("vue",{createHTML:e=>e})}catch(oe){}const s=o?e=>o.createHTML(e):e=>e,c="http://www.w3.org/2000/svg",u="http://www.w3.org/1998/Math/MathML",d="undefined"!==typeof document?document:null,l=d&&d.createElement("template"),p={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i="svg"===t?d.createElementNS(c,e):"mathml"===t?d.createElementNS(u,e):r?d.createElement(e,{is:r}):d.createElement(e);return"select"===e&&n&&null!=n.multiple&&i.setAttribute("multiple",n.multiple),i},createText:e=>d.createTextNode(e),createComment:e=>d.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>d.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,i,o){const a=r?r.previousSibling:t.lastChild;if(i&&(i===o||i.nextSibling)){while(1)if(t.insertBefore(i.cloneNode(!0),r),i===o||!(i=i.nextSibling))break}else{l.innerHTML=s("svg"===n?`<svg>${e}</svg>`:"mathml"===n?`<math>${e}</math>`:e);const i=l.content;if("svg"===n||"mathml"===n){const e=i.firstChild;while(e.firstChild)i.appendChild(e.firstChild);i.removeChild(e)}t.insertBefore(i,r)}return[a?a.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}},m=Symbol("_vtc"),h={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};n.QP;function f(e,t,r){const n=e[m];n&&(t=(t?[t,...n]:[...n]).join(" ")),null==t?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}const g=Symbol("_vod"),v=Symbol("_vsh");const y=Symbol("");const M=/(^|;)\s*display\s*:/;function I(e,t,r){const n=e.style,o=(0,i.Kg)(r);let a=!1;if(r&&!o){if(t)if((0,i.Kg)(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==r[t]&&S(n,t,"")}else for(const e in t)null==r[e]&&S(n,e,"");for(const e in r)"display"===e&&(a=!0),S(n,e,r[e])}else if(o){if(t!==r){const e=n[y];e&&(r+=";"+e),n.cssText=r,a=M.test(r)}}else t&&e.removeAttribute("style");g in e&&(e[g]=a?n.display:"",e[v]&&(n.display="none"))}const T=/\s*!important$/;function S(e,t,r){if((0,i.cy)(r))r.forEach((r=>S(e,t,r)));else if(null==r&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const n=_(e,t);T.test(r)?e.setProperty((0,i.Tg)(n),r.replace(T,""),"important"):e[n]=r}}const b=["Webkit","Moz","ms"],C={};function _(e,t){const r=C[t];if(r)return r;let n=(0,i.PT)(t);if("filter"!==n&&n in e)return C[t]=n;n=(0,i.ZH)(n);for(let i=0;i<b.length;i++){const r=b[i]+n;if(r in e)return C[t]=r}return t}const E="http://www.w3.org/1999/xlink";function k(e,t,r,n,o,a=(0,i.J$)(t)){n&&t.startsWith("xlink:")?null==r?e.removeAttributeNS(E,t.slice(6,t.length)):e.setAttributeNS(E,t,r):null==r||a&&!(0,i.Y2)(r)?e.removeAttribute(t):e.setAttribute(t,a?"":(0,i.Bm)(r)?String(r):r)}function w(e,t,r,n,o){if("innerHTML"===t||"textContent"===t)return void(null!=r&&(e[t]="innerHTML"===t?s(r):r));const a=e.tagName;if("value"===t&&"PROGRESS"!==a&&!a.includes("-")){const n="OPTION"===a?e.getAttribute("value")||"":e.value,i=null==r?"checkbox"===e.type?"on":"":String(r);return n===i&&"_value"in e||(e.value=i),null==r&&e.removeAttribute(t),void(e._value=r)}let c=!1;if(""===r||null==r){const n=typeof e[t];"boolean"===n?r=(0,i.Y2)(r):null==r&&"string"===n?(r="",c=!0):"number"===n&&(r=0,c=!0)}try{e[t]=r}catch(oe){0}c&&e.removeAttribute(o||t)}function R(e,t,r,n){e.addEventListener(t,r,n)}function A(e,t,r,n){e.removeEventListener(t,r,n)}const x=Symbol("_vei");function N(e,t,r,n,i=null){const o=e[x]||(e[x]={}),a=o[t];if(n&&a)a.value=n;else{const[r,s]=P(t);if(n){const a=o[t]=D(n,i);R(e,r,a,s)}else a&&(A(e,r,a,s),o[t]=void 0)}}const O=/(?:Once|Passive|Capture)$/;function P(e){let t;if(O.test(e)){let r;t={};while(r=e.match(O))e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}const r=":"===e[2]?e.slice(3):(0,i.Tg)(e.slice(2));return[r,t]}let L=0;const V=Promise.resolve(),U=()=>L||(V.then((()=>L=0)),L=Date.now());function D(e,t){const r=e=>{if(e._vts){if(e._vts<=r.attached)return}else e._vts=Date.now();(0,n.qL)(q(e,r.value),t,5,[e])};return r.value=e,r.attached=U(),r}function q(e,t){if((0,i.cy)(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map((e=>t=>!t._stopped&&e&&e(t)))}return t}const B=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,F=(e,t,r,n,o,a)=>{const s="svg"===o;"class"===t?f(e,n,s):"style"===t?I(e,r,n):(0,i.Mp)(t)?(0,i.CP)(t)||N(e,t,r,n,a):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):G(e,t,n,s))?(w(e,t,n),e.tagName.includes("-")||"value"!==t&&"checked"!==t&&"selected"!==t||k(e,t,n,s,a,"value"!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&(0,i.Kg)(n)?("true-value"===t?e._trueValue=n:"false-value"===t&&(e._falseValue=n),k(e,t,n,s)):w(e,(0,i.PT)(t),n,a,t)};function G(e,t,r,n){if(n)return"innerHTML"===t||"textContent"===t||!!(t in e&&B(t)&&(0,i.Tn)(r));if("spellcheck"===t||"draggable"===t||"translate"===t)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}return(!B(t)||!(0,i.Kg)(r))&&t in e}
/*! #__NO_SIDE_EFFECTS__ */
"undefined"!==typeof HTMLElement&&HTMLElement;Symbol("_moveCb"),Symbol("_enterCb");const j=e=>{const t=e.props["onUpdate:modelValue"]||!1;return(0,i.cy)(t)?e=>(0,i.DY)(t,e):t};function H(e){e.target.composing=!0}function W(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Y=Symbol("_assign"),K={created(e,{modifiers:{lazy:t,trim:r,number:n}},o){e[Y]=j(o);const a=n||o.props&&"number"===o.props.type;R(e,t?"change":"input",(t=>{if(t.target.composing)return;let n=e.value;r&&(n=n.trim()),a&&(n=(0,i.bB)(n)),e[Y](n)})),r&&R(e,"change",(()=>{e.value=e.value.trim()})),t||(R(e,"compositionstart",H),R(e,"compositionend",W),R(e,"change",W))},mounted(e,{value:t}){e.value=null==t?"":t},beforeUpdate(e,{value:t,oldValue:r,modifiers:{lazy:n,trim:o,number:a}},s){if(e[Y]=j(s),e.composing)return;const c=!a&&"number"!==e.type||/^0\d/.test(e.value)?e.value:(0,i.bB)(e.value),u=null==t?"":t;if(c!==u){if(document.activeElement===e&&"range"!==e.type){if(n&&t===r)return;if(o&&e.value.trim()===u)return}e.value=u}}};const Q=["ctrl","shift","alt","meta"],$={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>Q.some((r=>e[`${r}Key`]&&!t.includes(r)))},z=(e,t)=>{const r=e._withMods||(e._withMods={}),n=t.join(".");return r[n]||(r[n]=(r,...n)=>{for(let e=0;e<t.length;e++){const n=$[t[e]];if(n&&n(r,t))return}return e(r,...n)})},J={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},X=(e,t)=>{const r=e._withKeys||(e._withKeys={}),n=t.join(".");return r[n]||(r[n]=r=>{if(!("key"in r))return;const n=(0,i.Tg)(r.key);return t.some((e=>e===n||J[e]===n))?e(r):void 0})},Z=(0,i.X$)({patchProp:F},p);let ee;function te(){return ee||(ee=(0,n.K9)(Z))}const re=(...e)=>{const t=te().createApp(...e);const{mount:r}=t;return t.mount=e=>{const n=ie(e);if(!n)return;const o=t._component;(0,i.Tn)(o)||o.render||o.template||(o.template=n.innerHTML),1===n.nodeType&&(n.textContent="");const a=r(n,!1,ne(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),a},t};function ne(e){return e instanceof SVGElement?"svg":"function"===typeof MathMLElement&&e instanceof MathMLElement?"mathml":void 0}function ie(e){if((0,i.Kg)(e)){const t=document.querySelector(e);return t}return e}},3789:function(e,t,r){"use strict";var n=r(9306),i=r(8551),o=r(9565),a=r(1291),s=r(1767),c="Invalid size",u=RangeError,d=TypeError,l=Math.max,p=function(e,t){this.set=e,this.size=l(t,0),this.has=n(e.has),this.keys=n(e.keys)};p.prototype={getIterator:function(){return s(i(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){i(e);var t=+e.size;if(t!==t)throw new d(c);var r=a(t);if(r<0)throw new u(c);return new p(e,r)}},3838:function(e,t,r){"use strict";var n=r(7080),i=r(5170),o=r(8469),a=r(3789);e.exports=function(e){var t=n(this),r=a(e);return!(i(t)>r.size)&&!1!==o(t,(function(e){if(!r.includes(e))return!1}),!0)}},3853:function(e,t,r){"use strict";var n=r(6518),i=r(4449),o=r(4916),a=!o("isDisjointFrom",(function(e){return!e}));n({target:"Set",proto:!0,real:!0,forced:a},{isDisjointFrom:i})},4055:function(e,t,r){"use strict";var n=r(4576),i=r(34),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},4114:function(e,t,r){"use strict";var n=r(6518),i=r(8981),o=r(6198),a=r(4527),s=r(6837),c=r(9039),u=c((function(){return 4294967297!==[].push.call({length:4294967296},1)})),d=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},l=u||!d();n({target:"Array",proto:!0,arity:1,forced:l},{push:function(e){var t=i(this),r=o(t),n=arguments.length;s(r+n);for(var c=0;c<n;c++)t[r]=arguments[c],r++;return a(t,r),r}})},4117:function(e){"use strict";e.exports=function(e){return null===e||void 0===e}},4204:function(e,t,r){"use strict";var n=r(7080),i=r(4402).add,o=r(9286),a=r(3789),s=r(507);e.exports=function(e){var t=n(this),r=a(e).getIterator(),c=o(t);return s(r,(function(e){i(c,e)})),c}},4270:function(e,t,r){"use strict";var n=r(9565),i=r(4901),o=r(34),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&i(r=e.toString)&&!o(s=n(r,e)))return s;if(i(r=e.valueOf)&&!o(s=n(r,e)))return s;if("string"!==t&&i(r=e.toString)&&!o(s=n(r,e)))return s;throw new a("Can't convert object to primitive value")}},4353:function(e){!function(t,r){e.exports=r()}(0,(function(){"use strict";var e=1e3,t=6e4,r=36e5,n="millisecond",i="second",o="minute",a="hour",s="day",c="week",u="month",d="quarter",l="year",p="date",m="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},v=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},y={s:v,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),i=r%60;return(t<=0?"+":"-")+v(n,2,"0")+":"+v(i,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,u),o=r-i<0,a=t.clone().add(n+(o?-1:1),u);return+(-(n+(r-i)/(o?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:l,w:c,d:s,D:p,h:a,m:o,s:i,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},M="en",I={};I[M]=g;var T="$isDayjsObject",S=function(e){return e instanceof E||!(!e||!e[T])},b=function e(t,r,n){var i;if(!t)return M;if("string"==typeof t){var o=t.toLowerCase();I[o]&&(i=o),r&&(I[o]=r,i=o);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var s=t.name;I[s]=t,i=s}return!n&&i&&(M=i),i||!n&&M},C=function(e,t){if(S(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new E(r)},_=y;_.l=b,_.i=S,_.w=function(e,t){return C(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function g(e){this.$L=b(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[T]=!0}var v=g.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(_.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(h);if(n){var i=n[2]-1||0,o=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return _},v.isValid=function(){return!(this.$d.toString()===m)},v.isSame=function(e,t){var r=C(e);return this.startOf(t)<=r&&r<=this.endOf(t)},v.isAfter=function(e,t){return C(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<C(e)},v.$g=function(e,t,r){return _.u(e)?this[t]:this.set(r,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var r=this,n=!!_.u(t)||t,d=_.p(e),m=function(e,t){var i=_.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?i:i.endOf(s)},h=function(e,t){return _.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},f=this.$W,g=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(d){case l:return n?m(1,0):m(31,11);case u:return n?m(1,g):m(0,g+1);case c:var M=this.$locale().weekStart||0,I=(f<M?f+7:f)-M;return m(n?v-I:v+(6-I),g);case s:case p:return h(y+"Hours",0);case a:return h(y+"Minutes",1);case o:return h(y+"Seconds",2);case i:return h(y+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var r,c=_.p(e),d="set"+(this.$u?"UTC":""),m=(r={},r[s]=d+"Date",r[p]=d+"Date",r[u]=d+"Month",r[l]=d+"FullYear",r[a]=d+"Hours",r[o]=d+"Minutes",r[i]=d+"Seconds",r[n]=d+"Milliseconds",r)[c],h=c===s?this.$D+(t-this.$W):t;if(c===u||c===l){var f=this.clone().set(p,1);f.$d[m](h),f.init(),this.$d=f.set(p,Math.min(this.$D,f.daysInMonth())).$d}else m&&this.$d[m](h);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[_.p(e)]()},v.add=function(n,d){var p,m=this;n=Number(n);var h=_.p(d),f=function(e){var t=C(m);return _.w(t.date(t.date()+Math.round(e*n)),m)};if(h===u)return this.set(u,this.$M+n);if(h===l)return this.set(l,this.$y+n);if(h===s)return f(1);if(h===c)return f(7);var g=(p={},p[o]=t,p[a]=r,p[i]=e,p)[h]||1,v=this.$d.getTime()+n*g;return _.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||m;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=_.z(this),o=this.$H,a=this.$m,s=this.$M,c=r.weekdays,u=r.months,d=r.meridiem,l=function(e,r,i,o){return e&&(e[r]||e(t,n))||i[r].slice(0,o)},p=function(e){return _.s(o%12||12,e,"0")},h=d||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(f,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return _.s(t.$y,4,"0");case"M":return s+1;case"MM":return _.s(s+1,2,"0");case"MMM":return l(r.monthsShort,s,u,3);case"MMMM":return l(u,s);case"D":return t.$D;case"DD":return _.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return l(r.weekdaysMin,t.$W,c,2);case"ddd":return l(r.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(o);case"HH":return _.s(o,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return h(o,a,!0);case"A":return h(o,a,!1);case"m":return String(a);case"mm":return _.s(a,2,"0");case"s":return String(t.$s);case"ss":return _.s(t.$s,2,"0");case"SSS":return _.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(n,p,m){var h,f=this,g=_.p(p),v=C(n),y=(v.utcOffset()-this.utcOffset())*t,M=this-v,I=function(){return _.m(f,v)};switch(g){case l:h=I()/12;break;case u:h=I();break;case d:h=I()/3;break;case c:h=(M-y)/6048e5;break;case s:h=(M-y)/864e5;break;case a:h=M/r;break;case o:h=M/t;break;case i:h=M/e;break;default:h=M}return m?h:_.a(h)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return I[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=b(e,t,!0);return n&&(r.$L=n),r},v.clone=function(){return _.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),k=E.prototype;return C.prototype=k,[["$ms",n],["$s",i],["$m",o],["$H",a],["$W",s],["$M",u],["$y",l],["$D",p]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),C.extend=function(e,t){return e.$i||(e(t,E,C),e.$i=!0),C},C.locale=b,C.isDayjs=S,C.unix=function(e){return C(1e3*e)},C.en=I[M],C.Ls=I,C.p={},C}))},4376:function(e,t,r){"use strict";var n=r(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},4402:function(e,t,r){"use strict";var n=r(9504),i=Set.prototype;e.exports={Set:Set,add:n(i.add),has:n(i.has),remove:n(i["delete"]),proto:i}},4449:function(e,t,r){"use strict";var n=r(7080),i=r(4402).has,o=r(5170),a=r(3789),s=r(8469),c=r(507),u=r(9539);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<=r.size)return!1!==s(t,(function(e){if(r.includes(e))return!1}),!0);var d=r.getIterator();return!1!==c(d,(function(e){if(i(t,e))return u(d,"normal",!1)}))}},4495:function(e,t,r){"use strict";var n=r(9519),i=r(9039),o=r(4576),a=o.String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},4527:function(e,t,r){"use strict";var n=r(3724),i=r(4376),o=TypeError,a=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(i(e)&&!a(e,"length").writable)throw new o("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},4576:function(e,t,r){"use strict";var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4659:function(e,t,r){"use strict";var n=r(3724),i=r(4913),o=r(6980);e.exports=function(e,t,r){n?i.f(e,t,o(0,r)):e[t]=r}},4901:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports="undefined"==typeof t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},4913:function(e,t,r){"use strict";var n=r(3724),i=r(5917),o=r(8686),a=r(8551),s=r(6969),c=TypeError,u=Object.defineProperty,d=Object.getOwnPropertyDescriptor,l="enumerable",p="configurable",m="writable";t.f=n?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"===typeof e&&"prototype"===t&&"value"in r&&m in r&&!r[m]){var n=d(e,t);n&&n[m]&&(e[t]=r.value,r={configurable:p in r?r[p]:n[p],enumerable:l in r?r[l]:n[l],writable:!1})}return u(e,t,r)}:u:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return u(e,t,r)}catch(n){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},4916:function(e,t,r){"use strict";var n=r(7751),i=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var r=n("Set");try{(new r)[e](i(0));try{return(new r)[e](i(-1)),!1}catch(s){if(!t)return!0;try{return(new r)[e](o(-1/0)),!1}catch(c){var a=new r;return a.add(1),a.add(2),t(a[e](o(1/0)))}}}catch(c){return!1}}},5024:function(e,t,r){"use strict";var n=r(6518),i=r(3650),o=r(4916);n({target:"Set",proto:!0,real:!0,forced:!o("symmetricDifference")},{symmetricDifference:i})},5031:function(e,t,r){"use strict";var n=r(7751),i=r(9504),o=r(8480),a=r(3717),s=r(8551),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},5089:function(e,t,r){!function(e,r){r(t)}(0,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof r.g?r.g:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function i(e){var t={exports:{}};return e(t,t.exports),t.exports}var o,a,s=function(e){return e&&e.Math==Math&&e},c=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof t&&t)||function(){return this}()||Function("return this")(),u=function(e){try{return!!e()}catch(e){return!0}},d=!u((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),l=Function.prototype,p=l.apply,m=l.call,h="object"==typeof Reflect&&Reflect.apply||(d?m.bind(p):function(){return m.apply(p,arguments)}),f=Function.prototype,g=f.bind,v=f.call,y=d&&g.bind(v,v),M=d?function(e){return e&&y(e)}:function(e){return e&&function(){return v.apply(e,arguments)}},I=function(e){return"function"==typeof e},T=!u((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),S=Function.prototype.call,b=d?S.bind(S):function(){return S.apply(S,arguments)},C={}.propertyIsEnumerable,_=Object.getOwnPropertyDescriptor,E={f:_&&!C.call({1:2},1)?function(e){var t=_(this,e);return!!t&&t.enumerable}:C},k=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},w=M({}.toString),R=M("".slice),A=function(e){return R(w(e),8,-1)},x=Object,N=M("".split),O=u((function(){return!x("z").propertyIsEnumerable(0)}))?function(e){return"String"==A(e)?N(e,""):x(e)}:x,P=function(e){return null==e},L=TypeError,V=function(e){if(P(e))throw L("Can't call method on "+e);return e},U=function(e){return O(V(e))},D="object"==typeof document&&document.all,q=void 0===D&&void 0!==D?function(e){return"object"==typeof e?null!==e:I(e)||e===D}:function(e){return"object"==typeof e?null!==e:I(e)},B={},F=function(e){return I(e)?e:void 0},G=function(e,t){return arguments.length<2?F(B[e])||F(c[e]):B[e]&&B[e][t]||c[e]&&c[e][t]},j=M({}.isPrototypeOf),H=G("navigator","userAgent")||"",W=c.process,Y=c.Deno,K=W&&W.versions||Y&&Y.version,Q=K&&K.v8;Q&&(a=(o=Q.split("."))[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&H&&(!(o=H.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=H.match(/Chrome\/(\d+)/))&&(a=+o[1]);var $=a,z=!!Object.getOwnPropertySymbols&&!u((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&$&&$<41})),J=z&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,X=Object,Z=J?function(e){return"symbol"==typeof e}:function(e){var t=G("Symbol");return I(t)&&j(t.prototype,X(e))},ee=String,te=function(e){try{return ee(e)}catch(e){return"Object"}},re=TypeError,ne=function(e){if(I(e))return e;throw re(te(e)+" is not a function")},ie=function(e,t){var r=e[t];return P(r)?void 0:ne(r)},oe=TypeError,ae=Object.defineProperty,se="__core-js_shared__",ce=c[se]||function(e,t){try{ae(c,e,{value:t,configurable:!0,writable:!0})}catch(o){c[e]=t}return t}(se,{}),ue=i((function(e){(e.exports=function(e,t){return ce[e]||(ce[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),de=Object,le=function(e){return de(V(e))},pe=M({}.hasOwnProperty),me=Object.hasOwn||function(e,t){return pe(le(e),t)},he=0,fe=Math.random(),ge=M(1..toString),ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ge(++he+fe,36)},ye=ue("wks"),Me=c.Symbol,Ie=Me&&Me.for,Te=J?Me:Me&&Me.withoutSetter||ve,Se=function(e){if(!me(ye,e)||!z&&"string"!=typeof ye[e]){var t="Symbol."+e;z&&me(Me,e)?ye[e]=Me[e]:ye[e]=J&&Ie?Ie(t):Te(t)}return ye[e]},be=TypeError,Ce=Se("toPrimitive"),_e=function(e,t){if(!q(e)||Z(e))return e;var r,n=ie(e,Ce);if(n){if(void 0===t&&(t="default"),r=b(n,e,t),!q(r)||Z(r))return r;throw be("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&I(r=e.toString)&&!q(n=b(r,e)))return n;if(I(r=e.valueOf)&&!q(n=b(r,e)))return n;if("string"!==t&&I(r=e.toString)&&!q(n=b(r,e)))return n;throw oe("Can't convert object to primitive value")}(e,t)},Ee=function(e){var t=_e(e,"string");return Z(t)?t:t+""},ke=c.document,we=q(ke)&&q(ke.createElement),Re=function(e){return we?ke.createElement(e):{}},Ae=!T&&!u((function(){return 7!=Object.defineProperty(Re("div"),"a",{get:function(){return 7}}).a})),xe=Object.getOwnPropertyDescriptor,Ne={f:T?xe:function(e,t){if(e=U(e),t=Ee(t),Ae)try{return xe(e,t)}catch(e){}if(me(e,t))return k(!b(E.f,e,t),e[t])}},Oe=/#|\.prototype\./,Pe=function(e,t){var r=Ve[Le(e)];return r==De||r!=Ue&&(I(t)?u(t):!!t)},Le=Pe.normalize=function(e){return String(e).replace(Oe,".").toLowerCase()},Ve=Pe.data={},Ue=Pe.NATIVE="N",De=Pe.POLYFILL="P",qe=Pe,Be=M(M.bind),Fe=function(e,t){return ne(e),void 0===t?e:d?Be(e,t):function(){return e.apply(t,arguments)}},Ge=T&&u((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),je=String,He=TypeError,We=function(e){if(q(e))return e;throw He(je(e)+" is not an object")},Ye=TypeError,Ke=Object.defineProperty,Qe=Object.getOwnPropertyDescriptor,$e="enumerable",ze="configurable",Je="writable",Xe={f:T?Ge?function(e,t,r){if(We(e),t=Ee(t),We(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Je in r&&!r.writable){var n=Qe(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:ze in r?r.configurable:n.configurable,enumerable:$e in r?r.enumerable:n.enumerable,writable:!1})}return Ke(e,t,r)}:Ke:function(e,t,r){if(We(e),t=Ee(t),We(r),Ae)try{return Ke(e,t,r)}catch(e){}if("get"in r||"set"in r)throw Ye("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Ze=T?function(e,t,r){return Xe.f(e,t,k(1,r))}:function(e,t,r){return e[t]=r,e},et=Ne.f,rt=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return h(e,this,arguments)};return t.prototype=e.prototype,t},nt=function(e,t){var r,n,i,o,a,s,u,d,l=e.target,p=e.global,m=e.stat,h=e.proto,f=p?c:m?c[l]:(c[l]||{}).prototype,g=p?B:B[l]||Ze(B,l,{})[l],v=g.prototype;for(i in t)r=!qe(p?i:l+(m?".":"#")+i,e.forced)&&f&&me(f,i),a=g[i],r&&(s=e.dontCallGetSet?(d=et(f,i))&&d.value:f[i]),o=r&&s?s:t[i],r&&typeof a==typeof o||(u=e.bind&&r?Fe(o,c):e.wrap&&r?rt(o):h&&I(o)?M(o):o,(e.sham||o&&o.sham||a&&a.sham)&&Ze(u,"sham",!0),Ze(g,i,u),h&&(me(B,n=l+"Prototype")||Ze(B,n,{}),Ze(B[n],i,o),e.real&&v&&!v[i]&&Ze(v,i,o)))},it=Xe.f;nt({target:"Object",stat:!0,forced:Object.defineProperty!==it,sham:!T},{defineProperty:it});var ot,at=i((function(e){var t=B.Object,r=e.exports=function(e,r,n){return t.defineProperty(e,r,n)};t.defineProperty.sham&&(r.sham=!0)})),st=at,ct=n(i((function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),st(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}))),ut=n(i((function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}))),dt=Math.ceil,lt=Math.floor,pt=Math.trunc||function(e){var t=+e;return(t>0?lt:dt)(t)},mt=function(e){var t=+e;return t!=t||0===t?0:pt(t)},ht=Math.max,ft=Math.min,gt=function(e,t){var r=mt(e);return r<0?ht(r+t,0):ft(r,t)},vt=Math.min,yt=function(e){return e>0?vt(mt(e),9007199254740991):0},Mt=function(e){return yt(e.length)},It=function(e){return function(t,r,n){var i,o=U(t),a=Mt(o),s=gt(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},Tt={includes:It(!0),indexOf:It(!1)},St={},bt=Tt.indexOf,Ct=M([].push),_t=function(e,t){var r,n=U(e),i=0,o=[];for(r in n)!me(St,r)&&me(n,r)&&Ct(o,r);for(;t.length>i;)me(n,r=t[i++])&&(~bt(o,r)||Ct(o,r));return o},Et=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],kt=Object.keys||function(e){return _t(e,Et)},wt=T&&!Ge?Object.defineProperties:function(e,t){We(e);for(var r,n=U(t),i=kt(t),o=i.length,a=0;o>a;)Xe.f(e,r=i[a++],n[r]);return e},Rt={f:wt},At=G("document","documentElement"),xt=ue("keys"),Nt=function(e){return xt[e]||(xt[e]=ve(e))},Ot=Nt("IE_PROTO"),Pt=function(){},Lt=function(e){return"<script>"+e+"<\/script>"},Vt=function(e){e.write(Lt("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ut=function(){try{ot=new ActiveXObject("htmlfile")}catch(e){}var e,t;Ut="undefined"!=typeof document?document.domain&&ot?Vt(ot):((t=Re("iframe")).style.display="none",At.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Lt("document.F=Object")),e.close(),e.F):Vt(ot);for(var r=Et.length;r--;)delete Ut.prototype[Et[r]];return Ut()};St[Ot]=!0;var Dt=Object.create||function(e,t){var r;return null!==e?(Pt.prototype=We(e),r=new Pt,Pt.prototype=null,r[Ot]=e):r=Ut(),void 0===t?r:Rt.f(r,t)};nt({target:"Object",stat:!0,sham:!T},{create:Dt});var qt=B.Object,Bt=function(e,t){return qt.create(e,t)},Ft=String,Gt=TypeError,jt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=M(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return We(r),function(e){if("object"==typeof e||I(e))return e;throw Gt("Can't set "+Ft(e)+" as a prototype")}(n),t?e(r,n):r.__proto__=n,r}}():void 0);nt({target:"Object",stat:!0},{setPrototypeOf:jt});var Ht=B.Object.setPrototypeOf,Wt=M([].slice),Yt=Function,Kt=M([].concat),Qt=M([].join),$t={},zt=function(e,t,r){if(!me($t,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";$t[t]=Yt("C,a","return new C("+Qt(n,",")+")")}return $t[t](e,r)},Jt=d?Yt.bind:function(e){var t=ne(this),r=t.prototype,n=Wt(arguments,1),i=function(){var r=Kt(n,Wt(arguments));return this instanceof i?zt(t,r.length,r):t.apply(e,r)};return q(r)&&(i.prototype=r),i};nt({target:"Function",proto:!0,forced:Function.bind!==Jt},{bind:Jt});var Xt=function(e){return B[e+"Prototype"]},Zt=Xt("Function").bind,er=Function.prototype,tr=function(e){var t=e.bind;return e===er||j(er,e)&&t===er.bind?Zt:t},rr=i((function(e){function t(r,n){var i;return e.exports=t=Ht?tr(i=Ht).call(i):function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),nr=n(i((function(e){e.exports=function(e,t){e.prototype=Bt(t.prototype),e.prototype.constructor=e,rr(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports})));nt({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var ir=9007199254740991,or={f:Object.getOwnPropertySymbols},ar=Object.assign,sr=Object.defineProperty,cr=M([].concat),ur=!ar||u((function(){if(T&&1!==ar({b:1},ar(sr({},"a",{enumerable:!0,get:function(){sr(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=ar({},e)[r]||kt(ar({},t)).join("")!=n}))?function(e,t){for(var r=le(e),n=arguments.length,i=1,o=or.f,a=E.f;n>i;)for(var s,c=O(arguments[i++]),u=o?cr(kt(c),o(c)):kt(c),d=u.length,l=0;d>l;)s=u[l++],T&&!b(a,c,s)||(r[s]=c[s]);return r}:ar;nt({target:"Object",stat:!0,arity:2,forced:Object.assign!==ur},{assign:ur});var dr=B.Object.assign,lr=u((function(){kt(1)}));nt({target:"Object",stat:!0,forced:lr},{keys:function(e){return kt(le(e))}});var pr,mr,hr,fr=B.Object.keys,gr={},vr=c.WeakMap,yr=I(vr)&&/native code/.test(String(vr)),Mr="Object already initialized",Ir=c.TypeError,Tr=c.WeakMap;if(yr||ce.state){var Sr=ce.state||(ce.state=new Tr),br=M(Sr.get),Cr=M(Sr.has),_r=M(Sr.set);pr=function(e,t){if(Cr(Sr,e))throw Ir(Mr);return t.facade=e,_r(Sr,e,t),t},mr=function(e){return br(Sr,e)||{}},hr=function(e){return Cr(Sr,e)}}else{var Er=Nt("state");St[Er]=!0,pr=function(e,t){if(me(e,Er))throw Ir(Mr);return t.facade=e,Ze(e,Er,t),t},mr=function(e){return me(e,Er)?e[Er]:{}},hr=function(e){return me(e,Er)}}var kr,wr,Rr,Ar={set:pr,get:mr,has:hr,enforce:function(e){return hr(e)?mr(e):pr(e,{})},getterFor:function(e){return function(t){var r;if(!q(t)||(r=mr(t)).type!==e)throw Ir("Incompatible receiver, "+e+" required");return r}}},xr=Function.prototype,Nr=T&&Object.getOwnPropertyDescriptor,Or=me(xr,"name"),Pr={EXISTS:Or,PROPER:Or&&"something"===function(){}.name,CONFIGURABLE:Or&&(!T||T&&Nr(xr,"name").configurable)},Lr=!u((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Vr=Nt("IE_PROTO"),Ur=Object,Dr=Ur.prototype,qr=Lr?Ur.getPrototypeOf:function(e){var t=le(e);if(me(t,Vr))return t[Vr];var r=t.constructor;return I(r)&&t instanceof r?r.prototype:t instanceof Ur?Dr:null},Br=function(e,t,r,n){return n&&n.enumerable?e[t]=r:Ze(e,t,r),e},Fr=Se("iterator"),Gr=!1;[].keys&&("next"in(Rr=[].keys())?(wr=qr(qr(Rr)))!==Object.prototype&&(kr=wr):Gr=!0);var jr=!q(kr)||u((function(){var e={};return kr[Fr].call(e)!==e}));kr=jr?{}:Dt(kr),I(kr[Fr])||Br(kr,Fr,(function(){return this}));var Hr={IteratorPrototype:kr,BUGGY_SAFARI_ITERATORS:Gr},Wr={};Wr[Se("toStringTag")]="z";var Yr="[object z]"===String(Wr),Kr=Se("toStringTag"),Qr=Object,$r="Arguments"==A(function(){return arguments}()),zr=Yr?A:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Qr(e),Kr))?r:$r?A(t):"Object"==(n=A(t))&&I(t.callee)?"Arguments":n},Jr=Yr?{}.toString:function(){return"[object "+zr(this)+"]"},Xr=Xe.f,Zr=Se("toStringTag"),en=function(e,t,r,n){if(e){var i=r?e:e.prototype;me(i,Zr)||Xr(i,Zr,{configurable:!0,value:t}),n&&!Yr&&Ze(i,"toString",Jr)}},tn=Hr.IteratorPrototype,rn=function(){return this},nn=Pr.PROPER,on=Hr.BUGGY_SAFARI_ITERATORS,an=Se("iterator"),sn="keys",cn="values",un="entries",dn=function(){return this},ln=function(e,t,r,n,i,o,a){!function(e,t,r,n){var i=t+" Iterator";e.prototype=Dt(tn,{next:k(+!n,r)}),en(e,i,!1,!0),gr[i]=rn}(r,t,n);var s,c,u,d=function(e){if(e===i&&f)return f;if(!on&&e in m)return m[e];switch(e){case sn:return function(){return new r(this,e)};case cn:return function(){return new r(this,e)};case un:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",p=!1,m=e.prototype,h=m[an]||m["@@iterator"]||i&&m[i],f=!on&&h||d(i),g="Array"==t&&m.entries||h;if(g&&(s=qr(g.call(new e)))!==Object.prototype&&s.next&&(en(s,l,!0,!0),gr[l]=dn),nn&&i==cn&&h&&h.name!==cn&&(p=!0,f=function(){return b(h,this)}),i)if(c={values:d(cn),keys:o?f:d(sn),entries:d(un)},a)for(u in c)(on||p||!(u in m))&&Br(m,u,c[u]);else nt({target:t,proto:!0,forced:on||p},c);return a&&m[an]!==f&&Br(m,an,f,{name:i}),gr[t]=f,c};Xe.f;var pn="Array Iterator",mn=Ar.set,hn=Ar.getterFor(pn);ln(Array,"Array",(function(e,t){mn(this,{type:pn,target:U(e),index:0,kind:t})}),(function(){var e=hn(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),gr.Arguments=gr.Array;var fn=Se("toStringTag");for(var gn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var vn=c[gn],yn=vn&&vn.prototype;yn&&zr(yn)!==fn&&Ze(yn,fn,gn),gr[gn]=gr.Array}var Mn=Array.isArray||function(e){return"Array"==A(e)},In=M(Function.toString);I(ce.inspectSource)||(ce.inspectSource=function(e){return In(e)});var Tn=ce.inspectSource,Sn=function(){},bn=[],Cn=G("Reflect","construct"),_n=/^\s*(?:class|function)\b/,En=M(_n.exec),kn=!_n.exec(Sn),wn=function(e){if(!I(e))return!1;try{return Cn(Sn,bn,e),!0}catch(e){return!1}},Rn=function(e){if(!I(e))return!1;switch(zr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kn||!!En(_n,Tn(e))}catch(e){return!0}};Rn.sham=!0;var An=!Cn||u((function(){var e;return wn(wn.call)||!wn(Object)||!wn((function(){e=!0}))||e}))?Rn:wn,xn=Se("species"),Nn=Array,On=function(e,t){return new(function(e){var t;return Mn(e)&&(t=e.constructor,(An(t)&&(t===Nn||Mn(t.prototype))||q(t)&&null===(t=t[xn]))&&(t=void 0)),void 0===t?Nn:t}(e))(0===t?0:t)},Pn=M([].push),Ln=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,d,l){for(var p,m,h=le(c),f=O(h),g=Fe(u,d),v=Mt(f),y=0,M=l||On,I=t?M(c,v):r||a?M(c,0):void 0;v>y;y++)if((s||y in f)&&(m=g(p=f[y],y,h),e))if(t)I[y]=m;else if(m)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:Pn(I,p)}else switch(e){case 4:return!1;case 7:Pn(I,p)}return o?-1:n||i?i:I}},Vn={forEach:Ln(0),map:Ln(1),filter:Ln(2),some:Ln(3),every:Ln(4),find:Ln(5),findIndex:Ln(6),filterReject:Ln(7)},Un=function(e,t){var r=[][e];return!!r&&u((function(){r.call(null,t||function(){return 1},1)}))},Dn=Vn.forEach,qn=Un("forEach")?[].forEach:function(e){return Dn(this,e,arguments.length>1?arguments[1]:void 0)};nt({target:"Array",proto:!0,forced:[].forEach!=qn},{forEach:qn});var Bn=Xt("Array").forEach,Fn=Array.prototype,Gn={DOMTokenList:!0,NodeList:!0},jn=function(e){var t=e.forEach;return e===Fn||j(Fn,e)&&t===Fn.forEach||me(Gn,zr(e))?Bn:t},Hn=Vn.findIndex,Wn="findIndex",Yn=!0;Wn in[]&&Array(1).findIndex((function(){Yn=!1})),nt({target:"Array",proto:!0,forced:Yn},{findIndex:function(e){return Hn(this,e,arguments.length>1?arguments[1]:void 0)}});var Kn=Xt("Array").findIndex,Qn=Array.prototype,$n=function(e){var t=e.findIndex;return e===Qn||j(Qn,e)&&t===Qn.findIndex?Kn:t},zn=TypeError,Jn=Object.getOwnPropertyDescriptor,Xn=T&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(Mn(e)&&!Jn(e,"length").writable)throw zn("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},Zn=TypeError,ei=function(e){if(e>9007199254740991)throw Zn("Maximum allowed index exceeded");return e},ti=function(e,t,r){var n=Ee(t);n in e?Xe.f(e,n,k(0,r)):e[n]=r},ri=TypeError,ni=function(e,t){if(!delete e[t])throw ri("Cannot delete property "+te(t)+" of "+te(e))},ii=Se("species"),oi=function(e){return $>=51||!u((function(){var t=[];return(t.constructor={})[ii]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},ai=oi("splice"),si=Math.max,ci=Math.min;nt({target:"Array",proto:!0,forced:!ai},{splice:function(e,t){var r,n,i,o,a,s,c=le(this),u=Mt(c),d=gt(e,u),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=u-d):(r=l-2,n=ci(si(mt(t),0),u-d)),ei(u+r-n),i=On(c,n),o=0;o<n;o++)(a=d+o)in c&&ti(i,o,c[a]);if(i.length=n,r<n){for(o=d;o<u-n;o++)s=o+r,(a=o+n)in c?c[s]=c[a]:ni(c,s);for(o=u;o>u-n+r;o--)ni(c,o-1)}else if(r>n)for(o=u-n;o>d;o--)s=o+r-1,(a=o+n-1)in c?c[s]=c[a]:ni(c,s);for(o=0;o<r;o++)c[o+d]=arguments[o+2];return Xn(c,u-n+r),i}});var ui=Xt("Array").splice,di=Array.prototype,li=function(e){var t=e.splice;return e===di||j(di,e)&&t===di.splice?ui:t},pi=G("JSON","stringify"),mi=M(/./.exec),hi=M("".charAt),fi=M("".charCodeAt),gi=M("".replace),vi=M(1..toString),yi=/[\uD800-\uDFFF]/g,Mi=/^[\uD800-\uDBFF]$/,Ii=/^[\uDC00-\uDFFF]$/,Ti=!z||u((function(){var e=G("Symbol")();return"[null]"!=pi([e])||"{}"!=pi({a:e})||"{}"!=pi(Object(e))})),Si=u((function(){return'"\\udf06\\ud834"'!==pi("\udf06\ud834")||'"\\udead"'!==pi("\udead")})),bi=function(e,t){var r=Wt(arguments),n=t;if((q(t)||void 0!==e)&&!Z(e))return Mn(t)||(t=function(e,t){if(I(n)&&(t=b(n,this,e,t)),!Z(t))return t}),r[1]=t,h(pi,null,r)},Ci=function(e,t,r){var n=hi(r,t-1),i=hi(r,t+1);return mi(Mi,e)&&!mi(Ii,i)||mi(Ii,e)&&!mi(Mi,n)?"\\u"+vi(fi(e,0),16):e};pi&&nt({target:"JSON",stat:!0,arity:3,forced:Ti||Si},{stringify:function(e,t,r){var n=Wt(arguments),i=h(Ti?bi:pi,null,n);return Si&&"string"==typeof i?gi(i,yi,Ci):i}}),B.JSON||(B.JSON={stringify:JSON.stringify});var _i=function(e,t,r){return h(B.JSON.stringify,null,arguments)},Ei=_i;nt({target:"Array",stat:!0},{isArray:Mn});var ki=B.Array.isArray,wi=Et.concat("length","prototype"),Ri={f:Object.getOwnPropertyNames||function(e){return _t(e,wi)}},Ai=M([].concat),xi=G("Reflect","ownKeys")||function(e){var t=Ri.f(We(e)),r=or.f;return r?Ai(t,r(e)):t},Ni=Error,Oi=M("".replace),Pi=String(Ni("zxcasd").stack),Li=/\n\s*at [^:]*:[^\n]*/,Vi=Li.test(Pi),Ui=function(e,t){if(Vi&&"string"==typeof e&&!Ni.prepareStackTrace)for(;t--;)e=Oi(e,Li,"");return e},Di=function(e,t){q(t)&&"cause"in t&&Ze(e,"cause",t.cause)},qi=Se("iterator"),Bi=Array.prototype,Fi=function(e){return void 0!==e&&(gr.Array===e||Bi[qi]===e)},Gi=Se("iterator"),ji=function(e){if(!P(e))return ie(e,Gi)||ie(e,"@@iterator")||gr[zr(e)]},Hi=TypeError,Wi=function(e,t){var r=arguments.length<2?ji(e):t;if(ne(r))return We(b(r,e));throw Hi(te(e)+" is not iterable")},Yi=function(e,t,r){var n,i;We(e);try{if(!(n=ie(e,"return"))){if("throw"===t)throw r;return r}n=b(n,e)}catch(e){i=!0,n=e}if("throw"===t)throw r;if(i)throw n;return We(n),r},Ki=TypeError,Qi=function(e,t){this.stopped=e,this.result=t},$i=Qi.prototype,zi=function(e,t,r){var n,i,o,a,s,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),m=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),f=Fe(t,d),g=function(e){return n&&Yi(n,"normal",e),new Qi(!0,e)},v=function(e){return l?(We(e),h?f(e[0],e[1],g):f(e[0],e[1])):h?f(e,g):f(e)};if(p)n=e.iterator;else if(m)n=e;else{if(!(i=ji(e)))throw Ki(te(e)+" is not iterable");if(Fi(i)){for(o=0,a=Mt(e);a>o;o++)if((s=v(e[o]))&&j($i,s))return s;return new Qi(!1)}n=Wi(e,i)}for(c=p?e.next:n.next;!(u=b(c,n)).done;){try{s=v(u.value)}catch(e){Yi(n,"throw",e)}if("object"==typeof s&&s&&j($i,s))return s}return new Qi(!1)},Ji=String,Xi=function(e){if("Symbol"===zr(e))throw TypeError("Cannot convert a Symbol value to a string");return Ji(e)},Zi=function(e,t){return void 0===e?arguments.length<2?"":t:Xi(e)},eo=!u((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",k(1,7)),7!==e.stack)})),to=Se("toStringTag"),ro=Error,no=[].push,io=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=j(oo,this);jt?r=jt(ro(),i?qr(this):oo):(r=i?this:Dt(oo),Ze(r,to,"Error")),void 0!==t&&Ze(r,"message",Zi(t)),eo&&Ze(r,"stack",Ui(r.stack,1)),Di(r,n);var o=[];return zi(e,no,{that:o}),Ze(r,"errors",o),r};jt?jt(io,ro):function(e,t,r){for(var n=xi(t),i=Xe.f,o=Ne.f,a=0;a<n.length;a++){var s=n[a];me(e,s)||r&&me(r,s)||i(e,s,o(t,s))}}(io,ro,{name:!0});var oo=io.prototype=Dt(ro.prototype,{constructor:k(1,io),message:k(1,""),name:k(1,"AggregateError")});nt({global:!0,constructor:!0,arity:2},{AggregateError:io});var ao,so,co,uo,lo="process"==A(c.process),po=Se("species"),mo=function(e){var t=G(e),r=Xe.f;T&&t&&!t[po]&&r(t,po,{configurable:!0,get:function(){return this}})},ho=TypeError,fo=function(e,t){if(j(t,e))return e;throw ho("Incorrect invocation")},go=TypeError,vo=function(e){if(An(e))return e;throw go(te(e)+" is not a constructor")},yo=Se("species"),Mo=function(e,t){var r,n=We(e).constructor;return void 0===n||P(r=We(n)[yo])?t:vo(r)},Io=TypeError,To=function(e,t){if(e<t)throw Io("Not enough arguments");return e},So=/(?:ipad|iphone|ipod).*applewebkit/i.test(H),bo=c.setImmediate,Co=c.clearImmediate,_o=c.process,Eo=c.Dispatch,ko=c.Function,wo=c.MessageChannel,Ro=c.String,Ao=0,xo={},No="onreadystatechange";try{ao=c.location}catch(e){}var Oo=function(e){if(me(xo,e)){var t=xo[e];delete xo[e],t()}},Po=function(e){return function(){Oo(e)}},Lo=function(e){Oo(e.data)},Vo=function(e){c.postMessage(Ro(e),ao.protocol+"//"+ao.host)};bo&&Co||(bo=function(e){To(arguments.length,1);var t=I(e)?e:ko(e),r=Wt(arguments,1);return xo[++Ao]=function(){h(t,void 0,r)},so(Ao),Ao},Co=function(e){delete xo[e]},lo?so=function(e){_o.nextTick(Po(e))}:Eo&&Eo.now?so=function(e){Eo.now(Po(e))}:wo&&!So?(uo=(co=new wo).port2,co.port1.onmessage=Lo,so=Fe(uo.postMessage,uo)):c.addEventListener&&I(c.postMessage)&&!c.importScripts&&ao&&"file:"!==ao.protocol&&!u(Vo)?(so=Vo,c.addEventListener("message",Lo,!1)):so=No in Re("script")?function(e){At.appendChild(Re("script")).onreadystatechange=function(){At.removeChild(this),Oo(e)}}:function(e){setTimeout(Po(e),0)});var Uo,Do,qo,Bo,Fo,Go,jo,Ho,Wo={set:bo,clear:Co},Yo=/ipad|iphone|ipod/i.test(H)&&void 0!==c.Pebble,Ko=/web0s(?!.*chrome)/i.test(H),Qo=Ne.f,$o=Wo.set,zo=c.MutationObserver||c.WebKitMutationObserver,Jo=c.document,Xo=c.process,Zo=c.Promise,ea=Qo(c,"queueMicrotask"),ta=ea&&ea.value;ta||(Uo=function(){var e,t;for(lo&&(e=Xo.domain)&&e.exit();Do;){t=Do.fn,Do=Do.next;try{t()}catch(e){throw Do?Bo():qo=void 0,e}}qo=void 0,e&&e.enter()},So||lo||Ko||!zo||!Jo?!Yo&&Zo&&Zo.resolve?((jo=Zo.resolve(void 0)).constructor=Zo,Ho=Fe(jo.then,jo),Bo=function(){Ho(Uo)}):lo?Bo=function(){Xo.nextTick(Uo)}:($o=Fe($o,c),Bo=function(){$o(Uo)}):(Fo=!0,Go=Jo.createTextNode(""),new zo(Uo).observe(Go,{characterData:!0}),Bo=function(){Go.data=Fo=!Fo}));var ra=ta||function(e){var t={fn:e,next:void 0};qo&&(qo.next=t),Do||(Do=t,Bo()),qo=t},na=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ia=function(){this.head=null,this.tail=null};ia.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var oa,aa,sa=ia,ca=c.Promise,ua="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,da=!ua&&!lo&&"object"==typeof window&&"object"==typeof document,la=ca&&ca.prototype,pa=Se("species"),ma=!1,ha=I(c.PromiseRejectionEvent),fa=qe("Promise",(function(){var e=Tn(ca),t=e!==String(ca);if(!t&&66===$)return!0;if(!la.catch||!la.finally)return!0;if(!$||$<51||!/native code/.test(e)){var r=new ca((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[pa]=n,!(ma=r.then((function(){}))instanceof n))return!0}return!t&&(da||ua)&&!ha})),ga={CONSTRUCTOR:fa,REJECTION_EVENT:ha,SUBCLASSING:ma},va=TypeError,ya=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw va("Bad Promise constructor");t=e,r=n})),this.resolve=ne(t),this.reject=ne(r)},Ma={f:function(e){return new ya(e)}},Ia=Wo.set,Ta="Promise",Sa=ga.CONSTRUCTOR,ba=ga.REJECTION_EVENT,Ca=Ar.getterFor(Ta),_a=Ar.set,Ea=ca&&ca.prototype,ka=ca,wa=Ea,Ra=c.TypeError,Aa=c.document,xa=c.process,Na=Ma.f,Oa=Na,Pa=!!(Aa&&Aa.createEvent&&c.dispatchEvent),La="unhandledrejection",Va=function(e){var t;return!(!q(e)||!I(t=e.then))&&t},Ua=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Ga(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?u(Ra("Promise-chain cycle")):(n=Va(r))?b(n,r,c,u):c(r)):u(o)}catch(e){d&&!i&&d.exit(),u(e)}},Da=function(e,t){e.notified||(e.notified=!0,ra((function(){for(var r,n=e.reactions;r=n.get();)Ua(r,e);e.notified=!1,t&&!e.rejection&&Ba(e)})))},qa=function(e,t,r){var n,i;Pa?((n=Aa.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),c.dispatchEvent(n)):n={promise:t,reason:r},!ba&&(i=c["on"+e])?i(n):e===La&&function(e,t){var r=c.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},Ba=function(e){b(Ia,c,(function(){var t,r=e.facade,n=e.value;if(Fa(e)&&(t=na((function(){lo?xa.emit("unhandledRejection",n,r):qa(La,r,n)})),e.rejection=lo||Fa(e)?2:1,t.error))throw t.value}))},Fa=function(e){return 1!==e.rejection&&!e.parent},Ga=function(e){b(Ia,c,(function(){var t=e.facade;lo?xa.emit("rejectionHandled",t):qa("rejectionhandled",t,e.value)}))},ja=function(e,t,r){return function(n){e(t,n,r)}},Ha=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Da(e,!0))},Wa=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Ra("Promise can't be resolved itself");var n=Va(t);n?ra((function(){var r={done:!1};try{b(n,t,ja(Wa,r,e),ja(Ha,r,e))}catch(t){Ha(r,t,e)}})):(e.value=t,e.state=1,Da(e,!1))}catch(t){Ha({done:!1},t,e)}}};Sa&&(wa=(ka=function(e){fo(this,wa),ne(e),b(oa,this);var t=Ca(this);try{e(ja(Wa,t),ja(Ha,t))}catch(e){Ha(t,e)}}).prototype,(oa=function(e){_a(this,{type:Ta,done:!1,notified:!1,parent:!1,reactions:new sa,rejection:!1,state:0,value:void 0})}).prototype=Br(wa,"then",(function(e,t){var r=Ca(this),n=Na(Mo(this,ka));return r.parent=!0,n.ok=!I(e)||e,n.fail=I(t)&&t,n.domain=lo?xa.domain:void 0,0==r.state?r.reactions.add(n):ra((function(){Ua(n,r)})),n.promise})),aa=function(){var e=new oa,t=Ca(e);this.promise=e,this.resolve=ja(Wa,t),this.reject=ja(Ha,t)},Ma.f=Na=function(e){return e===ka||void 0===e?new aa(e):Oa(e)}),nt({global:!0,constructor:!0,wrap:!0,forced:Sa},{Promise:ka}),en(ka,Ta,!1,!0),mo(Ta);var Ya=Se("iterator"),Ka=!1;try{var Qa=0,$a={next:function(){return{done:!!Qa++}},return:function(){Ka=!0}};$a[Ya]=function(){return this},Array.from($a,(function(){throw 2}))}catch(e){}var za=function(e,t){if(!t&&!Ka)return!1;var r=!1;try{var n={};n[Ya]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},Ja=ga.CONSTRUCTOR||!za((function(e){ca.all(e).then(void 0,(function(){}))}));nt({target:"Promise",stat:!0,forced:Ja},{all:function(e){var t=this,r=Ma.f(t),n=r.resolve,i=r.reject,o=na((function(){var r=ne(t.resolve),o=[],a=0,s=1;zi(e,(function(e){var c=a++,u=!1;s++,b(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var Xa=ga.CONSTRUCTOR;ca&&ca.prototype,nt({target:"Promise",proto:!0,forced:Xa,real:!0},{catch:function(e){return this.then(void 0,e)}}),nt({target:"Promise",stat:!0,forced:Ja},{race:function(e){var t=this,r=Ma.f(t),n=r.reject,i=na((function(){var i=ne(t.resolve);zi(e,(function(e){b(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}}),nt({target:"Promise",stat:!0,forced:ga.CONSTRUCTOR},{reject:function(e){var t=Ma.f(this);return b(t.reject,void 0,e),t.promise}});var Za=function(e,t){if(We(e),q(t)&&t.constructor===e)return t;var r=Ma.f(e);return(0,r.resolve)(t),r.promise},es=ga.CONSTRUCTOR,ts=G("Promise"),rs=!es;nt({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Za(rs&&this===ts?ca:this,e)}}),nt({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=Ma.f(t),n=r.resolve,i=r.reject,o=na((function(){var r=ne(t.resolve),i=[],o=0,a=1;zi(e,(function(e){var s=o++,c=!1;a++,b(r,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||n(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||n(i))}))})),--a||n(i)}));return o.error&&i(o.value),r.promise}});var ns="No one promise resolved";nt({target:"Promise",stat:!0},{any:function(e){var t=this,r=G("AggregateError"),n=Ma.f(t),i=n.resolve,o=n.reject,a=na((function(){var n=ne(t.resolve),a=[],s=0,c=1,u=!1;zi(e,(function(e){var d=s++,l=!1;c++,b(n,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[d]=e,--c||o(new r(a,ns)))}))})),--c||o(new r(a,ns))}));return a.error&&o(a.value),n.promise}});var is=ca&&ca.prototype,os=!!ca&&u((function(){is.finally.call({then:function(){}},(function(){}))}));nt({target:"Promise",proto:!0,real:!0,forced:os},{finally:function(e){var t=Mo(this,G("Promise")),r=I(e);return this.then(r?function(r){return Za(t,e()).then((function(){return r}))}:e,r?function(r){return Za(t,e()).then((function(){throw r}))}:e)}});var as=M("".charAt),ss=M("".charCodeAt),cs=M("".slice),us=function(e){return function(t,r){var n,i,o=Xi(V(t)),a=mt(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=ss(o,a))<55296||n>56319||a+1===s||(i=ss(o,a+1))<56320||i>57343?e?as(o,a):n:e?cs(o,a,a+2):i-56320+(n-55296<<10)+65536}},ds={codeAt:us(!1),charAt:us(!0)},ls=ds.charAt,ps="String Iterator",ms=Ar.set,hs=Ar.getterFor(ps);ln(String,"String",(function(e){ms(this,{type:ps,string:Xi(e),index:0})}),(function(){var e,t=hs(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=ls(r,n),t.index+=e.length,{value:e,done:!1})}));var fs=B.Promise;nt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=Ma.f(this),r=na(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var gs=fs,vs=E.f,ys=M(vs),Ms=M([].push),Is=function(e){return function(t){for(var r,n=U(t),i=kt(n),o=i.length,a=0,s=[];o>a;)r=i[a++],T&&!ys(n,r)||Ms(s,e?[r,n[r]]:n[r]);return s}},Ts={entries:Is(!0),values:Is(!1)},Ss=Ts.values;nt({target:"Object",stat:!0},{values:function(e){return Ss(e)}});var bs=B.Object.values,Cs=Date,_s=M(Cs.prototype.getTime);nt({target:"Date",stat:!0},{now:function(){return _s(new Cs)}});var Es=B.Date.now,ks=Se("isConcatSpreadable"),ws=$>=51||!u((function(){var e=[];return e[ks]=!1,e.concat()[0]!==e})),Rs=oi("concat"),As=function(e){if(!q(e))return!1;var t=e[ks];return void 0!==t?!!t:Mn(e)};nt({target:"Array",proto:!0,arity:1,forced:!ws||!Rs},{concat:function(e){var t,r,n,i,o,a=le(this),s=On(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(As(o=-1===t?a:arguments[t]))for(i=Mt(o),ei(c+i),r=0;r<i;r++,c++)r in o&&ti(s,c,o[r]);else ei(c+1),ti(s,c++,o);return s.length=c,s}});var xs=Xt("Array").concat,Ns=Array.prototype,Os=function(e){var t=e.concat;return e===Ns||j(Ns,e)&&t===Ns.concat?xs:t},Ps=/MSIE .\./.test(H),Ls=c.Function,Vs=function(e){return Ps?function(t,r){var n=To(arguments.length,1)>2,i=I(t)?t:Ls(t),o=n?Wt(arguments,2):void 0;return e(n?function(){h(i,this,o)}:i,r)}:e},Us={setTimeout:Vs(c.setTimeout),setInterval:Vs(c.setInterval)},Ds=Us.setInterval;nt({global:!0,bind:!0,forced:c.setInterval!==Ds},{setInterval:Ds});var qs=Us.setTimeout;nt({global:!0,bind:!0,forced:c.setTimeout!==qs},{setTimeout:qs});var Bs=B.setTimeout,Fs=i((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,m=d.length;for(u=0;u<m;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}));nt({global:!0},{globalThis:c});var Gs=c,js=Array,Hs=Math.max,Ws=function(e,t,r){for(var n=Mt(e),i=gt(t,n),o=gt(void 0===r?n:r,n),a=js(Hs(o-i,0)),s=0;i<o;i++,s++)ti(a,s,e[i]);return a.length=s,a},Ys=Ri.f,Ks="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qs={f:function(e){return Ks&&"Window"==A(e)?function(e){try{return Ys(e)}catch(e){return Ws(Ks)}}(e):Ys(U(e))}},$s={f:Se},zs=Xe.f,Js=function(e){var t=B.Symbol||(B.Symbol={});me(t,e)||zs(t,e,{value:$s.f(e)})},Xs=function(){var e=G("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=Se("toPrimitive");t&&!t[n]&&Br(t,n,(function(e){return b(r,this)}),{arity:1})},Zs=Vn.forEach,ec=Nt("hidden"),tc="Symbol",rc=Ar.set,nc=Ar.getterFor(tc),ic=Object.prototype,oc=c.Symbol,ac=oc&&oc.prototype,sc=c.TypeError,cc=c.QObject,uc=Ne.f,dc=Xe.f,lc=Qs.f,pc=E.f,mc=M([].push),hc=ue("symbols"),fc=ue("op-symbols"),gc=ue("wks"),vc=!cc||!cc.prototype||!cc.prototype.findChild,yc=T&&u((function(){return 7!=Dt(dc({},"a",{get:function(){return dc(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=uc(ic,t);n&&delete ic[t],dc(e,t,r),n&&e!==ic&&dc(ic,t,n)}:dc,Mc=function(e,t){var r=hc[e]=Dt(ac);return rc(r,{type:tc,tag:e,description:t}),T||(r.description=t),r},Ic=function(e,t,r){e===ic&&Ic(fc,t,r),We(e);var n=Ee(t);return We(r),me(hc,n)?(r.enumerable?(me(e,ec)&&e[ec][n]&&(e[ec][n]=!1),r=Dt(r,{enumerable:k(0,!1)})):(me(e,ec)||dc(e,ec,k(1,{})),e[ec][n]=!0),yc(e,n,r)):dc(e,n,r)},Tc=function(e,t){We(e);var r=U(t),n=kt(r).concat(_c(r));return Zs(n,(function(t){T&&!b(Sc,r,t)||Ic(e,t,r[t])})),e},Sc=function(e){var t=Ee(e),r=b(pc,this,t);return!(this===ic&&me(hc,t)&&!me(fc,t))&&(!(r||!me(this,t)||!me(hc,t)||me(this,ec)&&this[ec][t])||r)},bc=function(e,t){var r=U(e),n=Ee(t);if(r!==ic||!me(hc,n)||me(fc,n)){var i=uc(r,n);return!i||!me(hc,n)||me(r,ec)&&r[ec][n]||(i.enumerable=!0),i}},Cc=function(e){var t=lc(U(e)),r=[];return Zs(t,(function(e){me(hc,e)||me(St,e)||mc(r,e)})),r},_c=function(e){var t=e===ic,r=lc(t?fc:U(e)),n=[];return Zs(r,(function(e){!me(hc,e)||t&&!me(ic,e)||mc(n,hc[e])})),n};z||(oc=function(){if(j(ac,this))throw sc("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Xi(arguments[0]):void 0,t=ve(e),r=function(e){this===ic&&b(r,fc,e),me(this,ec)&&me(this[ec],t)&&(this[ec][t]=!1),yc(this,t,k(1,e))};return T&&vc&&yc(ic,t,{configurable:!0,set:r}),Mc(t,e)},ac=oc.prototype,Br(ac,"toString",(function(){return nc(this).tag})),Br(oc,"withoutSetter",(function(e){return Mc(ve(e),e)})),E.f=Sc,Xe.f=Ic,Rt.f=Tc,Ne.f=bc,Ri.f=Qs.f=Cc,or.f=_c,$s.f=function(e){return Mc(Se(e),e)},T&&dc(ac,"description",{configurable:!0,get:function(){return nc(this).description}})),nt({global:!0,constructor:!0,wrap:!0,forced:!z,sham:!z},{Symbol:oc}),Zs(kt(gc),(function(e){Js(e)})),nt({target:tc,stat:!0,forced:!z},{useSetter:function(){vc=!0},useSimple:function(){vc=!1}}),nt({target:"Object",stat:!0,forced:!z,sham:!T},{create:function(e,t){return void 0===t?Dt(e):Tc(Dt(e),t)},defineProperty:Ic,defineProperties:Tc,getOwnPropertyDescriptor:bc}),nt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:Cc}),Xs(),en(oc,tc),St[ec]=!0;var Ec=z&&!!Symbol.for&&!!Symbol.keyFor,kc=ue("string-to-symbol-registry"),wc=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!Ec},{for:function(e){var t=Xi(e);if(me(kc,t))return kc[t];var r=G("Symbol")(t);return kc[t]=r,wc[r]=t,r}});var Rc=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!Ec},{keyFor:function(e){if(!Z(e))throw TypeError(te(e)+" is not a symbol");if(me(Rc,e))return Rc[e]}});var Ac=!z||u((function(){or.f(1)}));nt({target:"Object",stat:!0,forced:Ac},{getOwnPropertySymbols:function(e){var t=or.f;return t?t(le(e)):[]}}),Js("asyncIterator"),Js("hasInstance"),Js("isConcatSpreadable"),Js("iterator"),Js("match"),Js("matchAll"),Js("replace"),Js("search"),Js("species"),Js("split"),Js("toPrimitive"),Xs(),Js("toStringTag"),en(G("Symbol"),"Symbol"),Js("unscopables"),en(c.JSON,"JSON",!0);var xc=B.Symbol;Js("asyncDispose"),Js("dispose"),Js("matcher"),Js("metadataKey"),Js("observable"),Js("metadata"),Js("patternMatch"),Js("replaceAll");var Nc=xc,Oc=u((function(){qr(1)}));nt({target:"Object",stat:!0,forced:Oc,sham:!Lr},{getPrototypeOf:function(e){return qr(le(e))}});var Pc=B.Object.getPrototypeOf,Lc=M([].reverse),Vc=[1,2];nt({target:"Array",proto:!0,forced:String(Vc)===String(Vc.reverse())},{reverse:function(){return Mn(this)&&(this.length=this.length),Lc(this)}});var Uc=Xt("Array").reverse,Dc=Array.prototype,qc=function(e){var t=e.reverse;return e===Dc||j(Dc,e)&&t===Dc.reverse?Uc:t},Bc=oi("slice"),Fc=Se("species"),Gc=Array,jc=Math.max;nt({target:"Array",proto:!0,forced:!Bc},{slice:function(e,t){var r,n,i,o=U(this),a=Mt(o),s=gt(e,a),c=gt(void 0===t?a:t,a);if(Mn(o)&&(r=o.constructor,(An(r)&&(r===Gc||Mn(r.prototype))||q(r)&&null===(r=r[Fc]))&&(r=void 0),r===Gc||void 0===r))return Wt(o,s,c);for(n=new(void 0===r?Gc:r)(jc(c-s,0)),i=0;s<c;s++,i++)s in o&&ti(n,i,o[s]);return n.length=i,n}});var Hc=Xt("Array").slice,Wc=Array.prototype,Yc=function(e){var t=e.slice;return e===Wc||j(Wc,e)&&t===Wc.slice?Hc:t},Kc=$s.f("iterator"),Qc=Tt.includes,$c=u((function(){return!Array(1).includes()}));nt({target:"Array",proto:!0,forced:$c},{includes:function(e){return Qc(this,e,arguments.length>1?arguments[1]:void 0)}});var zc=Xt("Array").includes,Jc=Se("match"),Xc=TypeError,Zc=function(e){if(function(e){var t;return q(e)&&(void 0!==(t=e[Jc])?!!t:"RegExp"==A(e))}(e))throw Xc("The method doesn't accept regular expressions");return e},eu=Se("match"),tu=function(e){var t=/./;try{"/./"[e](t)}catch(o){try{return t[eu]=!1,"/./"[e](t)}catch(e){}}return!1},ru=M("".indexOf);nt({target:"String",proto:!0,forced:!tu("includes")},{includes:function(e){return!!~ru(Xi(V(this)),Xi(Zc(e)),arguments.length>1?arguments[1]:void 0)}});var nu=Xt("String").includes,iu=Array.prototype,ou=String.prototype,au=function(e){var t=e.includes;return e===iu||j(iu,e)&&t===iu.includes?zc:"string"==typeof e||e===ou||j(ou,e)&&t===ou.includes?nu:t},su=Vn.map,cu=oi("map");nt({target:"Array",proto:!0,forced:!cu},{map:function(e){return su(this,e,arguments.length>1?arguments[1]:void 0)}});var uu=Xt("Array").map,du=Array.prototype,lu=function(e){var t=e.map;return e===du||j(du,e)&&t===du.map?uu:t},pu=Vn.filter,mu=oi("filter");nt({target:"Array",proto:!0,forced:!mu},{filter:function(e){return pu(this,e,arguments.length>1?arguments[1]:void 0)}});var hu=Xt("Array").filter,fu=Array.prototype,gu=function(e){var t=e.filter;return e===fu||j(fu,e)&&t===fu.filter?hu:t},vu=i((function(e,t){e.exports=function(){function e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Nc?Nc:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return st(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(t){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof p?t:p,o=Bt(i.prototype),a=new b(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return _()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=I(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var l={};function p(){}function m(){}function h(){}var f={};c(f,o,(function(){return this}));var g=Pc&&Pc(Pc(C([])));g&&g!==r&&n.call(g,o)&&(f=g);var v=h.prototype=p.prototype=Bt(f);function y(e){var t;jn(t=["next","throw","return"]).call(t,(function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function r(i,o,a,s){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function I(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],jn(e).call(e,T,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:_}}function _(){return{value:void 0,done:!0}}return m.prototype=h,c(v,"constructor",h),c(h,"constructor",m),m.displayName=c(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Ht?Ht(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Bt(v),e},t.awrap=function(e){return{__await:e}},y(M.prototype),c(M.prototype,a,(function(){return this})),t.AsyncIterator=M,t.async=function(e,r,n,i,o){void 0===o&&(o=gs);var a=new M(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),c(v,s,"Generator"),c(v,o,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var r in e)t.push(r);return qc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=C,b.prototype={constructor:b,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,jn(t=this.tryEntries).call(t,S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+Yc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function t(e){return t="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e},t(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),st(e,"prototype",{writable:!1}),e}function o(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=gs))((function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):i(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}var a={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},s=12,c=8e3,u=function(){},d=function(){function n(e){r(this,n),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=a,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Es(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(e),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return i(n,[{key:"setConfig",value:function(e){var t=dr({},this.reportConfig.common,e.common);this.reportConfig=dr({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(e,t){var r=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,dr({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch((function(e){var t,n;null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter immediately upload failed",e)}))}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.priority||(r.priority=this.getEventPriority(e,t)),this.reportConfig.isDataReportEnable&&e){if("login"===e&&!1===t.succeed&&t.process_id){var n=this.lastFailLogin[t.process_id]||0;if(t.start_time-n<a.loginFailIgnoreInterval)return;this.lastFailLogin[t.process_id]=t.start_time}var i=Es();"HIGH"===r.priority?this.highPriorityMsgList.push({module:e,msg:t,createTime:i}):"NORMAL"===r.priority?this.msgList.push({module:e,msg:t,createTime:i}):"LOW"===r.priority&&this.lowPriorityMsgList.push({module:e,msg:t,createTime:i}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var r=dr(dr({start_time:Es()},t),{extension:[]});this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){}},{key:"reportTraceUpdateV2",value:function(e,t,r){var n,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var o=this.traceMsgCache[e].extension,a=o.length,s=(new Date).getTime();0===a?t.duration=s-this.traceMsgCache[e].start_time:o[a-1].end_time?t.duration=s-o[a-1].end_time:t.duration=s-this.traceMsgCache[e].start_time,o.push(dr({end_time:s},t));var c=o.length-1;(null==r?void 0:r.asyncParams)&&((n=this.traceMsgCache[e]).asyncPromiseArray||(n.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(r.asyncParams.then((function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&dr(i.traceMsgCache[e].extension[c],t)}))))}}},{key:"reportTraceEnd",value:function(e){var t,r,n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===i){"boolean"==typeof i?this.traceMsgCache[e].succeed=!!i:this.traceMsgCache[e].state=i,this.traceMsgCache[e].duration=Es()-this.traceMsgCache[e].start_time,jn(t=this.traceMsgCache[e].extension).call(t,(function(e){delete e.end_time}));var o=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,o.asyncPromiseArray){(r=this.endedAsyncMsgByModule)[e]||(r[e]=[]),this.endedAsyncMsgByModule[e].push(o);var a=function(){var t;n.endedAsyncMsgByModule[e]&&au(t=n.endedAsyncMsgByModule[e]).call(t,o)&&(delete o.asyncPromiseArray,n.report(e,o,{priority:n.getEventPriority(e,o)}))};gs.all(o.asyncPromiseArray).then(a).catch(a)}else this.report(e,o,{priority:this.getEventPriority(e,o)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var e,t=this;this.reportConfig.isDataReportEnable&&(jn(e=fr(this.traceMsgCache)).call(e,(function(e){t.reportTraceEnd(e,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=u,this.report=u,this.reportTraceStart=u,this.reportTraceUpdate=u,this.reportTraceEnd=u,this.pause=u,this.restore=u,this.destroy=u,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var r,n;return o(this,void 0,void 0,e().mark((function i(){var o,a,u,d,l,p=this;return e().wrap((function(i){for(var m;;)switch(i.prev=i.next){case 0:if(!this.loading){i.next=2;break}return i.abrupt("return");case 2:this.loading=!0,o=this.reportConfig.common||{},a=lu(m=this.reportConfig.compassDataEndpoint.split(",")).call(m,(function(e){var t;return Os(t="".concat(e,"/")).call(t,p.configPath)})),u=e().mark((function t(i){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.initConfigLoaded&&!p.isDestroyed){e.next=2;break}return e.abrupt("return","break");case 2:return e.prev=2,e.next=5,p.reportConfig.request(a[i],{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,appkey:o.app_key},timeout:p.reportConfig.timeout}).then((function(e){var t,r;if(!p.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){p.initConfigLoaded=!0;var n=e.data.data||{};p.reportConfig.maxSize=n.maxSize>1e3?1e3:n.maxSize,p.reportConfig.maxInterval=n.maxInterval>1e4?1e4:n.maxInterval,p.reportConfig.maxInterval=n.maxInterval<10?10:n.maxInterval,p.reportConfig.minInterval=n.minInterval<2?2:n.minInterval,p.reportConfig.maxDelay=n.maxDelay||300,p.reportConfig.maxInterval=1e3*p.reportConfig.maxInterval,p.reportConfig.minInterval=1e3*p.reportConfig.minInterval,p.reportConfig.maxDelay=1e3*p.reportConfig.maxDelay,n.endpoint?p.dataReportEndpoint=n.endpoint:p.dataReportEndpoint=a[i],p.serverAllowUpload=!0,p.loading=!1,p.reportHeartBeat()}else 200===e.status&&(p.initConfigLoaded=!0);null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.log("Get reporter upload config success")}})).catch((function(e){var t,r;p.isDestroyed||(p.loading=!1,null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.error("Get reporter upload config failed",e),p.reqRetryCount<s&&(p.reqRetryCount++,Bs((function(){p.isDestroyed||p.initUploadConfig()}),c)))}));case 5:e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(2),!p.isDestroyed){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:p.loading=!1,null===(n=null===(r=p.reportConfig)||void 0===r?void 0:r.logger)||void 0===n||n.error("Exec reporter request failed",e.t0),p.reqRetryCount<s&&(p.reqRetryCount++,Bs((function(){p.isDestroyed||p.initUploadConfig()}),c));case 14:case"end":return e.stop()}}),t,null,[[2,7]])})),d=0;case 7:if(!(d<a.length)){i.next=17;break}return i.delegateYield(u(d),"t0",9);case 9:if("break"!==(l=i.t0)){i.next=12;break}return i.abrupt("break",17);case 12:if("object"!==t(l)){i.next=14;break}return i.abrupt("return",l.v);case 14:d++,i.next=7;break;case 17:case"end":return i.stop()}}),i,this)})))}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=Bs((function(){e.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Es()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function(){var e,t,r,n,i,o,a=this,s={},c=Es();this.highPriorityMsgList=gu(e=this.highPriorityMsgList).call(e,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.msgList=gu(t=this.msgList).call(t,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.lowPriorityMsgList=gu(r=this.lowPriorityMsgList).call(r,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.cacheMsgList=gu(n=this.cacheMsgList).call(n,(function(e){return c-e.createTime<a.reportConfig.maxDelay}));var u=Yc(i=this.highPriorityMsgList).call(i,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=Yc(o=this.highPriorityMsgList).call(o,u.length),u.length<this.reportConfig.maxSize){var d,l,p=this.reportConfig.maxSize-u.length;u=Os(u).call(u,Yc(d=this.msgList).call(d,0,p)),this.msgList=Yc(l=this.msgList).call(l,p)}if(u.length<this.reportConfig.maxSize){var m,h,f=this.reportConfig.maxSize-u.length;u=Os(u).call(u,Yc(m=this.lowPriorityMsgList).call(m,0,f)),this.lowPriorityMsgList=Yc(h=this.lowPriorityMsgList).call(h,f)}if(u.length<this.reportConfig.maxSize){var g,v,y=this.reportConfig.maxSize-u.length;u=Os(u).call(u,Yc(g=this.cacheMsgList).call(g,0,y)),this.cacheMsgList=Yc(v=this.cacheMsgList).call(v,y)}return jn(u).call(u,(function(e){s[e.module]?s[e.module].push(e.msg):s[e.module]=[e.msg]})),{uploadMsgArr:u,uploadMsg:s}}},{key:"upload",value:function(){var e,t,r=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&Es()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=Es();try{var a,s=Os(a="".concat(this.dataReportEndpoint,"/")).call(a,this.dataReportPath);this.reportConfig.request(s,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n,o,a;r.cacheMsgList=Yc(t=Os(n=r.cacheMsgList).call(n,i)).call(t,0,r.reportConfig.cacheMaxSize),null===(a=null===(o=r.reportConfig)||void 0===o?void 0:o.logger)||void 0===a||a.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),n}();return d}()})),yu=Xt("Array").values,Mu=Array.prototype,Iu={DOMTokenList:!0,NodeList:!0},Tu=function(e){var t=e.values;return e===Mu||j(Mu,e)&&t===Mu.values||me(Iu,zr(e))?yu:t},Su=Tt.indexOf,bu=M([].indexOf),Cu=!!bu&&1/bu([1],1,-0)<0,_u=Un("indexOf");nt({target:"Array",proto:!0,forced:Cu||!_u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Cu?bu(this,e,t)||0:Su(this,e,t)}});var Eu=Xt("Array").indexOf,ku=Array.prototype,wu=function(e){var t=e.indexOf;return e===ku||j(ku,e)&&t===ku.indexOf?Eu:t},Ru=Vn.every,Au=Un("every");nt({target:"Array",proto:!0,forced:!Au},{every:function(e){return Ru(this,e,arguments.length>1?arguments[1]:void 0)}});var xu=Xt("Array").every,Nu=Array.prototype,Ou=function(e){var t=e.every;return e===Nu||j(Nu,e)&&t===Nu.every?xu:t},Pu=u((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Lu=Object.isExtensible,Vu=u((function(){Lu(1)}))||Pu?function(e){return!!q(e)&&(!Pu||"ArrayBuffer"!=A(e))&&(!Lu||Lu(e))}:Lu,Uu=!u((function(){return Object.isExtensible(Object.preventExtensions({}))})),Du=i((function(e){var t=Xe.f,r=!1,n=ve("meta"),i=0,o=function(e){t(e,n,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},r=!0;var e=Ri.f,t=M([].splice),i={};i[n]=1,e(i).length&&(Ri.f=function(r){for(var i=e(r),o=0,a=i.length;o<a;o++)if(i[o]===n){t(i,o,1);break}return i},nt({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Qs.f}))},fastKey:function(e,t){if(!q(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!me(e,n)){if(!Vu(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!me(e,n)){if(!Vu(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Uu&&r&&Vu(e)&&!me(e,n)&&o(e),e}};St[n]=!0})),qu=Xe.f,Bu=Vn.forEach,Fu=Ar.set,Gu=Ar.getterFor,ju=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",s=c[e],d=s&&s.prototype,l={};if(T&&I(s)&&(o||d.forEach&&!u((function(){(new s).entries().next()})))){var p=(n=t((function(t,r){Fu(fo(t,p),{type:e,collection:new s}),null!=r&&zi(r,t[a],{that:t,AS_ENTRIES:i})}))).prototype,m=Gu(e);Bu(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in d)||o&&"clear"==e||Ze(p,e,(function(r,n){var i=m(this).collection;if(!t&&o&&!q(r))return"get"==e&&void 0;var a=i[e](0===r?0:r,n);return t?this:a}))})),o||qu(p,"size",{configurable:!0,get:function(){return m(this).collection.size}})}else n=r.getConstructor(t,e,i,a),Du.enable();return en(n,e,!1,!0),l[e]=n,nt({global:!0,forced:!0},l),o||r.setStrong(n,e,i),n},Hu=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:Br(e,n,t[n],r);return e},Wu=Xe.f,Yu=Du.fastKey,Ku=Ar.set,Qu=Ar.getterFor,$u={getConstructor:function(e,t,r,n){var i=e((function(e,i){fo(e,o),Ku(e,{type:t,index:Dt(null),first:void 0,last:void 0,size:0}),T||(e.size=0),P(i)||zi(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=Qu(t),s=function(e,t,r){var n,i,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:i=Yu(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),T?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},c=function(e,t){var r,n=a(e),i=Yu(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return Hu(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,T?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),T?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=Fe(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Hu(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),T&&Wu(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Qu(t),o=Qu(n);ln(e,t,(function(e,t){Ku(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),mo(t)}};ju("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),$u);var zu=B.Map,Ju=[].push,Xu=function(e){var t,r,n,i,o=arguments.length,a=o>1?arguments[1]:void 0;return vo(this),(t=void 0!==a)&&ne(a),P(e)?new this:(r=[],t?(n=0,i=Fe(a,o>2?arguments[2]:void 0),zi(e,(function(e){b(Ju,r,i(e,n++))}))):zi(e,Ju,{that:r}),new this(r))};nt({target:"Map",stat:!0,forced:!0},{from:Xu});var Zu=function(){return new this(Wt(arguments))};nt({target:"Map",stat:!0,forced:!0},{of:Zu});var ed=function(){for(var e,t=We(this),r=ne(t.delete),n=!0,i=0,o=arguments.length;i<o;i++)e=b(r,t,arguments[i]),n=n&&e;return!!n};nt({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:ed}),nt({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,i=We(this),o=ne(i.get),a=ne(i.has),s=ne(i.set);return b(a,i,e)?(r=b(o,i,e),"update"in t&&(r=t.update(r,e,i),b(s,i,e,r)),r):(n=t.insert(e,i),b(s,i,e,n),n)}});var td=Wi;nt({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return!zi(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(Mo(t,G("Map"))),o=ne(i.set);return zi(r,(function(e,r){n(r,e,t)&&b(o,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return zi(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return zi(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var rd=M([].push);nt({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){ne(t);var r=Wi(e),n=new this,i=ne(n.has),o=ne(n.get),a=ne(n.set);return zi(r,(function(e){var r=t(e);b(i,n,r)?rd(b(o,n,r),e):b(a,n,r,[e])}),{IS_ITERATOR:!0}),n}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return zi(td(We(this)),(function(t,r,n){if((i=r)===(o=e)||i!=i&&o!=o)return n();var i,o}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new this;ne(t);var n=ne(r.set);return zi(e,(function(e){b(n,r,t(e),e)})),r}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return zi(td(We(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(Mo(t,G("Map"))),o=ne(i.set);return zi(r,(function(e,r){b(o,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(Mo(t,G("Map"))),o=ne(i.set);return zi(r,(function(e,r){b(o,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=We(this),r=ne(t.set),n=arguments.length,i=0;i<n;)zi(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var nd=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=We(this),r=td(t),n=arguments.length<2,i=n?void 0:arguments[1];if(ne(e),zi(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw nd("Reduce of empty map with no initial value");return i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=We(this),r=td(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return zi(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var id=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=We(this),n=ne(r.get),i=ne(r.has),o=ne(r.set),a=arguments.length;ne(t);var s=b(i,r,e);if(!s&&a<3)throw id("Updating absent value");var c=s?b(n,r,e):ne(a>2?arguments[2]:void 0)(e,r);return b(o,r,e,t(c,e,r)),r}});var od=TypeError,ad=function(e,t){var r,n=We(this),i=ne(n.get),o=ne(n.has),a=ne(n.set),s=arguments.length>2?arguments[2]:void 0;if(!I(t)&&!I(s))throw od("At least one callback required");return b(o,n,e)?(r=b(i,n,e),I(t)&&(r=t(r),b(a,n,e,r))):I(s)&&(r=s(),b(a,n,e,r)),r};nt({target:"Map",proto:!0,real:!0,forced:!0},{upsert:ad}),nt({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:ad});var sd=zu,cd=i((function(e){function t(r){var n;return e.exports=t=Ht?tr(n=Pc).call(n):function(e){return e.__proto__||Pc(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),ud=i((function(e){e.exports=function(e){var t;return-1!==wu(t=Function.toString.call(e)).call(t,"[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports})),dd=G("Reflect","construct"),ld=Object.prototype,pd=[].push,md=u((function(){function e(){}return!(dd((function(){}),[],e)instanceof e)})),hd=!u((function(){dd((function(){}))})),fd=md||hd;nt({target:"Reflect",stat:!0,forced:fd,sham:fd},{construct:function(e,t){vo(e),We(t);var r=arguments.length<3?e:vo(arguments[2]);if(hd&&!md)return dd(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return h(pd,n,t),new(h(Jt,e,n))}var i=r.prototype,o=Dt(q(i)?i:ld),a=h(e,o,t);return q(a)?a:o}});var gd=B.Reflect.construct,vd=i((function(e){e.exports=function(){if("undefined"==typeof Reflect||!gd)return!1;if(gd.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(gd(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports})),yd=i((function(e){function t(r,n,i){var o;return vd()?(e.exports=t=tr(o=gd).call(o),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(tr(Function).apply(e,n));return r&&rr(i,r.prototype),i},e.exports.__esModule=!0,e.exports.default=e.exports),t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Md=i((function(e){function t(r){var n="function"==typeof sd?new sd:void 0;return e.exports=t=function(e){if(null===e||!ud(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return yd(e,arguments,cd(this).constructor)}return t.prototype=Bt(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),rr(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Id=n(Md),Td=TypeError,Sd=function(e){return function(t,r,n,i){ne(r);var o=le(t),a=O(o),s=Mt(o),c=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw Td("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=r(i,a[c],c,o));return i}},bd={left:Sd(!1),right:Sd(!0)}.left,Cd=Un("reduce");nt({target:"Array",proto:!0,forced:!Cd||!lo&&$>79&&$<83},{reduce:function(e){var t=arguments.length;return bd(this,e,t,t>1?arguments[1]:void 0)}});var _d,Ed,kd,wd,Rd,Ad,xd,Nd,Od,Pd,Ld,Vd,Ud,Dd,qd,Bd,Fd,Gd,jd,Hd,Wd,Yd,Kd,Qd,$d,zd,Jd,Xd,Zd,el,tl,rl,nl,il,ol,al,sl,cl,ul,dl,ll,pl,ml,hl,fl,gl,vl,yl,Ml=Xt("Array").reduce,Il=Array.prototype,Tl=function(e){var t=e.reduce;return e===Il||j(Il,e)&&t===Il.reduce?Ml:t};!function(e){e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(_d||(_d={})),function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(Ed||(Ed={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(kd||(kd={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(wd||(wd={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(Rd||(Rd={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(Ad||(Ad={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(xd||(xd={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Nd||(Nd={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(Od||(Od={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Pd||(Pd={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(Ld||(Ld={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(Vd||(Vd={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(Ud||(Ud={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(Dd||(Dd={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(qd||(qd={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(Bd||(Bd={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(Fd||(Fd={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(Gd||(Gd={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(jd||(jd={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(Hd||(Hd={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(Wd||(Wd={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(Yd||(Yd={})),function(e){e[e.V2NIM_CLEAR_HISTORY_MODE_ALL=0]="V2NIM_CLEAR_HISTORY_MODE_ALL",e[e.V2NIM_CLEAR_HISTORY_MODE_LOCAL=1]="V2NIM_CLEAR_HISTORY_MODE_LOCAL"}(Kd||(Kd={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(Qd||(Qd={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}($d||($d={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(zd||(zd={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(Jd||(Jd={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(Xd||(Xd={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Zd||(Zd={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}(el||(el={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(tl||(tl={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(rl||(rl={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(nl||(nl={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(il||(il={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(ol||(ol={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(al||(al={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(sl||(sl={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=3]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(cl||(cl={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(ul||(ul={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(dl||(dl={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(ll||(ll={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(pl||(pl={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(ml||(ml={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(hl||(hl={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(fl||(fl={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(gl||(gl={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(vl||(vl={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(yl||(yl={}));var Sl={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation faileduse open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_IS_NOT_STICK_TOP:{code:110305,message:"conversation is not stick top"},V2NIM_ERROR_CODE_STICK_TOP_DISABLED:{code:110306,message:"conversation stick top disabled"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},bl=fr(Sl),Cl=Tl(bl).call(bl,(function(e,t){var r=Sl[t];return e[t]=r.code,e}),{}),_l=Tl(bl).call(bl,(function(e,t){var r=Sl[t];return e[r.code]=r.message,e}),{}),El=Object.freeze({__proto__:null,V2NIMErrorCode:Cl,V2NIMErrorDesc:_l,get V2NIMDataSyncLevel(){return _d},get V2NIMDataSyncType(){return Ed},get V2NIMDataSyncState(){return kd},get V2NIMConversationType(){return wd},get V2NIMLastMessageState(){return Rd},get V2NIMFriendAddMode(){return Ad},get V2NIMFriendAddApplicationType(){return xd},get V2NIMFriendAddApplicationStatus(){return Nd},get V2NIMFriendDeletionType(){return Od},get V2NIMFriendVerifyType(){return Pd},get V2NIMLoginAuthType(){return Ld},get V2NIMLoginStatus(){return Vd},get V2NIMLoginClientType(){return Ud},get V2NIMKickedOfflineReason(){return Dd},get V2NIMLoginClientChange(){return qd},get V2NIMConnectStatus(){return Bd},get V2NIMMessageType(){return Gd},get V2NIMMessageNotificationType(){return jd},get V2NIMMessageAttachmentUploadState(){return Hd},get V2NIMMessageSendingState(){return Wd},get V2NIMQueryDirection(){return Yd},get V2NIMMessageRevokeType(){return Qd},get V2NIMMessagePinState(){return $d},get V2NIMMessageQuickCommentType(){return zd},get V2NIMClientAntispamOperateType(){return Jd},get V2NIMSortOrder(){return Xd},get V2NIMSystemMessageType(){return Zd},get V2NIMTeamMessageMuteMode(){return el},get V2NIMP2PMessageMuteMode(){return tl},get V2NIMTeamMemberRoleQueryType(){return rl},get V2NIMTeamType(){return nl},get V2NIMTeamJoinMode(){return il},get V2NIMTeamAgreeMode(){return ol},get V2NIMTeamInviteMode(){return al},get V2NIMTeamUpdateInfoMode(){return sl},get V2NIMTeamChatBannedMode(){return cl},get V2NIMTeamUpdateExtensionMode(){return ul},get V2NIMTeamJoinActionType(){return ll},get V2NIMTeamJoinActionStatus(){return pl},get V2NIMTeamNotificationType(){return ml},get V2NIMTeamMemberRole(){return dl},get V2NIMAIModelRoleType(){return fl},get V2NIMAIModelType(){return hl},get V2NIMSignallingChannelType(){return vl},get V2NIMSignallingEventType(){return gl},get V2NIMUserStatusType(){return yl}}),kl=function(e){function t(t){var r;return(r=e.call(this,t.desc)||this).name="V2NIMError",r.code=t.code||0,r.desc=t.desc||_l[r.code]||Ol[r.code]||"",r.message=r.desc,r.detail=t.detail||{},r}return nr(t,e),t.prototype.toString=function(){var e,t=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?Ei(this.detail):"");return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+="\n rawError: "+this.detail.rawError.message),t},t}(Id(Error)),wl=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),(i=e.call(this,{code:Cl.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:t,rules:n,data:r}})||this).name="validateError",i.message=i.message+"\n"+Ei(i.detail,null,2),i.data=r,i.rules=n,i}return nr(t,e),t}(kl),Rl=function(e){function t(t){var r,n,i,o;return(r=e.call(this,{code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(n=t.detail)||void 0===n?void 0:n.reason,rules:null===(i=t.detail)||void 0===i?void 0:i.rules,data:null===(o=t.detail)||void 0===o?void 0:o.data}})||this).name="ValidateErrorV2",r}return nr(t,e),t}(kl),Al=function(e){function t(t,r,n){var i;return(i=e.call(this,{code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:t,key:r,rules:n}})||this).name="formatError",i}return nr(t,e),t}(kl),xl=function(e){function t(t){var r;return(r=e.call(this,dr({code:400},t))||this).desc=r.desc||"upload file error",r.message=r.desc,r.name="uploadError",r}return nr(t,e),t}(kl),Nl=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),void 0===n&&(n=400),(i=e.call(this,{code:n,desc:t,detail:r})||this).name="customError",i.data=r,i}return nr(t,e),t}(kl),Ol={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function Pl(e,t){return t=t||[],gu(e=e||[]).call(e,(function(e){return-1===wu(t).call(t,e)}))}function Ll(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function Vl(e,t,r,n){var i;void 0===t&&(t={}),void 0===n&&(n=!1);var o={};return jn(i=fr(e)).call(i,(function(i){var a=e[i].type,s=r?"In "+r+", ":"";if(null==t){var c=s+"param is null or undefined";throw n?new Rl({detail:{reason:c,data:{key:i},rules:"required"}}):new wl(c,{key:i},"required")}if(void 0===t[i]){if(!1===e[i].required)return void(o[i]=t[i]);var u=s+"param '"+i+"' is required";throw n?new Rl({detail:{reason:u,data:{key:i},rules:"required"}}):new wl(u,{key:i},"required")}var d=Ul[a];if(d&&!d(t,i,e[i],n)){var l=s+"param '"+i+"' unexpected",p={key:i,value:t[i]};throw n?new Rl({detail:{reason:l,data:p,rules:Ei(e[i],Ll)}}):new wl(l,p,Ei(e[i],Ll))}o[i]=t[i]})),o}var Ul={string:function(e,t,r){var n=r.allowEmpty,i=r.max,o=r.min,a=r.regExp,s=e[t];return"string"==typeof s&&(!1!==n||""!==s)&&!("number"==typeof i&&s.length>i)&&!("number"==typeof o&&s.length<o)&&!(function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(a)&&!a.test(s))},number:function(e,t,r){var n=r.min,i=r.max,o=e[t];return"number"==typeof o&&!("number"==typeof n&&o<n)&&!("number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,r){var n=Tu(r),i=e[t];return!n||wu(n).call(n,i)>-1},jsonstr:function(e,t){try{var r=JSON.parse(e[t]);return"object"==typeof r&&null!==r}catch(e){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,r,n){void 0===n&&(n=!1);var i=r.itemType,o=r.itemRules,a=r.rules,s=r.min,c=r.max,u=Tu(r),d=e[t];if(!ki(d))return!1;if("number"==typeof c&&d.length>c)return!1;if("number"==typeof s&&d.length<s)return!1;if(o)jn(d).call(d,(function(e,r){var i,a;Vl(((i={})[r]=o,i),((a={})[r]=e,a),t+"["+r+"]",n)}));else if(a)jn(d).call(d,(function(e,r){return Vl(a,e,t+"["+r+"]",n)}));else if("enum"===i){if(u&&Pl(d,u).length)return!1}else if(i&&!Ou(d).call(d,(function(e){return typeof e===i})))return!1;return!0},object:function(e,t,r,n){void 0===n&&(n=!1);var i=r.rules,o=r.allowEmpty,a=e[t];if("object"!=typeof a||null===a)return!1;if(i){var s=fr(i),c=fr(a),u=gu(c).call(c,(function(e){return wu(s).call(s,e)>-1}));if(!1===o&&0===u.length)return!1;Vl(i,a,t,n)}return!0}};function Dl(e,t){if(!e)throw new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE});Vl({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+e+"\\|[1-3]\\|")}},{conversationId:t},"",!0)}var ql=function(e,t,r,n){try{return n?t(We(r)[0],r[1]):t(r)}catch(t){Yi(e,"throw",t)}},Bl=Array,Fl=!za((function(e){Array.from(e)}));nt({target:"Array",stat:!0,forced:Fl},{from:function(e){var t=le(e),r=An(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Fe(i,n>2?arguments[2]:void 0));var a,s,c,u,d,l,p=ji(t),m=0;if(!p||this===Bl&&Fi(p))for(a=Mt(t),s=r?new this(a):Bl(a);a>m;m++)l=o?i(t[m],m):t[m],ti(s,m,l);else for(d=(u=Wi(t,p)).next,s=r?new this:[];!(c=b(d,u)).done;m++)l=o?ql(u,i,[c.value,m],!0):c.value,ti(s,m,l);return s.length=m,s}});var Gl=B.Array.from,jl=ji;function Hl(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Wl(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wl(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Wl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Yl=function(){function e(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=e.prototype;return t.addTimer=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1);var n=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:r,count:0,timeout:n+t,interval:t,callback:e}),this.id++,this.checkTimer(n),i},t.checkTimer=function(e){if(void 0===e&&(e=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var t,r,n=0,i=Hl(this.timerList);!(t=i()).done;){var o=t.value;(0===n||n>o.timeout)&&(n=o.timeout)}0!==this.timerList.length&&(null===this.timer||n<this.timeout||this.timeout<e)&&(this.timer=Bs(tr(r=this.nowTime).call(r,this),n-e),this.timeout=n)}},t.nowTime=function(){for(var e,t=(new Date).getTime(),r=Hl(this.timerList);!(e=r()).done;){var n=e.value;t>=n.timeout&&(n.callback(),n.count++,n.timeout=t+n.interval)}this.clerTime(),this.checkTimer(t)},t.clerTime=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function(e){for(var t=this.timerList.length-1;t>=0;t--){var r;this.timerList[t].id===e&&li(r=this.timerList).call(r,t,1)}},t.removeFinished=function(){for(var e=this.timerList.length-1;e>=0;e--){var t,r=this.timerList[e];r.loop>=0&&r.count>=r.loop&&li(t=this.timerList).call(t,e,1)}},t.destroy=function(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},e}(),Kl=i((function(e){function t(r){return e.exports=t="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Ql=i((function(e){var t=Kl.default;function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Nc?Nc:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return st(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Bt(i.prototype),a=new _(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return k()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=l;var m={};function h(){}function f(){}function g(){}var v={};d(v,s,(function(){return this}));var y=Pc&&Pc(Pc(E([])));y&&y!==i&&o.call(y,s)&&(v=y);var M=g.prototype=h.prototype=Bt(v);function I(e){var t;jn(t=["next","throw","return"]).call(t,(function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,r){function n(i,a,s,c){var u=p(e[i],e,a);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==t(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):r.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;this._invoke=function(e,t){function o(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(o,o):o()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],jn(e).call(e,b,this),this.reset(!0)}function E(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=g,d(M,"constructor",g),d(g,"constructor",f),f.displayName=d(g,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Ht?Ht(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Bt(M),e},n.awrap=function(e){return{__await:e}},I(T.prototype),d(T.prototype,c,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,i,o){void 0===o&&(o=gs);var a=new T(l(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(M),d(M,u,"Generator"),d(M,s,(function(){return this})),d(M,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return qc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=E,_.prototype={constructor:_,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,jn(t=this.tryEntries).call(t,C),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+Yc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})),$l=Ql(),zl=$l;try{regeneratorRuntime=$l}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=$l:Function("r","regeneratorRuntime = r")($l)}function Jl(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function Xl(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function Zl(e){return null!=e&&"object"==typeof e&&Pc(e)==Object.prototype}function ep(e,t){var r=Zl(e)||ki(e),n=Zl(t)||ki(t);if(r&&n){for(var i in t){var o=ep(e[i],t[i]);void 0!==o&&(e[i]=o)}return e}return t}var tp={setLogger:function(e){throw new Error("setLogger not implemented.")},platform:"",WebSocket:function(){function e(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=e.prototype;return t.close=function(e,t){throw new Error("Method not implemented.")},t.send=function(e){throw new Error("Method not implemented.")},t.onclose=function(e){throw new Error("Method not implemented.")},t.onerror=function(e){throw new Error("Method not implemented.")},t.onmessage=function(e){throw new Error("Method not implemented.")},t.onopen=function(e){throw new Error("Method not implemented.")},e}(),localStorage:{},request:function(e,t){throw new Error("request not implemented.")},uploadFile:function(e){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation:function(e){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:{getNetworkStatus:function(){return gs.resolve({net_type:0,net_connect:!0})},onNetworkStatusChange:function(e){},offNetworkStatusChange:function(){}},logStorage:function(){function e(e){}var t=e.prototype;return t.open=function(){return gs.resolve()},t.close=function(){},t.addLogs=function(e){return gs.resolve()},t.extractLogs=function(){return gs.resolve()},e}()},rp=["error","warn","log","debug"],np=function(){},ip=["off","error","warn","log","debug"],op=function(){function e(e,t){void 0===t&&(t={}),this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=np,this.log=np,this.warn=np,this.error=np,this.iid=Math.round(1e3*Math.random()),this.debugLevel=au(ip).call(ip,e)?e:"off",t.debugLevel&&(this.debugLevel=au(ip).call(ip,t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=!1===t.storageEnable?null:new tp.logStorage(null==t?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),this.open()}var t=e.prototype;return t.getDebugMode=function(){return"debug"===this.debugLevel},t.open=function(e){var t=this;this.logStorage&&this.logStorage.open(e).then((function(){t.log("Logger::open success")})).catch((function(e){t.warn("Logger::open failed",e)}))},t.setOptions=function(e){if(e&&e.logFunc){var t=e.logFunc;for(var r in t){var n=r,i=t[n];i&&(this.strategies[n].func=i)}}},t.setLogFunc=function(e,t){var r=this;void 0===t&&(t="log");var n=$n(rp).call(rp,(function(t){return t===e})),i=$n(rp).call(rp,(function(e){return e===t}));jn(rp).call(rp,(function(e,t){r[e]=function(){if(!(t>n&&t>i)){var r=Yc(Array.prototype).call(arguments),o=this.strategies[e],a=this.formatArgs(r,o.name);t<=i&&this.logStorage&&this.prepareSaveLog(a,e),t<=n&&o.func(a)}}}))},t.extractLogs=function(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.extractLogs():gs.resolve("")},t.prepareSaveLog=function(e,t){this.storageArr.push({text:e,level:t,time:Es(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])},t.saveLogs=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logStorage){e.next=2;break}return e.abrupt("return");case 2:return t=this.storageArr,this.storageArr=[],e.prev=4,e.next=7,this.logStorage.addLogs(t);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:case"end":return e.stop()}}),e,this,[[4,9]])})))},t.clearTimer=function(){this.timer&&clearTimeout(this.timer),this.timer=0},t.setTimer=function(){var e;this.clearTimer(),this.timer=Bs(tr(e=this.triggerTimer).call(e,this),5e3)},t.triggerTimer=function(){this.clearTimer(),this.saveLogs()},t.formatArgs=function(e,t){var r=new Date;return"[NIM "+this.iid+" "+t+" "+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds()+"] "+lu(e).call(e,(function(e){return e instanceof kl?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?Ei(e):e})).join(" ")},t.destroy=function(){this.debug=np,this.log=np,this.warn=np,this.error=np,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()},e}(),ap=Math.min,sp=[].lastIndexOf,cp=!!sp&&1/[1].lastIndexOf(1,-0)<0,up=Un("lastIndexOf"),dp=cp||!up?function(e){if(cp)return h(sp,this,arguments)||0;var t=U(this),r=Mt(t),n=r-1;for(arguments.length>1&&(n=ap(n,mt(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:sp;nt({target:"Array",proto:!0,forced:dp!==[].lastIndexOf},{lastIndexOf:dp});var lp,pp=Xt("Array").lastIndexOf,mp=Array.prototype,hp=function(e){var t=e.lastIndexOf;return e===mp||j(mp,e)&&t===mp.lastIndexOf?pp:t},fp="\t\n\v\f\r \u2028\u2029\ufeff",gp=M("".replace),vp="["+fp+"]",yp=RegExp("^"+vp+vp+"*"),Mp=RegExp(vp+vp+"*$"),Ip=function(e){return function(t){var r=Xi(V(t));return 1&e&&(r=gp(r,yp,"")),2&e&&(r=gp(r,Mp,"")),r}},Tp={start:Ip(1),end:Ip(2),trim:Ip(3)},Sp=Pr.PROPER,bp=Tp.trim;nt({target:"String",proto:!0,forced:(lp="trim",u((function(){return!!fp[lp]()||""!==""[lp]()||Sp&&fp[lp].name!==lp})))},{trim:function(){return bp(this)}});var Cp,_p=Xt("String").trim,Ep=String.prototype,kp=function(e){var t=e.trim;return"string"==typeof e||e===Ep||j(Ep,e)&&t===Ep.trim?_p:t},wp=(Cp=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Cp()+Cp()+Cp()+Cp()+Cp()+Cp()+Cp()+Cp()});function Rp(e){var t;return gu(t=fr(e)).call(t,(function(e){return!(+e>=0)}))}function Ap(e,t){var r,n=gu(r=fr(e)).call(r,(function(r){return e[r]==t}));return n.length>0?n[0]:void 0}function xp(e,t){if(void 0===t&&(t="-"),!e)throw new Nl("No sessionId",{},400);var r=wu(e).call(e,t);if(-1===r)throw new Nl("Can not find conjunctions",{},400);var n=Yc(e).call(e,0,r);return{accid:Yc(e).call(e,r+1),scene:"super_team"===n?"superTeam":n}}function Np(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}function Op(e,t){return function(e,t,r,n){for(var i in e=e||{},r=r||{},n=n||function(){},t=t||{}){var o=n(e[i],t[i]);e[i]=void 0===o?t[i]:o}for(var a in r){var s=n(e[a],r[a]);e[a]=void 0===s?r[a]:s}return e}({},e,t,(function(e,t){return void 0===t?e:t}))}function Pp(){return gs.resolve()}function Lp(){}function Vp(e){var t=hp(e).call(e,"."),r=t>-1?Yc(e).call(e,t+1):"";return/^\d+$/.test(kp(r).call(r))&&(r=""),r}function Up(e,t,r){return 0===e.length||e[0][t]<=r?0:e[e.length-1][t]>r?e.length:$n(e).call(e,(function(n,i){if(e[i-1]&&e[i-1][t]>r&&r>=n[t])return!0}))}var Dp=function(){function e(e){this.lastSuccUploadHost="",this.core=e}var t=e.prototype;return t.getFileUploadInformation=function(e){return tp.getFileUploadInformation(e)},t.request=function(e,t,r){var n=this,i=(new Date).getTime(),o=(null==r?void 0:r.exception_service)||0;return tp.request(e,t).catch((function(r){var a,s,c,u,d=r;throw n.core.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account||(null===(s=null===(a=n.core)||void 0===a?void 0:a.auth)||void 0===s?void 0:s.account),trace_id:null===(u=null===(c=n.core.clientSocket)||void 0===c?void 0:c.socket)||void 0===u?void 0:u.sessionId,start_time:i,action:1,exception_service:o}),n.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof d.code?d.code:0,description:d.message||""+d.code,operation_type:0,target:e,context:t?Ei(t):""},{asyncParams:tp.net.getNetworkStatus()}),n.core.reporter.reportTraceEnd("exceptions",1),r}))},t.uploadFile=function(e){var t,r,n,i;return Xl(this,void 0,void 0,zl.mark((function o(){var a,s,c,u,d,l,p,m,h,f,g,v,y,M;return zl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:c="BROWSER"===tp.platform,u=c?e.chunkUploadHostBackupList:e.commonUploadHostBackupList,d=c?e.chunkUploadHost:e.commonUploadHost,l=wu(u).call(u,d),p=-1===l?Os(a=[d]).call(a,u):Os(s=[d]).call(s,Yc(u).call(u,0,l),Yc(u).call(u,l+1)),m=Math.max(wu(p).call(p,this.lastSuccUploadHost),0),h=null,f=0;case 8:if(!(f<p.length)){o.next=32;break}return g=(new Date).getTime(),v=p[(f+m)%p.length],o.prev=11,o.next=14,tp.uploadFile(dr(dr({},e),c?{chunkUploadHost:v}:{commonUploadHost:v}));case 14:return y=o.sent,this.lastSuccUploadHost=v,o.abrupt("return",y);case 19:if(o.prev=19,o.t0=o.catch(11),this.core.cloudStorage.nos.nosErrorCount--,h=o.t0,M=o.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(r=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===r?void 0:r.account),trace_id:null===(i=null===(n=this.core.clientSocket)||void 0===n?void 0:n.socket)||void 0===i?void 0:i.sessionId,start_time:g,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof M.code?M.code:0,description:M.message||""+M.code,operation_type:1,target:v},{asyncParams:tp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),!o.t0||o.t0.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&10499!==o.t0.errCode){o.next=29;break}throw o.t0;case 29:f++,o.next=8;break;case 32:throw h;case 33:case"end":return o.stop()}}),o,this,[[11,19]])})))},e}(),qp="weblink.netease.im:443",Bp=["https://lbs.netease.im/lbs/webconf.jsp"],Fp="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Gp="imElite_sdk_abtest_web",jp="https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com",Hp=function(){function e(e,t){this.abtInfo={},this.core=e,this.config=Op({isAbtestEnable:!0,abtestUrl:Fp,abtestProjectKey:Gp},t)}var t=e.prototype;return t.setOptions=function(e){this.config=Op(this.config,e)},t.abtRequest=function(){var e,t;return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.config.isAbtestEnable){r.next=2;break}return r.abrupt("return");case 2:if(!this.abtInfo.experiments){r.next=4;break}return r.abrupt("return");case 4:if(this.config.abtestUrl){r.next=6;break}return r.abrupt("return");case 6:return r.prev=6,r.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.8.25",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:n=r.sent,r.next=15;break;case 12:r.prev=12,r.t0=r.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{};case 16:case"end":return r.stop()}}),r,this,[[6,12]])})))},e}();function Wp(e){var t={},r=new gs((function(e,r){t.abort=r}));return t.promise=gs.race([e,r]),t}gs.reject;var Yp=function(){function e(){this.abortFns=[]}var t=e.prototype;return t.add=function(e){var t=Wp(e);return this.abortFns.push(t.abort),t.promise},t.clear=function(e){var t;jn(t=this.abortFns).call(t,(function(t){return t(e||new kl({code:Cl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function(){this.clear()},e}(),Kp=Tp.trim,Qp=c.parseInt,$p=c.Symbol,zp=$p&&$p.iterator,Jp=/^[+-]?0x/i,Xp=M(Jp.exec),Zp=8!==Qp(fp+"08")||22!==Qp(fp+"0x16")||zp&&!u((function(){Qp(Object(zp))}))?function(e,t){var r=Kp(Xi(e));return Qp(r,t>>>0||(Xp(Jp,r)?16:10))}:Qp;nt({global:!0,forced:parseInt!=Zp},{parseInt:Zp});var em=B.parseInt;function tm(e,t){if("object"!=typeof e||null===e)return e;for(var r=(t=t||"").split("."),n=0;n<r.length;n++){var i=r[n],o=e[i],a=wu(i).call(i,"["),s=wu(i).call(i,"]");if(-1!==a&&-1!==s&&a<s){var c=Yc(i).call(i,0,a),u=em(Yc(i).call(i,a+1,s));o=e[c],o=ki(o)?o[u]:void 0}if(null==o)return o;e=o}return e}var rm={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},nm={timestamp:0,rtt:0,baseClock:0,baseTime:0},im=function(){function e(e,t,r){void 0===r&&(r="getServerTime"),this.serverOrigin=nm,this.config=rm,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new Yp,this.cmdName=r,t&&this.setOptions(t)}var t=e.prototype;return t.setOptions=function(e){this.config=dr({},rm,this.config,e)},t.reset=function(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=nm,this.currentChance=0},t.setOriginTimetick=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o,a,s,c,u,d;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.isSettingNTP){e.next=4;break}return e.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){e.next=6;break}return e.abrupt("return");case 6:if(t=tm(this.core,"auth.status"),r=tm(this.core,"status"),n=tm(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===r||1===n){e.next=11;break}return e.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,i="TimeOrigin::setOriginTimetick:",o=Es(),this.core.logger.debug(i+" getServerTime start, times "+this.currentChance),e.prev=18,e.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:s=e.sent,a=tm(s,"content.time"),this.isSettingNTP=!1,e.next=33;break;case 26:return e.prev=26,e.t0=e.catch(18),c=e.t0,this.isSettingNTP=!1,this.logger.warn(i+" Calculate Delay time, getServerTime error",c),c.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&(clearTimeout(this.timer),this.timer=Bs(tr(u=this.setOriginTimetick).call(u,this),this.failedDelay)),e.abrupt("return");case 33:if(a){e.next=37;break}return this.core.logger.warn(i+" Calculate Delay time incorrect format"),this.config.enable=!1,e.abrupt("return");case 37:d=Es()-o,this.doSet(a,d);case 39:case"end":return e.stop()}}),e,this,[[18,26]])})))},t.doSet=function(e,t){var r,n="TimeOrigin::setOriginTimetick:";if(t>this.config.tolerantRTT)this.logger.warn(n+" denied RTT:"+t),clearTimeout(this.timer),this.timer=Bs(tr(r=this.setOriginTimetick).call(r,this),this.failedDelay);else if(t>this.config.bestRTT){var i;this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.warn(n+" ignore RTT:"+t):(this.setServerOrigin(t,e),this.logger.log(n+" accept reluctantly RTT:"+t)),clearTimeout(this.timer),this.timer=Bs(tr(i=this.setOriginTimetick).call(i,this),this.failedDelay)}else{var o;this.setServerOrigin(t,e),this.logger.debug(n+" accept best RTT:"+t),this.currentChance=0,clearTimeout(this.timer),this.timer=Bs(tr(o=this.setOriginTimetick).call(o,this),this.successDelay)}},t.getNTPTime=function(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return Es()},t.checkNodeReliable=function(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,r=e.time-this.serverOrigin.baseTime;return Math.abs(r-t)<500}return!1},t.checkPerformance=function(){return"BROWSER"===tp.platform&&!("undefined"==typeof performance||!performance.now)},e.checkPerformance=function(){return"BROWSER"===tp.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function(){return{clock:this.checkPerformance()?performance.now():0,time:Es()}},e.getTimeNode=function(){return{clock:e.checkPerformance()?performance.now():0,time:Es()}},t.setServerOrigin=function(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:Es()}},e}(),om={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},am=function(){function e(e,t){this.traceData=om,this.core=e,this.traceData=dr({},om,t),this.traceData.extension=[]}var t=e.prototype;return t.reset=function(){this.traceData=dr({},om),this.traceData.extension=[]},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tp.net.getNetworkStatus();case 2:r=t.sent,n=r.net_type,i=r.net_connect,this.traceData.extension.push(dr({code:0,foreground:!0,foreg_backg_switch:!1,net_type:n,net_connect:i},e));case 6:case"end":return t.stop()}}),t,this)})))},t.end=function(e){var t=this.traceData.extension[0],r=this.traceData.extension[1];if(t&&0===t.operation_type&&r&&1===r.operation_type){var n=t.net_type!==r.net_type||t.net_connect!==r.net_connect;if(e||!n)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},e}(),sm={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},cm=function(){function e(e){this.traceData=sm,this.core=e,this.reset()}var t=e.prototype;return t.reset=function(){this.traceData=dr({},sm),this.traceData.history=[]},t.start=function(e){this.reset(),this.traceData.user_id=e,this.traceData.start_time=Es()},t.updateBegin=function(e){this.traceData.history.push(dr({head:"",body:"",start_time:Es(),httpdns:!1,index:0},e))},t.updateComplete=function(e){var t;jn(t=this.traceData.history).call(t,(function(t){t.target===e.target&&(dr(t,e),t.duration=Es()-t.start_time)}))},t.end=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.succeed=e,this.traceData.history=gu(r=this.traceData.history).call(r,(function(e){return void 0!==e.code})),0!==this.traceData.history.length){t.next=5;break}return this.reset(),t.abrupt("return");case 5:return this.traceData.duration=Es()-this.traceData.start_time,t.next=8,tp.net.getNetworkStatus();case 8:n=t.sent,i=n.net_type,o=n.net_connect,this.traceData.net_type=i,this.traceData.net_connect=o,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return t.stop()}}),t,this)})))},e}();function um(e){var t,r,n=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?n=e.reporterConfig.enableCompass:"boolean"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.isDataReportEnable)&&(n=e.reporterConfig.isDataReportEnable),n}var dm={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},lm="ReporterHook::setMonitorForResources:",pm=function(){function e(e,t){this.traceData=dm,this.core=e,this.traceData=dr({},dm,t)}var t=e.prototype;return t.reset=function(){this.traceData=dr({},dm)},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Es()},t.update=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.user_id){t.next=2;break}return t.abrupt("return");case 2:this.core.logger.log(lm+" upload update",e),dr(this.traceData,e);case 4:case"end":return t.stop()}}),t,this)})))},t.end=function(e){this.traceData.user_id&&(this.core.logger.log(lm+" upload end cause of "+e),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():Es())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=dm)},e}(),mm={},hm={},fm={},gm={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:ir,lbsUrls:Bp,linkUrl:qp,abtestUrl:Fp,isAbtestEnable:!0},vm=function(e){function t(r,n){var i,o,a;if(void 0===n&&(n={}),(a=e.call(this)||this).instanceName="NIM",a.pluginMap={},a.eventBus=new Fs,a.options={},a.V2NIMConversationIdUtil={},a.V2NIMMessageCreator={},a.V2NIMMessageAttachmentCreator={},a.V2NIMClientAntispamUtil={},a.DataStructureConverter={},a.V2NIMMessageConverter={},a.V2NIMMessageLogUtil={},a.V2NIMMessageExtendUtil={},a.V2NIMStorageUtil={},a.V2NIMNotificationService={},a.V2NIMStorageService={},a.auth={},a.V1NIMLoginService={},a.V2NIMLoginService={},a.clientSocket={},a.V2NIMSyncService={},a.V2NIMLocalConversationService={},a.V2NIMConversationService={},a.V2NIMConversationGroupService={},a.V2NIMMessageService={},a.V2NIMTeamService={},a.V2NIMUserService={},a.V2NIMFriendService={},a.V2NIMSettingService={},a.V2NIMAIService={},a.V2NIMSignallingService={},a.V2NIMSubscriptionService={},a.V2NIMPassthroughService={},a.YSFService={},a.offlinePush={},a.sync={},a.msg={},a.msgLog={},a.session={},a.cloudSession={},a.misc={},a.user={},a.friend={},a.systemMessage={},a.team={},a.event={},a.msgExtend={},a.cloudStorage={},a.passThrough={},a.superTeam={},a.plugin={},a.signaling={},a.qchatChannel={},a.qchatMedia={},a.qchatMsg={},a.qchatRole={},a.qchatServer={},a.pluginMap=fm,a.logger=new op(r.debugLevel,n.loggerConfig),n.privateConf){var s=a.getConfigFromPrivate(n.privateConf),c=s.authConfig,u=s.cloudStorageConfig,d=s.reporterConfig;dr(r,c),a.setInitOptions(r),a.otherOptions=dr(dr({},n),{cloudStorageConfig:dr(dr({storageKeyPrefix:"NIM"},n.cloudStorageConfig),u),reporterConfig:dr(dr({},n.reporterConfig),d),V1NIMLoginServiceConfig:dr(dr(dr({},r),n.V1NIMLoginServiceConfig),c),V2NIMLoginServiceConfig:dr(dr({},n.V2NIMLoginServiceConfig),c)})}else a.setInitOptions(r),a.otherOptions=dr(dr({},n),{V1NIMLoginServiceConfig:dr(dr({},r),n.V1NIMLoginServiceConfig),cloudStorageConfig:dr({storageKeyPrefix:"NIM"},n.cloudStorageConfig)});a.timerManager=new Yl,a.timeOrigin=new im(ut(a)),a.adapters=new Dp(ut(a)),a.abtest=new Hp(ut(a),dr(dr({isAbtestEnable:a.options.isAbtestEnable,abtestUrl:a.options.abtestUrl},a.otherOptions.abtestConfig),{abtestProjectKey:Gp}));var l=tp.getSystemInfo(),p=function(e,t){var r,n,i=null===(r=null==t?void 0:t.reporterConfig)||void 0===r?void 0:r.compassDataEndpoint,o=null===(n=null==t?void 0:t.reporterConfig)||void 0===n?void 0:n.reportConfigUrl;if(i)return i;if(o){var a=o.match(/^https:\/\/([^/]+)\/*/);return ki(a)&&a.length>=1?"https://"+a[1]:(e.error("Invalid reportConfigUrl: "+o),jp)}return jp}(a.logger,a.otherOptions);a.reporter=new vu(dr(dr({},p?{compassDataEndpoint:p}:{}),{isDataReportEnable:um(a.otherOptions),common:{app_key:r.appkey,dev_id:"",platform:"Web",sdk_ver:"10.8.25",env:"online",os_name:l.os,os_ver:l.osVer,lib_env:l.libEnv,host_env:l.hostEnv,host_env_ver:l.hostEnvVer,manufactor:l.manufactor,model:l.model,v2:"v1"!==a.options.apiVersion},request:tp.request,logger:a.logger,autoStart:!0})),a.reporterHookLinkKeep=new am(ut(a)),a.reporterHookCloudStorage=new pm(ut(a)),a.reporterHookLBS=new cm(ut(a)),tp.setLogger(a.logger);var m=a.getServiceKeys(fr(mm));return jn(m).call(m,(function(e){if(!a[e]||!a[e].name){var t=mm[e];a[e]=new t(ut(a))}})),jn(i=fr(mm)).call(i,(function(e){a.callSetOptions(e)})),jn(o=fr(hm)).call(o,(function(e){var t=hm[e];void 0!==t&&(a[e]=new t(ut(a)))})),t.instance=ut(a),a.logger.log("NIM init, version:10.8.25, sdk version:100825, appkey:"+r.appkey),a}nr(t,e);var r=t.prototype;return r.getServiceKeys=function(e){var t=$n(e).call(e,(function(e){return"V1NIMLoginService"===e}));if(t>-1){var r=e[t];li(e).call(e,t,1),"v1"===this.options.apiVersion&&e.unshift(r)}var n=$n(e).call(e,(function(e){return"V2NIMLoginService"===e}));if(n>-1){var i=e[n];li(e).call(e,n,1),"v2"===this.options.apiVersion&&e.unshift(i)}var o=$n(e).call(e,(function(e){return"sync"===e}));if(o>-1){var a=e[o];li(e).call(e,o,1),"v1"===this.options.apiVersion&&e.push(a)}var s=$n(e).call(e,(function(e){return"V2NIMSyncService"===e}));if(s>-1){var c=e[s];li(e).call(e,s,1),"v2"===this.options.apiVersion&&e.push(c)}return e},t.getInstance=function(e,r){if(!t.instance){if(e)return new t(e,r);throw new Error("Instance not exist, please input options")}if(e){if(t.instance.options.account===e.account&&t.instance.options.appkey===e.appkey)return t.instance.setOptions(e),t.instance;throw new Error("Unexpected login")}return t.instance},r.setInitOptions=function(e){Vl({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=dr(dr({},gm),e)},r.getConfigFromPrivate=function(e){var t;return e?{authConfig:JSON.parse(Ei({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0,linkSSL:null!==(t=e.websdkSsl)&&void 0!==t?t:void 0})),cloudStorageConfig:JSON.parse(Ei({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?(e.nosSsl?"https://":"http://")+e.nos_downloader_v2:void 0,downloadUrl:void 0!==e.nos_accelerate?e.nos_accelerate:void 0,downloadHostList:""===e.nos_accelerate_host?[]:"string"==typeof e.nos_accelerate_host?[e.nos_accelerate_host]:ki(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(Ei({enableCompass:"boolean"==typeof e.enableCompass?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}},r.connect=function(e){return void 0===e&&(e={}),this.V1NIMLoginService.login(e)},r.setOptions=function(e){if("object"==typeof e&&null!==e){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});Vl({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=dr(dr({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},r.getOptions=function(){return this.options},r.disconnect=function(){return this.V1NIMLoginService.logout()},r._disconnect=function(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===tm(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===tm(this.V2NIMLoginService,"lifeCycle.loginStatus")?gs.resolve():this.V2NIMLoginService.logout():gs.resolve()},r.destroy=function(){var e=this;return t.instance=void 0,this._disconnect().then((function(){e.status="destroyed",e.removeAllListeners(),e.eventBus.removeAllListeners(),e.logger.destroy(),e.reporter.destroy(),e.timerManager.destroy(),e._clearModuleData("destroy"),e._removeAllModuleListeners(),e.connect=Pp,e.disconnect=Pp,e._disconnect=Pp,e.destroy=Pp}))},r._clearModuleData=function(e){void 0===e&&(e="logout");var t=bs(this);jn(t).call(t,(function(t){t&&"function"==typeof t.reset&&t.reset(e)}))},r._removeAllModuleListeners=function(){var e=bs(this);jn(e).call(e,(function(e){e&&"function"==typeof e.removeAllListeners&&e.removeAllListeners()}))},r.kick=function(e){return this.V1NIMLoginService.kick(e)},r.sendCmd=function(e,t,r){return this.clientSocket.sendCmd(e,t,r)},r.emit=function(t){var r=this;try{for(var n,i,o=Es(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];var u=(n=e.prototype.emit).call.apply(n,Os(i=[this,t]).call(i,s)),d=Es()-o;return d>=10&&this.logger.warn("Core::emit event: "+t+" process takes: "+d+"ms"),u}catch(e){return this.logger.error("Core::emit event: "+t+". Error: "+e),Bs((function(){throw r.logger.error("Core::emit throw error in setTimeout. event: "+t+". Error: "+e),e}),0),!1}},r._registerDep=function(e,t){this[t]&&this[t].name||(this[t]=new e(this),this.callSetOptions(t))},r.callSetOptions=function(e){var t=e+"Config",r=e+"Options",n=this.otherOptions[t]||this.otherOptions[r]||{},i=tm(this,e+".setOptions");"function"==typeof i&&("cloudStorage"===e&&(n=this.otherOptions[t]||this.otherOptions.serverConfig||{}),i.call(this[e],n))},t.registerService=function(e,t){mm[t]=e},t.registerPrivateService=function(e,t){hm[t]=e},t.registerPlugin=function(e,t){fm[t]=e},ct(t,[{key:"account",get:function(){return this.auth.account}},{key:"status",get:function(){return this.V1NIMLoginService.status},set:function(e){this.V1NIMLoginService.status=e}},{key:"config",get:function(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),t}(Fs);vm.sdkVersion=100825,vm.sdkVersionFormat="10.8.25";var ym=i((function(e,t){e.exports=function(){function e(e){if(e){var t,r="";return jn(t=fr(e)).call(t,(function(t,n){r+=0===n?"?":"&",r+=t+"="+e[t]})),r}return""}var t=function(e){function t(t,r,n,i){var o;return(o=e.call(this,n)||this).source=t,o.code=r,o.desc=n,o.detail=i||{},o}return nr(t,e),t}(Id(Error));function r(r,n){void 0===n&&(n={dataType:"json",method:"GET",timeout:5e3});var i="text"===n.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",o="GET"===n.method?e(n.params):"";return new gs((function(e,a){if(window.XMLHttpRequest){var s,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){try{s=JSON.parse(c.response||"{}")}catch(t){s=c.response}e({status:c.status,data:s})}else Bs((function(){a(new t(1,c.status,"readyState: "+c.readyState+"; statusText: "+c.statusText))}),0)},c.open(n.method,""+r+o),c.timeout=n.timeout||5e3,c.setRequestHeader("Content-Type",i),n.headers)for(var u in n.headers)c.setRequestHeader(u,n.headers[u]);c.ontimeout=function(e){a(new t(1,408,e&&e.message?e.message:"request timeout"))},c.send(Ei(n.data))}else a(new t(2,10400,"request no suppout"))}))}return r}()})),Mm=Math.floor,Im=function(e,t){var r=e.length,n=Mm(r/2);return r<8?Tm(e,t):Sm(e,Im(Ws(e,0,n),t),Im(Ws(e,n),t),t)},Tm=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},Sm=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},bm=Im,Cm=H.match(/firefox\/(\d+)/i),_m=!!Cm&&+Cm[1],Em=/MSIE|Trident/.test(H),km=H.match(/AppleWebKit\/(\d+)\./),wm=!!km&&+km[1],Rm=[],Am=M(Rm.sort),xm=M(Rm.push),Nm=u((function(){Rm.sort(void 0)})),Om=u((function(){Rm.sort(null)})),Pm=Un("sort"),Lm=!u((function(){if($)return $<70;if(!(_m&&_m>3)){if(Em)return!0;if(wm)return wm<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Rm.push({k:t+n,v:r})}for(Rm.sort((function(e,t){return t.v-e.v})),n=0;n<Rm.length;n++)t=Rm[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));nt({target:"Array",proto:!0,forced:Nm||!Om||!Pm||!Lm},{sort:function(e){void 0!==e&&ne(e);var t=le(this);if(Lm)return void 0===e?Am(t):Am(t,e);var r,n,i=[],o=Mt(t);for(n=0;n<o;n++)n in t&&xm(i,t[n]);for(bm(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Xi(t)>Xi(r)?1:-1}}(e)),r=Mt(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)ni(t,n++);return t}});var Vm=Xt("Array").sort,Um=Array.prototype,Dm=function(e){var t=e.sort;return e===Um||j(Um,e)&&t===Um.sort?Vm:t},qm=i((function(e,t){self,e.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&st(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return T}});var r=function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(e){},this.onProgress=function(e){},this.onUploadProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]};function n(e,t){var r=void 0!==Nc&&jl(e)||e["@@iterator"];if(!r){if(ki(e)||(r=function(e,t){if(e){var r;if("string"==typeof e)return i(e,t);var n=Yc(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o={privateObj:{},setItem:function(e,t){o.privateObj[e]=t},getItem:function(e){return o.privateObj[e]},removeItem:function(e){delete o.privateObj[e]},getKeys:function(){return fr(o.privateObj)}},a={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return"_NosUploader_"+e.name+Yc(t).call(t,t.length-5)+Yc(r).call(r,r.length-5)},getFileInfo:function(e){var t=o.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t,r){a.clearExpiredInfo();var n=this.getFileKey(t),i={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Es(),end:!1};return e.payload&&(i.payload=e.payload),r&&o.setItem(n,Ei(i)),n},setUploadContext:function(e,t,r){var n=this.getFileInfo(e);n&&(n.ctx=t,r&&o.setItem(e,Ei(n)))},setComplete:function(e,t){var r=this.getFileInfo(e);r&&(r.modifyAt=Es(),r.end=!0,t&&o.setItem(e,Ei(r)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){0===wu(e).call(e,"_NosUploader_")&&o.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof o.getKeys?o.getKeys():fr(o),r=Es(),i=[],s=n(t);try{for(s.s();!(e=s.n()).done;){var c=e.value;if(0===wu(c).call(c,"_NosUploader_")){var u=a.getFileInfo(c);null===u||r-u.modifyAt>T.expireTime?o.removeItem(c):i.push({fileInfo:u,key:c})}}}catch(e){s.e(e)}finally{s.f()}if(i.length>T.maxFileCache){var d,l,p=n(Yc(d=Dm(i).call(i,(function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt}))).call(d,T.maxFileCache));try{for(p.s();!(l=p.n()).done;){var m,h=l.value;0===wu(m=h.key).call(m,"_NosUploader_")&&o.removeItem(h.key)}}catch(e){p.e(e)}finally{p.f()}}}},s=a;function c(e){return(c="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){var t="function"==typeof sd?new sd:void 0;return(d=function(e){var r,n;if(null===e||(n=e,-1===wu(r=Function.toString.call(n)).call(r,"[native code]")))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,h(this).constructor)}return i.prototype=Bt(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),m(i,e)})(e)}function l(e,t,r){return(l=p()?gd:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(tr(Function).apply(e,n));return r&&m(i,r.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!gd)return!1;if(gd.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(gd(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t){return(m=Ht||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Ht?Pc:function(e){return e.__proto__||Pc(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Bt(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(i,e);var t,r,n=(t=i,r=p(),function(){var e,n=h(t);if(r){var i=h(this).constructor;e=gd(n,arguments,i)}else e=n.apply(this,arguments);return u(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this,"NosUploadError:"+e)).errCode=t,r.errMsg=e,r}return i}(d(Error)),g=function e(t,r,n){if("uploading"===t.uploadState){var i=t.config,o=t.param,a=s.getUploadContext(t.fileKey);if(!a)return n(0);var c=new XMLHttpRequest,u=i.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName))+"?uploadContext"+"&context=".concat(a)+"&version=".concat(i.version);c.onreadystatechange=function(){var o;if("abort"!==t.uploadState&&4===c.readyState){var a,d,l,p;try{p=JSON.parse(c.responseText)}catch(t){p={errMsg:"JsonParseError in getOffset. xhr.status = "+c.status+". xhr.responseText: "+c.responseText,errCode:500}}200===c.status?p.errCode?t.config.onError(new f(p.errMsg,p.errCode)):n(p.offset):c.status.toString().match(/^5/)?e(t,r-1,n):r>0?("function"==typeof(null===(o=i.logger)||void 0===o?void 0:o.error)&&i.logger.error(Os(a="getOffset(".concat(u,") error. retry after 3 seconds. ")).call(a,(new Date).toTimeString())),Bs((function(){e(t,r-1,n)}),3500)):c.status?(s.removeFileInfo(t.fileKey),i.onError(new f(Os(d=Os(l="getOffset(".concat(u,") error: ")).call(l,c.status," ")).call(d,c.statusText)))):i.onError(new f("getOffset(".concat(u,") error. no Error Code")))}},c.open("get",u),c.setRequestHeader("x-nos-token",o.token),c.timeout=i.getOffsetTimeout,c.send()}},v=function e(t,r,n,i){if("uploading"===t.uploadState){var o=t.param,a=t.config,c=Yc(File.prototype),u=void 0!==o.ctx?o.ctx:"",d=r+a.trunkSize>=t.file.size,l=d?t.file.size:r+a.trunkSize,p=new XMLHttpRequest,m=a.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName));if(p.upload.onprogress=function(e){if("abort"!==t.uploadState){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,a.onProgress(n),a.onUploadProgress({loaded:e.loaded,total:t.file.size,percentage:n,percentageText:(100*n).toFixed(2)+"%"})):a.onError(new f("browser does not support query upload progress"))}},p.onreadystatechange=function(){var o,c;if("abort"!==t.uploadState&&4===p.readyState){var u,l,h,g;try{g=JSON.parse(p.responseText)}catch(t){"function"==typeof(null===(o=a.logger)||void 0===o?void 0:o.error)&&a.logger.error("JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText,t),g={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText}}200===p.status?(t.setContext(g.context),d?(i(),t.setComplete()):e(t,g.offset,a.retryCount,i)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,i):(s.removeFileInfo(t.fileKey),a.onError(new f(g.errMsg,g.errCode))):n>0?("function"==typeof(null===(c=a.logger)||void 0===c?void 0:c.error)&&a.logger.error(Os(u="uploadTrunk(".concat(m,") error. retry after 3 seconds. ")).call(u,(new Date).toTimeString())),Bs((function(){e(t,r,n-1,i)}),3500)):p.status?(s.removeFileInfo(t.fileKey),a.onError(new f(Os(l=Os(h="uploadTrunk(".concat(m,") error: ")).call(h,p.status," ")).call(l,p.statusText)))):a.onError(new f("uploadTrunk(".concat(m,") error. no Error Code. Please check your network")))}},p.open("post",m+"?offset=".concat(r)+"&complete=".concat(d)+"&context=".concat(u)+"&version=".concat(a.version)),p.setRequestHeader("x-nos-token",o.token),o.md5&&p.setRequestHeader("content-md5",o.md5),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=a.trunkUploadTimeout,"undefined"!=typeof FileReader){var h=new FileReader;h.addEventListener("load",(function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)instanceof ArrayBuffer&&e.target.result.byteLength>0?p.send(e.target.result):a.onError(new f("Read ArrayBuffer failed",194003))})),h.addEventListener("error",(function(e){var t=e.target.error;a.onError(new f("Read ArrayBuffer error. ".concat(t.toString()),194003))})),h.readAsArrayBuffer(c.call(t.file,r,l))}else p.send(c.call(t.file,r,l))}};function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}var M=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=s.initFile(r,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;g(this,t.retryCount,(function(r){v(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new f("Upload Aborted",10499)))}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){s.setUploadContext(this.fileKey,e,this.config.enableCache),this.param.ctx=e}},{key:"setComplete",value:function(){s.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&y(e.prototype,t),e}(),I={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(e){var t=s.getFileKey(e),r=s.getFileInfo(t);return null===r?null:Es()-r.modifyAt>I.expireTime?(s.removeFileInfo(t),null):{uploadInfo:dr({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){I.maxFileCache=e},setExpireTime:function(e){I.expireTime=e},printCaches:function(){if("undefined"!=typeof localStorage)for(var e=0,t=fr(localStorage);e<t.length;e++){var r=t[e],n=s.getFileInfo(r);n&&console.log(n,"modifiedAt",new Date(n.modifyAt).toTimeString())}},createConfig:function(e){return new r(e)},createTask:function(e,t,r){return new M(e,t,r)}},T=I;return t.default}()})),Bm=Vn.some,Fm=Un("some");nt({target:"Array",proto:!0,forced:!Fm},{some:function(e){return Bm(this,e,arguments.length>1?arguments[1]:void 0)}});var Gm=Xt("Array").some,jm=Array.prototype,Hm=function(e){var t=e.some;return e===jm||j(jm,e)&&t===jm.some?Gm:t},Wm={debug:function(){},log:function(){},warn:function(){},error:function(){}};function Ym(e){Wm=e}function Km(){if(!navigator||!navigator.userAgent)return!1;var e=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return Hm(e).call(e,(function(e){return navigator.userAgent.match(e)}))}function Qm(){var e;return!(!navigator||!navigator.userAgent)&&"object"==typeof navigator&&"string"==typeof navigator.userAgent&&wu(e=navigator.userAgent).call(e,"Electron")>=0}function $m(){return navigator&&navigator.userAgent}function zm(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Wm,e.fileInput||e.file){t.next=3;break}throw new Error("File not exist");case 3:if(!e.file){t.next=7;break}a=e.file,t.next=21;break;case 7:if("string"!=typeof e.fileInput){t.next=16;break}if(!((s=document.getElementById(e.fileInput))&&s.files&&s.files[0])){t.next=13;break}a=s.files[0],t.next=14;break;case 13:throw new Error("Can not get file from fileInput");case 14:t.next=21;break;case 16:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){t.next=20;break}a=e.fileInput.files[0],t.next=21;break;case 20:throw new Error("Can not get file from fileInput "+e.fileInput);case 21:if(!(e.maxSize&&a.size>e.maxSize)){t.next=23;break}throw new Error("The file exceeds maxSize limit. maxSize: "+e.maxSize+", get "+a.size);case 23:return t.next=25,new gs((function(t,r){var n,i=qm.getFileUploadInformation(a),s=qm.createConfig({enableCache:!0,retryCount:0,directUploadAddr:e.chunkUploadHost,onError:function(e){r(e)},onUploadProgress:e.onUploadProgress||function(){},onComplete:function(e){t(e)}});if(i)if(i.complete)e.onUploadProgress&&e.onUploadProgress({total:a.size,loaded:a.size,percentage:1,percentageText:"100%"}),t(i.uploadInfo);else{n=qm.createTask(a,i.uploadInfo,s);try{e.onUploadStart&&e.onUploadStart(n)}catch(e){o.error("Adapter uploadFile: options.onUploadStart error",e&&e.message),n.abort(),r(e)}}else{n=qm.createTask(a,dr(dr({bucketName:e.nosToken.bucket,objectName:decodeURIComponent(e.nosToken.objectName),token:e.nosToken.token},e.md5?{md5:e.md5}:{}),e.payload?{payload:e.payload}:{}),s);try{e.onUploadStart&&e.onUploadStart(n)}catch(e){o.error("Adapter uploadFile: options.onUploadStart error",e&&e.message),n.abort(),r(e)}}}));case 25:return(c=t.sent).name=a.name,c.size=a.size,c.type=a.type,c.ext=hp(r=c.name).call(r,".")>-1?Yc(n=c.name).call(n,hp(i=c.name).call(i,".")+1).toLowerCase():"",t.abrupt("return",c);case 31:case"end":return t.stop()}}),t)})))}function Jm(e){var t;if(e.file)t=e.file;else if("string"==typeof e.fileInput){var r=document.getElementById(e.fileInput);if(!(r&&r.files&&r.files[0]))throw new Error("Can not get file from fileInput");t=r.files[0]}else{if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0]))throw new Error("Can not get file from fileInput "+e.fileInput);t=e.fileInput.files[0]}return qm.getFileUploadInformation(t)}
/*!
	 * Platform.js v1.3.6
	 * Copyright 2014-2020 Benjamin Tan
	 * Copyright 2011-2013 John-David Dalton
	 * Available under MIT license
	 */var Xm=i((function(e,r){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,i=r,o=e&&!e.nodeType&&e,a=i&&o&&"object"==typeof t&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(n=a);var s=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,d=u.hasOwnProperty,l=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function h(e,t){for(var r in e)d.call(e,r)&&t(e[r],r,e)}function f(e){return null==e?p(e):l.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=s)for(;++r<n;)t(e[r],r,e);else h(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var M=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=f(t);i&&(r=t,t=null);var o=r.navigator||{},a=o.userAgent||"";t||(t=a);var s,u,d=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(l.toString()),p="Object",M=i?p:"ScriptBridgingProxyObject",I=i?p:"Environment",T=i&&r.java?"JavaPackage":f(r.java),S=i?p:"RuntimeObject",b=/\bJava/.test(T)&&r.java,C=b&&f(r.environment)==I,_=b?"a":"",E=b?"b":"",k=r.document||{},w=r.operamini||r.opera,R=c.test(R=i&&w?w["[[Class]]"]:f(w))?R:w=null,A=t,x=[],N=null,O=t==a,P=O&&w&&"function"==typeof w.version&&w.version(),L=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return v(e,(function(e,r,n){return e||(r[U]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),q=function(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=m(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function F(e){return v(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(q)&&!U&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=y(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!U?U=B([D]):D&&U&&(U=U.replace(RegExp("^("+g(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+g(D)+")[-_.]?(\\w)","i"),D+" $2")),(s=/\bGoogle TV\b/.exec(U))&&(U=s[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&x.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(D=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,U=s.product):/^iP/.test(U)?(V||(V="Safari"),q="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test(q)?q="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(q)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",q=/\bAndroid\b/.test(q)?q:"Android"):"Silk"==V?(/\bMobi/i.test(t)||(q="Android",x.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&x.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?x.push("speed mode"):"PaleMoon"==V&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?x.push("identifying as Firefox "+s[1]):"Firefox"==V&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(q||(q="Firefox OS"),U||(U=s[1])):!V||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(V=null),(s=U||D||q)&&(U||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(q))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(q)?q:s)+" Browser")):"Electron"==V&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&x.push("Chromium "+s),P||(P=F(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(V),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(P)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==q?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(L=[s]),"IE"==V&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",q="Windows Phone "+(/\+$/.test(s)?s:s+".x"),x.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",q="Windows Phone 8.x",x.unshift("desktop mode"),P||(P=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(V&&x.push("identifying as "+V+(P?" "+P:"")),V="IE",P=s[1]),O){if(function(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}(r,"global"))if(b&&(A=(s=b.lang.System).getProperty("os.arch"),q=q||s.getProperty("os.name")+" "+s.getProperty("os.version")),C){try{P=r.require("ringo/engine").version.join("."),V="RingoJS"}catch(t){(s=r.system)&&s.global.system==r.system&&(V="Narwhal",q||(q=s[0].os||null))}V||(V="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(s=r.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(x.push("Node "+s.versions.node),V="Electron",P=s.versions.electron):"string"==typeof s.versions.nw&&(x.push("Chromium "+P,"Node "+s.versions.node),V="NW.js",P=s.versions.nw)),V||(V="Node.js",A=s.arch,q=s.platform,P=(P=/[\d.]+/.exec(s.version))?P[0]:null));else f(s=r.runtime)==M?(V="Adobe AIR",q=s.flash.system.Capabilities.os):f(s=r.phantom)==S?(V="PhantomJS",P=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof k.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(P=[P,k.documentMode],(s=+s[1]+4)!=P[1]&&(x.push("IE "+P[1]+" mode"),L&&(L[1]=""),P[1]=s),P="IE"==V?String(P[1].toFixed(1)):P[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(x.push("masking as "+V+" "+P),V="IE",P="11.0",L=["Trident"],q="Windows");q=q&&m(q)}if(P&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(P)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(O&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(N=/b/i.test(s)?"beta":"alpha",P=P.replace(RegExp(s+"\\+?$"),"")+("beta"==N?E:_)+(/\d+\+?/.exec(s)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(q))V="Firefox Mobile";else if("Maxthon"==V&&P)P=P.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(q=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&x.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||U||/Browser|Mobi/.test(V))||"Windows CE"!=q&&!/Mobi/i.test(t))if("IE"==V&&O)try{null===r.external&&x.unshift("platform preview")}catch(t){x.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(s=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||P)?(q=((s=[s,/BB10/.test(t)])[1]?(U=null,D="BlackBerry"):"Device Software")+" "+s[0],P=null):this!=h&&"Wii"!=U&&(O&&w||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(q)||"IE"==V&&(q&&!/^Win/.test(q)&&P>5.5||/\bWindows XP\b/.test(q)&&P>8||8==P&&!/\bTrident\b/.test(t)))&&!c.test(s=e.call(h,t.replace(c,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),c.test(V)?(/\bIE\b/.test(s)&&"Mac OS"==q&&(q=null),s="identify"+s):(s="mask"+s,V=R?m(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(q=null),O||(P=null)),L=["Presto"],x.push(s));else V+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==V&&"+"==s[1].slice(-1)?(V="WebKit Nightly",N="alpha",P=s[1].slice(0,-1)):P!=s[1]&&P!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(P=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),O&&(d||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==V&&(!P||parseInt(P)>45)?P=s:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&x.unshift("headless")),"Opera"==V&&(s=/\bzbov|zvav$/.exec(q))?(V+=" ",x.unshift("desktop mode"),"zvav"==s?(V+="Mini",P=null):V+="Mobile",q=q.replace(RegExp(" *"+s+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(L&&L[1])?(x.unshift("desktop mode"),V="Chrome Mobile",P=null,/\bOS X\b/.test(q)?(D="Apple",q="iOS 4.3+"):q=null):/\bSRWare Iron\b/.test(V)&&!P&&(P=F("Chrome")),P&&0==P.indexOf(s=/[\d.]+$/.exec(q))&&t.indexOf("/"+s+"-")>-1&&(q=y(q.replace(s,""))),q&&-1!=q.indexOf(V)&&!RegExp(V+" OS").test(q)&&(q=q.replace(RegExp(" *"+g(V)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(q)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&L[1])&&(s=L[L.length-1])&&x.push(s),x.length&&(x=["("+x.join("; ")+")"]),D&&U&&U.indexOf(D)<0&&x.push("on "+D),U&&x.push((/^on /.test(x[x.length-1])?"":"on ")+U),q&&(s=/ ([\d.+]+)$/.exec(q),u=s&&"/"==q.charAt(q.length-s[0].length-1),q={architecture:32,family:s&&!u?q.replace(s[0],""):q,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(q&&(q.architecture=64,q.family=q.family.replace(RegExp(" *"+s),"")),V&&(/\bWOW64\b/i.test(t)||O&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&x.unshift("32-bit")):q&&/^OS X/.test(q.family)&&"Chrome"==V&&parseFloat(P)>=39&&(q.architecture=64),t||(t=null);var G={};return G.description=t,G.layout=L&&L[0],G.manufacturer=D,G.name=V,G.prerelease=N,G.product=U,G.ua=t,G.version=V&&P,G.os=q||{architecture:null,family:null,version:null,toString:function(){return"null"}},G.parse=e,G.toString=function(){return this.description||""},G.version&&x.unshift(P),G.name&&x.unshift(V),q&&V&&(q!=String(q).split(" ")[0]||q!=V.split(" ")[0]&&!U)&&x.push(U?"("+q+")":"on "+q),x.length&&(G.description=x.join(" ")),G}();i&&o?h(M,(function(e,t){i[t]=e})):n.platform=M}).call(t)}));function Zm(){var e,t,r=Xm.version||"";if(Qm())try{var n=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);n&&n[1]&&"string"==typeof n[1]&&(r=n[1])}catch(e){}return{os:(null===(e=Xm.os)||void 0===e?void 0:e.family)||"",osVer:(null===(t=Xm.os)||void 0===t?void 0:t.version)||"",browser:Xm.name||"",browserVer:Xm.version||"",libEnv:"BROWSER",hostEnv:Qm()?"Electron":Km()?"H5":$m()?"BROWSER":"Unset",hostEnvEnum:Qm()?5:Km()?101:$m()?100:0,hostEnvVer:r,userAgent:navigator&&navigator.userAgent,model:r,manufactor:Xm.name||""}}var eh=null,th=null,rh={getNetworkStatus:function(){return gs.resolve({net_type:0,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function(e){eh=function(){e({isConnected:!0,networkType:0})},th=function(){e({isConnected:!1,networkType:0})},window.addEventListener("online",eh),window.addEventListener("offline",th)},offNetworkStatusChange:function(){eh&&window.removeEventListener("online",eh),th&&window.removeEventListener("offline",th),eh=null,th=null}},nh=Vn.find,ih="find",oh=!0;ih in[]&&Array(1).find((function(){oh=!1})),nt({target:"Array",proto:!0,forced:oh},{find:function(e){return nh(this,e,arguments.length>1?arguments[1]:void 0)}});var ah=Xt("Array").find,sh=Array.prototype,ch=function(e){var t=e.find;return e===sh||j(sh,e)&&t===sh.find?ah:t},uh="log",dh=function(){function e(e,t){this.db=null,this.stores=[],this.name=e,this.version=t}var t=e.prototype;return t.setName=function(e){this.name=e},t.getDB=function(){if(!this.db)throw new Error("DB not ready");return this.db},t.getStore=function(e){var t,r=ch(t=this.stores).call(t,(function(t){return t.storeName===e}));if(!r)throw new Error("LogStorage: store not found. "+e);return r},t.open=function(){var e=this,t=window.indexedDB.open(this.name,this.version);return new gs((function(r,n){t.onerror=function(e){var t=e.target;n(t.error)},t.onsuccess=function(t){var n,i,o=t.target;e.db=o.result,e.db.removeEventListener("close",tr(n=e.triggerDBCloseEvt).call(n,e)),e.db.addEventListener("close",tr(i=e.triggerDBCloseEvt).call(i,e)),e.stores.push(new lh(uh,e)),r()},t.onupgradeneeded=function(t){var r=t.target;e.upgradeDBBySchema(r)}}))},t.triggerDBCloseEvt=function(){try{this.db&&this.db.close(),this.db=null}catch(t){}this.open()},t.upgradeDBBySchema=function(e){var t=e.result,r=e.transaction&&t.objectStoreNames.contains(uh)?e.transaction.objectStore(uh):t.createObjectStore(uh,{keyPath:"id",autoIncrement:!0});try{r.index("time")}catch(e){r.createIndex("time","time",{unique:!1})}},t.close=function(){var e;this.db&&(this.db.removeEventListener("close",tr(e=this.triggerDBCloseEvt).call(e,this)),this.db.close(),this.stores=[],this.db=null)},e}(),lh=function(){function e(e,t){this.idb=null,this.storeName=e,this.idb=t}var t=e.prototype;return t.getDB=function(){if(!this.idb)throw new Error("DB not ready");return this.idb.getDB()},t.getStoreName=function(){return this.storeName},t.bulkCreate=function(e){var t=this.getDB(),r=this.getStoreName(),n=t.transaction(r,"readwrite"),i=n.objectStore(r);return jn(e).call(e,(function(e){i.add(e)})),new gs((function(e,t){n.oncomplete=function(){e()},n.onerror=function(e){var r=e.target;t(r.error)},n.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.bulkDelete=function(e){var t=e.keyName,r=e.lower,n=e.upper,i=e.lowerOpen,o=void 0!==i&&i,a=e.upperOpen,s=void 0!==a&&a,c=IDBKeyRange.bound(r,n,o,s),u=this.getDB(),d=this.getStoreName(),l=u.transaction(d,"readwrite"),p=l.objectStore(d).index(t).openCursor(c),m=0;return p.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),m++,t.continue())},new gs((function(e,t){l.oncomplete=function(){e(m)},l.onerror=function(e){var r=e.target;t(r.error)},l.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.readAllAndClear=function(){var e=this.getDB(),t=this.getStoreName(),r=e.transaction(t,"readwrite").objectStore(t);if(!r.getAll)throw new Error("IDBExtract not support");var n=r.getAll();return new gs((function(e,t){n.onsuccess=function(t){var n=t.target;r.clear(),e(n.result)},n.onerror=function(e){var r=e.target;t(r.error)}}))},e}(),ph=function(){function e(e){void 0===e&&(e="nim-logs"),this.idb=new dh(e,1)}var t=e.prototype;return t.open=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e&&this.idb.setName(e),t.next=3,this.idb.open();case 3:return r=this.idb.getStore(uh),t.prev=4,t.next=7,r.bulkDelete({keyName:"time",lower:0,upper:Es()-2592e5});case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(4);case 11:case"end":return t.stop()}}),t,this,[[4,9]])})))},t.close=function(){this.idb.close()},t.addLogs=function(e){return this.idb.getStore(uh).bulkCreate(e)},t.extractLogs=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.idb.getStore(uh),e.next=3,r.readAllAndClear();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:return i=Tl(n).call(n,(function(e,t){var r=t.iid;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),o=lu(t=fr(i)).call(t,(function(e){var t=i[e];return"==========iid:"+e+"==========\n "+lu(t).call(t,(function(e){return e.text})).join("\n")})).join("\n"),e.abrupt("return",new File([o],"nim-logs.txt",{type:"text/plain"}));case 9:case"end":return e.stop()}}),e,this)})))},e}();function mh(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return hh(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hh(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function hh(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var fh={},gh={};function vh(e,t,r,n){var i=fh[e];if(!i)return r.error("createCmd:: can not find cmd config: ",e),null;var o,a={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&n&&jn(o=i.params).call(o,(function(e){var t=n[e.name];if(null!=t){var r=e.type,i=e.reflectMapper,o=e.select;switch(e.type){case"PropertyArray":r="ArrayMable",t=lu(t).call(t,(function(e){return{t:"Property",v:i?Ih(e,i,o):e}}));break;case"Property":t=i?Ih(t,i,o):t;break;case"Bool":t=t?"true":"false"}a.Q.push({t:r,v:t})}})),{packet:a,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}function yh(e,t){var r,n;try{n=JSON.parse(e)}catch(r){return void t.error('Parse command error:"'+e+'"')}var i=n.sid+"_"+n.cid,o=n.r;if(au(r=["4_1","4_2","4_10","4_11"]).call(r,i)){var a=n.r[1].headerPacket;i=a.sid+"_"+a.cid,n.sid=a.sid,n.cid=a.cid,o=n.r[1].body}var s=gh[i],c=[];if(s){for(var u,d=mh(s);!(u=d()).done;){var l=u.value;c.push(Mh(n,l.config,l.cmd,o,t))}return c}t.error("parseCmd:: mapper not exist",i,n.code)}function Mh(e,t,r,n,i){var o,a={cmd:r,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:im.getTimeNode()};if(!r||!t)return a.notFound=!0,a;(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function(e){if("number"!=typeof e||e!=e)throw new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+e}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;return t-=t<=38?1:2,1e5+1e3*t+(511&e)}(e.code));var s,c=function(e,t){var r=_l[e],n=Ol[e];return null===n?null:new kl({code:e,desc:r||n||e,detail:{cmd:t,timetag:Es()}})}(e.code,r);if(a.error=c,a.error){if(a.error.detail.cmd=r,!(null===(o=null==t?void 0:t.ignoreErrCodes)||void 0===o?void 0:au(o).call(o,e.code)))return a;i.warn("parseCmd:: ignore error ",a.error),a.error.detail.ignore=!0}return t.response&&jn(s=t.response).call(s,(function(e,t){var r=n[t],i=e.type,o=e.name,s=e.reflectMapper;if(void 0!==r)switch(i){case"Property":a.content[o]=s?Th(r,s):r;break;case"PropertyArray":a.content[o]=lu(r).call(r,(function(e){return s?Th(e,s):e}));break;case"Int":case"Long":case"Byte":a.content[o]=+r;break;case"Bool":a.content[o]="true"===r||!0===r||1===r;break;default:a.content[o]=r}})),a}function Ih(e,t,r){var n={};for(var i in e=function(e,t){var r={};for(var n in t){for(var i,o=t[n],a="number"==typeof o?n:o.access?o.access:n,s=e,c=mh(a.split("."));!(i=c()).done;){var u=i.value;if(void 0===s[u]||null===s[u]){s=void 0;break}s=s[u]}void 0!==s&&(r[a]=s)}return r}(e,t),t){var o=t[i],a="number"==typeof o?i:o.access?o.access:i;if(!r||au(r).call(r,i))if(a in e){if("number"==typeof o)n[o]=e[a];else if("object"==typeof o)if(o.converter){var s=o.converter(e[a],e);void 0!==s&&(n[o.id]=s)}else n[o.id]=e[a]}else"object"==typeof o&&o.def&&("function"==typeof o.def?n[o.id]=o.def(e):n[o.id]=o.def)}return n}function Th(e,t){var r={};for(var n in e){var i=t[n];if("string"==typeof i)r[i]=e[n];else if("object"==typeof i&&"prop"in i){var o=i.access?i.access:i.prop;if(i.converter){var a=i.converter(e[n],e);void 0!==a&&(r[o]=a)}else i.type&&"number"===i.type?r[o]=+e[n]:i.type&&"boolean"===i.type?r[o]=!("0"===e[n]||!e[n]):r[o]=e[n]}}for(var s in t){var c=t[s];if(c&&void 0!==c.def){var u=c.access?c.access:c.prop;u in r||("function"==typeof c.def?r[u]=c.def(e):r[u]=c.def)}}return r=function(e){var t={},r=function(r){var n=r.split(".");Tl(n).call(n,(function(t,i,o){return t[i]||(t[i]=isNaN(Number(n[o+1]))?n.length-1==o?e[r]:{}:[])}),t)};for(var n in e)r(n);return t}(r),r}function Sh(e){for(var t in dr(fh,e.cmdConfig),e.cmdMap){var r=e.cmdMap[t],n=e.cmdConfig[r];if(n)if(ki(gh[t])){for(var i,o=!1,a=mh(gh[t]);!(i=a()).done;){var s=i.value;if(s.cmd===r&&s.config.service===n.service){o=!0;break}}o||gh[t].push({config:n,cmd:r})}else gh[t]=[{config:n,cmd:r}]}}function bh(e){var t,r={};return jn(t=fr(e)).call(t,(function(t){r[t]=Ch(e[t])})),r}function Ch(e){var t={};for(var r in e){var n=e[r];"number"==typeof n?t[n]=r:"object"==typeof n&&(t[n.id]={prop:r,type:n.retType,access:n.retAccess?n.retAccess:n.access?n.access:r,def:n.retDef,converter:n.retConverter})}return t}function _h(e){return e?1:0}function Eh(e){if(e&&"object"==typeof e)try{return Ei(e)}catch(e){return}}function kh(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(e){return}}var wh,Rh,Ah,xh,Nh,Oh={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},Ph={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},Lh=bh(Ph),Vh={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Ph.login}],response:[{type:"Property",name:"loginRes",reflectMapper:Lh.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:Lh.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:Lh.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:Lh.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function Uh(e,t){if(!Zl(t))return{};var r=JSON.parse(Ei(t)),n=Dh(e,r);return JSON.parse(Ei(dr(dr({},r),n)))}function Dh(e,t){if(!Zl(t))return{};var r={},n=fr(e);return jn(n).call(n,(function(n){var i=e[n].type;if("string"!=typeof i){var o=Dh(e[n],t);fr(o).length>0&&(r[n]=o)}else{var a=e[n],s=a.rawKey||n,c=qh[i](t,s,a);void 0!==c&&(t[s]=void 0,r[n]=c)}})),r}!function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(wh||(wh={})),function(e){e[e.p2p=0]="p2p",e[e.team=1]="team",e[e.superTeam=5]="superTeam"}(Rh||(Rh={})),function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(Ah||(Ah={})),function(e){e[e.unread=1]="unread",e[e.read=2]="read",e[e.deleted=3]="deleted",e[e.sending=4]="sending",e[e.sendFailed=5]="sendFailed",e[e.sent=6]="sent",e[e.receipt=7]="receipt",e[e.refused=10]="refused"}(xh||(xh={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(Nh||(Nh={}));var qh={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,r){return Tu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(e){return{}}}};function Bh(e,t){if(!Zl(t))return{};var r=JSON.parse(Ei(t)),n=Fh(e,r);return JSON.parse(Ei(dr(dr({},r),n)))}function Fh(e,t){var r;if(!Zl(t))return Tl(r=fr(e)).call(r,(function(t,r){return t[e[r].rawKey||r]=void 0,t}),{});var n={},i=fr(e);return jn(i).call(i,(function(r){var i=e[r].type;if("string"!=typeof i){var o=Fh(e[r],t[r]);return dr(n,o),void(t[r]=void 0)}var a=e[r],s=a.rawKey||r,c=Gh[i](t,r,a);t[s]=void 0,n[s]=c})),n}var Gh={number:function(e,t){return e[t]},string:function(e,t){return e[t]},boolean:function(e,t){return!0===e[t]?1:!1===e[t]?0:void 0},enum:function(e,t,r){return Tu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return Ei(e[t])}catch(e){return""}}},jh=Gh;function Hh(e,t){return e&&e.length>0?lu(e).call(e,(function(e){return dr(dr({},e),{account:e.account,connectionId:e.connectionId,deviceId:e.deviceId,ip:e.ip,mac:e.mac,os:e.os,type:Ap(Ah,e.type)||e.type,time:em(e.time),online:3!==t})})):[]}var Wh={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},Yh=Kh;function Kh(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Kh.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Kh.prototype.reset=function(){this.attempts=0},Kh.prototype.setMin=function(e){this.ms=e},Kh.prototype.setMax=function(e){this.max=e},Kh.prototype.setJitter=function(e){this.jitter=e};var Qh,$h=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],zh=["transport not supported","client not handshaken","unauthorized"],Jh=["reconnect"],Xh=function(e){function t(t,r,n){var i;return(i=e.call(this)||this).websocket=null,i.socketConnectTimer=0,i.url="",i.linkSSL=!0,i.core=t,i.url=r,i.linkSSL=n,i.status="disconnected",i.logger=t.logger,i.connect(),i}nr(t,e);var r=t.prototype;return r.connect=function(){var e=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request((this.linkSSL?"https":"http")+"://"+this.url+"/socket.io/1/?t="+Es(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(t){if("connecting"===e.status){var r=t.data.split(":"),n=r[0];return r[1],e.sessionId=n,e.logger.log("imsocket::XHR success. status "+e.status+", "+("connecting"===e.status?"continue websocket connection":"stop websocket connection")),e._createWebsocket((e.linkSSL?"wss":"ws")+"://"+e.url+"/socket.io/1/websocket/"+n)}})).catch((function(t){if("connecting"===e.status){var r='imsocket::XHR fail. raw message: "'+(t=t||{}).message+'", code: "'+t.code+'"',n=t.code;n="v2"===tm(e.core,"options.apiVersion")?t.code===Cl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Cl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Cl.V2NIM_ERROR_CODE_CONNECT_FAILED:408===t.code?408:415;var i=new kl({code:n,detail:{reason:r,rawError:t}});e.logger.error(r),e.status="disconnected",e.emit("handshakeFailed",i)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(e){this.logger.warn("imsocket::attempt to send encodePacket error",e)}try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=Bs((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",r.socketUrl),r.emit("handshakeFailed",new kl({code:"v2"===tm(r.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+r.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new tp.WebSocket(e),this.websocket.onmessage=tr(t=this.onMessage).call(t,this),this.websocket.onclose=function(e){e=e||{},r.logger.log("imsocket::Websocket onclose done "+e.wasClean+"/"+e.code+"/"+e.reason),r.clean(),r.emit("disconnect",{code:e.code||0,reason:e.reason})},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"logined"===r.core.status&&r.core.clientSocket.ping()}},r.onMessage=function(e){var t,r=this.decodePacket(e.data);if(r)switch(r.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",r.data);break;case"event":r.name&&this.emit(r.name,r.args);break;case"error":"unauthorized"===r.reason?this.emit("connect_failed",r.reason):this.emit("error",r.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new kl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",r.type)}},r.encodePacket=function(e){var t,r,n=e.type,i=e.id,o=void 0===i?"":i,a=e.endpoint,s=void 0===a?"":a,c=e.ack,u=null;if(!n)return"";switch(n){case"error":t=e.reason?wu(zh).call(zh,e.reason):"",r=e.advice?wu(Jh).call(Jh,e.advice):"",""===t&&""===r||(u=t+(""!==r?"+"+r:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},u=Ei(t);break;case"json":u=Ei(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+Ei(e.args):"")}var d=[wu($h).call($h,n),o+("data"===c?"+":""),s];return null!=u&&d.push(u),d.join(":")},r.decodePacket=function(e){if(e)if(""!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var r,n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c={type:$h[+n],endpoint:a};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":r=s.split("+"),c.reason=zh[+r[0]]||"";break;case"message":c.data=s||"";break;case"connect":c.qs=s||"";break;case"event":try{var u=JSON.parse(s);c.name=u.name,c.args=u.args}catch(e){this.logger.error("imsocket::parseData::type::event error",e)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(s)}catch(e){this.logger.error("imsocket::parseData::type::json error",e)}break;case"ack":if((r=s.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=r[1],c.args=[],r[3]))try{c.args=r[3]?JSON.parse(r[3]):[]}catch(e){this.logger.error("imsocket::parseData::type::ack error",e)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",Yc(e).call(e,0,20))},r.send=function(e){var t,r={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(r))},t}(Fs);function Zh(e){e=e||[];for(var t=[],r=0;r<e.length;r++)-1===wu(t).call(t,e[r])&&t.push(e[r]);return t}function ef(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return tf(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Qh||(Qh={}));var rf=function(){function e(e,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.linkSSL=!0,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new Yh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new sd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,t&&(this.auth=t),this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager}var t=e.prototype;return t.setSessionId=function(e){},t.setLinkSSL=function(e){this.linkSSL=e},t.connect=function(e,t){return void 0===e&&(e={}),Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({linkUrls:{type:"array",itemType:"string",required:!1}},e),/^(unconnected|waitReconnect)$/.test(this.core.status)){r.next=5;break}return n="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(n),r.abrupt("return",gs.reject(n));case 5:this.core.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=Os(i=e.linkUrls).call(i,this.linkUrls),this.linkUrls=Zh(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(qp),o=0;case 9:if(!(o<this.linkUrls.length)){r.next=31;break}return a=this.linkUrls[o],s=(new Date).getTime(),r.prev=12,r.next=15,this.doConnect(a);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+a),r.abrupt("return",a);case 20:r.prev=20,r.t0=r.catch(12),c=r.t0,t&&t(c,a),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:s,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof c.code?c.code:0,description:c.message||""+c.code,operation_type:0,target:a},{asyncParams:tp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+a,r.t0);case 28:o++,r.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(Qh.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Qh.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return r.stop()}}),r,this,[[12,20]])})))},t.doConnect=function(e){var t=this,r=!1;return new gs((function(n,i){var o;t.socket=new Xh(t.core,e,t.linkSSL),t.socket.on("connect",(function(){t.logger.log("clientSocketV1::on connect",e),t.core.reporterHookLinkKeep&&(t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e})),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Xl(t,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",n),!this.core.reporterHookLinkKeep){t.next=5;break}return t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:r=!0,this.doDisconnect(Qh.OFFLINE,"SocketOnDisconnect");case 7:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientsocketV1::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function(e,t,r){var n,i,o,a,s;if(this.logger.log("doDisconnect: type "+e+", description "+t),"unconnected"!==this.core.status){var c={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new kl({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var u=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(e===Qh.ACTIVE||u)this.logger.log("doDisconnect: emit disconnect, type "+e,u),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(n=this.auth)||void 0===n||n.emit("disconnect"),this.destroyOnlineListener();else if(e===Qh.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var d="string"==typeof t?{reason:"unknow",message:t}:t;this.core.eventBus.emit("kicked",d),this.core.emit("kicked",d),null===(i=this.auth)||void 0===i||i.emit("kicked",d),this.destroyOnlineListener()}else e===Qh.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):e===Qh.OFFLINE&&(null===(a=null===(o=this.auth)||void 0===o?void 0:o.authenticator)||void 0===a?void 0:a.checkLoginTerminalCode(null==r?void 0:r.code))?(this.logger.log("doDisconnect: login terminal code "+(null==r?void 0:r.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(s=this.auth)||void 0===s||s.emit("disconnect")):e===Qh.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function(){var e,t,r=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(e=this.auth)||void 0===e||e.emit("disconnect"));var n=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+n),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:n}),null===(t=this.auth)||void 0===t||t.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=Bs((function(){return Xl(r,void 0,void 0,zl.mark((function e(){var t=this;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("waitReconnect"===this.core.status){e.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),e.abrupt("return");case 3:return e.next=5,tp.net.getNetworkStatus();case 5:!1===e.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(Qh.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return e.stop()}}),e,this)})))}),n)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function(e,t,r){var n=this;if("logined"!==this.core.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+e),gs.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return gs.reject("No_socket");var i="heartbeat"!==e,o=i?this.packetSer++:0,a=vh(e,o,this.logger,t);if(!a){var s="SendCmd "+o+" "+e+" error";return this.logger.error(s),gs.reject(new Error(s))}var c=a.packet,u=a.hasPacketResponse,d=a.hasPacketTimer,l=Ei(c);i&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",e,"ser:"+o,l):this.logger.log("clientsocketV1::sendCmd",e,"ser:"+o));var p=(new Date).getTime();return new gs((function(i,a){u&&n.sendingCmdMap.set(o,{cmd:e,params:t,callback:[i,a],timer:d?Bs((function(){var t=new kl({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:e,ser:o,timetag:Es()}});n.markCmdInvalid(o,t,e)}),r&&r.timeout?r.timeout:n.core.config.timeout):null});try{n.socket.send(l),u||i(c)}catch(t){var s=new kl({code:415,detail:{reason:t&&t.message||"Unable to send packet",cmd:e,ser:o,timetag:Es(),rawError:t}});n.markCmdInvalid(o,s,e),a(t)}})).catch((function(e){var t,r=[408,415];if(!au(r).call(r,e.code))return gs.reject(e);n.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account,trace_id:null===(t=n.socket)||void 0===t?void 0:t.sessionId,start_time:p,action:2,exception_service:6});var i=tm(e,"data.disconnect_reason")||"",o=408===e.code?"Send failed due to timeout":"Send failed. Reason unknown";return o=415===e.code?Ei({disconnect_reason:i}):o,n.reporter.reportTraceUpdateV2("exceptions",{code:e.code||415,description:o,operation_type:1,target:c.SID+"-"+c.CID,context:""+c.SER},{asyncParams:tp.net.getNetworkStatus()}),n.reporter.reportTraceEnd("exceptions",1),gs.reject(e)}))},t.onMessage=function(e){var t=yh(e,this.logger);if(t)for(var r,n=ef(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("core:onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("imsocket::recvCmd ser:"+o,i.cmd,i.content):this.logger.log("imsocket::recvCmd ser:"+o,i.cmd)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n,i,o=this;if(e){var a=e.raw.ser,s=this.sendingCmdMap.get(a);if(s&&s.cmd===e.cmd){var c=s.callback,u=s.timer,d=s.params;if(clearTimeout(u),e.params=d,this.sendingCmdMap.delete(a),"heartbeat"===e.cmd)return void c[0]();var l=null===(r=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===r?void 0:r.call(t,e);l&&"function"==typeof l.then?l.then((function(e){c[0](e)})).catch((function(e){c[1](e)})):(this.logger.log("imsocket:: handlerFn without promise",e.service,e.cmd),c[0]())}else{var p=null===(i=null===(n=this.core[e.service])||void 0===n?void 0:n.process)||void 0===i?void 0:i.call(n,e);p&&"function"==typeof p.then&&p.catch((function(e){o.logger.error("imsocket::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log('markAllCmdInvaild:: cmd "'+o+'"'),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=18;break;case 6:return t.prev=6,t.t0=t.catch(1),t.next=10,this.testHeartBeat5Timeout();case 10:if(!t.sent){t.next=18;break}if(!this.core.reporterHookLinkKeep){t.next=16;break}return t.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(Qh.OFFLINE,"PingError"),t.abrupt("return");case 18:this.pingTimer=Bs((function(){r.ping()}),3e4);case 19:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,tp.net.onNetworkStatusChange((function(t){e.logger.log("clientsocketV1::onlineListener:network change",t),t.isConnected&&"logined"===e.core.status?e.ping():t.isConnected&&"waitReconnect"===e.core.status?(e.reconnectTimer&&clearTimeout(e.reconnectTimer),e.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){e.logger.error("clientsocketV1::attempToReconnect failed "+e.retryCount)}))):t.isConnected||e.doDisconnect(Qh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientsocketV1::onlineListener:destroy"),tp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),gs.resolve();default:return gs.resolve()}},e}(),nf=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V1NIMLoginService,this.logger=this.core.logger}var t=e.prototype;return t.getLbsInfos=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",gs.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),r=Zh(this.auth.config.lbsUrls),e.prev=7,e.next=10,this.ladderLoad(r);case 10:if(200===(n=e.sent).status&&n.data){e.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+n.status}});case 14:this.success(n),e.next=25;break;case 17:if(e.prev=17,e.t0=e.catch(7),i=e.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=24;break}throw e.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return e.abrupt("return",this.socketLinkUrls);case 26:case"end":return e.stop()}}),e,this,[[7,17]])})))},t.checkTerminator=function(e){return e===Cl.V2NIM_ERROR_CODE_CANCELLED||e===Cl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(wu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=Bs((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V1NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(dr(dr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V1NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new gs((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V1NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(dr(dr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data,a=[this.auth.config.linkUrl];tm(o,"common.link")&&(a=Os(i=tm(o,"common.link")).call(i,a)),tm(o,'common["link.default"]')&&(a=Os(a).call(a,tm(o,'common["link.default"]'))),this.socketLinkUrls=a,o["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",o["nos-chunk"]),null===(r=this.core.cloudStorage)||void 0===r||r.setOptions({chunkUploadHost:o["nos-chunk"]})),ki(o.nosup)&&o.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",o.nosup),null===(n=this.core.cloudStorage)||void 0===n||n.setOptions({commonUploadHostBackupList:o.nosup,commonUploadHost:o.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",Yc(t=this.socketLinkUrls).call(t,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:Ei(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:tp.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:tp.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),of=function(){function e(e){this.core=e}var t=e.prototype;return t.verifyAuthentication=function(e){var t,r,n;return void 0===e&&(e=!1),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f,g;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=this.core.options,s=tp.getSystemInfo(),c=dr(dr({},a),{appLogin:e?0:1,appkey:a.appkey,account:a.account,token:a.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100825,sdkHumanVersion:"10.8.25",os:s.os,browser:s.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.8.25":Yc(o=s.userAgent.replace("{{appkey}}",a.appkey)).call(o,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:s.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:s.hostEnvEnum}),u=s.os.toLowerCase(),"UNIAPP"!==tp.platform||"ios"!==u&&"android"!==u||(c.isReactNative=1,c.clientType="ios"===u?2:1,d=!!(null===(t=this.core.offlinePush.authConfig)||void 0===t?void 0:t.honorCertificateName),s.pushDeviceInfo&&s.pushDeviceInfo.MANUFACTURER&&(c.deviceInfo=Ei(dr({IS_SUPPORT_HONOR:d},s.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",a.account,null===(n=null===(r=this.core.clientSocket)||void 0===r?void 0:r.socket)||void 0===n?void 0:n.sessionId),i.next=8,this.core.clientSocket.sendCmd("login",{login:c});case 8:if(!(l=i.sent).error){i.next=11;break}throw l.error;case 11:return p=l.content,m=p.loginRes,h=p.loginPorts,f=p.aosPushInfo,g=Hh(h,2),(g=gu(g).call(g,(function(e){return e.connectionId!==m.connectionId}))).length>0&&this.core.emit("multiPortLogin",g),i.abrupt("return",dr(dr({},m),{aosPushInfo:f}));case 16:case"end":return i.stop()}}),i,this)})))},t.checkLoginTerminalCode=function(e){if(void 0===e)return!1;var t=[201,302,317,403,404,417,422];return au(t).call(t,e)},e}(),af=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.logger=r.logger,n.core=r,n}nr(t,e);var r=t.prototype;return r.checkV2=function(){var e=this.core.options.apiVersion;if("v2"===e)return!0;throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+e+'" of client is not supported.'}})},r.checkLogin=function(){if(0===this.core.V2NIMLoginService.getLoginStatus())throw new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Client logout."}})},r.emit=function(t){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.logger.debug(this.name+"::emit event: '"+t.toString()+"',",void 0!==i[0]?i[0]:"",void 0!==i[1]?i[1]:"",void 0!==i[2]?i[2]:"");try{var a,s,c=(a=e.prototype.emit).call.apply(a,Os(s=[this,t]).call(s,i));return c}catch(e){return Bs((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",e),e}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"],r=this.handler&&this.handler[e.cmd+"Handler"];if("function"==typeof t||"function"==typeof r){if(e.error)return this.logger.error(e.cmd+"::recvError",e.error),gs.reject(e.error);try{var n=t?t.call(this,e):r.call(this.handler,e);return gs.resolve(n)}catch(e){return gs.reject(e)}}var i=tm(e,"error.detail.ignore");return e.error&&!i?gs.reject(e.error):gs.resolve(e)},t}(Fs),sf=function(){function e(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}return e.prototype.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=tm(e,"error.detail.ignore");return e.error&&!r?gs.reject(e.error):gs.resolve(e)},e}(),cf={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},uf={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},df={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Ch(uf)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:uf}]}},lf={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}},pf=function(e){function t(t){var r;return(r=e.call(this,"misc",t)||this).core=t,Sh({cmdMap:cf,cmdConfig:df}),r.setListener(),r}nr(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){e.core.timeOrigin.setOriginTimetick()}))},r.getServerTime=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=e.sent,e.abrupt("return",em(t.content.time));case 4:case"end":return e.stop()}}),e,this)})))},r.notifyDetectHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.content.data,(r=Uh(lf,n)).t3=e.__receiveTimeNode.time,r.t4=Es(),t.prev=3,t.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:r});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",t.t0);case 11:case"end":return t.stop()}var n}),t,this,[[3,8]])})))},r.notifylogHandler=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,this.core.logger.extractLogs();case 4:t=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return");case 10:if(t){e.next=12;break}return e.abrupt("return");case 12:if("string"!=typeof t){e.next=14;break}return e.abrupt("return");case 14:return r="",e.prev=15,e.next=18,this.core.cloudStorage.uploadFile({type:"file",file:t});case 18:n=e.sent,r=n.url,e.next=25;break;case 22:return e.prev=22,e.t1=e.catch(15),e.abrupt("return");case 25:if(r){e.next=27;break}return e.abrupt("return");case 27:return r+=(wu(r).call(r,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.prev=28,e.next=31,this.core.clientSocket.sendCmd("uploadLog",{url:r});case 31:e.next=36;break;case 33:return e.prev=33,e.t2=e.catch(28),e.abrupt("return");case 36:case"end":return e.stop()}}),e,this,[[1,7],[15,22],[28,33]])})))},t}(sf),mf={needReconnect:!0,reconnectionAttempts:ir,lbsUrls:Bp,linkUrl:qp,xhrConnectTimeout:8e3,socketConnectTimeout:8e3,linkSSL:!0},hf=function(e){function t(t,r){var n;(n=e.call(this,"V1NIMLoginService",t)||this).account="",n.token="",n.deviceId="",n.processId="",n.clientSession="",n.status="unconnected",n.config=mf,n.isManualLoginAttempt=!1,n.core._registerDep(pf,"misc"),Sh({cmdMap:Oh,cmdConfig:Vh}),t.V1NIMLoginService=ut(n),r&&n.setOptions(r);var i=new rf(n.core,ut(n));return n.clientSocket=i,"v1"===n.core.options.apiVersion&&(n.core.clientSocket=i,n.core.auth=ut(n)),n.lbs=new nf(t),n.authenticator=new of(t),n.doLoginStepsManager=new Yp,n}nr(t,e);var r=t.prototype;return r.reset=function(){this.lbs.reset()},r.setOptions=function(e){var t,r,n;e&&fr(e).length>0?(this.config=Op(this.config,e),this.account=e.account||this.core.options.account,this.token=e.token||this.core.options.token,this.core.options=dr(dr({},this.core.options),this.config)):(this.config=Op(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token),null===(r=null===(t=this.core.clientSocket)||void 0===t?void 0:t.setLinkSSL)||void 0===r||r.call(t,null===(n=this.config.linkSSL)||void 0===n||n);var i="",o="";this.config.isFixedDeviceId?(i=tp.localStorage.getItem("__NIM_DEVC_ID__")||wp(),o=tp.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||wp(),tp.localStorage.setItem("__NIM_DEVC_ID__",i),tp.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",o)):(i=wp(),o=wp()),this.deviceId=i,this.clientSession=o,this.core.reporter.setConfig({common:{dev_id:i}})},r.connect=function(e){return void 0===e&&(e={}),this.login(e)},r.login=function(e){return void 0===e&&(e={}),Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),e.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=wp()),t.next=4,this._connect(e);case 4:return this.core.abtest.abtRequest(),t.prev=5,t.next=8,this.doLogin(e.isAutoReconnect);case 8:this.processId=wp(),this.isManualLoginAttempt=!1,t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(5),this.isManualLoginAttempt=!1,t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,12]])})))},r._connect=function(e){return void 0===e&&(e={}),Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){t.next=4;break}return r="NIM status is "+this.core.status+", and would not connect",this.logger.warn(r),t.abrupt("return",gs.reject(r));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:e.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Ei(dr(dr({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:tp.net.getNetworkStatus()}),t.next=10,this.lbs.getLbsInfos();case 10:return n=t.sent,t.prev=11,t.next=14,this.clientSocket.connect({linkUrls:n,isAutoReconnect:e.isAutoReconnect},(function(e,t){o.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:e.code||408,description:"ws_handshake_failed:"+e.message,succeed:!1},{asyncParams:tp.net.getNetworkStatus()})}));case 14:(i=t.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:i,code:200,succeed:!0},{asyncParams:tp.net.getNetworkStatus()}),t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(11),this.core.reporter.reportTraceEnd("login",!1),t.t0;case 22:case"end":return t.stop()}}),t,this,[[11,18]])})))},r.doLogin=function(e){return void 0===e&&(e=!1),Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.authenticator.verifyAuthentication(e);case 3:r=t.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:tp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",t.next=21;break;case 9:if(t.prev=9,t.t0=t.catch(0),n=t.t0,i=tm(n,"data.disconnect_reason")||"",o=415===n.code?Ei({disconnect_reason:i}):n.message,this.core.logger.warn("nim login:: login failed",t.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:n.code||0,succeed:!1,description:o},{asyncParams:tp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(Qh.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",t.t0),!this.isManualLoginAttempt){t.next=20;break}throw t.t0;case 20:return t.abrupt("return");case 21:return t.prev=21,t.next=24,this.core.cloudStorage.init();case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",t.t1);case 29:this.core.eventBus.emit("logined",r),this.core.emit("logined",r),this.emit("logined",r),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 35:case"end":return t.stop()}}),t,this,[[0,9],[21,26]])})))},r.disconnect=function(){return this.logout()},r.logout=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),e.t0=this.status,e.next="logined"===e.t0?5:"connected"===e.t0||"connecting"===e.t0||"waitReconnect"===e.t0?18:"unconnected"===e.t0||"destroyed"===e.t0?21:22;break;case 5:return e.prev=5,e.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.next=17;break;case 12:e.prev=12,e.t1=e.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return e.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(Qh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.abrupt("return",gs.resolve());case 21:return e.abrupt("return",gs.resolve());case 22:case"end":return e.stop()}}),e,this,[[5,12]])})))},r.kick=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkApiVersion(),r.next=3,this.clientSocket.sendCmd("kick",e);case 3:return n=r.sent,r.abrupt("return",null===(t=n.content)||void 0===t?void 0:t.deviceIds);case 5:case"end":return r.stop()}}),r,this)})))},r._checkApiVersion=function(){if("v1"!==this.core.options.apiVersion)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},r.nimLoginClientChangeHandler=function(e){if(e.error)this.logger.error("nimLoginClientChangeHandler:: error, ",e.error);else{var t=e.content,r=Hh(t.datas,t.state);r.length>0&&(this.core.emit("multiPortLogin",r),this.emit("multiPortLogin",r))}},r.kickedHandler=function(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var t=function(e){var t=Uh({clientType:{type:"enum",values:Ah},customClientType:{type:"number"}},e),r=Wh[t.reason];return dr(t,r=r||{reason:"unknow",message:"Unknown reason"})}(e.content);this.logger.warn("kicked::",t),this.clientSocket.doDisconnect(Qh.KICKED,t),this.core._clearModuleData()}},r.getConnectStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},r.getLoginStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},r.getLoginUser=function(){return this.core.options.account},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Os(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,c))},t}(af);function ff(e){return Uh({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},e)}function gf(e){e=e||{};var t={};for(var r in e)t[e[r]]=r;return t}var vf={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},yf={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},Mf={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},If={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:Mf.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:gf(Mf.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:gf(Mf.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:gf(Mf.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},Tf={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:gf(Mf.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:gf(Mf.qchatAuthRepTag)}]}},Sf=ds.codeAt;nt({target:"String",proto:!0},{codePointAt:function(e){return Sf(this,e)}});var bf=Xt("String").codePointAt,Cf=String.prototype,_f=function(e){var t=e.codePointAt;return"string"==typeof e||e===Cf||j(Cf,e)&&t===Cf.codePointAt?bf:t},Ef=RangeError,kf=String.fromCharCode,wf=String.fromCodePoint,Rf=M([].join),Af=!!wf&&1!=wf.length;nt({target:"String",stat:!0,arity:1,forced:Af},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;n>i;){if(t=+arguments[i++],gt(t,1114111)!==t)throw Ef(t+" is not a valid code point");r[i]=t<65536?kf(t):kf(55296+((t-=65536)>>10),t%1024+56320)}return Rf(r,"")}});var xf=B.String.fromCodePoint,Nf=function(e){var t;if(void 0!==e)return(t=Uf(e)).sign=1,t},Of=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Pf=function(e){var t;return Hm(t=["number"==typeof e,"string"==typeof e&&e.length>0,Of(e)&&e.length>0,e instanceof Uf]).call(t,(function(e){return!0===e}))},Lf="Invalid Number",Vf="Invalid Number - Division By Zero";function Uf(e){var t;if(!(this instanceof Uf))return new Uf(e);if(this.number=[],this.sign=1,this.rest=0,Pf(e)){if(Of(e)){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),t=e.length-1;t>=0;t--)if(!this.addDigit(e[t]))return}else for("-"!==(e=e.toString()).charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),t=e.length-1;t>=0;t--)if(!this.addDigit(em(e.charAt(t),10)))return}else this.number=Lf}Uf.prototype.addDigit=function(e){return function(e){return/^\d$/.test(e)}(e)?(this.number.push(e),this):(this.number=Lf,!1)},Uf.prototype._compare=function(e){var t,r;if(!Pf(e))return null;if(t=Uf(e),this.sign!==t.sign)return this.sign;if(this.number.length>t.number.length)return this.sign;if(this.number.length<t.number.length)return-1*this.sign;for(r=this.number.length-1;r>=0;r--){if(this.number[r]>t.number[r])return this.sign;if(this.number[r]<t.number[r])return-1*this.sign}return 0},Uf.prototype.gt=function(e){return this._compare(e)>0},Uf.prototype.gte=function(e){return this._compare(e)>=0},Uf.prototype.equals=function(e){return 0===this._compare(e)},Uf.prototype.lte=function(e){return this._compare(e)<=0},Uf.prototype.lt=function(e){return this._compare(e)<0},Uf.prototype.subtract=function(e){var t;return void 0===e?this:(t=Uf(e),this.sign!==t.sign?(this.number=Uf._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=Nf(this).lt(Nf(t))?Uf._subtract(t,this):Uf._subtract(this,t),this))},Uf._add=function(e,t){var r,n=0,i=Math.max(e.number.length,t.number.length);for(r=0;r<i||n>0;r++)e.number[r]=(n+=(e.number[r]||0)+(t.number[r]||0))%10,n=Math.floor(n/10);return e.number},Uf._subtract=function(e,t){var r,n,i=0,o=e.number.length;for(r=0;r<o;r++)e.number[r]-=(t.number[r]||0)+i,e.number[r]+=10*(i=e.number[r]<0?1:0);for(r=0,o=e.number.length-1;0===e.number[o-r]&&o-r>0;)r++;return r>0&&li(n=e.number).call(n,-r),e.number},Uf.prototype.multiply=function(e){if(void 0===e)return this;var t,r,n=Uf(e),i=0,o=[];if(this.isZero()||n.isZero())return Uf(0);for(this.sign*=n.sign,t=0;t<this.number.length;t++)for(i=0,r=0;r<n.number.length||i>0;r++)o[t+r]=(i+=(o[t+r]||0)+this.number[t]*(n.number[r]||0))%10,i=Math.floor(i/10);return this.number=o,this},Uf.prototype.divide=function(e){if(void 0===e)return this;var t,r,n=Uf(e),i=[],o=Uf(0);if(n.isZero())return this.number=Vf,this;if(this.isZero())return this.rest=Uf(0),this;if(this.sign*=n.sign,n.sign=1,1===n.number.length&&1===n.number[0])return this.rest=Uf(0),this;for(t=this.number.length-1;t>=0;t--)for(o.multiply(10),o.number[0]=this.number[t],i[t]=0;n.lte(o);)i[t]++,o.subtract(n);for(t=0,r=i.length-1;0===i[r-t]&&r-t>0;)t++;return t>0&&li(i).call(i,-t),this.rest=o,this.number=i,this},Uf.prototype.mod=function(e){return this.divide(e).rest},Uf.prototype.isZero=function(){var e;for(e=0;e<this.number.length;e++)if(0!==this.number[e])return!1;return!0},Uf.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;e--)t+=this.number[e];return this.sign>0?t:"-"+t};var Df=Math.pow(2,32);function qf(e){for(var t=new Uint8Array(5),r=new DataView(t.buffer),n=0;0!=(4294967168&e);)r.setUint8(n++,127&e|128),e>>>=7;return r.setUint8(n++,127&e),Yc(t).call(t,0,n)}function Bf(e){if("function"==typeof TextEncoder)return(new TextEncoder).encode(e);var t=function(e){for(var t=[],r=e.length,n=0;n<r;){var i=_f(e).call(e,n),o=0,a=0;for(i<=127?(o=0,a=0):i<=2047?(o=6,a=192):i<=65535?(o=12,a=224):i<=2097151&&(o=18,a=240),t.push(a|i>>o),o-=6;o>=0;)t.push(128|i>>o&63),o-=6;n+=i>=65536?2:1}return t}(e);return new Uint8Array(t)}function Ff(e){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(e):function(e){for(var t="",r=0;r<e.length;){var n=e[r],i=0,o=0;if(n<=127?(i=0,o=255&n):n<=223?(i=1,o=31&n):n<=239?(i=2,o=15&n):n<=244&&(i=3,o=7&n),e.length-r-i>0)for(var a=0;a<i;)o=o<<6|63&(n=e[r+a+1]),a+=1;else o=65533,i=e.length-r;t+=xf(o),r+=i+1}return t}(e)}var Gf=function(){function e(e){this.offset=0,this.buffer=new Uint8Array(e),this.view=new DataView(e)}var t=e.prototype;return t.checkBufferBoundaryAccess=function(){return this.offset>=this.buffer.byteLength},t.length=function(){var e;return(null===(e=this.view)||void 0===e?void 0:e.byteLength)||0},t.getBuffer=function(){return this.view.buffer},t.getOffset=function(){return this.offset},t.popRaw=function(e){try{var t,r=Yc(t=this.buffer).call(t,this.offset,this.offset+e);return this.offset+=e,r}catch(e){throw new Error("UnpackException raw "+(e&&e.message))}},t.popByte=function(){try{var e=this.view.getUint8(this.offset);return this.offset+=1,e}catch(e){throw new Error("UnpackException byte "+(e&&e.message))}},t.popVarbin=function(){return this.popRaw(this.popVarInt())},t.popString=function(){try{return Ff(this.popVarbin())}catch(t){throw new Error("UnpackException string "+(t&&t.message))}},t.popInt=function(){try{var e=this.view.getUint32(this.offset,!0);return this.offset+=4,e}catch(e){throw new Error("UnpackException int "+(e&&e.message))}},t.popVarInt=function(){var e=1,t=0,r=0,n=0;do{if(t+=(127&(r=this.popByte()))*e,e*=128,(n+=1)>5)throw new Error("Variable length quantity is too long")}while(0!=(128&r));return t},t.popLong=function(){try{var e,t=function(e,t){void 0===t&&(t=!1);var r=new DataView(e.buffer),n=t?[4,0]:[0,4],i=n[0],o=n[1],a=r.getUint32(i,t),s=r.getUint32(o,t);return a>0?a*Df+s:s}(Yc(e=this.buffer).call(e,this.offset,this.offset+8),!0);return this.offset+=8,Number(t)}catch(e){throw new Error("UnpackException long "+(e&&e.message))}},t.popShort=function(){try{var e=this.view.getUint16(this.offset,!0);return this.offset+=2,e}catch(e){throw new Error("UnpackException short "+(e&&e.message))}},t.popBoolean=function(){return this.popByte()>0},t.toString=function(){return Gl(new Uint8Array(this.buffer)).toString()},t.reset=function(){this.offset=0,this.buffer=null,this.view=null},e}(),jf=function(){function e(e){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new Gf(e)}var t=e.prototype;return t.reset=function(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()},t.getBodyDetail=function(){return this.bodyArr.join("")},t.unmarshalHeader=function(){var e,t=this._unmarshalHeader();this.packetLength=t.packetLength,this.serviceId=t.serviceId,this.commandId=t.commandId,this.serialId=t.serialId,this.tag=t.tag,this.resCode=t.resCode,4===t.serviceId&&au(e=[1,2,10,11]).call(e,t.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function(){var e=this.unpack.popVarInt(),t=this.unpack.popByte(),r=this.unpack.popByte(),n=this.unpack.popShort(),i=this.unpack.popByte(),o=200;return this.hasRescode(i)&&(o=this.unpack.popShort()),{packetLength:e,serviceId:t,commandId:r,serialId:n,tag:i,resCode:o}},t.hasRescode=function(t){return 0!=((t=t||this.tag)&e.RES_CODE)},t.getHeader=function(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nProperty("+e+") {");for(var r=0;r<e;r++){var n=this.unpack.popVarInt();this.bodyArr.push(n+":");var i=this.unpack.popString();this.bodyArr.push('"'+i.length+" "+this.unpack.getOffset()+'",'),t[n]=i}return this.bodyArr.push("},"),t},t.unmarshalPropertyArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nPropertyArray("+e+") [");for(var r=0;r<e;r++)t.push(this.unmarshalProperty());return this.bodyArr.push("],"),t},t.unmarshalLong=function(){var e=this.unpack.popLong();return this.bodyArr.push("\nLong:"+e),e},t.unmarshalLongArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nLongArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nStrArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalStrStrMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrStrMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popString();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalLongLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return{m_map:t}},t.unmarshalKVArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nKVArray "+e+":");for(var r=0;r<e;r++)t.push(this.unmarshalStrStrMap());return t},t.unmarshal=function(e){var t,r=this,n=dr(dr({},this.getHeader()),{r:[]});if(this.innerHeader&&(n.r[0]=this.msgId,n.r[1]={body:[],headerPacket:this.getInnerHeader()}),!au(t=[200,406,808,810,7101]).call(t,n.code))return Ei(n);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error("UnpackException packetLength("+this.packetLength+") greater than bufferLength("+this.unpack.length()+")");var i=[];return e&&jn(e).call(e,(function(e){if(!r.unpack.checkBufferBoundaryAccess())switch(e.type){case"PropertyArray":i.push(r.unmarshalPropertyArray());break;case"Property":i.push(r.unmarshalProperty());break;case"Byte":i.push(r.unpack.popByte());break;case"Int":i.push(r.unpack.popInt());break;case"Bool":i.push(r.unpack.popBoolean());break;case"Long":i.push(r.unmarshalLong());break;case"LongArray":i.push(r.unmarshalLongArray());break;case"String":i.push(r.unpack.popString());break;case"StrArray":i.push(r.unmarshalStrArray());break;case"StrStrMap":i.push(r.unmarshalStrStrMap());break;case"StrLongMap":i.push(r.unmarshalStrLongMap());break;case"LongLongMap":i.push(r.unmarshalLongLongMap());break;case"KVArray":i.push(r.unmarshalKVArray())}})),this.innerHeader?n.r[1].body=i:n.r=i,Ei(n)},e}();jf.RES_CODE=2;var Hf=function(){function e(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=e.prototype;return t.reset=function(){this.offset=0,this.buffer=null,this.view=null},t.size=function(){return this.offset},t.getBuffer=function(){var e;return Yc(e=this.buffer).call(e,0,this.offset).buffer},t.ensureCapacity=function(e){var t=this.offset+e;if(t>this.capacity)throw new Error("PackException over limit");if(t>this.buffer.byteLength){var r=Math.ceil(t/this.pageSize)*this.pageSize,n=new Uint8Array(r);n.set(this.buffer),this.buffer=n,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function(e){this.ensureCapacity(e.length);try{this.buffer.set(e,this.offset),this.offset+=e.length}catch(e){throw new Error("PackException raw")}},t.putByte=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e)}catch(e){throw new Error("PackException byte")}},t.putString=function(e){try{var t=Bf(e);this.putVarbin(t)}catch(e){throw new Error("PackException string")}},t.putInt=function(e){this.ensureCapacity(4);try{this.view.setInt32(this.offset,e,!0),this.offset+=4}catch(e){throw new Error("PackException int")}},t.putVarInt=function(e){var t=qf(e);this.putRaw(t)},t.putBoolean=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e?1:0)}catch(e){throw new Error("PackException boolean")}},t.putLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){void 0===t&&(t=!1);var r=new Uint8Array(8),n=new DataView(r.buffer),i=Number(e>Df-1?e/Df:0),o=Number(4294967295&e),a=t?[4,0]:[0,4],s=a[0],c=a[1];return n.setUint32(s,i,t),n.setUint32(c,o,t),r}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(e){throw new Error("PackException long")}},t.putStringAsLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){var r,n;void 0===t&&(t=!1);var i=new Uint8Array(8),o=new DataView(i.buffer),a=qc(r=Uf(e).divide(Df).number).call(r).join(""),s=qc(n=Uf(e).mod(Df).number).call(n).join(""),c=Number(a),u=Number(s),d=t?[4,0]:[0,4],l=d[0],p=d[1];return o.setUint32(l,c,t),o.setUint32(p,u,t),i}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(e){throw new Error("PackException stringAsLong")}},t.putShort=function(e){this.ensureCapacity(2);try{this.view.setInt16(this.offset,e,!0),this.offset+=2}catch(e){throw new Error("PackException short")}},t.putVarbin=function(e){if(!e)return this.ensureCapacity(1),this.putVarInt(0);if(e.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var t=qf(e.length);this.ensureCapacity(t.length+e.length);try{this.buffer.set(t,this.offset),this.offset+=t.length,this.buffer.set(e,this.offset),this.offset+=e.length}catch(e){throw new Error("PackException varbin")}},e}();function Wf(e){if("number"!=typeof e){if(null==e)return!1;e=Number(e)}if(isNaN(e))throw new Error("Number type conversion error");return!0}function Yf(e){return null==e}var Kf,Qf=function(){function e(e,t,r){this.pack=new Hf,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=e,this.commandId=t,this.serialId=r}var t=e.prototype;return t.marshalHeader=function(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function(e){var t=this,r=fr(e),n=gu(r).call(r,(function(e){return!Yf(e)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putVarInt(Number(r)),ki(e[r])||"[object Object]"===Object.prototype.toString.call(e[r])?t.pack.putString(Ei(e[r])):t.pack.putString(String(e[r]))}))},t.marshalPropertyArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),jn(e).call(e,(function(e){t.marshalProperty(null==e?void 0:e.v)}))},t.marshalStrArray=function(e){var t=this,r=gu(e).call(e,(function(e){return!Yf(e)})),n=r.length;this.pack.putVarInt(n),jn(r).call(r,(function(e){t.pack.putString(String(e))}))},t.marshalLongArray=function(e){var t=this,r=gu(e).call(e,(function(e){return Wf(e)})),n=r.length;this.pack.putVarInt(n),jn(r).call(r,(function(e){t.putLong(e)}))},t.marshalStrStrMap=function(e){var t=this,r=fr(e),n=gu(r).call(r,(function(t){return!Yf(e[t])&&!Yf(t)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putString(String(r)),t.pack.putString(String(e[r]))}))},t.marshalStrLongMap=function(e){var t=this,r=fr(e),n=gu(r).call(r,(function(t){return Wf(e[t])&&!Yf(t)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putString(String(r)),t.putLong(e[r])}))},t.marshalLongLongMap=function(e){var t=this,r=fr(e),n=gu(r).call(r,(function(t){var r=Number(t);return Wf(r)&&Wf(e[r])}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){var n=Number(r);t.putLong(n),t.putLong(e[n])}))},t.marshalKVArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),jn(e).call(e,(function(e){t.marshalStrStrMap(e)}))},t.putLong=function(e){"string"==typeof e&&e.length>15?this.pack.putStringAsLong(e):this.pack.putLong(Number(e))},t.marshal=function(e,t){var r=this;return this.marshalHeader(),t&&jn(t).call(t,(function(t,n){var i,o=t.type,a=null===(i=e[n])||void 0===i?void 0:i.v;if(!Yf(a))switch(o){case"PropertyArray":r.marshalPropertyArray(a);break;case"Property":r.marshalProperty(a);break;case"Byte":if(!Wf(a))return;r.pack.putByte(Number(a));break;case"Int":if(!Wf(a))return;r.pack.putInt(Number(a));break;case"Bool":"false"===a?a=!1:"true"===a&&(a=!0),r.pack.putBoolean(a);break;case"Long":if(!Wf(a))return;r.putLong(a);break;case"LongArray":r.marshalLongArray(a);break;case"String":r.pack.putString(String(a));break;case"StrArray":r.marshalStrArray(a);break;case"StrStrMap":r.marshalStrStrMap(a);break;case"StrLongMap":r.marshalStrLongMap(a);break;case"LongLongMap":r.marshalLongLongMap(a);break;case"KVArray":r.marshalKVArray(a)}})),this.pack.getBuffer()},t.reset=function(){this.pack.reset()},e}(),$f=function(e){function t(t,r,n){var i;return(i=e.call(this)||this).websocket=null,i.socketConnectTimer=0,i.linkSSL=!0,i.url="",i.core=t,i.url=r,i.linkSSL=n,i.status="disconnected",i.logger=t.logger,i.connect(),i}nr(t,e);var r=t.prototype;return r.connect=function(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket((this.linkSSL?"wss":"ws")+"://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect")}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=Bs((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",e),r.emit("connectFailed",new kl({code:"v2"===tm(r.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+e}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new tp.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=tr(t=this.onMessage).call(t,this),this.websocket.onclose=function(e){e=e||{},r.logger.log("imsocket::Websocket onclose done "+e.wasClean+"/"+e.code+"/"+e.reason),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new kl({code:"v2"===tm(r.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new kl({code:"v2"===tm(r.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){r.onConnect()}},r.onMessage=function(e){if(e.data){var t=new jf(e.data),r={sid:-1,cid:-1,ser:-1,packetLength:-1},n=null;try{t.unmarshalHeader(),r=t.getHeader(),n=t.getInnerHeader()}catch(t){this.reportBinaryError({err:t,sid:n?n.sid:null==r?void 0:r.sid,cid:n?n.cid:null==r?void 0:r.cid,rawBuf:e.data,type:"decode"})}var i=n?n.sid:r.sid,o=n?n.cid:r.cid,a=i+"_"+o,s=gh[a];if(s&&s.length>0){var c,u=s[0].config;try{c=t.unmarshal(u.response)}catch(n){var d=t.getBodyDetail();this.reportBinaryError({err:n,rawBuf:e.data,sid:i,cid:o,parseDetail:d,type:"decode"}),t.reset();var l=dr(dr({},r),{sid:i,cid:o,code:Cl.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+l.sid+"_"+l.cid+'", ser '+l.ser+", packetLength "+l.packetLength+" unmarshal error. "+d+" \n",n),void this.emit("message",Ei(l))}this.emit("message",c)}else this.core.logger.warn("imsocket::onMessage cmd not found",a);t.reset()}},r.send=function(e,t,r,n,i){var o,a,s=new Qf(e,t,r),c=fh[n],u="";try{u=Ei(i),a=s.marshal(JSON.parse(u),c.params)}catch(n){throw this.reportBinaryError({err:n,sid:e,cid:t,rawStr:u,type:"encode"}),s.reset(),new kl({code:Cl.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:e+"-"+t+", ser "+r+" marshal error",rawError:n}})}null===(o=this.websocket)||void 0===o||o.send(a),s.reset()},r.reportBinaryError=function(e){var t,r,n,i=e.err,o=e.rawStr,a=e.sid,s=e.cid,c=e.type,u=e.parseDetail,d=e.rawBuf;if(d){try{n=function(e){if("function"!=typeof btoa)return"";for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return r=null,btoa(t)}(d)}catch(e){n="reportBinaryError::arrayBufferToBase64 parsing failed, error: "+(null==e?void 0:e.message)+", sid: "+a+", cid: "+s,this.core.logger.error(n)}d=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(t=this.core.auth)||void 0===t?void 0:t.account,trace_id:null===(r=this.core.clientSocket.socket)||void 0===r?void 0:r.sessionId,start_time:Es(),action:2,exception_service:9});var l=i?(i.message+";;;"||0)+(u?"parseDetail: "+u+";;;":"")+(o?" rawStr: "+o:"")+(n?" rawBuf: "+n:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===c?Cl.V2NIM_ERROR_CODE_PACK_ERROR:Cl.V2NIM_ERROR_CODE_UNPACK_ERROR,description:l,operation_type:"encode"===c?3:4,target:a+"-"+s},{asyncParams:tp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},t}(Fs);function zf(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Jf(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Jf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Kf||(Kf={}));var Xf,Zf=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new Yh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new sd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.setLinkSSL=function(e){this.linkSSL=e},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",gs.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:tp.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:tp.net.getNetworkStatus()}),c.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==Cl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new gs((function(n,i){var o;t.socket=new $f(t.core,e,t.linkSSL),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Xl(t,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect "+e,n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Kf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("connectFailed",(function(n){r?t.ping():(t.logger.error("clientSocketV2::connectFailed:"+e+", reason:"+(n&&n.message)),t.cleanSocket()),r=!0,i(n)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new kl({code:Cl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Kf.ACTIVE||e===Kf.KICKED?this.destroyOnlineListener():e===Kf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new kl({code:Cl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!au(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),gs.reject(new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:dr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=vh(e,c,this.logger,t);if(!u){var d=new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:dr(dr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),gs.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=Ei(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new gs((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?Bs((function(){var t=new kl({code:Cl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:dr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(l.SID,l.CID,c,e,l.Q),p||i(l)}catch(t){var s=new kl({code:Cl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:dr({ser:c,reason:"Unable to send packet"+(t&&t.message?": "+t.message:""),timetag:(new Date).getTime(),rawError:t},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return Xl(n,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=[Cl.V2NIM_ERROR_CODE_DISCONNECT,Cl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Cl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],au(n).call(n,r.code)){t.next=4;break}return t.abrupt("return",gs.reject(r));case 4:return this.reportSendCmdFailed(r,{sid:l.SID,cid:l.CID,ser:c},f),t.abrupt("return",gs.reject(r));case 6:case"end":return t.stop()}}),t,this)})))}))},t.reportSendCmdFailed=function(e,t,r){var n;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(n=this.socket)||void 0===n?void 0:n.sessionId,start_time:r,action:2,exception_service:6});var i=tm(e,"detail.disconnect_reason")||"",o=e.code===Cl.V2NIM_ERROR_CODE_DISCONNECT?Ei({disconnect_reason:i}):e.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:e.code,description:o,operation_type:1,target:t.sid+"-"+t.cid,context:""+t.ser},{asyncParams:tp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function(e){var t=yh(e,this.logger);if(t){var r=t[0],n=r.raw.ser;"heartbeat"!==r.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n,e):this.logger.log("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n+",code:"+r.raw.code));for(var i,o=zf(t);!(i=o()).done;){var a=i.value;if(a.error&&this.logger.error("clientSocketV2::onMessage packet error",a.raw.sid+"_"+a.raw.cid+", ser:"+n+",",a.error),a.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",a.raw.sid+"_"+a.raw.cid+", ser:"+n);this.packetHandler(a)}}},t.packetHandler=function(e){var t,r,n,i,o=this;if(e){var a=e.raw.ser,s=this.sendingCmdMap.get(a);if(s&&s.cmd===e.cmd){var c=s.callback,u=s.timer,d=s.params;if(clearTimeout(u),e.params=d,this.sendingCmdMap.delete(a),"heartbeat"===e.cmd)return void c[0]();var l=null===(r=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===r?void 0:r.call(t,e);l&&"function"==typeof l.then?l.then((function(e){c[0](e)})).catch((function(e){c[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),c[0](e))}else{var p=null===(i=null===(n=this.core[e.service])||void 0===n?void 0:n.process)||void 0===i?void 0:i.call(n,e);p&&"function"==typeof p.then&&p.catch((function(e){o.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==Cl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Kf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=Bs((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,tp.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(Kf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),tp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}();function eg(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return tg(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tg(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tg(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Xf||(Xf={}));var rg=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.linkSSL=!0,this.packetSer=1,this.backoff=new Yh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new sd,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.setLinkSSL=function(e){this.linkSSL=e},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",gs.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:tp.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:tp.net.getNetworkStatus()}),c.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==Cl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new gs((function(n,i){var o;t.socket=new Xh(t.core,e,t.linkSSL),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return Xl(t,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect",n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Xf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientSocketV2::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new kl({code:Cl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Xf.ACTIVE||e===Xf.KICKED?this.destroyOnlineListener():e===Xf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new kl({code:Cl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!au(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),gs.reject(new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:dr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=vh(e,c,this.logger,t);if(!u){var d=new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:dr(dr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),gs.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=Ei(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new gs((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?Bs((function(){var t=new kl({code:Cl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:dr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(h),p||i(l)}catch(t){var s=new kl({code:Cl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:dr({ser:c,reason:"Unable to send packet"+(t&&t.message?": "+t.message:""),timetag:(new Date).getTime(),rawError:t},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return Xl(n,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e,i=[Cl.V2NIM_ERROR_CODE_DISCONNECT,Cl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Cl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],au(i).call(i,n.code)){t.next=4;break}return t.abrupt("return",gs.reject(n));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(r=this.socket)||void 0===r?void 0:r.sessionId,start_time:f,action:2,exception_service:6}),o=tm(n,"detail.disconnect_reason")||"",a=n.code===Cl.V2NIM_ERROR_CODE_DISCONNECT?Ei({disconnect_reason:o}):n.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:a,operation_type:1,target:l.SID+"-"+l.CID,context:""+l.SER},{asyncParams:tp.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),t.abrupt("return",gs.reject(n));case 10:case"end":return t.stop()}}),t,this)})))}))},t.onMessage=function(e){var t=yh(e,this.logger);if(t)for(var r,n=eg(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("clientSocketV2::onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o,i.content):this.logger.log("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o+";code:"+i.raw.code)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n,i,o=this;if(e){var a=e.raw.ser,s=this.sendingCmdMap.get(a);if(s&&s.cmd===e.cmd){var c=s.callback,u=s.timer,d=s.params;if(clearTimeout(u),e.params=d,this.sendingCmdMap.delete(a),"heartbeat"===e.cmd)return void c[0]();var l=null===(r=null===(t=this.core[e.service])||void 0===t?void 0:t.process)||void 0===r?void 0:r.call(t,e);l&&"function"==typeof l.then?l.then((function(e){c[0](e)})).catch((function(e){c[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),c[0](e))}else{var p=null===(i=null===(n=this.core[e.service])||void 0===n?void 0:n.process)||void 0===i?void 0:i.call(n,e);p&&"function"==typeof p.then&&p.catch((function(e){o.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==Cl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Xf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=Bs((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,tp.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(Xf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),tp.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}(),ng=function(){function e(e){this.currenRetryCount=0,this.backoff=new Yh({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.reset=function(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function(){var e=this,t=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var r=this.reconnectDelayProvider(t);"number"==typeof r&&r>=0&&(t=r>=1e3?r:r+200+Math.ceil(300*Math.random()))}catch(e){this.core.logger.error("reconnect::connectDelayProvider excute failed,",e)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+t+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=Bs((function(){e.core.logger.log("reconnect::reconnect timer is now triggered");var t=e.auth.getConnectStatus();3===t?e.doReLogin():e.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+t)}),t),!0},t.doReLogin=function(){var e=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var t=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return t.then((function(){e.core.reporter.reportTraceEnd("login",!0)})).catch((function(t){var r=t;if(e.core.logger.warn("reconnect::try login but failed due to",r),e.core.reporter.reportTraceEnd("login",!1),e.auth.checkLoginTerminalCode(r&&r.code))return e.auth.clientSocket.doDisconnect(Kf.ACTIVE,"ReloginTerminated"),void e.auth.lifeCycle.processEvent("exited",r);r&&399===r.code&&e.auth.lbs.reset(),e.auth.lifeCycle.processEvent("waiting")})),t},t._setReconnectDelayProvider=function(e){this.reconnectDelayProvider=e},e}(),ig=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.getLbsInfos=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",gs.resolve(t));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),r=Zh(this.auth.config.lbsUrls),e.prev=8,e.next=11,this.ladderLoad(r);case 11:if(200===(n=e.sent).status&&n.data){e.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+n.status}});case 15:this.success(n),e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(8),i=e.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=25;break}throw e.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return e.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return e.stop()}}),e,this,[[8,18]])})))},t.checkTerminator=function(e){return e===Cl.V2NIM_ERROR_CODE_CANCELLED||e===Cl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(wu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=Bs((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V2NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(dr(dr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V2NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new gs((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V2NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(dr(dr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data.common,a=o["mix.link"]||[],s=o["link.default"]||[];this.socketLinkUrls=Os(t=Os(a).call(a,s)).call(t,this.auth.config.linkUrl),e.data["nos-chunk"]&&(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",e.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:e.data["nos-chunk"]})),ki(e.data.nosup)&&e.data.nosup.length>0&&(null===(i=this.core.cloudStorage)||void 0===i?void 0:i.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",e.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:e.data.nosup,commonUploadHost:e.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",Yc(r=this.socketLinkUrls).call(r,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:Ei(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:tp.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:tp.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),og=function(){function e(e){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.verifyAuthentication=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return n=t.sent,t.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return i=t.sent,this.auth.token=n,o=tp.getSystemInfo(),a={appkey:this.core.options.appkey,account:this.auth.account,token:n,authType:this.auth.loginOption.authType,appLogin:e?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100825,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.8.25":Yc(r=o.userAgent.replace("{{appkey}}",this.core.options.appkey)).call(r,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:o.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:o.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.8.25",os:o.os,browser:o.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:i},s=o.os.toLowerCase(),"UNIAPP"!==tp.platform||"ios"!==s&&"android"!==s&&"harmonyos"!==s?"React Native"===tp.platform&&(this.core.logger.log("V2NIMLoginService deviceInfo",this.core.V2NIMLoginService.deviceInfo,"os",s),a.isReactNative=1,a.clientType="ios"===s?2:1,a.deviceInfo=Ei(dr({IS_SUPPORT_HONOR:!0},this.core.V2NIMLoginService.deviceInfo))):(a.isReactNative=1,a.clientType="ios"===s?2:"android"===s?1:65,o.pushDeviceInfo&&o.pushDeviceInfo.MANUFACTURER&&(a.deviceInfo=Ei(dr({IS_SUPPORT_HONOR:!0},o.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",a.account,a.clientSession,a.appLogin),t.prev=12,t.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:a}));case 15:c=t.sent,t.next=26;break;case 18:if(t.prev=18,t.t0=t.catch(12),u=t.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:u.code||0,succeed:!1,description:u.message},{asyncParams:tp.net.getNetworkStatus()}),u.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&u.code!==Cl.V2NIM_ERROR_CODE_TIMEOUT){t.next=24;break}throw u;case 24:throw this.processLoginFailed(u),u;case 26:return d=c.content,l=d.data,p=d.loginClients,this.changeLoginClient(1,p),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:tp.net.getNetworkStatus()}),this.loginClientOfThisConnection=ff(l),this.core.clientSocket.setSessionId(l.consid),tp.localStorage.setItem(this.lastLoginClientKey,Ei(dr({account:this.auth.account},this.loginClientOfThisConnection))),t.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return t.stop()}}),t,this,[[12,18]])})))},t.refreshLoginToken=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.auth.loginOption.authType){t.next=2;break}return t.abrupt("return",this.auth.token);case 2:if("function"==typeof this.auth.loginOption.tokenProvider){t.next=4;break}return t.abrupt("return",this.auth.token);case 4:return t.prev=4,t.next=7,this.auth.loginOption.tokenProvider(e);case 7:if("string"!=typeof(r=t.sent)){t.next=12;break}return t.abrupt("return",r);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",r),new kl({code:Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:r}});case 14:t.next=23;break;case 16:throw t.prev=16,t.t0=t.catch(4),n=t.t0,i=n,n.code!==Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",n),i=new kl({code:Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:t.t0}})),this.processLoginFailed(n),i;case 23:case"end":return t.stop()}}),t,this,[[4,16]])})))},t.refreshThirdPartyExt=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this.auth.loginOption.loginExtensionProvider){t.next=2;break}return t.abrupt("return","");case 2:return t.prev=2,t.next=5,this.auth.loginOption.loginExtensionProvider(e);case 5:if("string"!=typeof(r=t.sent)){t.next=10;break}return t.abrupt("return",r);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",r),new kl({code:Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:r}});case 12:t.next=25;break;case 14:if(t.prev=14,t.t0=t.catch(2),n=t.t0,i=n,n.code!==Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",n),i=new kl({code:Cl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:t.t0}})),2!==this.auth.loginOption.authType){t.next=24;break}throw this.processLoginFailed(n),i;case 24:return t.abrupt("return","");case 25:case"end":return t.stop()}}),t,this,[[2,14]])})))},t.processLoginFailed=function(e){this.auth.clientSocket.doDisconnect(Kf.ACTIVE,e),this.checkLoginTerminalCode(e.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",e)},t.changeLoginClient=function(e,t){var r=this,n=lu(t).call(t,(function(e){return ff(e)}));if(1===e)this.loginClients=n,this.auth.emit("onLoginClientChanged",e,this.loginClients);else if(2===e){var i=gu(n).call(n,(function(e){var t,n=gu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId}));return r.loginClients.push(e),0===n.length}));i.length>0&&this.auth.emit("onLoginClientChanged",e,i)}else if(3===e){var o=gu(n).call(n,(function(e){var t;return function(e,t){t=t||function(){return!0};for(var r=[],n=(e=e||[]).length,i=0,o=0;o<n;o++)t(e[o-i])&&(r.push(li(e).call(e,o-i,1)[0]),i+=1)}(r.loginClients,(function(t){return t.clientId===e.clientId&&t.consid===e.consid})),0===gu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId})).length}));o.length>0&&this.auth.emit("onLoginClientChanged",e,o)}},t.checkAutoLogin=function(e){if(e)return!1;var t=tp.localStorage.getItem(this.lastLoginClientKey);if(!t)return!1;var r="",n="";try{var i=JSON.parse(t);r=tm(i,"clientId"),n=tm(i,"account")}catch(e){return!1}return r===this.auth.deviceId&&n===this.auth.account},t.checkLoginTerminalCode=function(e){var t=[Cl.V2NIM_ERROR_CODE_CANCELLED,Cl.V2NIM_ERROR_CODE_TIMEOUT,Cl.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Cl.V2NIM_ERROR_CODE_FORBIDDEN,Cl.V2NIM_ERROR_CODE_NOT_FOUND,Cl.V2NIM_ERROR_CODE_PARAMETER_ERROR,Cl.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Cl.V2NIM_ERROR_CODE_IM_DISABLED,Cl.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Cl.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Cl.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Cl.V2NIM_ERROR_CODE_INVALID_TOKEN,Cl.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Cl.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Cl.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Cl.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return au(t).call(t,e)},t.reset=function(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function(){tp.localStorage.removeItem(this.lastLoginClientKey)},e}(),ag=function(){function e(e){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=e,this.auth=e.V2NIMLoginService,this.logger=e.logger}var t=e.prototype;return t.processEvent=function(e,t,r){var n=this.getConnectStatus();switch(e){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(this.name+"::connect fail",t),this.setLoginStatus(3),this.setConnectStatus(0,t);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",t),this.setLoginStatus(3),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",t);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",r);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",t),!t)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(t.code)?0:3),this.setConnectStatus(0,t),this.auth.emit("onLoginFailed",t);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",r),this.setLoginStatus(0),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",t),this.setLoginStatus(0),this.setConnectStatus(0,t);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(3),this.setConnectStatus(3),2!==n&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function(){return this.connectStatus},t.getLoginStatus=function(){return this.loginStatus},t.setLoginStatus=function(e){e!==this.loginStatus&&(this.loginStatus=e,this.auth.emit("onLoginStatus",e))},t.setConnectStatus=function(e,t){if(e!==this.connectStatus){var r=this.connectStatus;this.connectStatus=e,this.auth.emit("onConnectStatus",e),this.delegateConnectEvent(r,e,t)}},t.delegateConnectEvent=function(e,t,r){1===e&&0===t&&r&&this.auth.emit("onDisconnected",r),2===e&&0===t&&r&&this.auth.emit("onConnectFailed",r)},e}(),sg=function(){function e(e){this.core=e,this.auth=e.V2NIMLoginService,this.datas=[]}var t=e.prototype;return t.switchDataSync=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e.type,o=e.state,a=e.error,s=e.subType,c=gu(r=this.datas).call(r,(function(e){return e.type===i&&e.subType===s})),c.length>0?(c[0].state=o,c[0].error=a):this.datas.push({type:i,state:o,subType:s}),u=Ou(n=this.datas).call(n,(function(e){return 3===e.state})),1===i&&(2===o&&"mainSync"===s?(this.core.eventBus.emit("V2NIMLoginService/syncing"),this.auth.emit("onDataSync",i,o)):3===o&&u&&(this.core.eventBus.emit("V2NIMLoginService/syncDone",a),this.auth.emit("onDataSync",i,o,a)));case 5:case"end":return t.stop()}}),t,this)})))},t.checkSyncing=function(){var e;return Hm(e=this.datas).call(e,(function(e){return"mainSync"===e.subType&&2===e.state}))},t.reset=function(){this.datas=[]},e}();function cg(e,t){e=e||{};var r={};return jn(t=t||[]).call(t,(function(t){void 0!==e[t]&&(r[t]=e[t])})),r}var ug=["https://lbs.netease.im/lbs/webconf.jsp"],dg={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},lg=function(e){function t(t,r){var n,i;return void 0===r&&(r={}),(n=e.call(this,"V2NIMLoginService",t)||this).account="",n.previousLoginAccount="",n.token="",n.deviceId="",n.clientSession="",n.processId="",n.kickedDetail=null,n.binaryWebsocket=!0,n.core._registerDep(pf,"misc"),Sh({cmdMap:vf,cmdConfig:If}),"v2"===t.options.apiVersion&&(Sh({cmdMap:yf,cmdConfig:Tf}),n.core.auth=ut(n)),n.previousLoginManager=new Yp,n.doLoginStepsManager=new Yp,n.loginTimerManager=new Yl,n.loginOption=dr({},dg),n.config={lbsUrls:ug,linkUrl:"weblink.netease.im:443",linkSSL:!0},n.setOptions(r),t.V2NIMLoginService=ut(n),!1!==n.core.options.binaryWebsocket&&"function"==typeof Uint8Array?(n.binaryWebsocket=!0,i=new Zf(n.core)):(n.binaryWebsocket=!1,i=new rg(n.core)),n.clientSocket=i,"v2"===n.core.options.apiVersion&&(n.core.clientSocket=i),n.lifeCycle=new ag(t),n.reconnect=new ng(t),n.lbs=new ig(t),n.authenticator=new og(t),n.dataSync=new sg(t),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){var t,r,n;Vl({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=Op(this.config,e),null===(r=null===(t=this.core.clientSocket)||void 0===t?void 0:t.setLinkSSL)||void 0===r||r.call(t,null===(n=this.config.linkSSL)||void 0===n||n);var i="",o="";this.config.isFixedDeviceId?(i=tp.localStorage.getItem("__NIM_DEVC_ID__")||wp(),o=tp.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||wp(),tp.localStorage.setItem("__NIM_DEVC_ID__",i),tp.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",o)):(i=wp(),o=wp()),this.deviceId=i,this.clientSession=o,this.core.reporter.setConfig({common:{dev_id:i}})},r.reset=function(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},r.login=function(e,t,r){return void 0===r&&(r={}),Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a=this;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._checkApiVersion(),i=tp.getSystemInfo()||{},o=i.os?i.os.toLowerCase():"","React Native"!==tp.platform||"android"!==o||!this.hasSettingService||!this.core.V2NIMSettingService.offlinePushPlugin){n.next=13;break}return n.prev=4,n.next=7,this.core.V2NIMSettingService.getRNDeviceInfo();case 7:this.deviceInfo=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n.catch(4),this.logger.error(n.t0);case 13:if(e){n.next=15;break}throw new Rl({detail:{reason:"Empty account"}});case 15:if(Vl({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1}},r,"",!0),0!==r.authType||t){n.next=18;break}throw new Rl({detail:{reason:"When authType is 0, token cannot be empty"}});case 18:if(""!==this.previousLoginAccount&&this.previousLoginAccount!==e&&this.core._clearModuleData(),0!==this.getLoginStatus()){n.next=23;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+e,r),n.next=29;break;case 23:if(1!==this.getLoginStatus()){n.next=27;break}return n.abrupt("return",this.smoothForLogined(e,t,r));case 27:if(2!==this.getLoginStatus()){n.next=29;break}return n.abrupt("return",this.smoothForLogining(e,t,r));case 29:return this.account=e,this.previousLoginAccount=e,this.token=t,this.processId=wp(),this.loginOption=Op(dg,r),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var e=new kl({code:Cl.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});a.doLoginStepsManager.clear(e),a.previousLoginManager.clear(e),a.originLoginPromise=void 0,a.lifeCycle.processEvent("exited",e)}),this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),n.prev=37,n.next=40,this.multiTryDoLogin();case 40:this.loginTimerManager.destroy(),n.next=47;break;case 43:throw n.prev=43,n.t1=n.catch(37),this.loginTimerManager.destroy(),n.t1;case 47:case"end":return n.stop()}}),n,this,[[4,10],[37,43]])})))},r.getChatroomLinkAddress=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:t},"",!0),n="unknow environment"!==Np(),t=void 0===t?n:t,r.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:t});case 5:return i=r.sent,r.abrupt("return",i.content.linkAddress);case 7:case"end":return r.stop()}}),r,this)})))},r.multiTryDoLogin=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),n=0;case 2:if(!(n<=this.loginOption.retryCount)){t.next=32;break}return i="V2NIMLoginService::times of login try: "+n,n>0?this.logger.warn(i):this.logger.log(i),t.prev=5,this.originLoginPromise=e||this.doLogin(!1),e=void 0,t.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return o=t.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,t.abrupt("return",o);case 18:if(t.prev=18,t.t0=t.catch(5),r=t.t0||r,this.logger.error("V2NIMLoginService::login failed, times of login try: "+n+", err.code: "+(null==r?void 0:r.code)+', err.message: "'+(null==r?void 0:r.message)+'"'),r.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(r&&r.code)){t.next=28;break}throw this.lifeCycle.processEvent("exited",r),r;case 28:r&&399===r.code&&this.lbs.reset();case 29:n++,t.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",r),r;case 34:case"end":return t.stop()}}),t,this,[[5,18]])})))},r.doLogin=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",i?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:Ei(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:tp.net.getNetworkStatus()}),n.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return o=n.sent,n.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(o,e));case 9:return n.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(i));case 11:if(a=n.sent,this.processId=wp(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.dataSync.reset(),this.lifeCycle.processEvent("loginSucc",void 0,dr(dr({},a),{isReconnect:e})),this.clientSocket.ping(),this.core.abtest.abtRequest(),"function"==typeof(null===(t=this.core.V2NIMClientAntispamUtil)||void 0===t?void 0:t.downloadLocalAntiSpamVocabs)&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),"function"!=typeof(null===(r=this.core.cloudStorage)||void 0===r?void 0:r.init)){n.next=29;break}return n.prev=21,n.next=24,this.core.cloudStorage.init();case 24:n.next=29;break;case 26:n.prev=26,n.t0=n.catch(21),this.logger.warn("doLogin::cloudStorage init error",n.t0);case 29:return n.abrupt("return",a);case 30:case"end":return n.stop()}}),n,this,[[21,26]])})))},r.smoothForLogined=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+i),!i){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,this.logout();case 8:return n.abrupt("return",this.login(e,t,r));case 9:case"end":return n.stop()}}),n,this)})))},r.smoothForLogining=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+i),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=t,this.loginOption=Op(this.loginOption,r),!i){n.next=18;break}if(this.originLoginPromise){n.next=11;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),n.next=14,gs.resolve();case 14:return n.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:n.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Kf.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),n.next=24,gs.resolve();case 24:return n.abrupt("return",this.login(e,t,r));case 25:case"end":return n.stop()}}),n,this)})))},r.checkIsSameLogin=function(e,t,r){return this.account===e&&this.loginOption.authType===r.authType&&(0!==r.authType||this.token===t)},r.logout=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),r=this.getLoginStatus(),e.t0=r,e.next=1===e.t0?10:2===e.t0?25:3===e.t0?29:0===e.t0?33:35;break;case 10:return e.prev=10,e.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(Kf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.next=24;break;case 18:e.prev=18,e.t1=e.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(Kf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return e.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(Kf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.abrupt("break",37);case 33:throw this.core._clearModuleData(),new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+r+". connectStatus "+t}});case 35:throw this.core._clearModuleData(),new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+r+". connectStatus "+t}});case 37:case"end":return e.stop()}}),e,this,[[10,18]])})))},r.getConnectStatus=function(){return this.lifeCycle.getConnectStatus()},r.getLoginStatus=function(){return this.lifeCycle.getLoginStatus()},r.getLoginUser=function(){return this.account},r.getLoginClients=function(){var e;return lu(e=function(e,t){e=e||[],t=t||"";for(var r=[],n=[],i=0;i<e.length;i++){var o=e[i][t];-1===wu(n).call(n,o)&&(n.push(o),r.push(e[i]))}return r}(this.authenticator.loginClients,"clientId")).call(e,(function(e){return cg(e,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}))},r.getCurrentLoginClient=function(){var e;if(null===(e=this.authenticator.loginClientOfThisConnection)||void 0===e?void 0:e.clientId)return cg(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])},r.getDataSync=function(){var e=this.dataSync.datas;return e&&e.length>0?lu(e).call(e,(function(e){return{type:e.type,state:e.state}})):null},r.setReconnectDelayProvider=function(e){this.reconnect._setReconnectDelayProvider(e)},r.kickOffline=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),Vl({clientId:{type:"string",allowEmpty:!1}},e,"",!0),t.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]});case 4:if(r=t.sent,0!==tm(r,"content.clientIds.length")){t.next=8;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return t.stop()}}),t,this)})))},r.getKickedOfflineDetail=function(){return this.kickedDetail},r.checkLoginTerminalCode=function(e){return this.authenticator.checkLoginTerminalCode(e)},r.checkIllegalState=function(){if(!this.getLoginUser())throw new kl({code:Cl.V2NIM_ERROR_CODE_ILLEGAL_STATE})},r._checkApiVersion=function(){if("v2"!==this.core.options.apiVersion)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},r.v2LoginHandler=function(e){if(e.error)throw this.clientSocket.doDisconnect(Kf.ACTIVE,e.error),e.error;return e},r.v2LoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(em(e.content.state),e.content.datas)},r.nimLoginClientChangeHandler=function(e){this.authenticator.changeLoginClient(em(e.content.state),e.content.datas)},r.qchatLoginClientChangeHandler=function(e){var t=em(e.content.state);t=1===t?2:3,this.authenticator.changeLoginClient(t,[e.content.data])},r.v2BeKickedHandler=function(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var t=function(e){return Uh({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},e)}(e.content);this.core.logger.warn("v2Bekicked::",t),this.kickedDetail=t,this.clientSocket.doDisconnect(Kf.KICKED,t),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new kl({code:Cl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),t),this.emit("onKickedOffline",t)}},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onLoginFailed"===t||"onDisconnected"===t||"onConnectFailed"===t){var c=a[0];this.logger.log(""+i,c.toString())}else if("onDataSync"===t){var u=a[2];this.logger.log(""+i,a[0],a[1],u&&u.toString())}else{var d,l;(d=this.logger).log.apply(d,Os(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},ct(t,[{key:"hasSettingService",get:function(){var e;return!!(null===(e=this.core.V2NIMSettingService)||void 0===e?void 0:e.name)}}]),t}(af),pg=M("".startsWith),mg=M("".slice),hg=Math.min,fg=tu("startsWith");nt({target:"String",proto:!0,forced:!fg},{startsWith:function(e){var t=Xi(V(this));Zc(e);var r=yt(hg(arguments.length>1?arguments[1]:void 0,t.length)),n=Xi(e);return pg?pg(t,n,r):mg(t,r,r+n.length)===n}});var gg=Xt("String").startsWith,vg=String.prototype,yg=function(e){var t=e.startsWith;return"string"==typeof e||e===vg||j(vg,e)&&t===vg.startsWith?gg:t},Mg=function(){function e(e){this.name="V2NIMConversationIdUtil",this.core=e}var t=e.prototype;return t.conversationId=function(e,t){return this.core.account+"|"+e+"|"+t},t.p2pConversationId=function(e){return this.core.account+"|1|"+e},t.teamConversationId=function(e){return this.core.account+"|2|"+e},t.superTeamConversationId=function(e){return this.core.account+"|3|"+e},t.messageConversationId=function(e){return 1===e.conversationType?e.senderId===this.core.account?this.p2pConversationId(e.receiverId):this.p2pConversationId(e.senderId):2===e.conversationType?this.teamConversationId(e.receiverId):this.superTeamConversationId(e.receiverId)},t.parseConversationType=function(e){try{if(e&&yg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Number(t[0])}return this.core.logger.warn("conversationId is not start with "+this.core.account),0}catch(e){return 0}},t.parseConversationTargetId=function(e){try{if(e&&yg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Yc(t).call(t,2)}return this.core.logger.warn("conversationId is not start with "+this.core.account),""}catch(e){return""}},t.convertToV1ConversationId=function(e){var t=this.parseConversationType(e);return(1===t?"p2p":2===t?"team":"superTeam")+"|"+this.parseConversationTargetId(e)},e}(),Ig=Xt("Array").keys,Tg=Array.prototype,Sg={DOMTokenList:!0,NodeList:!0},bg=function(e){var t=e.keys;return e===Tg||j(Tg,e)&&t===Tg.keys||me(Sg,zr(e))?Ig:t},Cg=function(){function e(){this.messages=new sd,this.capacity=1e4}var t=e.prototype;return t.reset=function(){this.messages.clear()},t.getMessageById=function(e){if(e)return this.messages.get(e)},t.getMessagesByConversationId=function(e){var t,r=[];return jn(t=this.messages).call(t,(function(t){t.conversationId===e&&r.push(t)})),r},t.getLastMessageOfConversation=function(e){var t=this.getMessagesByConversationId(e);if(0!==t.length)return Tl(t).call(t,(function(e,t){return t.createTime>e.createTime?t:e}),t[0])},t.upsertMessages=function(e){var t=this;jn(e).call(e,(function(e){t.setLRU(e.messageClientId,e)}))},t.setLRU=function(e,t){if(this.messages.has(e))this.messages.delete(e);else if(this.messages.size>=this.capacity){var r,n=bg(r=this.messages).call(r).next().value;n&&this.messages.delete(n)}this.messages.set(e,t)},t.deleteMessage=function(e){this.messages.delete(e)},t.deleteMessages=function(e,t){var r,n=this;jn(r=this.messages).call(r,(function(r){e===r.conversationId&&(!t||t&&r.createTime<t)&&n.messages.delete(r.messageClientId)}))},e}(),_g={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}}},Eg=dr({requestId:{type:"string",allowEmpty:!1}},_g),kg=[1,3,2,0],wg=[2,7,12,100,6,1,-1,4,5,11,0,10,3],Rg={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},Ag={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},xg={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},Ng={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:Rg},pushConfig:{type:"object",required:!1,rules:Ag},antiSpamConfig:{type:"object",required:!1,rules:xg},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:_g},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},Og={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:wg},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:Ng,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Pg={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:wg},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:Ng}},Lg={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:kg},createTime:{type:"number"}}},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},Vg={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:wg},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Ug={conversationType:{type:"enum",values:kg},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},Dg={messageRefers:{type:"array",required:!0,rules:Ug}},qg={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:kg},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Bg={messages:{type:"array",rules:qg}},Fg={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1},clearMode:{type:"enum",values:[0],required:!1}},Gg={serverExtension:{type:"string",required:!1}},jg={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[1]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Hg={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},Wg={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},Yg={message:{type:"object",rules:{conversationType:{type:"enum",values:kg},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},Kg={messages:{type:"array",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Qg={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},$g={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},zg={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},Jg={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:[1,0]},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},Xg={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:[1,0],required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:wg},messageSubtypes:{type:"array",required:!1,itemType:"number"}},Zg={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}}}},ev={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}},min:1}},tv={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},rv=dr(dr({},tv),{duration:{type:"number",required:!1}}),nv=dr(dr({},rv),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),iv=dr(dr({},tv),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),ov={messageRefer:{type:"object",required:!0,rules:Ug},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},av={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},sv={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:Rg},pushConfig:{type:"object",required:!1,rules:Ag},antiSpamConfig:{type:"object",required:!1,rules:xg},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},cv=function(){function e(e,t){this.p2pMessageReceipts={},this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.p2pMessageReceipts={}},t.sendP2PMessageReceipt=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(jg,e,"",!0),e.senderId!==this.core.account){t.next=3;break}throw new Rl({detail:{reason:"sendP2PMessageReceipt. sender: "+e.senderId+" is not allowed to send msg receipt"}});case 3:return t.next=5,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:e.senderId,messageClientId:e.messageClientId,createTime:e.createTime}});case 5:case"end":return t.stop()}}),t,this)})))},t.isPeerRead=function(e){if(1!==e.conversationType)return!1;if(e.senderId!==this.core.account)return!1;if(e.senderId===this.core.account&&e.receiverId===this.core.account)return!0;var t=this.core.V2NIMConversationIdUtil.messageConversationId(e),r=this.p2pMessageReceipts[t]||0;return e.createTime<=r},t.getP2PMessageReceipt=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Dl(this.core.account,e),1===this.core.V2NIMConversationIdUtil.parseConversationType(e)){t.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return t.abrupt("return",{conversationId:e,timestamp:this.p2pMessageReceipts[e]||0});case 5:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceipts=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(ev,{messages:e},"",!0),!Hm(e).call(e,(function(e){return e.senderId!==i.core.account}))){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!Hm(e).call(e,(function(t){return t.receiverId!==e[0].receiverId}))){t.next=5;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return t.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:e});case 7:return n=t.sent,t.abrupt("return",lu(r=n.content.data).call(r,(function(e){return dr(dr({},e),{conversationId:i.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId)})})));case 9:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceiptDetail=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(Zg,{message:e},"",!0),e.senderId===this.core.account){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+e.senderId+" incorrect"}});case 3:return t.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:e});case 5:return r=t.sent,t.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageClientId:e.messageClientId,messageServerId:e.messageServerId,readCount:r.content.readAccountList.length,unreadCount:r.content.unreadAccountList.length},readAccountList:r.content.readAccountList,unreadAccountList:r.content.unreadAccountList});case 7:case"end":return t.stop()}}),t,this)})))},t.sendTeamMessageReceipts=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Hm(e).call(e,(function(t){return t.conversationId!==e[0].conversationId}))){t.next=2;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: conversationId not same"}});case 2:if(Vl(Hg,{messages:e},"",!0),!Hm(e).call(e,(function(e){return e.senderId===r.core.account}))){t.next=5;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 5:return t.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:e});case 7:return t.abrupt("return");case 8:case"end":return t.stop()}}),t,this)})))},t.syncP2PMessagReceiptsHandler=function(e){var t,r=this,n=lu(t=e.content.data).call(t,(function(e){var t=r.core.V2NIMConversationIdUtil.p2pConversationId(e.senderId),n=e.createTime;return r.p2pMessageReceipts[t]=n,{conversationId:t,timestamp:n}}));this.service.emit("onReceiveP2PMessageReadReceipts",n)},t.onP2PMessageReceiptsHandler=function(e){var t=this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.data.senderId),r=e.content.data.createTime;this.p2pMessageReceipts[t]=r,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:t,timestamp:r}])},t.onTeamMessageReceiptsHandler=function(e){var t,r=this,n=lu(t=e.content.data).call(t,(function(e){return{conversationId:r.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:e.readCount,unreadCount:e.unreadCount,latestReadAccount:e.latestReadAccount}}));this.service.emit("onReceiveTeamMessageReadReceipts",n)},e}(),uv={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},dv={antispamBusinessId:1},lv="V2NIMTeamService",pv={teamId:1,name:3,teamType:{id:4,retConverter:function(e){return 0==+e?1:+e}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function(e,t){return 1==+e&&(void 0===t[13]||1==+t[13])}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},mv={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:function(e){try{return JSON.parse(e)}catch(e){return[]}}}},hv={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:function(e){try{return JSON.parse(e)}catch(e){return[]}}}},fv={accountIds:{id:1,converter:function(e){return Ei(e)}},operation:2},gv={v2TeamCreate:{sid:31,cid:1,service:lv,params:[{type:"Property",name:"team",reflectMapper:pv},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:dv}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:lv,params:[{type:"Property",name:"team",reflectMapper:pv},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:dv}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:lv,params:[{type:"Property",name:"team",reflectMapper:pv},{type:"Property",name:"antispamConfig",reflectMapper:dv}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:lv,params:[{type:"Property",name:"team",reflectMapper:pv},{type:"Property",name:"antispamConfig",reflectMapper:dv}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:lv,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:lv,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:lv,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:lv,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)}]},v2TeamGetByIds:{sid:31,cid:34,service:lv,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Ch(pv)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:lv,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Ch(pv)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:lv,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:lv,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)}]},v2TeamRejectInvite:{sid:31,cid:22,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)},{type:"Int",name:"isInTeam"}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Ch(pv)},{type:"Int",name:"isInTeam"}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:lv,params:[{type:"Property",name:"teamMember",reflectMapper:mv},{type:"Property",name:"specialFollowUpdate",reflectMapper:fv}],response:[{type:"Property",name:"data",reflectMapper:Ch(mv)}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:lv,params:[{type:"Property",name:"teamMember",reflectMapper:hv},{type:"Property",name:"specialFollowUpdate",reflectMapper:fv}],response:[{type:"Property",name:"data",reflectMapper:Ch(hv)}]},v2TeamUpdateMember:{sid:31,cid:20,service:lv,params:[{type:"Property",name:"teamMember",reflectMapper:mv}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:lv,params:[{type:"Property",name:"teamMember",reflectMapper:hv}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:lv,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:lv,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:lv,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:lv,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:lv,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(mv)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:lv,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(hv)}]},v2TeamMemberGetList:{sid:31,cid:36,service:lv,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function(e){return+e}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(mv)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:lv,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:Ch(pv)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:lv,response:[{type:"Property",name:"data",reflectMapper:Ch(pv)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:lv,response:[{type:"Property",name:"data",reflectMapper:Ch(mv)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:lv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(mv)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:lv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(pv)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:lv,response:[{type:"Property",name:"data",reflectMapper:Ch(pv)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:lv,response:[{type:"Property",name:"data",reflectMapper:Ch(hv)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:lv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(hv)},{type:"Long",name:"timetag"}]}};function vv(e,t){if(!e)return{};var r=e;return r.tinfo&&(r.tinfo=function(e){return Th(e,Ch(pv))}(r.tinfo),r.tinfo.teamType=t),r.uinfos,void 0!==r.mute&&(r.mute=em(r.mute)),r}function yv(e,t,r){return void 0===r&&(r={}),dr({teamId:e,teamType:t,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:0,agreeMode:0,inviteMode:0,updateInfoMode:0,updateExtensionMode:0,chatBannedMode:0,isValidTeam:!0},r)}function Mv(e,t,r,n){return void 0===n&&(n={}),dr({teamId:e,teamType:t,accountId:r,joinTime:0,inTeam:!0,memberRole:0,chatBanned:!1},n)}function Iv(e,t){return void 0===t&&(t=1),lu(e).call(e,(function(e){return function(e,t){return void 0===t&&(t=1),e.teamType=t,e.chatBanned=void 0!==e.chatBanned&&e.chatBanned,e}(e,t)}))}function Tv(e,t){var r,n=dr(dr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t),isSelf:t.senderId===e.account,sendingState:1,messageStatus:{errorCode:(null===(r=null==t?void 0:t.messageStatus)||void 0===r?void 0:r.errorCode)||200}});return n.threadReply&&(n.threadReply=dr(dr({},n.threadReply),{conversationType:n.conversationType,conversationId:n.conversationId})),n.threadRoot&&(n.threadRoot=dr(dr({},n.threadRoot),{conversationType:n.conversationType,conversationId:n.conversationId})),n}function Sv(e,t){return dr(dr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t)})}function bv(e,t){var r=t.createTime,n=t.senderId,i=t.receiverId,o=t.conversationType;return{conversationType:o,conversationId:e.V2NIMConversationIdUtil.messageConversationId({conversationType:o,senderId:n,receiverId:i}),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:r,messageClientId:t.messageClientId}}function Cv(e,t){var r={7:1,8:2,12:3,13:1,14:2}[t.sysMsgType];return{postscript:t.postscript,revokeType:{7:1,8:2,12:3,13:4,14:5}[t.sysMsgType]||0,revokeAccountId:t.opeAccount||t.senderId,callbackExtension:t.callbackExtension,serverExtension:t.attach||"",messageRefer:{conversationType:r,conversationId:e.V2NIMConversationIdUtil.messageConversationId(dr(dr({},t),{conversationType:r,senderId:t.senderId,receiverId:t.receiverId})),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:t.deleteMsgCreatetime,messageClientId:t.messageClientId}}}function _v(e,t){return{conversationId:1===t.conversationType?e.V2NIMConversationIdUtil.p2pConversationId(t.receiverId):2===t.conversationType?e.V2NIMConversationIdUtil.teamConversationId(t.teamId):e.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),deleteTime:t.deleteTime,serverExtension:t.serverExtension}}function Ev(e,t){var r={0:0,401:401,1:1,402:402,2:2,403:403,3:3,404:404,4:4,405:405,5:5,410:410,6:6,406:406,7:7,407:407,8:8,408:408,9:9,411:411,10:10,409:409};return void 0===r[t]&&e.logger.warn("[V2NIMMessageService] undefined notification type: "+t),"number"==typeof r[t]?r[t]:-1}function kv(e,t){return 5===e.messageType?function(e,t){var r,n,i,o,a,s=t.attachment||{};if(t.attachment&&"type"in t.attachment)return t;var c=void 0;if(null===(r=s.data)||void 0===r?void 0:r.tinfo){var u=s.id,d=s.data,l=u>400?2:1,p=vv(dr({},d),l).tinfo;c={},p.teamId,c=Jl(p,["teamId"])}var m=dr(dr(dr(dr({raw:s.raw,type:Ev(e,s.id)},c?{updatedTeamInfo:c}:{}),{targetIds:(null===(n=s.data)||void 0===n?void 0:n.ids)||((null===(i=s.data)||void 0===i?void 0:i.id)?[s.data.id]:[])}),"string"==typeof(null===(o=s.data)||void 0===o?void 0:o.attach)?{serverExtension:s.data.attach}:{}),"number"==typeof(null===(a=s.data)||void 0===a?void 0:a.mute)?{chatBanned:0!==s.data.mute}:{});return dr(dr({},t),{attachment:m})}(t,e):100===e.messageType?function(e,t){var r,n,i;if("string"==typeof(null===(r=t.attachment)||void 0===r?void 0:r.raw)&&(null===(i=null===(n=e.V2NIMMessageService)||void 0===n?void 0:n.customAttachmentParsers)||void 0===i?void 0:i.length)>0){var o=t.subType||0,a=e.V2NIMMessageService.customAttachmentParsers,s=t.attachment.raw;Hm(a).call(a,(function(r){try{var n=r(o,s);if(Zl(n))return n.raw=s,t.attachment=n,!0}catch(t){return e.logger.warn("customAttachmentParser: subType "+o+", raw: "+s+". parse error with "+t),!1}return!1}))}return t}(t,e):e}function wv(e,t){if(!t)return"";switch(e){case 100:return t.raw||"";case 1:case 3:case 2:case 6:return function(e){var t=e,r=t.width,n=t.height,i=t.duration;t.path,t.file,t.raw,t.ctx,t.payload,t.bucketName,t.objectName,t.token;var o=t.ext,a=Jl(t,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),s="string"==typeof o&&"."===o[0]?Yc(o).call(o,1):o;return Ei(dr(dr(dr(dr(dr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{w:r}),void 0===n?{}:{h:n}),void 0===i?{}:{dur:i}))}(t);case 4:return function(e){return Ei({lat:e.latitude,lng:e.longitude,title:e.address})}(t);case 12:return function(e){e.raw;var t=Jl(e,["raw"]);try{var r;return Ei(dr(dr({},t),{durations:lu(r=e.durations).call(r,(function(e){return{accid:e.accountId,duration:e.duration}}))}))}catch(t){return Ei(e)}}(t);default:return t.raw||Ei(t)}}function Rv(e,t){var r;try{switch(r=JSON.parse(e),t){case 100:return{raw:e};case 4:return function(e,t){return{latitude:t.lat,longitude:t.lng,address:t.title,raw:e}}(e,r);case 2:case 3:case 1:case 6:return function(e,t){var r=t.w,n=t.h,i=t.dur,o=t.ext,a=Jl(t,["w","h","dur","ext"]),s="string"==typeof o&&"."!==o[0]?"."+o:o;return dr(dr(dr(dr(dr(dr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{width:r}),void 0===n?{}:{height:n}),void 0===i?{}:{duration:i}),{raw:e})}(e,r);case 12:return function(e,t){var r;return dr(dr({},t),{durations:lu(r=t.durations).call(r,(function(e){return{accountId:e.accid,duration:e.duration}})),raw:e})}(e,r);default:return"object"==typeof r&&r?dr(dr({},r),{raw:e}):{raw:e}}}catch(t){return"object"==typeof r&&r?dr(dr({},r),{raw:e}):{raw:e}}}var Av=function(){function e(e){this.core=e}var t=e.prototype;return t.doSendFile=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u,d;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.attachment,r.prev=1,r.next=4,this.core.V2NIMStorageService._uploadFile({taskId:e.messageClientId,uploadParams:{fileObj:(null==n?void 0:n.file)||(null==n?void 0:n.path),sceneName:null==n?void 0:n.sceneName}},t,{fileType:e.messageType});case 4:for(u in(o=r.sent)[0],a=o[1],s=dr(dr({},n),{uploadState:1}),void 0!==a.w&&(s.width=s.width||a.w),void 0!==a.h&&(s.height=s.height||a.h),void 0!==a.dur&&(s.duration=s.duration||a.dur),s.ext=s.ext&&-1===wu(i=s.ext).call(i,".")?"."+s.ext:s.ext,c=["w","h","dur","ext","name"],a)au(c).call(c,u)||(s[u]=a[u]);s.raw,s.file,s.path,d=Jl(s,["raw","file","path"]),e.attachment=JSON.parse(Ei(d)),e.attachment&&(e.attachment.raw=wv(e.messageType,e.attachment)),r.next=23;break;case 19:throw r.prev=19,r.t0=r.catch(1),e.attachment&&(e.attachment.uploadState=2),r.t0;case 23:case"end":return r.stop()}}),r,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({messageClientId:{type:"string",allowEmpty:!1}},e,"",!0),au(r=[2,6,1,3]).call(r,e.messageType)){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+e.messageType+" incorrect"}});case 3:if(2!==e.sendingState&&1!==e.sendingState){t.next=5;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return t.next=7,this.core.V2NIMStorageService._cancelUploadFile(e.messageClientId);case 7:case"end":return t.stop()}}),t,this)})))},e}(),xv="V2NIMMessageService",Nv={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},Ov={conversationType:{id:0,converter:Bv,retConverter:Fv},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function(e,t){return wv(t.messageType,e)},retConverter:function(e,t){return Rv(e,Number(t[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:_h,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"])return e?Ei(e):"#%@all@%#"},retConverter:function(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(e){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:_h,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function(e){return tm(e,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:_h,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:_h,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:_h,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:_h,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:Eh,retConverter:kh},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:Eh,retConverter:Lp},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:Eh,retConverter:Lp},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:Lp},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:Eh,retConverter:Lp},errorCode:{id:61,access:"messageStatus.errorCode",converter:Lp,retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:_h,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:_h,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:_h,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:_h,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:_h,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:_h,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:_h,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:_h,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:Eh,retConverter:function(){}},inclusive:{id:155,access:"targetConfig.inclusive",converter:function(e){return e?1:2},retConverter:function(){}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:function(e){return e?1:2},retConverter:function(){}}},Pv=Ch(Ov),Lv={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};Ch(Lv);var Vv={version:1,md5:2,nosurl:3,thesaurus:4},Uv={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},Dv={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},qv={v2BatchMarkRead:{sid:4,cid:5,service:xv,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},onMsg:{sid:7,cid:2,service:xv,response:[{type:"Property",name:"msg",reflectMapper:Ch(Ov)}]},syncOfflineMsgs:{sid:4,cid:4,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Ov)}]},syncRoamingMsgs:{sid:4,cid:9,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Ov)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2RevokeMessage:{sid:30,cid:13,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Uv}]},v2DeleteMessage:{sid:30,cid:23,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Lv}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:xv,params:[{type:"PropertyArray",name:"tag",reflectMapper:Lv}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:xv,params:[{type:"PropertyArray",name:"tag",reflectMapper:Dv}],response:[{type:"PropertyArray",name:"tag",reflectMapper:Ch(Dv)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Uv}]},syncP2PMessagReceipts:{sid:4,cid:12,service:xv,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Ov)}]},onP2PMessageReceipts:{sid:7,cid:12,service:xv,response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:xv,params:[{type:"PropertyArray",name:"tag",reflectMapper:Dv}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Dv)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Dv,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:Ch(Dv)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:xv,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Dv)}]},onRevokeMessage:{sid:7,cid:14,service:xv,response:[{type:"Property",name:"data",reflectMapper:Ch(Uv)}]},syncRevokeMessage:{sid:7,cid:15,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Uv)}]},syncOnDeleteMessages:{sid:4,cid:21,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Lv)}]},onDeleteMessage:{sid:7,cid:123,service:xv,response:[{type:"Property",name:"data",reflectMapper:Ch(Lv)}]},onDeleteMessages:{sid:7,cid:124,service:xv,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Lv)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Vv}],response:[{type:"Property",name:"data",reflectMapper:Ch(Vv)}]},v2MessageP2pModify:{sid:30,cid:31,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2MessageTeamModify:{sid:31,cid:37,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:xv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2MessageOnModified:{sid:7,cid:33,service:xv,response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},v2MessageSyncModified:{sid:4,cid:27,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Ov)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:xv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Ov)},{type:"Long",name:"time"}]}};function Bv(e){return 1===e?0:2===e?1:3===e?5:void 0}function Fv(e){var t=em(e);return 0===t?1:1===t?2:5===t?3:0}var Gv="V2NIMNotificationService",jv={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},Hv={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:_h,retConverter:function(e,t){return"0"!==t[6]&&!!em(e)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:_h,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(101===e.type&&e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"])return e?Ei(e):"#%@all@%#"},retConverter:function(e){if("#%@all@%#"!==e&&e)try{return JSON.parse(e)}catch(e){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:_h,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:_h,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:_h,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:_h,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:_h,retType:"boolean",access:"pushConfig.pushNickEnabled"}},Wv={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},Yv={v2SendCustomNotification:{sid:30,cid:7,service:Gv,params:[{type:"Property",name:"tag",reflectMapper:Hv}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:Gv,params:[{type:"Property",name:"tag",reflectMapper:Hv}]},onSysNotification:{sid:7,cid:3,service:Gv,response:[{type:"Property",name:"data",reflectMapper:Ch(Hv)}]},syncBroadcastMsg:{sid:4,cid:16,service:Gv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Wv)}]},onBroadcastMsg:{sid:7,cid:17,service:Gv,response:[{type:"Property",name:"data",reflectMapper:Ch(Wv)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:Gv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Hv)}]},v2NotificationRevoke:{sid:7,cid:14,service:Gv,response:[{type:"Property",name:"data",reflectMapper:Ch(Hv)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:Gv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Hv)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},Kv="YSFService",Qv={"4_5":"ysfBatchMarkRead","101_1":"ysfSendMessage","101_2":"ysfOnMsg","4_100":"ysfSyncOfflineMsgs","101_3":"ysfOnSysNotification","101_7":"ysfSendCustomNotification","4_101":"ysfSyncSysNotification"},$v={ysfBatchMarkRead:{sid:4,cid:5,service:Kv,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},ysfSendMessage:{sid:101,cid:1,service:Kv,params:[{type:"Property",name:"tag",reflectMapper:Ov}],response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},ysfOnMsg:{sid:101,cid:2,service:Kv,response:[{type:"Property",name:"data",reflectMapper:Ch(Ov)}]},ysfSyncOfflineMsgs:{sid:4,cid:100,service:Kv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Ov)}]},ysfOnSysNotification:{sid:101,cid:3,service:Kv,response:[{type:"Property",name:"data",reflectMapper:Ch(Hv)}]},ysfSendCustomNotification:{sid:101,cid:7,service:Kv,params:[{type:"Property",name:"tag",reflectMapper:Hv}]},ysfSyncSysNotification:{sid:4,cid:101,service:Kv,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Hv)}]}},zv={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},Jv=function(){function e(e){this.core=e}return e.prototype.generateNotificationTag=function(e,t,r){var n;void 0===r&&(r={});var i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),a=Es(),s=((n={})[1]=100,n[2]=101,n[3]=103,n);return dr(dr({},r),{notificationConfig:dr({unreadEnabled:!0,offlineEnabled:!0},null==r?void 0:r.notificationConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0},null==r?void 0:r.pushConfig),antispamConfig:dr({antispamEnabled:!0},null==r?void 0:r.antispamConfig),routeConfig:dr({routeEnabled:!0},null==r?void 0:r.routeConfig),timestamp:a,type:s[i],receiverId:o,content:t})},e}();function Xv(e){var t="object"==typeof e?e:void 0,r="string"==typeof e?e:void 0;if(!t&&!r)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof r)if(0===wu(r).call(r,"nim-external")){var n=document.getElementById(r);if(!(n&&n.files&&n.files[0]))throw new kl({code:Cl.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+r}});t=n.files[0]}else if("BROWSER"===tp.platform)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+r}});if("object"==typeof t&&void 0===t.size)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:t,path:r}}var Zv,ey,ty={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}},ry=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageUtil",t)||this).core=t,r}nr(t,e);var r=t.prototype;return r.imageThumbUrl=function(e,t){return e+"?imageView&thumbnail="+t+"z"+t},r.videoCoverUrl=function(e,t){return e+"?vframe&offset="+t},r.getImageThumbUrl=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(ty,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getThumbUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},r.getVideoCoverUrl=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(ty,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getVideoCoverUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},t}(af),ny={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},iy={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function oy(e){return void 0===e&&(e="file"),Ei(ny[e]||{}).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(Zv||(Zv={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(ey||(ey={}));var ay={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function sy(e,t){e=e||{},t=t||function(){return!0};var r={};for(var n in e)t(e[n])&&(r[n]=e[n]);return r}var cy=function(){function e(e,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=e,this.cloudStorage=t}var t=e.prototype;return t.reset=function(){this.nosErrorCount=0},t.getNosAccessToken=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getNosAccessToken",{tag:e});case 2:return r=t.sent,n=tm(r,"content.nosAccessTokenTag.token"),i=e.url,t.abrupt("return",{token:n,url:-1!==wu(i).call(i,"?")?i+"&token="+n:i+"?token="+n});case 6:case"end":return t.stop()}}),t,this)})))},t.deleteNosAccessToken=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:e});case 2:case"end":return t.stop()}}),t,this)})))},t.nosUpload=function(e,t){var r,n,i,o,a,s,c,u;return Xl(this,void 0,void 0,zl.mark((function d(){var l,p,m,h,f,g,v,y,M,I,T,S,b,C,_,E,k,w,R;return zl.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(l=tm(this.core,"config.cdn.bucket"),p={tag:e.nosScenes||l||"nim"},e.nosSurvivalTime&&(p.expireSec=e.nosSurvivalTime),m=this.core.adapters.getFileUploadInformation(e),t||m){d.next=18;break}return d.prev=6,d.next=9,this.core.sendCmd("getNosToken",{responseBody:oy(e.type),nosToken:p});case 9:h=d.sent,d.next=18;break;case 12:if(d.prev=12,d.t0=d.catch(6),this.core.logger.error("uploadFile:: getNosToken error",d.t0),!(d.t0 instanceof kl)){d.next=17;break}throw d.t0;case 17:throw new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:d.t0,curProvider:1}});case 18:return f=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",m?null===(r=m.uploadInfo)||void 0===r?void 0:r.objectName:t?null==t?void 0:t.objectName:h.content.nosToken.objectName),g="",t&&t.shortUrl&&(g=t.shortUrl),(null===(o=null===(i=null===(n=null==m?void 0:m.uploadInfo)||void 0===n?void 0:n.payload)||void 0===i?void 0:i.mixStoreToken)||void 0===o?void 0:o.shortUrl)&&(g=m.uploadInfo.payload.mixStoreToken.shortUrl),v=g||f,d.prev=23,M=m?{token:null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.token,bucket:null===(s=null==m?void 0:m.uploadInfo)||void 0===s?void 0:s.bucketName,objectName:null===(c=null==m?void 0:m.uploadInfo)||void 0===c?void 0:c.objectName}:t||h.content.nosToken,this.core.logger.log("uploadFile:: uploadFile params",{nosToken:M,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:tp.platform}),I="BROWSER"===tp.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(M&&M.bucket),this.core.reporterHookCloudStorage.update({remote_addr:I,operation_type:t?2:0}),d.next=30,this.core.adapters.uploadFile(dr(dr(dr({},e),{nosToken:M,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:e.maxSize||this.config.chunkMaxSize}),t?{payload:{mixStoreToken:t}}:{}));case 30:y=d.sent,d.next=65;break;case 33:if(d.prev=33,d.t1=d.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",d.t1),T="v2"===tm(this.core,"options.apiVersion"),d.t1.code!==Cl.V2NIM_ERROR_CODE_CANCELLED&&10499!==d.t1.errCode){d.next=39;break}throw new xl({code:T?Cl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:tm(d.t1,"message")||"Request abort",rawError:d.t1,curProvider:1}});case 39:if(!T||d.t1.errCode!==Cl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){d.next=41;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:tm(d.t1,"message")||"Read file failed",rawError:d.t1,curProvider:1}});case 41:return d.next=43,tp.net.getNetworkStatus();case 43:if(S=d.sent,!1!==S.net_connect){d.next=47;break}throw new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:d.t1,curProvider:1}});case 47:if(!t){d.next=64;break}if(!(this.nosErrorCount<=0)){d.next=60;break}d.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=56;break;case 53:throw d.prev=53,d.t2=d.catch(49),new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:e.file||e.filePath}});case 56:return this.nosErrorCount=tm(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),d.abrupt("return",this.cloudStorage._uploadFile(e));case 60:return this.nosErrorCount--,d.abrupt("return",this.nosUpload(e,t));case 62:d.next=65;break;case 64:throw new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:d.t1,curProvider:1}});case 65:if(b=null==y?void 0:y.type,(C=b&&wu(b).call(b,"/")>-1?Yc(b).call(b,0,wu(b).call(b,"/")):"")||(C=e.type||""),(_={image:"imageInfo",video:"vinfo",audio:"vinfo"})[C]){d.next=71;break}return d.abrupt("return",dr({url:v},y));case 71:return d.prev=71,d.next=74,this.core.adapters.request(f+"?"+_[C],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:E=d.sent,d.next=81;break;case 77:return d.prev=77,d.t3=d.catch(71),this.core.logger.error("uploadFile:: fetch file info error",d.t3),d.abrupt("return",dr({url:v},y));case 81:if(!E){d.next=88;break}return k=E.data,w="imageInfo"===_[C]?k:null===(u=null==k?void 0:k.GetVideoInfo)||void 0===u?void 0:u.VideoInfo,R={url:v,name:y.name,size:y.size,ext:y.ext,w:null==w?void 0:w.Width,h:null==w?void 0:w.Height,orientation:null==w?void 0:w.Orientation,dur:null==w?void 0:w.Duration,audioCodec:null==w?void 0:w.AudioCodec,videoCodec:null==w?void 0:w.VideoCodec,container:null==w?void 0:w.Container},d.abrupt("return",sy(R,(function(e){return void 0!==e})));case 88:return d.abrupt("return",dr({url:v},y));case 89:case"end":return d.stop()}}),d,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.core.logger.error("getNosCdnHost::error",t.t0),t.abrupt("return");case 10:if(r){t.next=12;break}return t.abrupt("return");case 12:n=null===(e=null==r?void 0:r.content)||void 0===e?void 0:e.nosConfigTag,0!==(i=em(null==n?void 0:n.expire))&&n.cdnDomain?-1===i?(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){o._getNosCdnHost()}),1e3*i)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return t.stop()}}),t,this,[[0,6]])})))},ct(e,[{key:"config",get:function(){return this.cloudStorage.config}}]),e}(),uy={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},dy={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},ly={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:dy.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:gf(dy.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:dy.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:gf(dy.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:gf(dy.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:gf(dy.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:gf(dy.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:dy.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:gf(dy.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:dy.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:gf(dy.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:dy.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:gf(dy.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:dy.nosAccessTokenTag}]}},py=function(){function e(e,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.reset=function(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(tp.localStorage)try{tp.localStorage.getItem&&tp.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(tp.localStorage.getItem(this.GRAYKEY))[e])}catch(e){tp.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",e)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){r.next=17;break}return r.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(n=r.sent).content||!n.content.grayConfigTag){r.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(n.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(n.content.grayConfigTag.ttl)}catch(e){this.logger.error("getGrayscaleConfig error",e)}if(this.grayConfig){r.next=10;break}return r.abrupt("return");case 10:i=tp.localStorage.getItem(this.GRAYKEY)?JSON.parse(tp.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),i[e]=this.grayConfig,tp.localStorage.setItem(this.GRAYKEY,Ei(i)),r.next=17;break;case 16:this.logger.log("uploadFile:: result grayConfig:",n.content);case 17:if(!(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable)){r.next=20;break}return r.next=20,this._getMixStorePolicy(e);case 20:case"end":return r.stop()}}),r,this)})))},t._getMixStorePolicy=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(new Date).getTime(),tp.localStorage)try{this.mixStorePolicy=JSON.parse(tp.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=em(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>r&&(i=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-r,this.core.timerManager.addTimer(tr(n=this._getMixStorePolicy).call(n,this,e),i))}catch(r){tp.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(tp.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",r)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=r)){t.next=31;break}return t.prev=3,t.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:a=t.sent,s=a.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=s.policyVersion,this.mixStorePolicy.ttl=Number(s.ttl),this.mixStorePolicy.providers=s.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=em(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=s.nosPolicy?JSON.parse(s.nosPolicy):null,this.mixStorePolicy.s3Policy=s.s3Policy?JSON.parse(s.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(tr(o=this._getMixStorePolicy).call(o,this,e),1e3*this.mixStorePolicy.ttl),c=tp.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(tp.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),c[e]=this.mixStorePolicy,tp.localStorage.setItem(this.MIXSTOREKEY,Ei(c)),t.next=31;break;case 24:if(t.prev=24,t.t0=t.catch(3),this.logger.error("getMixStorePolicy error",t.t0),0!==this.mixStoreErrorCount){t.next=29;break}throw new Error("getMixStorePolicy all count error");case 29:this._getMixStorePolicy(e),this.mixStoreErrorCount--;case 31:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 32:case"end":return t.stop()}}),t,this,[[3,24]])})))},t._addCircuitTimer=function(){var e=this,t=this.mixStorePolicy.providers,r=t[(wu(t).call(t,String(this.curProvider))+1)%t.length];if(!r)throw new Error("uploadFile nextProvider error");if(r===t[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+r),this.curProvider=em(r),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var n=this.mixStorePolicy[1===this.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){e.logger.log("uploadFile:: upload policy will change,now policy:"+e.curProvider+" nextProvider:"+em(e.mixStorePolicy.providers[0])),e.curProvider=em(e.mixStorePolicy.providers[0]),e.core.timerManager.deleteTimer(e.circuitTimer)}),1e3*n)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e});case 2:return r=t.sent,t.abrupt("return",r.content.mixStoreAuthTokenResTag);case 4:case"end":return t.stop()}}),t,this)})))},e}(),hy=Tp.trim,fy=M("".charAt),gy=c.parseFloat,vy=c.Symbol,yy=vy&&vy.iterator,My=1/gy(fp+"-0")!=-1/0||yy&&!u((function(){gy(Object(yy))}))?function(e){var t=hy(Xi(e)),r=gy(t);return 0===r&&"-"==fy(t,0)?-0:r}:gy;nt({global:!0,forced:parseFloat!=My},{parseFloat:My});var Iy,Ty=B.parseFloat,Sy=-1,by=function(){function e(e,t){this.s3=null,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.s3Upload=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g,v=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Sy+=1,!e.file){r.next=5;break}n=e.file,r.next=20;break;case 5:if("string"!=typeof e.fileInput){r.next=15;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((i=document.getElementById(e.fileInput))&&i.files&&i.files[0])){r.next=12;break}n=i.files[0],r.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:r.next=20;break;case 15:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){r.next=19;break}n=e.fileInput.files[0],r.next=20;break;case 19:throw new Error("Can not get file from fileInput "+e.fileInput);case 20:if(this.mixStorePolicy.s3Policy){r.next=22;break}throw new Error("dont get s3 policy");case 22:return o={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},a=this.s3,s=decodeURIComponent(t.bucket),c=decodeURIComponent(t.objectName),u=n,d="https://"+s+".s3.amazonaws.com/"+c,l={},(p=this.mixStorePolicy.s3Policy)&&p.uploadConfig&&ki(p.uploadConfig.uploadUrl)&&p.uploadConfig.uploadUrl.length>0&&(m=p.uploadConfig.uploadUrl.length,Sy%=m,l.endpoint=p.uploadConfig.uploadUrl[Sy],l.s3ForcePathStyle=!0,d=l.endpoint+"/"+s+"/"+c),this.core.reporterHookCloudStorage.update({remote_addr:d,operation_type:1}),(h=new a(l)).config.update(o),f={Bucket:s,Key:c,Body:u,Metadata:{token:t.token},ContentType:u.type||"application/octet-stream"},this.core.logger.log("uploadFile:: s3 upload params:",f),(g=h.upload(f)).on("httpUploadProgress",(function(t){var r=Ty((t.loaded/t.total).toFixed(2));e.onUploadProgress&&e.onUploadProgress({total:t.total,loaded:t.loaded,percentage:r,percentageText:Math.round(100*r)+"%"})})),r.abrupt("return",new gs((function(r,n){var i=(new Date).getTime();g.send((function(o,a){return Xl(v,void 0,void 0,zl.mark((function d(){var l,p,m,h,f,g,v,y;return zl.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(!o||"RequestAbortedError"!==o.code){d.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",o),n(new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:o,curProvider:2}})),d.next=41;break;case 5:if(!o){d.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",o),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(p=null===(l=this.core)||void 0===l?void 0:l.auth)||void 0===p?void 0:p.account),trace_id:null===(m=this.core.clientSocket.socket)||void 0===m?void 0:m.sessionId,start_time:i,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof o.status?o.status:"number"==typeof o.code?o.code:0,description:o.message||""+o.code,operation_type:1,target:Ei({bucket:s,object:c})},{asyncParams:tp.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),d.next=12,tp.net.getNetworkStatus();case 12:if(h=d.sent,!1!==h.net_connect){d.next=16;break}return d.abrupt("return",n(new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:o,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:d.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=23;break;case 20:return d.prev=20,d.t0=d.catch(16),d.abrupt("return",n(new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:e.file||e.filePath}})));case 23:r(this.cloudStorage._uploadFile(e)),d.next=41;break;case 26:if(f=(f=(f=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",a.Key),g={size:u.size,name:u.name,url:t.shortUrl?t.shortUrl:f,ext:u.name.split(".")[1]||"unknown"},v=e.type||"",(y={image:"imageInfo"})[v]){d.next=36;break}return d.abrupt("return",r(g));case 36:return d.t1=r,d.next=39,this.getS3FileInfo({url:f,infoSuffix:y[v],s3Result:g});case 39:return d.t2=d.sent,d.abrupt("return",(0,d.t1)(d.t2));case 41:case"end":return d.stop()}}),d,this,[[16,20]])})))})),e.onUploadStart&&e.onUploadStart(g)})));case 39:case"end":return r.stop()}}),r,this)})))},t.getS3FileInfo=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.url,i=e.infoSuffix,o=e.s3Result,r.prev=1,r.next=4,this.core.adapters.request(n+"?"+i,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:a=r.sent,r.next=11;break;case 7:return r.prev=7,r.t0=r.catch(1),this.core.logger.error("uploadFile:: fetch file info error",r.t0),r.abrupt("return",o);case 11:if(!a){r.next=18;break}return s=a.data,c="imageInfo"===i?s:null===(t=null==s?void 0:s.GetVideoInfo)||void 0===t?void 0:t.VideoInfo,u=dr(dr({},o),{w:null==c?void 0:c.Width,h:null==c?void 0:c.Height,orientation:null==c?void 0:c.Orientation,dur:null==c?void 0:c.Duration,audioCodec:null==c?void 0:c.AudioCodec,videoCodec:null==c?void 0:c.VideoCodec,container:null==c?void 0:c.Container}),r.abrupt("return",sy(u,(function(e){return void 0!==e})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",n+"?"+i),r.abrupt("return",o);case 20:case"end":return r.stop()}}),r,this,[[1,7]])})))},ct(e,[{key:"mixStorePolicy",get:function(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),e}(),Cy=function(){function e(e,t){void 0===t&&(t={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=e.logger,this.core=e,this.nos=new cy(e,this),this.mixStorage=new py(e,this),this.aws=new by(e,this),Sh({cmdMap:uy,cmdConfig:ly}),this.setOptions(t),this.setListeners()}var t=e.prototype;return t.setOptions=function(e){void 0===e&&(e={});var t=e.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=t+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=t+"-AllMixStorePolicy";var r=e.s3,n=Jl(e,["s3"]),i=dr({},ay,this.config);if(n&&Object.prototype.hasOwnProperty.call(n,"cdn")){var o=dr(dr({},i.cdn),n.cdn);this.config=dr({},i,n),this.config.cdn=o}else this.config=dr({},i,n);r&&(this.aws.s3=r)},t.setListeners=function(){var e,t,r,n;this.core.eventBus.on("kicked",tr(e=this._clearUnCompleteTask).call(e,this)),this.core.eventBus.on("disconnect",tr(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",tr(r=this._clearUnCompleteTask).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",tr(n=this._clearUnCompleteTask).call(n,this))},t._clearUnCompleteTask=function(){var e,t=this;jn(e=fr(this.uploadTaskMap)).call(e,(function(e){var r=t.uploadTaskMap[e];r&&r.abort&&r.abort()})),this.uploadTaskMap={}},t.init=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){e.next=5;break}return e.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return e.next=7,this.nos._getNosCdnHost();case 7:case"end":return e.stop()}}),e,this)})))},t.processCallback=function(e,t){var r=this,n=e.onUploadProgress,i=e.onUploadDone,o=e.onUploadStart;return{onUploadStart:"function"==typeof o?function(e){r.uploadTaskMap[t]=e;try{o(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",e)}}:function(e){r.uploadTaskMap[t]=e},onUploadProgress:"function"==typeof n?function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total});try{n(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",e)}}:function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total})},onUploadDone:"function"==typeof i?function(e){r.core.reporterHookCloudStorage.end(0);try{i(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",e)}}:function(){r.core.reporterHookCloudStorage.end(0)},taskKey:t}},t.uploadFile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),e.fileInput||e.file||e.filePath){t.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!e.type||"file"===e.type){t.next=7;break}if(!(r=tm(e,"file.type"))||"string"!=typeof r||-1!==wu(r).call(r,e.type)){t.next=7;break}throw new Error('The meta type "'+r+'" does not match "'+e.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),e.file?this.core.reporterHookCloudStorage.update({full_size:e.file.size}):"string"==typeof e.fileInput?(n=document.getElementById(e.fileInput))&&n.files&&n.files[0]&&this.core.reporterHookCloudStorage.update({full_size:n.files[0].size}):e.fileInput&&e.fileInput.files&&e.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:e.fileInput.files[0].size}),i=wp(),o=this.processCallback(e,i),a=o.onUploadStart,s=o.onUploadProgress,c=o.onUploadDone,e.onUploadStart=a,e.onUploadProgress=s,e.onUploadDone=c,u=null,t.prev=15,t.next=18,this._uploadFile(e);case 18:u=t.sent,e.md5&&(u.md5=e.md5),delete this.uploadTaskMap[i],t.next=28;break;case 23:throw t.prev=23,t.t0=t.catch(15),delete this.uploadTaskMap[i],this.core.reporterHookCloudStorage.end((t.t0&&t.t0.code)===Cl.V2NIM_ERROR_CODE_CANCELLED?3:1),t.t0;case 28:return u&&(u.size=void 0===u.size?void 0:Number(u.size),u.w=void 0===u.w?void 0:Number(u.w),u.h=void 0===u.h?void 0:Number(u.h),u.dur=void 0===u.dur?void 0:Number(u.dur)),u.url=decodeURIComponent(u.url),e.onUploadDone({size:u.size,name:u.name,url:u.url,ext:u.name.split(".")[1]||"unknown"}),t.abrupt("return",u);case 32:case"end":return t.stop()}}),t,this,[[15,23]])})))},t._uploadFile=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(tm(this.mixStorage,"grayConfig.mixStoreEnable")&&tm(this.mixStorage,"mixStorePolicy.providers.length")){n.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),n.abrupt("return",this.nos.nosUpload(e));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+tm(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+tm(this.mixStorage,"curProvider")),i=this.core.adapters.getFileUploadInformation(e),o=!0,i?!1===i.complete&&2===this.mixStorage.curProvider&&(o=!1):o=!1,this.aws.s3||(this.mixStorage.curProvider=1),a=iy,o){n.next=23;break}return n.prev=10,n.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:e.nosSurvivalTime,returnBody:oy(e.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}});case 13:s=n.sent,a=s.content.mixStoreTokenResTag,n.next=23;break;case 17:if(n.prev=17,n.t0=n.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",n.t0),!(n.t0 instanceof kl)){n.next=22;break}throw n.t0;case 22:throw new xl({code:"v2"===tm(this.core,"options.apiVersion")?Cl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:n.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(o){n.next=27;break}return n.abrupt("return",2===this.mixStorage.curProvider?this.aws.s3Upload(e,a):this.nos.nosUpload(e,a));case 27:return n.abrupt("return",this.nos.nosUpload(e,null===(r=null===(t=null==i?void 0:i.uploadInfo)||void 0===t?void 0:t.payload)||void 0===r?void 0:r.mixStoreToken));case 28:case"end":return n.stop()}}),n,this,[[10,17]])})))},t.getThumbUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&tm(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString());if(1===u&&this.mixStorePolicy.nosPolicy&&tm(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString())}return au(e).call(e,"?")?e+"&imageView&thumbnail="+t.width+"x"+t.height:e+"?imageView&thumbnail="+t.width+"x"+t.height},t.getVideoCoverUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&tm(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png");if(1===u&&this.mixStorePolicy.nosPolicy&&tm(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png")}return au(e).call(e,"?")?e+"&vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png":e+"?vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png"},t.getPrivateUrl=function(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var r=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);r[0];var n=r[1];r[2];var i=r[3];r[4];var o=r[5];if(r[6],r[7],null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var a=this._getUrlType(e);return 2===a&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",o)),1===a&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",o)),e}var s=this.config,c=s.downloadUrl,u=s.downloadHostList,d=s.nosCdnEnable,l=this.config.cdn.cdnDomain,p=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",m=decodeURIComponent(o),h=wu(m).call(m,p);if(l&&h>-1&&d)return""+n+l+"/"+Yc(m).call(m,h);if(au(u).call(u,i)&&au(o).call(o,"/")){var f=wu(o).call(o,"/"),g=o.substring(0,f),v=o.substring(f+1);return c.replace("{bucket}",g).replace("{object}",v)}var y=gu(u).call(u,(function(e){return"string"==typeof i&&au(i).call(i,e)}))[0],M=y?i.replace(y,"").replace(/\W/g,""):null;return M?c.replace("{bucket}",M).replace("{object}",o):e},t.getOriginUrl=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&au(e).call(e,"_im_url=1")){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}});case 4:return r=t.sent,t.abrupt("return",r.content.nosSafeUrlTag.originUrl);case 6:case"end":return t.stop()}}),t,this)})))},t.getFileToken=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e),r=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,n=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,r!==String(-1)||n!==String(-1)){t.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(2!==e.type){t.next=17;break}if(!(r&&wu(r).call(r,String(2))>=0||n&&wu(n).call(n,String(2))>0)){t.next=13;break}return t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:t.next=33;break;case 17:if(e.urls&&e.urls.length){t.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(o=[],a=[],jn(i=e.urls).call(i,(function(e){var t=s._getUrlType(e);1===t&&a.push(e),2===t&&o.push(e)})),(!n||0!==o.length&&wu(n).call(n,String(3))<0)&&(this.logger.warn("s3 url don't support url token"),o=[]),(!r||0!==a.length&&wu(r).call(r,String(3))<0)&&(this.logger.warn("nos url don't support url token"),a=[]),0!==o.length||0!==a.length){t.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==o.length&&0!==a.length){t.next=33;break}return e.urls=Ei(e.urls),t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 33:case"end":return t.stop()}}),t,this)})))},t._getUrlType=function(e){var t,r;return this.mixStorePolicy.nosPolicy&&Hm(t=this.mixStorePolicy.nosPolicy.dlcdns).call(t,(function(t){return wu(e).call(e,t)>=0}))?1:this.mixStorePolicy.s3Policy&&Hm(r=this.mixStorePolicy.s3Policy.dlcdns).call(r,(function(t){return wu(e).call(e,t)>=0}))?2:null},t.getNosAccessToken=function(e){return Vl({url:{type:"string",allowEmpty:!1}},e),this.nos.getNosAccessToken(e)},t.deleteNosAccessToken=function(e){return Vl({token:{type:"string",allowEmpty:!1}},e),this.nos.deleteNosAccessToken(e)},t.process=function(e){var t=tm(e,"error.detail.ignore");return e.error&&!t?gs.reject(e.error):gs.resolve(e)},ct(e,[{key:"grayConfig",get:function(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function(){return this.mixStorage.mixStorePolicy}}]),e}(),_y=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageService",t)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},r.uploadingMessageInfo={},r.core=t,r.core._registerDep(Cy,"cloudStorage"),r.core._registerDep(ry,"V2NIMStorageUtil"),r}nr(t,e);var r=t.prototype;return r.addCustomStorageScene=function(e,t){return this.checkV2(),Vl({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:e,expireTime:t},"",!0),this.sceneMap[e]={sceneName:e,expireTime:t},{sceneName:e,expireTime:t}},r.getStorageSceneList=function(){return this.checkV2(),bs(this.sceneMap)},r.getStorageScene=function(e){return e&&this.sceneMap[e]||this.sceneMap.nim_default_im},r.hasStorageScene=function(e){return void 0!==this.sceneMap[e]},r.createUploadFileTask=function(e){var t;if(this.checkV2(),"string"==typeof e.fileObj&&0===wu(t=e.fileObj).call(t,"nim-external")){var r=document.getElementById(e.fileObj);r&&r.files&&r.files[0]&&(e.fileObj=r.files[0])}return{taskId:wp(),uploadParams:e}},r.uploadFile=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",n[0]);case 6:case"end":return r.stop()}}),r,this)})))},r.uploadFileWithMetaInfo=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",(i=n[1],o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,d=void 0,l=void 0,p=void 0,m=void 0,h=void 0,f=void 0,g=void 0,o=i.url,a=i.name,s=i.size,c=i.ext,u=i.md5,d=i.h,l=i.w,p=i.orientation,m=i.dur,h=i.audioCodec,f=i.videoCodec,g=i.container,JSON.parse(Ei({url:o,name:a,size:s,ext:c,md5:u,height:d,width:l,orientation:p,duration:m,audioCodec:h,videoCodec:f,container:g}))));case 6:case"end":return r.stop()}var i,o,a,s,c,u,d,l,p,m,h,f,g}),r,this)})))},r._uploadFile=function(e,t,r){var n;return Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f=this;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){i.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(o=e.uploadParams,a=e.taskId,s=Xv(o.fileObj),c=s.file,u=s.path,d=(r||{}).fileType,!this.uploadingMessageInfo[a]){i.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(i.prev=7,l={},c?l.file=c:u&&(0===(null==u?void 0:wu(u).call(u,"nim-external"))?l.fileInput=u:l.filePath=u),p=this.getStorageScene(o.sceneName),l.nosScenes=p.sceneName,l.nosSurvivalTime=p.expireTime,l.type=1===d?"image":2===d?"audio":3===d?"video":"file",!l.file||!this.core.pluginMap["browser-md5-file"]){i.next=19;break}return i.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],a,l.file);case 17:m=i.sent,l.md5=m;case 19:return l.onUploadProgress=function(e){"function"==typeof t&&t(Math.round(100*e.percentage))},l.onUploadStart=function(e){var t;if(null===(t=f.uploadingMessageInfo[a])||void 0===t?void 0:t.abort)return e.abort(),void delete f.uploadingMessageInfo[a];f.uploadingMessageInfo[a]={abort:!1,task:e}},this.uploadingMessageInfo[a]={abort:!1},i.next=24,this.core.cloudStorage.uploadFile(l);case 24:if(h=i.sent,!(null===(n=this.uploadingMessageInfo[a])||void 0===n?void 0:n.abort)){i.next=27;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[a],i.abrupt("return",[h.url,h]);case 31:throw i.prev=31,i.t0=i.catch(7),delete this.uploadingMessageInfo[a],this.core.logger.error("sendFile:: upload File error or abort.",i.t0),i.t0;case 36:case"end":return i.stop()}}),i,this,[[7,31]])})))},r.cancelUploadFile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this._cancelUploadFile(e.taskId);case 3:case"end":return t.stop()}}),t,this)})))},r._cancelUploadFile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),!(null==(r=this.uploadingMessageInfo[e])?void 0:r.task)){t.next=16;break}return t.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),t.next=7,r.task.abort();case 7:delete this.uploadingMessageInfo[e],t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),delete this.uploadingMessageInfo[e],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",t.t0);case 14:t.next=22;break;case 16:if(!r){t.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),r.abort=!0,t.next=22;break;case 21:throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return t.stop()}}),t,this,[[3,10]])})))},r.getFileMd5=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i=this;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new gs((function(n,o){var a,s=new e;(null===(a=i.uploadingMessageInfo[t])||void 0===a?void 0:a.abort)?o(new kl({code:Cl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):i.uploadingMessageInfo[t]={abort:!1,task:s};try{s.md5(r,(function(e,t){"aborted"===e?o(new kl({code:Cl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:e}})):e?o(new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:e}})):n(t)}))}catch(e){o(new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:e}}))}})));case 1:case"end":return n.stop()}}),n)})))},r.shortUrlToLong=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this.core.cloudStorage.getOriginUrl(e));case 2:case"end":return t.stop()}}),t,this)})))},r.getImageThumbUrl=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getImageThumbUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},r.getVideoCoverUrl=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getVideoCoverUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},t}(af),Ey=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageCreator",t)||this).name="V2NIMMessageCreator",r.defaultNosSceneName="nim_default_im",r.core=t,r}nr(t,e);var r=t.prototype;return r.createMessage=function(e,t){return dr(dr(dr({messageClientId:wp(),messageType:e,createTime:this.core.timeOrigin.getNTPTime(),sendingState:0,messageStatus:{errorCode:200},isSelf:!0},t),t.attachment?{attachment:dr(dr({},t.attachment),{raw:wv(e,t.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:dr({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},t.messageConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),routeConfig:dr({routeEnabled:!0},t.routeConfig),antispamConfig:dr({antispamEnabled:!0},t.antispamConfig)})},r.createTextMessage=function(e){return this.checkV2(),Vl({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(0,{text:e})},r.createImageMessage=function(e,t,r,n,i){this.checkV2(),Vl(iv,{name:t,sceneName:r,width:n,height:i},"",!0);var o=this.createGenericFileMessageAttachment(e,t,r,void 0,n,i,"jpeg");return this.createMessage(1,{attachment:o,attachmentUploadState:0})},r.createAudioMessage=function(e,t,r,n){this.checkV2(),Vl(rv,{name:t,sceneName:r,duration:n},"",!0);var i=this.createGenericFileMessageAttachment(e,t,r,n,void 0,void 0,"aac");return this.createMessage(2,{attachment:i,attachmentUploadState:0})},r.createVideoMessage=function(e,t,r,n,i,o){this.checkV2(),Vl(nv,{name:t,sceneName:r,duration:n,width:i,height:o},"",!0);var a=this.createGenericFileMessageAttachment(e,t,r,n,i,o,"mp4");return this.createMessage(3,{attachment:a,attachmentUploadState:0})},r.createFileMessage=function(e,t,r){this.checkV2(),Vl(tv,{name:t,sceneName:r},"",!0);var n=this.createGenericFileMessageAttachment(e,t,r,void 0,void 0,void 0,"txt");return this.createMessage(6,{attachment:n,attachmentUploadState:0})},r.createGenericFileMessageAttachment=function(e,t,r,n,i,o,a){if(r=r||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMStorageService not exist"}});if(!this.core.V2NIMStorageService.hasStorageScene(r))throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+r+" has not been added"}});var s=Xv(e),c=s.file,u=s.path,d=dr(dr(dr({name:t,uploadState:0,sceneName:r||this.defaultNosSceneName},n?{duration:n}:{}),i?{width:i}:{}),o?{height:o}:{});if(c){var l,p=hp(l=c.name).call(l,"."),m=-1===p?c.name:c.name.substring(0,p);d.name=d.name||m,d.size=c.size,d.ext="."+(Vp(c.name)||Vp(t||"")||a)}else if(u){var h=hp(u).call(u,"/"),f=hp(u).call(u,"."),g=-1===f?u.substring(h+1):u.substring(h+1,f);d.name=d.name||g,d.ext="."+(Vp(u)||Vp(t||"")||a)}return d=JSON.parse(Ei(d)),u?d.path=u:c&&(d.file=c),d},r.createLocationMessage=function(e,t,r){return this.checkV2(),Vl({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:e,longitude:t,address:r},"",!0),this.createMessage(4,{attachment:{latitude:e,longitude:t,address:r}})},r.createCustomMessage=function(e,t){return this.checkV2(),Vl({text:{type:"string"}},{text:e},"",!0),Vl({rawAttachment:{type:"string"}},{rawAttachment:t},"",!0),this.createMessage(100,{text:e,attachment:{raw:t}})},r.createCustomMessageWithAttachment=function(e,t){return this.checkV2(),Vl({raw:{type:"string"}},e,"attachment",!0),Vl({subType:{type:"number",min:0,required:!1}},{subType:t},"",!0),this.createMessage(100,t?{attachment:e,subType:t}:{attachment:e})},r.createCallMessage=function(e,t,r,n,i){return this.checkV2(),Vl({type:{type:"number",allowEmpty:!1}},{type:e},"",!0),Vl({channelId:{type:"string",allowEmpty:!1}},{channelId:t},"",!0),Vl({status:{type:"number",allowEmpty:!1}},{status:r},"",!0),Vl({durations:{type:"array",allowEmpty:!1}},{durations:n},"",!0),this.createMessage(12,{text:i||"",attachment:{type:e,channelId:t,durations:n,status:r}})},r.createForwardMessage=function(e){this.checkV2();var t=[11,5,7,10];if(!e||au(t).call(t,e.messageType))return null;var r={messageClientId:wp(),messageType:e.messageType};return e.text&&(r.text=e.text),e.attachment&&(r.attachment=e.attachment),e.attachment&&"uploadState"in e.attachment&&(r.attachmentUploadState=e.attachment.uploadState),this.createMessage(e.messageType,r)},r.createTipsMessage=function(e){return this.checkV2(),Vl({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(10,{text:e})},t}(af),ky=function(){function e(){this.name="V2NIMMessageAttachmentCreator"}var t=e.prototype;return t.createLocationMessageAttachment=function(e,t,r){return{latitude:"number"==typeof e?e:0,longitude:"number"==typeof t?t:0,address:"string"==typeof r?r:""}},t.createCustomMessageAttachment=function(e){return{raw:"string"==typeof e?e:""}},e}(),wy=function(){function e(e){this.config={enable:!1},this.name="V2NIMClientAntispamUtil",this.core=e}var t=e.prototype;return t.setOptions=function(e){this.config=dr(this.config,e)},t.reset=function(e){"destroy"===e&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.vocabInfo){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 7:t=e.sent,this.vocabInfo=dr(dr({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",e.t0);case 14:case"end":return e.stop()}}),e,this,[[4,11]])})))},t.checkTextAntispam=function(e,t){if(void 0===t&&(t="**"),!this.config.enable)return{operateType:0,replacedText:e};if(Vl({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:e,replace:t},"",!0),!this.vocabInfo)return{operateType:0,replacedText:e};for(var r=e,n=0;n<this.vocabInfo.thesaurus.length;n++){var i=this.filterContent(r,this.vocabInfo.thesaurus[n],t);if(r=i.replacedText,2===i.operateType||3===i.operateType)return i}return{operateType:r===e?0:1,replacedText:r}},t.filterContent=function(e,t,r){for(var n=0;n<bg(t).length;n++){var i=bg(t)[n],o=i.match||t.match,a=i.operate||t.operate,s=void 0;try{s=this.matchContent(e,i.key,o,a,r)}catch(e){}if(s&&(e=s.replacedText,2===s.operateType||3===s.operateType))return s}return{operateType:1,replacedText:e}},t.matchContent=function(e,t,r,n,i){var o=!1,a=null;if(1===r){if(wu(e).call(e,t)>=0){o=!0;var s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");a=new RegExp(s,"g")}}else 2===r&&(a=new RegExp(t,"g")).test(e)&&(o=!0);if(o&&a)switch(n){case 1:return{operateType:1,replacedText:e.replace(a,i)};case 2:return{operateType:2,replacedText:e};case 3:return{operateType:3,replacedText:e}}return{operateType:0,replacedText:e}},e}(),Ry=function(e){function t(t){var r;return(r=e.call(this,"YSFService",t)||this).core._registerDep(Mg,"V2NIMConversationIdUtil"),r.core._registerDep(Ey,"V2NIMMessageCreator"),r.core._registerDep(ky,"V2NIMMessageAttachmentCreator"),r.core._registerDep(wy,"V2NIMClientAntispamUtil"),r.core._registerDep(_y,"V2NIMStorageService"),r.sendUtil=new Ay(r.core,ut(r)),r.fileUtil=new Av(r.core),r.model=new Cg,r.notificationUtil=new Jv(r.core),Sh({cmdMap:Qv,cmdConfig:$v}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o=this.name+"::emit "+t.toString(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];if("onSendMessage"===t){var u=s[0];this.logger.log(""+o,u.messageClientId+"/"+u.messageServerId+";createTime:"+u.createTime+";","sendingState:"+u.sendingState+";attachmentUploadState:"+(u.attachmentUploadState||0)+";messageStatus:"+(null===(i=u.messageStatus)||void 0===i?void 0:i.errorCode))}else if("onReceiveMessages"===t){var d=s[0];this.logger.log(""+o,lu(d).call(d,(function(e){return e.messageClientId+"/"+e.messageServerId+";createTime:"+e.createTime})))}else if("onReceiveCustomNotifications"===t){var l=s[0];this.logger.log(""+o,lu(l).call(l,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else{var p,m;(p=this.logger).log.apply(p,Os(m=[""+o]).call(m,s))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,s))},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u,d;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Vl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||wp(),Vl(Pg,{conversationId:t,message:e,params:r},"",!0),Dl(this.core.account,t),o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t,r),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=8,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 8:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 11:case"end":return i.stop()}}),i,this)})))},r.sendCustomNotification=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Dl(this.core.account,e),Vl(zv,{content:t,params:r},"",!0),(i=this.notificationUtil.generateNotificationTag(e,t,r)).type=100,n.next=7,this.core.sendCmd("ysfSendCustomNotification",{tag:i});case 7:case"end":return n.stop()}}),n,this)})))},r.sendMessageFn=function(e){},r.cancelMessageAttachmentUpload=function(e){return this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t;if(e&&e.length>0){var r=gu(t=lu(e).call(e,(function(e){return e.messageServerId}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:2,ids:r})}},r.markNotificationAck=function(e){var t;if(e&&e.length>0){var r=gu(t=lu(e).call(e,(function(e){return e.idServer}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:3,ids:r})}},r.ysfOnMsgHandler=function(e){var t=e.content.data,r=kv(Tv(this.core,t),this.core);delete r.__clientExt,this.emit("onReceiveMessages",[r]),this.model.upsertMessages([r]),this.markMsgsAck([r])},r.ysfSyncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas;r=lu(r).call(r,(function(e){return kv(Tv(t.core,e),t.core)})),this.markMsgsAck(r),this.emit("onReceiveMessages",r),this.model.upsertMessages(r)},r.ysfOnSysNotificationHandler=function(e){this.markNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.processSystemNotification=function(e){var t=dr(dr({},e),{conversationType:1});return delete t.type,t},r.ysfSyncSysNotificationHandler=function(e){var t,r,n,i=this;this.markNotificationAck(e.content.datas);var o=gu(t=lu(r=Dm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},t}(af),Ay=function(){function e(e,t){this.uploadingMessageInfo={},this.core=e,this.service=t}var t=e.prototype;return t.prepareMessage=function(e,t,r,n){var i=this.checkIfResend(e),o=this.generateSendMessage({message:e,params:r,resend:i,conversationId:t,replyMessage:n}),a=dr({},r.targetConfig?{targetConfig:r.targetConfig}:{}),s=this.checkIfAntispam(r,o),c=s.clientAntispamResult,u=s.text;return o.text=u,o.clientAntispamHit=!!c&&3===c.operateType,{messageBeforeSend:o,clientAntispamResult:c,hiddenParams:a}},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw this.service.emit("onSendMessage",dr(dr({},t),{sendingState:2,messageStatus:{errorCode:Cl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new kl({code:Cl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.doMsgReceiveReport=function(e,t){if(e.senderId!==this.core.account){var r=tm(e,"__clientExt.statistics.apiCallingTime")||0,n=tm(e,"__clientExt.statistics.sendTime")||0,i=tm(e,"__clientExt.statistics.attachUploadDuration")||0,o=this.core.timeOrigin.getNTPTime(),a=e.createTime,s=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):o;this.core.reporter.report("msgReceive",{msgId:e.messageServerId,clientId:e.messageClientId,serverTime:e.createTime,receiveTime:s,fromAccid:1===e.conversationType?e.senderId:"",toAccid:e.receiverId,type:Bv(e.conversationType),tid:1===e.conversationType?"":e.receiverId,apiCallingTime:r,sendTime:n,attachUploadDuration:i,callbackTime:o,preHandleTime:o,result:200,failReason:"",rt:o-a})}},t.checkIfResend=function(e){var t=this.service.model.getMessageById(e.messageClientId),r=!1;if(e.messageServerId||1===e.sendingState)throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if(1===(null==t?void 0:t.sendingState))throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return t&&(r=!0),r},t.doSendMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.apiCallingTimeNode,n=e.messageBeforeSend,i=e.clientAntispamResult,o=e.hiddenParams,a=e.progress,s={},!(c=this.service instanceof Ry)){t.next=7;break}u="ysfSendMessage",t.next=20;break;case 7:if(1!==n.conversationType){t.next=11;break}u="v2SendP2pMessage",t.next=20;break;case 11:if(2!==n.conversationType){t.next=15;break}u="v2SendTeamMessage",t.next=20;break;case 15:if(3!==n.conversationType){t.next=19;break}u="v2SendSuperTeamMessage",t.next=20;break;case 19:throw new Rl({detail:{reason:"conversationType: "+n.conversationType+" is not supported"}});case 20:if(this.service.sendMessageFn(n),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",n),!n.attachment||!("uploadState"in n.attachment)||n.attachment.url||0!==n.attachment.uploadState&&2!==n.attachment.uploadState){t.next=48;break}return d=Es(),t.prev=24,n.attachmentUploadState=3,n.attachment.uploadState=3,this.service.emit("onSendMessage",n),t.next=30,this.service.fileUtil.doSendFile(n,a);case 30:n.attachmentUploadState=1,n.attachment.uploadState=1,this.service.emit("onSendMessage",n),t.next=45;break;case 35:throw t.prev=35,t.t0=t.catch(24),n.attachmentUploadState=2,n.attachment.uploadState=2,n.sendingState=2,n.messageStatus={errorCode:t.t0.code||Cl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),s.attachUploadDuration=Es()-d,this.doSendMessageFailed(r,s,n,t.t0),t.t0;case 45:s.attachUploadDuration=Es()-d,t.next=49;break;case 48:this.service.emit("onSendMessage",n);case 49:return this.core.timeOrigin.checkNodeReliable(r)&&(s.apiCallingTime=this.core.timeOrigin.getNTPTime(r),s.sendTime=this.core.timeOrigin.getNTPTime(),n.__clientExt={statistics:s}),t.prev=50,t.next=53,this.core.sendCmd(u,{tag:dr({},n,o)});case 53:l=t.sent,t.next=63;break;case 56:throw t.prev=56,t.t1=t.catch(50),this.doSendMessageFailed(r,s,n,t.t1),n.sendingState=2,n.messageStatus={errorCode:t.t1.code||Cl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),t.t1;case 63:return p=tm(l,"content.data.errorCode"),m=dr(dr(dr({},n),l.content.data),{sendingState:1,messageStatus:{errorCode:p&&200!==p?p:200}}),this.service.sendMessageFn(m),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",m),this.doMsgSendReport(r,s,n),(h=m.antispamResult)&&(m.messageStatus.errorCode=Cl.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete m.antispamResult,this.service.emit("onSendMessage",m),t.abrupt("return",dr(dr({message:m},h?{antispamResult:h}:{}),i?{clientAntispamResult:i}:{}));case 73:case"end":return t.stop()}}),t,this,[[24,35],[50,56]])})))},t.doSendMessageFailed=function(e,t,r,n){var i=dr(dr({},r),{sendingState:2});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",i),this.service.sendMessageFn(i),this.doMsgSendReport(e,t,r,n)},t.doMsgSendReport=function(e,t,r,n){t.apiCallingTime=this.core.timeOrigin.getNTPTime(e),t.sendTime=this.core.timeOrigin.getNTPTime();var i=this.core.timeOrigin.getNTPTime(),o=tm(n,"detail.reason");this.core.reporter.report("msgSend",{msgId:r.messageServerId,clientId:r.messageClientId,msgTime:r.createTime,fromAccid:1===r.conversationType?r.senderId:"",toAccid:r.receiverId,type:Bv(r.conversationType),tid:1===r.conversationType?"":r.receiverId,result:n?n.code:200,failReason:o||(null==n?void 0:n.message)||"",rt:i-t.apiCallingTime,apiCallingTime:t.apiCallingTime,sendTime:t.sendTime,attachUploadDuration:t.attachUploadDuration,apiCallbackTime:i})},t.generateSendMessage=function(e){var t,r,n=e.conversationId,i=e.replyMessage,o=e.resend,a=e.message,s=e.params,c={};if(i){var u=i.threadRoot;c={threadReply:{senderId:i.senderId,receiverId:i.receiverId,messageServerId:i.messageServerId,createTime:i.createTime,messageClientId:i.messageClientId,conversationType:i.conversationType,conversationId:i.conversationId},threadRoot:{senderId:u?u.senderId:i.senderId,receiverId:u?u.receiverId:i.receiverId,messageServerId:u?u.messageServerId:i.messageServerId,createTime:u?u.createTime:i.createTime,messageClientId:u?u.messageClientId:i.messageClientId,conversationType:u?u.conversationType:i.conversationType,conversationId:u?u.conversationId:i.conversationId}}}var d=this.core.V2NIMConversationIdUtil.parseConversationType(n),l=this.core.V2NIMConversationIdUtil.parseConversationTargetId(n);s.pushConfig&&!0!==s.pushConfig.forcePush&&(delete s.pushConfig.forcePushContent,delete s.pushConfig.forcePushAccountIds);var p={},m={};if(s.aiConfig){var h=tm(s,"aiConfig.content.msg"),f=tm(s,"aiConfig.content.type")||0;h?m={msg:h,type:f}:void 0===h&&0===a.messageType&&(m={msg:a.text||"",type:f}),(p=dr({},s.aiConfig)).aiStatus=1,void 0!==m.msg&&(p.content=m)}var g=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(this.core.account),v=(null==g?void 0:g.updateTime)||0;return dr(dr(dr(dr(dr(dr(dr(dr({},a),c),{messageConfig:dr(dr({},a.messageConfig),s.messageConfig),routeConfig:dr(dr({},a.routeConfig),s.routeConfig),pushConfig:dr(dr({},a.pushConfig),s.pushConfig),antispamConfig:dr(dr({},a.antispamConfig),s.antispamConfig),robotConfig:dr(dr({},a.robotConfig),s.robotConfig)}),p&&p.accountId?{aiConfig:p}:{}),a.attachment?{attachment:dr({},a.attachment)}:{}),{resend:o,senderId:this.core.account,conversationType:d,receiverId:l,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:d,senderId:this.core.account,receiverId:l})}),v?{userUpdateTime:v}:{}),{sendingState:3})},e}(),xy=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.checkIfModify=function(e,t){var r,n;if("0"===e.messageServerId)throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(!au(r=[0,1,2,3,4,6,10,12,100]).call(r,e.messageType))throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" not correct"}});if(au(n=[0,1,2,3,6,10,12]).call(n,e.messageType)&&t.attachment)throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" can not modify attachment"}});var i=["subType","text","serverExtension","attachment"];if(!Hm(i).call(i,(function(e){return void 0!==tm(t,e)})))throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(Ou(i).call(i,(function(r){return"attachment"===r?e.attachment&&t.attachment?wv(e.messageType,e.attachment)===wv(e.messageType,t.attachment):!t.attachment:tm(e,r)===tm(t,r)})))throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})},t.prepareMessage=function(e,t){var r=this.generateSendMessage(e,t),n=this.checkIfAntispam(t,r),i=n.clientAntispamResult,o=n.text;return r.text=o,r.clientAntispamHit=!!i&&3===i.operateType,{messageBeforeSend:r,clientAntispamResult:i}},t.modifyMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(1!==e.conversationType){r.next=4;break}n="v2MessageP2pModify",r.next=13;break;case 4:if(2!==e.conversationType){r.next=8;break}n="v2MessageTeamModify",r.next=13;break;case 8:if(3!==e.conversationType){r.next=12;break}n="v2MessageSuperTeamModify",r.next=13;break;case 12:throw new Rl({detail:{reason:"conversationType: "+e.conversationType+" is not supported"}});case 13:return r.next=15,this.core.sendCmd(n,{tag:e});case 15:if(i=r.sent,!t||3!==t.operateType){r.next=18;break}return r.abrupt("return",{errorCode:Cl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:t});case 18:if(o=dr(dr({},e),i.content.data),!(a=o.antispamResult)){r.next=22;break}return r.abrupt("return",dr({errorCode:Cl.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:a},t?{clientAntispamResult:t}:{}));case 22:return delete o.antispamResult,s=Tv(this.core,o),this.service.model.upsertMessages([s]),this.core.eventBus.emit("V2NIMMessageService/modifyMsg",s),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",s),r.abrupt("return",dr(dr({errorCode:200,message:s},a?{antispamResult:a}:{}),t?{clientAntispamResult:t}:{}));case 28:case"end":return r.stop()}}),r,this)})))},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw new kl({code:Cl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.generateSendMessage=function(e,t){var r;return dr(dr({messageConfig:{lastMessageUpdateEnabled:null===(r=e.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled},routeConfig:dr({routeEnabled:!0},t.routeConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),antispamConfig:dr({antispamEnabled:!0},t.antispamConfig)},t.attachment?{attachment:t.attachment}:{}),{conversationType:e.conversationType,senderId:e.senderId,receiverId:e.receiverId,createTime:e.createTime,messageClientId:e.messageClientId,messageServerId:e.messageServerId,messageType:e.messageType,subType:t.subType,text:t.text,serverExtension:t.serverExtension})},e}(),Ny=function(){function e(e,t){var r=this;this.emitRevokeMessage=function(e){var t=lu(e).call(e,(function(e){return Cv(r.core,e)}));jn(t).call(t,(function(e){r.service.model.deleteMessage(e.messageRefer.messageClientId)})),r.service.emit("onMessageRevokeNotifications",t),r.core.eventBus.emit("V2NIMMessageService/revokeMessages",t)},this.core=e,this.service=t,this.logger=e.logger}var t=e.prototype;return t.revokeMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl(Lg,{message:e,params:t},"",!0),Dl(this.core.account,e.conversationId),1!==e.conversationType||e.senderId===this.core.account){r.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 6:if(e.messageServerId&&"0"!==e.messageServerId){r.next=8;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+e.messageServerId}});case 8:return o=3===e.conversationType?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(n={})[1]=7,n[2]=8,n[3]=12,a=n,s=dr(dr(dr({},e),t),{attach:t&&t.serverExtension,sysMsgType:a[e.conversationType],opeAccount:this.core.account}),r.next=13,this.core.sendCmd(o,{tag:s});case 13:(i={})[1]=1,i[2]=2,i[3]=3,c=i,u=[JSON.parse(Ei({postscript:t&&t.postscript,revokeType:c[e.conversationType],revokeAccountId:this.core.account,serverExtension:t&&t.serverExtension,messageRefer:bv(this.core,e)}))],this.revokeMessagesFn(u),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",s);case 17:case"end":return r.stop()}}),r,this)})))},t.deleteMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl(qg,e,"",!0),3!==e.sendingState){r.next=5;break}this.service.fileUtil.cancelMessageAttachmentUpload(e),r.next=7;break;case 5:if(!e.sendingState||1===e.sendingState){r.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 7:if(n={messageRefer:bv(this.core,e),serverExtension:t},i=Es(),!e.messageServerId||"0"===e.messageServerId){r.next=14;break}return r.next=12,this.core.sendCmd("v2DeleteMessage",{tag:n});case 12:o=r.sent,i=o.content.timetag;case 14:a=[{serverExtension:t,messageRefer:bv(this.core,e),deleteTime:i}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[dr(dr({},n),{deleteTime:i})]),this.deleteMessagesFn(a);case 17:case"end":return r.stop()}}),r,this)})))},t.deleteMessages=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl(Bg,{messages:e},"",!0),i=[],o=[],0!==e.length){r.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 7:a=e[0].conversationId,s=0;case 9:if(!(s<e.length)){r.next=22;break}if(3!==e[s].sendingState){r.next=14;break}this.service.fileUtil.cancelMessageAttachmentUpload(e[s]),r.next=16;break;case 14:if(!e[s].sendingState||1===e[s].sendingState){r.next=16;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+s}});case 16:if(!(s>=1&&e[s].conversationId!==a)){r.next=18;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 18:e[s].messageServerId&&"0"!==e[s].messageServerId?i.push(e[s]):o.push(e[s]);case 19:s++,r.next=9;break;case 22:if(c=Es(),u=Os(n=[]).call(n,o),r.prev=24,!(i.length>0)){r.next=31;break}return r.next=28,this.core.sendCmd("v2DeleteMessages",{tag:lu(i).call(i,(function(e){return{messageRefer:e,serverExtension:t}}))});case 28:l=r.sent,c=l.content.timetag,u=Os(d=[]).call(d,u,i);case 31:r.next=40;break;case 33:if(r.prev=33,r.t0=r.catch(24),0!==o.length){r.next=39;break}throw r.t0;case 39:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 40:p=lu(u).call(u,(function(e){return{serverExtension:t,messageRefer:bv(m.core,e),deleteTime:c}})),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",lu(u).call(u,(function(e){return{messageRefer:e,serverExtension:t,deleteTime:c}}))),this.deleteMessagesFn(p);case 43:case"end":return r.stop()}}),r,this,[[24,33]])})))},t.revokeMessagesFn=function(e){var t=this;jn(e).call(e,(function(e){t.service.model.deleteMessage(e.messageRefer.messageClientId)})),this.service.emit("onMessageRevokeNotifications",e),this.core.eventBus.emit("V2NIMMessageService/revokeMessages",e)},t.deleteMessagesFn=function(e){var t=this;jn(e).call(e,(function(e){t.service.model.deleteMessage(e.messageRefer.messageClientId)})),this.service.emit("onMessageDeletedNotifications",e),this.core.eventBus.emit("V2NIMMessageService/deleteMessages",e)},e}(),Oy=function(){function e(e,t){this.core=e,this.service=t,this.model=t.model,this.receiptUtil=t.receiptUtil,this.logger=this.core.logger}var t=e.prototype;return t.onMsgHandler=function(e){var t=e.content.msg,r=t._conversationOnlineSyncNotify,n=t._conversationOnlineSyncData,i=Jl(t,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),o=Tv(this.core,i),a=kv(o,this.core);this.logger.log("v2OnMsgHandler::recvMsg "+a.messageClientId+" "+a.messageServerId),5!==a.messageType&&this.core.V2NIMUserService.checkUserUpdate&&this.core.V2NIMUserService.checkUserUpdate(a,a.userUpdateTime),!this.service.config.compatibleWithV1&&this.service.sendUtil.doMsgReceiveReport(a,e),delete a.__clientExt,this.service.emit("onReceiveMessages",[a]),this.model.upsertMessages([a]),!this.service.config.compatibleWithV1&&this.service.markMsgsAck([a]),r&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(r),data:JSON.parse(n)}},a),5===a.messageType&&this.core.eventBus.emit("V2NIMTeamService/notification",o),this.core.eventBus.emit("V2NIMMessageService/onMsg",a)},t.syncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas,n=lu(r).call(r,(function(e){return kv(Tv(t.core,e),t.core)}));!this.service.config.compatibleWithV1&&this.service.markMsgsAck(n),this.service.emit("onReceiveMessages",n),this.model.upsertMessages(n),this.core.eventBus.emit("V2NIMMessageService/offlineMsgs",n)},t.syncRoamingMsgsHandler=function(e){var t=this,r=e.content.datas;r=lu(r).call(r,(function(e){return kv(Tv(t.core,e),t.core)})),this.service.emit("onReceiveMessages",r),this.model.upsertMessages(r),this.core.eventBus.emit("V2NIMMessageService/roamingMsgs",r)},t.onP2PMessageReceiptsHandler=function(e){this.receiptUtil.onP2PMessageReceiptsHandler(e)},t.onTeamMessageReceiptsHandler=function(e){this.receiptUtil.onTeamMessageReceiptsHandler(e)},t.syncP2PMessagReceiptsHandler=function(e){this.receiptUtil.syncP2PMessagReceiptsHandler(e)},t.syncRevokeMessageHandler=function(e){this.service.deleteUtil.emitRevokeMessage(e.content.datas)},t.onRevokeMessageHandler=function(e){this.service.deleteUtil.emitRevokeMessage([e.content.data])},t.onDeleteMessageHandler=function(e){var t=e.content.data,r={serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:Sv(this.core,t.messageRefer)};this.service.deleteUtil.deleteMessagesFn([r])},t.onDeleteMessagesHandler=function(e){var t,r=this,n=lu(t=e.content.data).call(t,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Sv(r.core,e.messageRefer)}}));this.service.deleteUtil.deleteMessagesFn(n)},t.syncOnDeleteMessagesHandler=function(e){var t=this,r=e.content.datas,n=lu(r).call(r,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Sv(t.core,e.messageRefer)}}));this.service.emit("onMessageDeletedNotifications",n)},t.v2MessageOnModifiedHandler=function(e){var t=Tv(this.core,e.content.data);this.model.upsertMessages([t]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",t),this.service.emit("onReceiveMessagesModified",[t])},t.v2MessageSyncModifiedHandler=function(e){var t,r,n=this,i=gu(t=lu(r=e.content.datas).call(r,(function(e){return Tv(n.core,e)}))).call(t,(function(e){var t,r=(null===(t=n.model.getMessageById(e.messageClientId))||void 0===t?void 0:t.modifyTime)||0;return(e.modifyTime||0)>r}));i.length>0&&(this.model.upsertMessages(i),jn(i).call(i,(function(e){return n.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",e)})),this.service.emit("onReceiveMessagesModified",i))},t.v2MessageSyncSuperTeamModifiedHandler=function(e){this.v2MessageSyncModifiedHandler(e)},e}(),Py=function(){function e(e,t){this.core=e,this.service=t,this.logger=this.core.logger}var t=e.prototype;return t.setListener=function(){var e,t,r,n=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",tr(e=this.service.sendMessageFn).call(e,this.service)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",tr(t=this.service.deleteUtil.emitRevokeMessage).call(t,this.service.deleteUtil)),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",tr(r=this.service.deleteUtil.deleteMessagesFn).call(r,this.service.deleteUtil)),this.core.eventBus.on("V2NIMConversationService/deleteConversation",(function(e){jn(e).call(e,(function(e){return n.service.model.deleteMessages(e)}))}))},t.beforeEmit=function(e){for(var t,r,n,i=this.service.name+"::emit "+e.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onSendMessage"===e){var c=a[0];this.logger.log(""+i,c.messageClientId+"/"+c.messageServerId+"/"+c.createTime+";","sendingState:"+c.sendingState+";attachmentUploadState:"+(c.attachmentUploadState||0)+";messageStatus:"+(null===(t=c.messageStatus)||void 0===t?void 0:t.errorCode)+";config.lastMsg:"+(null===(r=c.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)+";config.unread:"+(null===(n=c.messageConfig)||void 0===n?void 0:n.unreadEnabled))}else if("onReceiveMessages"===e||"onReceiveMessagesModified"===e){var u=a[0];this.logger.log(""+i,lu(u).call(u,(function(e){var t,r;return e.messageClientId+"/"+e.messageServerId+"/"+e.createTime+";config.lastMsg:"+(null===(t=e.messageConfig)||void 0===t?void 0:t.lastMessageUpdateEnabled)+";config.unread:"+(null===(r=e.messageConfig)||void 0===r?void 0:r.unreadEnabled)})))}else if("onMessageRevokeNotifications"===e){var d=a[0];this.logger.log(""+i,lu(d).call(d,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId+";revokeAccountId:"+e.revokeAccountId})))}else if("onMessageDeletedNotifications"===e){var l=a[0];this.logger.log(""+i,lu(l).call(l,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId+";deleteTime:"+e.deleteTime})))}else{var p,m;(p=this.logger).log.apply(p,Os(m=[""+i]).call(m,a))}},e}(),Ly=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMMessageService",t)||this).customAttachmentParsers=[],n.config={compatibleWithV1:!0},n.core._registerDep(Mg,"V2NIMConversationIdUtil"),n.core._registerDep(Ey,"V2NIMMessageCreator"),n.core._registerDep(ky,"V2NIMMessageAttachmentCreator"),n.core._registerDep(wy,"V2NIMClientAntispamUtil"),n.receiptUtil=new cv(n.core,ut(n)),n.fileUtil=new Av(n.core),n.sendUtil=new Ay(n.core,ut(n)),n.modifyUtil=new xy(n.core,ut(n)),n.deleteUtil=new Ny(n.core,ut(n)),n.model=new Cg,n.event=new Py(n.core,ut(n)),n.handler=new Oy(n.core,ut(n)),"v2"!==n.core.options.apiVersion?ut(n):(Sh({cmdMap:Nv,cmdConfig:qv}),n.setOptions(r),n.setListener(),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.msg)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.setListener=function(){this.event.setListener()},r.reset=function(){this.model.reset(),this.receiptUtil.reset()},r.emit=function(t){for(var r,n,i,o,a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return(r=this.event).beforeEmit.apply(r,Os(n=[t]).call(n,s)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,s))},r.checkExtendUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageExtendUtil)||void 0===e?void 0:e.name))throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageLogUtil is not registered"}})},r.checkLogUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageLogUtil)||void 0===e?void 0:e.name))throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageExtendUtil is not registered"}})},r.getMessageList=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageList(e)},r.getMessageListByRefers=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(e)},r.clearHistoryMessage=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(e)},r.pinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.pinMessage(e,t)},r.unpinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.unpinMessage(e,t)},r.updatePinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updatePinMessage(e,t)},r.voiceToText=function(e){return this.checkV2(),this.checkExtendUtil(),"string"==typeof e.duration&&(e.duration=Number(e.duration)),this.core.V2NIMMessageExtendUtil.voiceToText(e)},r.getPinnedMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(e)},r.addQuickComment=function(e,t,r,n){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addQuickComment(e,t,r,n)},r.removeQuickComment=function(e,t,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeQuickComment(e,t,r)},r.getQuickCommentList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(e)},r.addCollection=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addCollection(e)},r.removeCollections=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeCollections(e)},r.updateCollectionExtension=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(e,t)},r.getCollectionListByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(e)},r.getCollectionListExByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListExByOption(e)},r.searchCloudMessages=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(e)},r.getThreadMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(e)},r.registerCustomAttachmentParser=function(e){var t;"function"==typeof e&&-1===wu(t=this.customAttachmentParsers).call(t,e)&&this.customAttachmentParsers.unshift(e)},r.unregisterCustomAttachmentParser=function(e){var t,r,n=wu(t=this.customAttachmentParsers).call(t,e);n>-1&&li(r=this.customAttachmentParsers).call(r,n,1)},r.sendP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(e)},r.isPeerRead=function(e){return this.checkV2(),this.receiptUtil.isPeerRead(e)},r.getP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(e)},r.getTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(e)},r.getTeamMessageReceiptDetail=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(e)},r.sendTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(e)},r.revokeMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),r.abrupt("return",this.deleteUtil.revokeMessage(e,t));case 2:case"end":return r.stop()}}),r,this)})))},r.deleteMessage=function(e,t){return this.checkV2(),this.deleteUtil.deleteMessage(e,t)},r.deleteMessages=function(e,t){return this.checkV2(),this.deleteUtil.deleteMessages(e,t)},r.cancelMessageAttachmentUpload=function(e){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t=this;if(e&&e.length>0){var r=[],n=[];jn(e).call(e,(function(e){e.senderId===t.core.account&&e.senderId!==e.receiverId||(1===e.conversationType?r.push(e):2===e.conversationType&&n.push(e))})),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:lu(r).call(r,(function(e){return e.messageServerId}))}),n.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:lu(n).call(n,(function(e){return e.messageServerId}))})}},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u,d,l,p,m=this;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Vl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||wp(),!e.conversationId||e.conversationId===t){i.next=5;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:if(Vl(Pg,{conversationId:t,message:e,params:r},"",!0),Dl(this.core.account,t),2!==(o=this.core.V2NIMConversationIdUtil.parseConversationType(t))&&3!==o||!r.robotConfig||r.robotConfig.accountId){i.next=10;break}throw new Rl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 10:if(2!==o&&3!==o||!r.targetConfig){i.next=20;break}if(a=r.targetConfig.receiverIds,3!==o||!1!==r.targetConfig.inclusive){i.next=14;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});case 14:if(a=gu(a).call(a,(function(e){return e&&e!==m.core.account})),0!==a.length){i.next=17;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});case 17:r.targetConfig.receiverIds=a,i.next=21;break;case 20:r.targetConfig=void 0;case 21:return s=this.core.timeOrigin.getTimeNode(),c=this.sendUtil.prepareMessage(e,t,r),u=c.messageBeforeSend,d=c.clientAntispamResult,l=c.hiddenParams,this.logger.log("V2SendMessage start:"+u.messageClientId+"/"+u.createTime+";conversation:"+t+";","NTPTime:"+this.core.timeOrigin.getNTPTime(s)),i.prev=24,i.next=27,this.sendUtil.doSendMessage({apiCallingTimeNode:s,messageBeforeSend:u,clientAntispamResult:d,hiddenParams:l,progress:n});case 27:p=i.sent,i.next=34;break;case 30:throw i.prev=30,i.t0=i.catch(24),this.logger.warn("V2SendMessage end:"+u.messageClientId+".",i.t0 instanceof kl?"failed:"+i.t0.code:"failed"),i.t0;case 34:return p.message.senderId===p.message.receiverId&&this.markMsgsAck([p.message]),this.logger.log("V2SendMessage end:"+p.message.messageClientId+"/"+p.message.messageServerId+"/"+p.message.createTime),i.abrupt("return",p);case 37:case"end":return i.stop()}}),i,this,[[24,30]])})))},r.replyMessage=function(e,t,r,n){return void 0===r&&(r={}),Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u,d;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Vl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||wp(),Vl(Og,{message:e,replyMessage:t,params:r},"",!0),Dl(this.core.account,t.conversationId),2!==e.conversationType&&3!==e.conversationType||!r.robotConfig||r.robotConfig.accountId){i.next=7;break}throw new Rl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 7:return o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t.conversationId,r,t),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=11,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 11:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 14:case"end":return i.stop()}}),i,this)})))},r.modifyMessage=function(e,t){this.checkV2(),this.checkLogin(),Vl(av,e,"message",!0),Vl(sv,t,"params",!0),this.modifyUtil.checkIfModify(e,t);var r=this.modifyUtil.prepareMessage(e,t),n=r.messageBeforeSend,i=r.clientAntispamResult;return this.modifyUtil.modifyMessage(n,i)},r.sendMessageFn=function(e){if(e.msgAckSnapshot){var t=e.msgAckSnapshot,r={conversationId:e.conversationId,messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:0,unreadCount:Number(t)};delete e.msgAckSnapshot,this.emit("onReceiveTeamMessageReadReceipts",[r])}e=kv(e,this.core),this.model.upsertMessages([e]),this.core.eventBus.emit("V2NIMMessageService/sendMessage",e,e.sendingState)},t}(af),Vy={super_team:3,p2p:1,team:2},Uy=((Iy={})[3]="super_team",Iy[1]="p2p",Iy[0]="p2p",Iy[2]="team",Iy);function Dy(e,t){void 0===t&&(t="|");var r=wu(e).call(e,t);if(-1===r)return{target:"",type:0};var n=Yc(e).call(e,0,r);return{target:Yc(e).call(e,r+1),type:Vy[n]||0}}function qy(e,t){return Uy[e]+"|"+t}var By=function(){function e(){this.map=new sd,this.capacity=1e4,this.readTimeMap=new sd,this.stickTopMap=new sd}var t=e.prototype;return t.reset=function(){lu(this).clear(),this.readTimeMap.clear(),this.stickTopMap.clear()},t.count=function(){return lu(this).size},t.sort=function(){var e,t=this,r=Gl(Tu(e=lu(this)).call(e));Dm(r).call(r,(function(e,t){return t.sortOrder-e.sortOrder})),lu(this).clear(),jn(r).call(r,(function(e){lu(t).set(e.conversationId,e)}))},t.processConversation=function(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e},t.getById=function(e){return lu(this).get(e)},t.getAll=function(){var e,t=Gl(Tu(e=lu(this)).call(e));return Dm(t).call(t,(function(e,t){return t.sortOrder-e.sortOrder}))},t.getByOption=function(e,t,r){var n,i=r.conversationTypes,o=r.onlyUnread,a=[];jn(n=lu(this)).call(n,(function(e){i&&i.length>0&&!au(i).call(i,e.type)||o&&!e.unreadCount||r.ignoreMuted&&e.mute||a.push(e)})),a=Dm(a).call(a,(function(e,t){return t.sortOrder-e.sortOrder}));var s=0;e>0&&(s=Up(a,"sortOrder",e),a[s]&&a[s].sortOrder===e&&(s+=1));var c=Yc(a).call(a,s).length;return(a=Yc(a).call(a,s,s+t)).length>0?{offset:c>t?a[a.length-1].sortOrder:0,finished:!(c>t),conversationList:a}:{offset:0,finished:!0,conversationList:a}},t.upsert=function(e){var t=e.conversationId,r=lu(this).get(t);if(!r){var n=this.processConversation(dr({stickTop:this.getStickTop(t),localExtension:"",lastMessage:null,unreadCount:0,sortOrder:0,createTime:0,updateTime:0},e));return this.setLRU(t,n),n.unreadCount>0}var i=e.unreadCount!==r.unreadCount,o=dr({},r,e);return o=this.processConversation(o),this.setLRU(t,o),i},t.setLRU=function(e,t){if(lu(this).has(e))lu(this).delete(e);else if(lu(this).size>=this.capacity){var r,n=bg(r=lu(this)).call(r).next().value;n&&lu(this).delete(n)}lu(this).set(e,t)},t.bulkUpsert=function(e){var t=this,r=!1;return jn(e).call(e,(function(e){t.upsert(e)&&(r=!0)})),r},t.deleteById=function(e){var t=this.getById(e);if(t)return lu(this).delete(e),t},t.updateReadTime=function(e,t){this.readTimeMap.set(e,t)},t.getReadTime=function(e){return this.readTimeMap.get(e)||0},t.updateStickTop=function(e,t){t?this.stickTopMap.set(e,!0):this.stickTopMap.delete(e)},t.getStickTop=function(e){return this.stickTopMap.get(e)||!1},e}(),Fy={"4_14":"v2LocalConvSyncReadTime","4_20":"v2LocalConvSyncSuperTeamReadTime","4_22":"v2LocalConvSyncMoreRoaming","4_23":"v2LocalConvSyncStickTop","4_25":"v2LocalConvSyncReliableInfo","7_16":"v2LocalConvMarkReadTime","7_25":"v2LocalConvMultiMarkReadTime","7_116":"v2LocalConvMultiSyncReadTime","21_25":"v2LocalConvSuperTeamMarkReadTime","21_32":"v2LocalConvSuperTeamMultiMarkReadTime","21_125":"v2LocalConvSuperTeamMultiSyncReadTime","33_12":"v2LocalConvStickTopAdd","33_13":"v2LocalConvStickTopDelete","23_112":"v2LocalConvStickTopMultiSyncAdd","23_113":"v2LocalConvStickTopMultiSyncDelete","23_114":"v2LocalConvStickTopMultiSyncUpdate"},Gy="V2NIMLocalConversationService",jy={id:1,ext:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},Hy={scene:1,to:2,timetag:3},Wy={v2LocalConvSyncReadTime:{sid:4,cid:14,service:Gy,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},v2LocalConvSyncSuperTeamReadTime:{sid:4,cid:20,service:Gy,response:[{type:"LongLongMap",name:"superTeam"}]},v2LocalConvSyncMoreRoaming:{sid:4,cid:22,service:Gy,response:[]},v2LocalConvSyncStickTop:{sid:4,cid:23,service:Gy,response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Ch(jy)}]},v2LocalConvSyncReliableInfo:{sid:4,cid:25,service:Gy,response:[]},v2LocalConvMarkReadTime:{sid:7,cid:16,service:Gy,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvMultiMarkReadTime:{sid:7,cid:25,service:Gy,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:Hy}]},v2LocalConvMultiSyncReadTime:{sid:7,cid:116,service:Gy,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMarkReadTime:{sid:21,cid:25,service:Gy,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvSuperTeamMultiMarkReadTime:{sid:21,cid:32,service:Gy,ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"tags",reflectMapper:Hy}]},v2LocalConvSuperTeamMultiSyncReadTime:{sid:21,cid:125,service:Gy,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2LocalConvStickTopAdd:{sid:33,cid:12,service:Gy,params:[{type:"Property",name:"tag",reflectMapper:jy}],response:[{type:"Property",name:"data",reflectMapper:Ch(jy)}]},v2LocalConvStickTopDelete:{sid:33,cid:13,service:Gy,params:[{type:"Property",name:"tag",reflectMapper:jy}],response:[{type:"Long",name:"timetag"}]},v2LocalConvStickTopMultiSyncAdd:{sid:23,cid:112,service:Gy,response:[{type:"Property",name:"data",reflectMapper:Ch(jy)}]},v2LocalConvStickTopMultiSyncDelete:{sid:23,cid:113,service:Gy,response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:Ch(jy)}]},v2LocalConvStickTopMultiSyncUpdate:{sid:23,cid:114,service:Gy,response:[{type:"Property",name:"data",reflectMapper:Ch(jy)}]}};function Yy(e,t){e=e||[],t=t||1,t=Math.max(Math.floor(t),1);for(var r=[],n=0;n<e.length;n+=t)r.push(Yc(e).call(e,n,n+t));return r}function Ky(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Qy(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qy(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Qy(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var $y=function(){function e(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=e,this.service=t,this.model=t.model,this.logger=t.logger}var t=e.prototype;return t.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function(){var e,t=Tl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0),r=this.totalUnreadCount;return void 0!==r&&r===t||(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),t},t.digestUnreadCountChange=function(){this._digest()},t._digest=function(){var e,t=this,r=this.totalUnreadCount,n=Tl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+n),r!==n&&(this.totalUnreadCount=n,this.service.emit("onTotalUnreadCountChanged",n));var i=fr(this.unreadCountByFilter);jn(i).call(i,(function(e){var r=JSON.parse(e),n=t.getUnreadCountByFilter(r),i=t.unreadCountByFilter[e];t.unreadCountByFilter[e]=n,r.equals=tr(Jy).call(Jy,r),i!==n&&t.service.emit("onUnreadCountChangedByFilter",r,n)}))},t.clearUnreadCount=function(e){var t=this,r=Tl(e).call(e,(function(e,r){return t.service.model.upsert({conversationId:r.conversationId,type:r.type,unreadCount:0})&&e.push(r.conversationId),e}),[]);if(r.length>0){var n=lu(r).call(r,(function(e){return t.service.model.getById(e)}));this.service.triggerConversationChanged(n),this.digestUnreadCountChange()}},t.getUnreadCountByIds=function(e){var t=this;return e=Zh(e),Tl(e).call(e,(function(e,r){var n=t.service.model.getById(r);return e+(n&&n.unreadCount||0)}),0)},t.getUnreadCountByFilter=function(e){var t,r=this.service.model.count(),n=this.service.model.getByOption(0,r,{conversationTypes:e.conversationTypes,ignoreMuted:e.ignoreMuted});return Tl(t=n.conversationList).call(t,(function(e,t){return e+(t.unreadCount||0)}),0)},t.isMessageUnread=function(e,t){var r;return void 0===t&&(t=0),e.createTime>t&&e.senderId!==this.core.account&&200===e.messageStatus.errorCode&&!1!==(null===(r=e.messageConfig)||void 0===r?void 0:r.unreadEnabled)},t.isMessageReferUnread=function(e,t){void 0===t&&(t=0);var r=this.core.V2NIMMessageService.model.getMessageById(e.messageClientId);return r?this.isMessageUnread(r,t):e.createTime>t&&e.senderId!==this.core.account},t.countUnreadByMessageInMemory=function(e,t){var r=this;void 0===t&&(t=0);var n=0,i=this.core.V2NIMMessageService.model.getMessagesByConversationId(e);return jn(i).call(i,(function(e){r.isMessageUnread(e,t)&&n++})),n},t.addFilter=function(e){var t=zy(e);if(void 0!==this.unreadCountByFilter[t])throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(t),n=this.getUnreadCountByFilter(r);this.unreadCountByFilter[t]=n,this.service.emit("onUnreadCountChangedByFilter",r,n)},t.deleteFilter=function(e){var t=zy(e);if(void 0===this.unreadCountByFilter[t])throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]},t.markConversationRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.model.getById(e),n=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.model.getReadTime(e),r){t.next=6;break}return t.abrupt("return",o||this.core.timeOrigin.getNTPTime());case 6:if(a=this.service.compute.computeReadTimeForMark(r),!(o>=a)){t.next=10;break}return this.logger.log("V2LocalConv::markConversationRead currentReadTime >= readTime "+e+","+o+","+a),t.abrupt("return",o);case 10:if(3!==i){t.next=15;break}return t.next=13,this.core.sendCmd("v2LocalConvSuperTeamMarkReadTime",{timetag:a,to:n});case 13:t.next=17;break;case 15:return t.next=17,this.core.sendCmd("v2LocalConvMarkReadTime",{scene:1===i?0:2===i?1:2,timetag:a,to:n});case 17:return this.model.updateReadTime(e,a),t.abrupt("return",a);case 19:case"end":return t.stop()}}),t,this)})))},t.markMultiConversationRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={cmd:"v2LocalConvSuperTeamMultiMarkReadTime",params:[]},n={cmd:"v2LocalConvMultiMarkReadTime",params:[]},jn(e).call(e,(function(e){var t=p.model.getById(e);if(t){var i=p.core.V2NIMConversationIdUtil.parseConversationTargetId(e),o=p.core.V2NIMConversationIdUtil.parseConversationType(e),a=p.model.getReadTime(e),s=p.service.compute.computeReadTimeForMark(t);if(!(a>=s)){var c={conversationId:e,scene:1===o?0:2===o?1:2,timetag:s,to:i};3===o?r.params.push(c):n.params.push(c)}}})),i=Yy(r.params,50),o=Yy(n.params,50),a=Ky(i);case 6:if((s=a()).done){t.next=19;break}return c=s.value,t.prev=8,t.next=11,this.core.sendCmd(r.cmd,{tags:c});case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(8),this.logger.warn("markMultiConversationRead::error:",lu(c).call(c,(function(e){return e.conversationId})),t.t0);case 16:jn(c).call(c,(function(e){p.model.updateReadTime(e.conversationId,e.timetag)}));case 17:t.next=6;break;case 19:u=Ky(o);case 20:if((d=u()).done){t.next=33;break}return l=d.value,t.prev=22,t.next=25,this.core.sendCmd(n.cmd,{tags:l});case 25:t.next=30;break;case 27:t.prev=27,t.t1=t.catch(22),this.logger.warn("markMultiConversationRead::error:",lu(l).call(l,(function(e){return e.conversationId})),t.t1);case 30:jn(l).call(l,(function(e){p.model.updateReadTime(e.conversationId,e.timetag)}));case 31:t.next=20;break;case 33:case"end":return t.stop()}}),t,this,[[8,13],[22,27]])})))},e}();function zy(e){var t=e.conversationTypes;return t&&(t=Dm(t).call(t)),Ei({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function Jy(e){return Ei(this)===zy(e)}var Xy,Zy={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function eM(e,t){return t&&t.length>0?lu(t).call(t,(function(t){return rM(e,t)})):[]}function tM(e,t,r,n){var i,o;void 0===r&&(r=0);var a=t=kv(t,e),s=a.messageType,c=a.subType,u=a.text,d=a.attachment,l=a.serverExtension,p="";if(t.senderId!==e.account&&5!==s){p=tm(t,"fromNick");var m=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t.senderId);m&&m.alias&&(p=m.alias)}return JSON.parse(Ei({lastMessageState:r,messageRefer:bv(e,t),messageType:s,subType:c,text:u,attachment:d,serverExtension:l,callbackExtension:t.callbackExtension,sendingState:n,senderName:p}))}function rM(e,t){var r=Uh(Zy,t);if(r.groupIds?r.groupIds=JSON.parse(r.groupIds):delete r.groupIds,"string"==typeof r.lastMessage)if(""===r.lastMessage);else if(1===r.lastMessageState){var n=Cv(e,Th(JSON.parse(r.lastMessage),Ch(Uv)));r.lastMessage=function(e,t){var r=t.messageRefer,n=t.revokeAccountId,i=t.revokeType,o=t.callbackExtension,a=t.serverExtension,s=t.postscript,c=function(e,t,r,n){var i,o,a,s,c,u,d,l;if(t!==e.account){var p=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t);if(p&&p.alias)return p.alias;if(2===r){var m=null===(s=null===(a=e.V2NIMTeamService)||void 0===a?void 0:a.memberModel)||void 0===s?void 0:s.getById(n,1,t);if(m&&m.teamNick)return m.teamNick}else if(3===r){var h=null===(u=null===(c=e.V2NIMTeamService)||void 0===c?void 0:c.memberModel)||void 0===u?void 0:u.getById(n,1,t);if(h&&h.teamNick)return h.teamNick}var f=null===(l=null===(d=e.V2NIMUserService)||void 0===d?void 0:d.model)||void 0===l?void 0:l.getUser(t);return f&&f.name?f.name:void 0}}(e,t.revokeAccountId,t.messageRefer.conversationType,t.messageRefer.receiverId)||"";return JSON.parse(Ei({lastMessageState:1,messageRefer:r,revokeAccountId:n,revokeType:i,callbackExtension:o,serverExtension:a,text:s||"",senderName:c}))}(e,n)}else if(0===r.lastMessageState){var i=Th(JSON.parse(r.lastMessage),Ch(Ov));r.lastMessage=tM(e,i,r.lastMessageState,i.senderId===e.account?1:void 0)}else 2===r.lastMessageState&&delete r.lastMessage;return r}function nM(e){var t=e.version,r=e.deleteFlag;return{conversation:Jl(e,["version","deleteFlag"]),version:t,deleteFlag:r}}!function(e){e[e.createConversation=1]="createConversation",e[e.deleteConversation=2]="deleteConversation",e[e.updateConversation=3]="updateConversation",e[e.setConversationTop=4]="setConversationTop",e[e.clearConversationUnread=5]="clearConversationUnread",e[e.addConversationToGroup=6]="addConversationToGroup",e[e.removeConversationFromGroup=7]="removeConversationFromGroup",e[e.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",e[e.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",e[e.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",e[e.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",e[e.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",e[e.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"}(Xy||(Xy={}));var iM={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function oM(e){return Uh(iM,e)}var aM=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.computeFromExternal=function(e){var t,r,n;if(0===e.type)return e;var i=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),a={};if((null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(a.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===i&&this.hasUserService){var s,c=this.core.V2NIMUserService.model.getUser(o),u=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(o):void 0;e.conversationId===(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.conversationId)&&(s=null===(n=e.lastMessage)||void 0===n?void 0:n.senderName),a.name=(null==u?void 0:u.alias)||(null==c?void 0:c.name)||s||o,a.avatar=(null==c?void 0:c.avatar)||""}else if(2===i&&this.hasTeamService){var d=this.core.V2NIMTeamService.model.getById(o,1);a.name=(null==d?void 0:d.name)||o,a.avatar=(null==d?void 0:d.avatar)||""}else if(3===i&&this.hasTeamService){var l=this.core.V2NIMTeamService.model.getById(o,2);a.name=(null==l?void 0:l.name)||o,a.avatar=(null==l?void 0:l.avatar)||""}return dr(e,a),e},t.computeSortOrder=function(e,t){return t?e?t+1e15:t:e?1e15:0},t.computeReadTimeForMark=function(e){var t,r,n,i=e.conversationId,o=this.service.model.getReadTime(i);if(null===(r=null===(t=null==e?void 0:e.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===r?void 0:r.createTime)n=e.lastMessage.messageRefer.createTime;else{if(0===e.unreadCount&&o>0)return o;if(!this.core.timeOrigin.checkNodeReliable())return o||0;n=this.core.timeOrigin.getNTPTime()}return n},t.computeConvWithLastMsg=function(e,t){var r,n=t||this.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);if(n){if(!1!==(null===(r=n.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)){var i=tM(this.core,n,0,n.sendingState);e.lastMessage=i}e.createTime=e.createTime||n.createTime,e.updateTime=n.createTime,e.sortOrder=this.computeSortOrder(e.stickTop,n.createTime)}return e},t.computeConvWithUnread=function(e,t){var r=this.service.model.getReadTime(e.conversationId),n=e.unreadCount||0;return t?t&&this.service.unread.isMessageUnread(t)&&(n+=1):n=this.service.unread.countUnreadByMessageInMemory(e.conversationId,r),e.unreadCount=n,e},t.computeConvByMsgsCache=function(e,t){var r,n=this.service.model.getById(e),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.core.V2NIMMessageService.model.getLastMessageOfConversation(e),a=null==t?void 0:t.updateTime,s=0;s=a||(o&&o.createTime?o.createTime:n&&n.updateTime?n.updateTime:this.core.timeOrigin.getNTPTime());var c=this.service.model.getStickTop(e),u=dr(dr({conversationId:e,type:i,stickTop:c,localExtension:(null==n?void 0:n.localExtension)||"",lastMessage:null,unreadCount:0},t),{createTime:(null==n?void 0:n.createTime)||s,updateTime:s,sortOrder:this.computeSortOrder(c,s)});if(o&&!1!==(null===(r=o.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)){var d=tM(this.core,o,0,o.sendingState);u.lastMessage=d}return u},ct(e,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasFriendService",get:function(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}},{key:"hasMessageService",get:function(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}}]),e}(),sM=function(){function e(e,t){this.core=e,this.service=t,this.model=this.service.model,this.logger=this.core.logger}var t=e.prototype;return t.v2LocalConvSyncStickTopHandler=function(e){var t=this,r=e.content,n=r.timetag,i=r.isThereAnyChange,o=r.datas;if(i){var a=this.model.getAll(),s=lu(o).call(o,(function(e){var r=Dy(e.id),n=r.target,i=r.type,o=t.core.V2NIMConversationIdUtil.conversationId(i,n);return t.model.updateStickTop(o,!0),o}));jn(a).call(a,(function(e){au(s).call(s,e.conversationId)?(e.stickTop=!0,e.updateTime=e.updateTime>n?e.updateTime:n):e.stickTop=!1,t.model.updateStickTop(e.conversationId,e.stickTop)})),this.model.bulkUpsert(a)}},t.v2LocalConvSyncReadTimeHandler=function(e){var t,r,n=this,i=e.content.p2p||{},o=e.content.team.m_map||{};this.logger.log("v2SyncLocalConvAck::",i,o),jn(t=fr(i)).call(t,(function(e){var t=n.core.V2NIMConversationIdUtil.p2pConversationId(e),r=n.model.getReadTime(t);i[e]>r&&(n.model.updateReadTime(t,i[e]),n.service.emit("onConversationReadTimeUpdated",t,i[e]))})),jn(r=fr(o)).call(r,(function(e){var t=n.core.V2NIMConversationIdUtil.teamConversationId(e),r=n.model.getReadTime(t);o[e]>r&&(n.model.updateReadTime(t,o[e]),n.service.emit("onConversationReadTimeUpdated",t,o[e]))}))},t.v2LocalConvSyncSuperTeamReadTimeHandler=function(e){var t,r=this,n=e.content.superTeam.m_map;this.logger.log("v2SyncLocalSuperTeamConvAck::",n),jn(t=fr(n)).call(t,(function(e){var t=r.core.V2NIMConversationIdUtil.superTeamConversationId(e),i=r.model.getReadTime(t);n[e]>i&&(r.model.updateReadTime(t,n[e]),r.service.emit("onConversationReadTimeUpdated",t,n[e]))}))},t.v2LocalConvMultiSyncReadTimeHandler=function(e){var t=e.content,r=Dy((0===t.scene?"p2p":1===t.scene?"team":"super_team")+"-"+t.to,"-"),n=r.type,i=r.target,o=this.core.V2NIMConversationIdUtil.conversationId(n,i),a=this.model.getById(o),s=null==a?void 0:a.unreadCount,c=this.model.getReadTime(o);t.timetag<=c?this.logger.warn("v2LocalConvMultiSyncReadTimeHandler: "+o+" do not need update ack "+t.timetag+"/"+c):(this.model.updateReadTime(o,t.timetag),this.service.emit("onConversationReadTimeUpdated",o,t.timetag),a?(a=this.service.compute.computeConvWithUnread(a),this.model.upsert(a),this.service.unread.digestUnreadCountChange(),void 0===s&&a.unreadCount>0?this.service.triggerConversationCreated(a):"number"==typeof s&&a.unreadCount!==s&&this.service.triggerConversationChanged([a])):this.logger.log("v2LocalConvMultiSyncReadTimeHandler: "+o+" not exist"))},t.v2LocalConvSuperTeamMultiSyncReadTimeHandler=function(e){this.v2LocalConvMultiSyncReadTimeHandler(e)},t.v2LocalConvStickTopMultiSyncAddHandler=function(e){var t=e.content.data,r=Dy(t.id),n=r.target,i=r.type,o=this.core.V2NIMConversationIdUtil.conversationId(i,n);this.model.updateStickTop(o,!0);var a=this.model.getById(o);a&&(a.stickTop=!0,a.updateTime=a.updateTime>t.updateTime?a.updateTime:t.updateTime,a.sortOrder=this.service.compute.computeSortOrder(!0,t.updateTime),this.model.upsert(a),this.service.triggerConversationChanged([a]))},t.v2LocalConvStickTopMultiSyncDeleteHandler=function(e){var t=e.content,r=t.data,n=t.timetag,i=Dy(r.id),o=i.target,a=i.type,s=this.core.V2NIMConversationIdUtil.conversationId(a,o);this.model.updateStickTop(s,!1);var c=this.model.getById(s);c&&(c.stickTop=!1,c.updateTime=c.updateTime>n?c.updateTime:n,c.sortOrder=this.service.compute.computeSortOrder(!1,n),this.model.upsert(c),this.service.triggerConversationChanged([c]))},e}();ju("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),$u);var cM=B.Set;nt({target:"Set",stat:!0,forced:!0},{from:Xu}),nt({target:"Set",stat:!0,forced:!0},{of:Zu}),nt({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=We(this),t=ne(e.add),r=0,n=arguments.length;r<n;r++)b(t,e,arguments[r]);return e}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:ed});var uM=Wi;nt({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=We(this),r=uM(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return!zi(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){var t=We(this),r=new(Mo(t,G("Set")))(t),n=ne(r.delete);return zi(e,(function(e){b(n,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=We(this),r=uM(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(Mo(t,G("Set"))),o=ne(i.add);return zi(r,(function(e){n(e,e,t)&&b(o,i,e)}),{IS_ITERATOR:!0}),i}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=We(this),r=uM(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return zi(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){var t=We(this),r=new(Mo(t,G("Set"))),n=ne(t.has),i=ne(r.add);return zi(e,(function(e){b(n,t,e)&&b(i,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){var t=We(this),r=ne(t.has);return!zi(e,(function(e,n){if(!0===b(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){var t=Wi(this),r=We(e),n=r.has;return I(n)||(r=new(G("Set"))(e),n=ne(r.has)),!zi(t,(function(e,t){if(!1===b(n,r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){var t=We(this),r=ne(t.has);return!zi(e,(function(e,n){if(!1===b(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}});var dM=M([].join),lM=[].push;nt({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=We(this),r=uM(t),n=void 0===e?",":Xi(e),i=[];return zi(r,lM,{that:i,IS_ITERATOR:!0}),dM(i,n)}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=We(this),r=uM(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(Mo(t,G("Set"))),o=ne(i.add);return zi(r,(function(e){b(o,i,n(e,e,t))}),{IS_ITERATOR:!0}),i}});var pM=TypeError;nt({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=We(this),r=uM(t),n=arguments.length<2,i=n?void 0:arguments[1];if(ne(e),zi(r,(function(r){n?(n=!1,i=r):i=e(i,r,r,t)}),{IS_ITERATOR:!0}),n)throw pM("Reduce of empty set with no initial value");return i}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=We(this),r=uM(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return zi(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){var t=We(this),r=new(Mo(t,G("Set")))(t),n=ne(r.delete),i=ne(r.add);return zi(e,(function(e){b(n,r,e)||b(i,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){var t=We(this),r=new(Mo(t,G("Set")))(t);return zi(e,ne(r.add),{that:r}),r}});var mM=cM,hM=function(){function e(e,t){this.core=e,this.service=t,this.model=this.service.model,this.compute=this.service.compute,this.logger=this.core.logger}var t=e.prototype;return t.setListener=function(){var e,t,r,n,i,o,a,s,c,u,d=this;this.core.eventBus.on("V2NIMLoginService/syncing",(function(){return d.service.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMLoginService/syncDone",tr(e=this.onSyncDone).call(e,this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",tr(t=this.sendMsg).call(t,this)),this.core.eventBus.on("V2NIMMessageService/onMsg",tr(r=this.recvMsg).call(r,this)),this.core.eventBus.on("V2NIMMessageService/modifyMsg",tr(n=this.modifyMsg).call(n,this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",tr(i=this.deleteMessages).call(i,this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",tr(o=this.deleteMessages).call(o,this)),this.core.eventBus.on("V2NIMMessageLogUtil/onClearHistoryNotifications",tr(a=this.clearMessages).call(a,this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",tr(s=this.generateConv).call(s,this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",tr(c=this.generateConv).call(c,this)),this.core.eventBus.on("V2NIMSettingService/setMute",tr(u=this.setMute).call(u,this))},t.beforeEmit=function(e){for(var t,r=this.service.name+"::emit "+e.toString(),n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];if("onConversationCreated"===e){var a=i[0],s=null===(t=a.lastMessage)||void 0===t?void 0:t.messageRefer;this.logger.log(""+r,"id:"+a.conversationId+";unread:"+a.unreadCount+";lastMsg:"+((null==s?void 0:s.messageClientId)||"")+"/"+((null==s?void 0:s.messageServerId)||""))}else if("onConversationChanged"===e){var c=i[0];this.logger.log(""+r,lu(c).call(c,(function(e){var t,r=null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer;return"id:"+e.conversationId+";unread:"+e.unreadCount+";lastMsg:"+((null==r?void 0:r.messageClientId)||"")+"/"+((null==r?void 0:r.messageServerId)||"")})))}else{var u,d;(u=this.logger).log.apply(u,Os(d=[""+r]).call(d,i))}},t.onSyncDone=function(e){var t=this;if(e)this.service.emit("onSyncFailed",e);else{var r=this.model.getAll();r=lu(r).call(r,(function(e){var r=e.conversationId,n=t.compute.computeConvByMsgsCache(r);return n=t.compute.computeConvWithUnread(n),n=t.compute.computeFromExternal(n),t.model.upsert(n),t.model.getById(r)})),r.length>0&&(this.service.triggerConversationChanged(r),this.service.unread.resetTotalAfterSyncDone()),this.service.emit("onSyncFinished")}},t.generateConv=function(e){var t=this,r=Zh(lu(e).call(e,(function(e){return e.conversationId})));jn(r).call(r,(function(e){var r=t.compute.computeConvByMsgsCache(e);t.model.upsert(r)}))},t.setMute=function(e,t){var r=this.model.getById(e);r&&r.mute!==t&&(r.mute=t,this.model.upsert(r),this.service.triggerConversationChanged([r]))},t.deleteMessages=function(e){var t=this,r=new mM;jn(e).call(e,(function(e){var n,i=e.messageRefer.conversationId,o=t.model.getById(i);if(o){if(e.messageRefer.messageClientId===(null===(n=o.lastMessage)||void 0===n?void 0:n.messageRefer.messageClientId)){r.add(i);var a=t.core.V2NIMMessageService.model.getLastMessageOfConversation(i);o.lastMessage=a?tM(t.core,a,0,a.sendingState):void 0}var s=t.model.getReadTime(i);if(o.unreadCount>0&&t.service.unread.isMessageReferUnread(e.messageRefer,s)&&(r.add(i),o.unreadCount--),"deleteTime"in e)e.deleteTime>o.updateTime&&(o.updateTime=e.deleteTime,o.sortOrder=t.compute.computeSortOrder(o.stickTop,o.updateTime));else{var c=t.core.timeOrigin.getNTPTime();o.updateTime=c,o.sortOrder=t.compute.computeSortOrder(o.stickTop,c)}t.model.upsert(o)}}));var n=Gl(r);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&n.length>0&&(this.service.triggerConversationChanged(lu(n).call(n,(function(e){return t.model.getById(e)}))),this.service.unread.digestUnreadCountChange())},t.sendMsg=function(e){var t=e.conversationId,r=this.model.getById(t);if(r){var n=this.updateCauseMessage(r,e);this.service.triggerConversationChanged([n])}else{var i=this.createCauseMessage(t,e);this.service.triggerConversationCreated(i)}},t.recvMsg=function(e){var t=e.conversationId,r=this.model.getById(t);if(r){var n=this.updateCauseMessage(r,e);n=this.compute.computeConvWithUnread(n,e),n=this.compute.computeFromExternal(n),this.model.upsert(n),this.service.triggerConversationChanged([n])}else{var i=this.createCauseMessage(t,e);i=this.compute.computeConvWithUnread(i,e),i=this.compute.computeFromExternal(i),this.model.upsert(i),this.service.triggerConversationCreated(i)}this.service.unread.digestUnreadCountChange()},t.updateCauseMessage=function(e,t){return e=this.compute.computeConvWithLastMsg(e,t),this.model.upsert(e),this.model.getById(e.conversationId)},t.createCauseMessage=function(e,t){var r,n=this.core.V2NIMConversationIdUtil.parseConversationType(e),i=this.model.getStickTop(e),o=!1===(null===(r=t.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)?void 0:tM(this.core,t,0,t.sendingState),a={conversationId:e,type:n,createTime:t.createTime,updateTime:t.createTime,sortOrder:this.compute.computeSortOrder(!1,t.createTime),stickTop:i,localExtension:"",lastMessage:o,unreadCount:0};return this.model.upsert(a),a},t.clearMessages=function(e){var t=this,r=new mM;jn(e).call(e,(function(e){var n=e.conversationId,i=e.deleteTime,o=t.model.getById(n);o&&(o.unreadCount>0&&(o.unreadCount=0,r.add(n)),o.lastMessage&&o.lastMessage.messageRefer.createTime<=e.deleteTime&&(o.lastMessage=void 0,r.add(n)),i>o.updateTime&&(o.updateTime=i,o.sortOrder=t.compute.computeSortOrder(o.stickTop,o.updateTime)),t.model.upsert(o))}));var n=Gl(r);!this.core.V2NIMLoginService.dataSync.checkSyncing()&&n.length>0&&(this.service.triggerConversationChanged(lu(n).call(n,(function(e){return t.model.getById(e)}))),this.service.unread.digestUnreadCountChange())},t.modifyMsg=function(e){var t,r=e.conversationId,n=this.model.getById(r);n&&e.messageClientId===(null===(t=n.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)&&(n.lastMessage=tM(this.core,e,0,e.sendingState),this.service.triggerConversationChanged([n]))},e}(),fM={type:"array",itemRules:{type:"enum",values:[1,2,3]},min:1},gM=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMLocalConversationService",t)||this).config={},n.model=new By,n.unread=new $y(n.core,ut(n)),n.compute=new aM(n.core,ut(n)),n.event=new hM(n.core,ut(n)),n.handler=new sM(n.core,ut(n)),n.core._registerDep(Mg,"V2NIMConversationIdUtil"),n.core._registerDep(Ly,"V2NIMMessageService"),"v2"!==n.core.options.apiVersion?ut(n):(Sh({cmdMap:Fy,cmdConfig:Wy}),n.setOptions(r),n.setListener(),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=dr(this.config,e)},r.setListener=function(){this.event.setListener()},r.reset=function(){this.model.reset(),this.unread.reset()},r.emit=function(t){for(var r,n,i,o,a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return(r=this.event).beforeEmit.apply(r,Os(n=[t]).call(n,s)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,s))},r.getConversationList=function(e,t){var r,n=this;this.checkV2(),Vl({offset:{type:"number",min:0}},{offset:e},"",!0),Vl({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var i=this.model.getByOption(e,t,{});return i.conversationList=lu(r=i.conversationList).call(r,(function(e){return n.compute.computeFromExternal(e)})),gs.resolve(i)},r.getConversationListByOption=function(e,t,r){var n,i=this;this.checkV2(),Vl({offset:{type:"number",min:0}},{offset:e},"",!0),Vl({limit:{type:"number",min:1}},{limit:t},"",!0),Vl({conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1}},r,"option",!0),this.core.V2NIMLoginService.checkIllegalState();var o=this.model.getByOption(e,t,r);return o.conversationList=lu(n=o.conversationList).call(n,(function(e){return i.compute.computeFromExternal(e)})),gs.resolve(o)},r.getConversation=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Dl(this.core.account,e),!(r=this.model.getById(e))){t.next=7;break}return t.abrupt("return",this.compute.computeFromExternal(r));case 7:throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 8:case"end":return t.stop()}}),t,this)})))},r.getConversationListByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),n=gu(r=lu(e).call(e,(function(e){return i.model.getById(e)}))).call(r,(function(e){return!!e})),n=lu(n).call(n,(function(e){return i.compute.computeFromExternal(e)})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.createConversation=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Dl(this.core.account,e),!(r=this.model.getById(e))){t.next=5;break}return t.abrupt("return",this.compute.computeFromExternal(r));case 5:return n=this.compute.computeConvByMsgsCache(e,{updateTime:this.core.timeOrigin.getNTPTime()}),n=this.compute.computeConvWithUnread(n),n=this.compute.computeFromExternal(n),this.model.upsert(n),i=this.model.getById(e),this.triggerConversationCreated(i),t.abrupt("return",i);case 12:case"end":return t.stop()}}),t,this)})))},r.deleteConversation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Dl(this.core.account,e),Vl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.next=5,this.unread.markConversationRead(e);case 5:if(n=this.model.deleteById(e)){r.next=8;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 8:t&&this.core.V2NIMMessageService.model.deleteMessages(e),!!(n&&n.unreadCount>0)&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",[e]);case 12:case"end":return r.stop()}}),r,this)})))},r.deleteConversationListByIds=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Vl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.next=5,this.unread.markMultiConversationRead(e);case 5:return n=!1,jn(e).call(e,(function(e){t&&i.core.V2NIMMessageService.model.deleteMessages(e),i.model.deleteById(e)&&(n=!0)})),n&&this.unread.digestUnreadCountChange(),this.emit("onConversationDeleted",e),r.abrupt("return",[]);case 10:case"end":return r.stop()}}),r,this)})))},r.stickTopConversation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Dl(this.core.account,e),Vl({stickTop:{type:"boolean"}},{stickTop:t},"",!0),(null==(n=this.model.getById(e))?void 0:n.stickTop)!==t){r.next=6;break}return r.abrupt("return");case 6:return i=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),o=this.core.V2NIMConversationIdUtil.parseConversationType(e),r.next=10,this.core.sendCmd(t?"v2LocalConvStickTopAdd":"v2LocalConvStickTopDelete",{tag:{id:qy(o,i)}});case 10:a=r.sent,this.model.updateStickTop(e,t),s=a.content.timetag||a.content.data.updateTime,this.model.upsert({conversationId:e,type:o,stickTop:t,updateTime:s,sortOrder:this.compute.computeSortOrder(t,s)}),c=[this.model.getById(e)],this.triggerConversationChanged(c);case 16:case"end":return r.stop()}}),r,this)})))},r.updateConversationLocalExtension=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Dl(this.core.account,e),Vl({localExtension:{type:"string"}},{localExtension:t},"",!0),n=this.model.getById(e)){r.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(n.localExtension!==t){r.next=8;break}return r.abrupt("return");case 8:i=dr(dr({},n),{localExtension:t}),this.model.upsert(i),this.triggerConversationChanged([i]);case 11:case"end":return r.stop()}}),r,this)})))},r.getTotalUnreadCount=function(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},r.getUnreadCountByIds=function(e){this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return gs.resolve(t)},r.getUnreadCountByFilter=function(e){this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return gs.resolve(t)},r.clearTotalUnreadCount=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.checkLogin(),t=this.model.getAll(),e.next=5,this.unread.markMultiConversationRead(lu(t).call(t,(function(e){return e.conversationId})));case 5:this.unread.clearUnreadCount(t);case 6:case"end":return e.stop()}}),e,this)})))},r.clearUnreadCountByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.checkLogin(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),r=[],n=[],i=new RegExp("^"+this.core.account+"\\|[1-3]\\|"),jn(e).call(e,(function(e){i.test(e)?r.push(e):n.push(e)})),!(r.length>0)){t.next=12;break}return a=gu(o=lu(r).call(r,(function(e){return s.model.getById(e)}))).call(o,(function(e){return!!e})),t.next=11,this.unread.markMultiConversationRead(r);case 11:this.unread.clearUnreadCount(a);case 12:return t.abrupt("return",lu(n).call(n,(function(e){return{conversationId:e,error:new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST})}})));case 13:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByTypes=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.checkLogin(),Vl({types:fM},{types:e},"",!0),n=this.model.getByOption(0,1e3,{conversationTypes:e}),t.next=6,this.unread.markMultiConversationRead(lu(r=n.conversationList).call(r,(function(e){return e.conversationId})));case 6:this.unread.clearUnreadCount(n.conversationList);case 7:case"end":return t.stop()}}),t,this)})))},r.subscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)},r.unsubscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)},r.getConversationReadTime=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Dl(this.core.account,e),t.abrupt("return",this.model.getReadTime(e));case 3:case"end":return t.stop()}}),t,this)})))},r.markConversationRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.checkLogin(),Dl(this.core.account,e),t.abrupt("return",this.unread.markConversationRead(e));case 4:case"end":return t.stop()}}),t,this)})))},r.valiteFilter=function(e){if(Vl({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&!0!==e.ignoreMuted)throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},r.triggerConversationChanged=function(e){var t=this;e=lu(e).call(e,(function(e){return t.compute.computeFromExternal(e)})),e=JSON.parse(Ei(e)),jn(e).call(e,(function(e){e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState})),this.emit("onConversationChanged",e)},r.triggerConversationCreated=function(e){e=this.compute.computeFromExternal(e),delete(e=JSON.parse(Ei(e))).lastMessageState,this.emit("onConversationCreated",e)},t}(af),vM=function(){function e(){this.map=new sd,this.readTimeMap=new sd}var t=e.prototype;return t.set=function(e){var t=this;jn(e).call(e,(function(e){e=t.processConversation(e),lu(t).set(e.conversationId,e)}))},t.reset=function(){lu(this).clear(),this.readTimeMap.clear()},t.count=function(){return lu(this).size},t.sort=function(){var e,t=this,r=Gl(Tu(e=lu(this)).call(e));Dm(r).call(r,(function(e,t){return t.sortOrder-e.sortOrder})),lu(this).clear(),jn(r).call(r,(function(e){lu(t).set(e.conversationId,e)}))},t.processConversation=function(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e},t.getById=function(e){return lu(this).get(e)},t.getAll=function(){var e,t=Gl(Tu(e=lu(this)).call(e));return Dm(t).call(t,(function(e,t){return t.sortOrder-e.sortOrder}))},t.getByOption=function(e,t,r){var n,i=r.conversationTypes,o=r.onlyUnread,a=r.conversationGroupIds,s=[];jn(n=lu(this)).call(n,(function(e){if((!(i&&i.length>0)||au(i).call(i,e.type))&&(!o||e.unreadCount)&&(!r.ignoreMuted||!e.mute)){if(a){var t=e.groupIds,n=(null==t?void 0:t.length)||0;if(0===a.length&&n>0)return;if(a.length>0&&0===n)return;if(a.length>0&&n>0&&!Hm(a).call(a,(function(e){return t&&au(t).call(t,e)})))return}s.push(e)}})),s=Dm(s).call(s,(function(e,t){return t.sortOrder-e.sortOrder}));var c=0;e>0&&(c=Up(s,"sortOrder",e),s[c]&&s[c].sortOrder===e&&(c+=1));var u=Yc(s).call(s,c).length;return(s=Yc(s).call(s,c,c+t)).length>0?{offset:u>t?s[s.length-1].sortOrder:0,finished:!(u>t),conversationList:s}:{offset:0,finished:!0,conversationList:s}},t.upsert=function(e){var t=e.conversationId,r=lu(this).get(t);if(!r)return e=this.processConversation(dr({},e)),lu(this).set(t,e),e.unreadCount>0;var n=e.unreadCount!==r.unreadCount,i=dr({},r,e);return i=this.processConversation(i),lu(this).set(t,i),n},t.bulkUpsert=function(e){var t=this,r=!1;return jn(e).call(e,(function(e){t.upsert(e)&&(r=!0)})),r},t.deleteById=function(e){var t=this.getById(e);if(t)return lu(this).delete(e),t},t.updateReadTime=function(e,t){this.readTimeMap.set(e,t)},t.getReadTime=function(e){return this.readTimeMap.get(e)||0},e}();function yM(e,t){var r=typeof e;if(r!==typeof t)return!1;if("object"===r){if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(ki(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!yM(e[n],t[n]))return!1;return!0}if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(null===e&&null===t)return!0;if(fr(e).length!==fr(t).length)return!1;for(var i in e)if(!yM(e[i],t[i]))return!1;return!0}return e===t}var MM=function(){function e(e,t){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},t.doSync=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"conversationSync"}),e.prev=3,e.next=6,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 6:t=e.sent,e.next=19;break;case 9:if(e.prev=9,e.t0=e.catch(3),(r=e.t0).code!==Cl.V2NIM_ERROR_CODE_CANCELLED){e.next=14;break}return e.abrupt("return");case 14:return this.isSyncing=!1,this.service.emit("onSyncFailed",r),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:r,subType:"conversationSync"}),this.processTempPacket(),e.abrupt("return");case 19:n=0===em(tm(t,"content.info.syncType")),i=tm(t,"content.info.nextCursor"),this.doSyncAndSuccess(n,i);case 22:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.doSyncAndSuccess=function(e,t){var r;e&&Dm(r=this.service.model).call(r),this.isSyncing=!1,this.nextCursor=em(t)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,subType:"conversationSync"}),this.processTempPacket()},t.setBackFillIds=function(e){var t=this;return jn(e).call(e,(function(e){if(2===e.lastMessageState&&t.service.compute.hasMessageService){t.conversationIdsForBackFill[e.conversationId]=!0;var r=t.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);e.lastMessage=r?tM(t.core,r,e.lastMessageState,r.sendingState):""}else t.conversationIdsForBackFill[e.conversationId]=!1;delete e.lastMessageState})),e},t.recvConversationFromSyncAction=function(e){var t=this,r=tm(e,"content.info").syncType,n=eM(this.core,tm(e,"content.datas"));0===(r=em(r))?(jn(n).call(n,(function(e){t.initFieldVersion(e.conversationId,e.version)})),n=this.setBackFillIds(n),this.setModel(n)):(n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n))},t.recvConversation=function(e){var t=this;if(this.isSyncing)this.tempPacket.push(e);else{var r=eM(this.core,tm(e,"content.datas")),n=gu(r).call(r,(function(e){return!!e.conversationId})),i=oM(tm(e,"content.info")),o=lu(n).call(n,(function(e){return"id:"+e.conversationId+", ver:"+e.version})).join(";");if(this.core.logger.getDebugMode()?this.core.logger.debug("V2NIMConversation::recvConversation: "+o+".",i,n):this.core.logger.log("V2NIMConversation::recvConversation: "+o+".",i),2===i.type){var a=lu(n).call(n,(function(e){return delete t.fieldVersion[e.conversationId],t.service.model.deleteById(e.conversationId),e.conversationId}));return this.service.emit("onConversationDeleted",a),void this.service.unread.digestUnreadCountChange()}12!==i.type?(i.type,n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n)):this.compareAndClearUnreadInModel(i.oneClickClearUnreadVersion,i.oneClickClearUnreadType,{conversationGroupIds:i.oneClickClearUnreadGroupId?[i.oneClickClearUnreadGroupId]:void 0,conversationTypes:i.oneClickClearUnreadConversationType})}},t.recvConversationForCreated=function(e){var t=this,r=gu(e).call(e,(function(e){return!t.fieldVersion[e.conversationId]})),n=Tl(r).call(r,(function(e,r){if(!t.fieldVersion[r.conversationId]){t.initFieldVersion(r.conversationId,r.version),e=!!t.updateModel(r)||e;var n=t.service.model.getById(r.conversationId);return n&&t.service.triggerConversationCreated(n),e}return e}),!1);return n&&this.service.unread.digestUnreadCountChange(),r.length},t.recvConversationForChanged=function(e){var t,r=this,n=this.bulkCompare(e);if(0!==n.length){this.bulkUpdateModel(n);var i=gu(t=lu(n).call(n,(function(e){return r.service.model.getById(e.conversationId)}))).call(t,(function(e){return!!e}));this.service.triggerConversationChanged(i)}},t.processTempPacket=function(){var e,t=this;jn(e=this.tempPacket).call(e,(function(e){t.recvConversation(e)})),this.tempPacket=[]},t.bulkCompare=function(e){var t,r=this;return gu(t=lu(e).call(e,(function(e){return r.compare(e)}))).call(t,(function(e){return!!e}))},t.compare=function(e){var t=this,r=e.version,n=e.conversationId,i=e.deleteFlag,o=e.type,a=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],s={},c=0;return jn(a).call(a,(function(i){var o=i;if(void 0!==e[o]){var a=t.fieldVersion[n];a&&"number"==typeof a[o]&&a[o]>=r||(t.fieldVersion[n]=t.fieldVersion[n]||{},t.fieldVersion[n][o]=r,s[o]=e[o],c+=1)}})),c?dr(dr({},s),{conversationId:n,deleteFlag:i,version:r,type:o}):void 0},t.bulkUpdateModel=function(e){var t=this,r=!1;jn(e).call(e,(function(e){t.updateModel(e)&&(r=!0)})),r&&this.service.unread.digestUnreadCountChange()},t.initFieldVersion=function(e,t){this.fieldVersion[e]={stickTop:t,groupIds:t,serverExtension:t,lastMessage:t,lastMessageState:t,unreadCount:t,sortOrder:t,createTime:t,updateTime:t}},t.initConversation=function(e,t){var r=Es();return dr({conversationId:e,type:this.core.V2NIMConversationIdUtil.parseConversationType(e),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:r,updateTime:r,sortOrder:r},t)},t.updateModel=function(e){var t=nM(e),r=t.deleteFlag,n=t.conversation;if(r){var i=this.service.model.deleteById(n.conversationId);return!!(i&&i.unreadCount>0)}return this.service.model.upsert(n)},t.setModel=function(e){var t,r=lu(t=gu(e).call(e,(function(e){return!e.deleteFlag}))).call(t,(function(e){return nM(e).conversation}));this.service.model.set(r)},t.updateModelWithLastMessage=function(e,t,r,n){var i=this.service.model.getById(e),o=t?tM(this.core,t,r,n):void 0;if(!yM(null==i?void 0:i.lastMessage,o))if(i){var a=dr(dr({},i),{sortOrder:o?i.stickTop?o.messageRefer.createTime+1e15:o.messageRefer.createTime:i.sortOrder,lastMessage:o});this.service.model.upsert(a),this.service.triggerConversationChanged([a])}else{this.initFieldVersion(e,-1);var s=this.initConversation(e,{lastMessage:o});this.service.model.upsert(s),this.service.triggerConversationCreated(s)}},t.updateModelByRevoke=function(e){var t=this,r=[];jn(e).call(e,(function(e){var n=e.postscript,i=e.messageRefer,o=Jl(e,["postscript","messageRefer"]),a=i.conversationId,s=t.service.model.getById(a);s&&s.lastMessage&&s.lastMessage.messageRefer.messageClientId===i.messageClientId&&1!==s.lastMessage.lastMessageState&&(s.lastMessage.lastMessageState=1,n&&(s.lastMessage.text=n),dr(s.lastMessage,o),t.service.model.upsert(s),r.push(s))})),r.length>0&&this.service.triggerConversationChanged(r)},t.compareAndUpdateModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",lu(e).call(e,(function(e){return e.conversationId})));var r=!1,n=[];jn(e).call(e,(function(e){var i=t.compare(e);if(i){var o=t.service.model.getById(e.conversationId);t.updateModel(i)&&(r=!0);var a=t.service.model.getById(e.conversationId);a&&(o?n.push(a):t.service.triggerConversationCreated(a))}})),n.length>0&&this.service.triggerConversationChanged(n),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",e);var r=Tl(e).call(e,(function(e,r){delete t.fieldVersion[r];var n=t.service.model.deleteById(r);return!!(n&&n.unreadCount>0)||e}),!1);this.service.emit("onConversationDeleted",e),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteGroupInModel=function(e,t){var r,n=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",e,t);var i=[];jn(r=fr(this.fieldVersion)).call(r,(function(r){var o=n.fieldVersion[r];if(void 0===o.groupIds||e>o.groupIds){o.groupIds=e;var a=n.service.model.getById(r);if(a&&a.groupIds&&a.groupIds.length>0){var s,c=gu(s=a.groupIds).call(s,(function(e){return e!==t}));if(c.length!==a.groupIds.length){var u=dr(dr({},a),{groupIds:c});n.service.model.upsert(u),u&&i.push(u)}}}})),i.length>0&&this.service.triggerConversationChanged(i)},t.compareAndClearUnreadInModel=function(e,t,r){var n=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",e,t,r);var i=[],o=[];if(1===t)o=this.service.model.getAll();else if(r){var a=this.service.model.count();o=this.service.model.getByOption(0,a,r).conversationList}jn(o).call(o,(function(t){var r=t.conversationId,o=n.fieldVersion[r];if(void 0===o.unreadCount||e>o.unreadCount){o.unreadCount=e;var a=t.unreadCount,s=dr(dr({},t),{unreadCount:0});n.service.model.upsert(s),a>0&&i.push(s)}})),i.length>0&&this.service.triggerConversationChanged(i),this.service.unread.digestUnreadCountChange()},t.backfillLastMsg=function(e,t){var r=this,n=e=Zh(e);(t||(n=gu(e).call(e,(function(e){return r.conversationIdsForBackFill[e]})),0!==n.length))&&jn(n).call(n,(function(e){var t=tm(r.service.model.getById(e),"lastMessage.messageRefer.messageClientId"),n=r.service.compute.hasMessageService?r.core.V2NIMMessageService.model.getLastMessageOfConversation(e):void 0;(n&&n.messageClientId)!==t&&(r.conversationIdsForBackFill[e]=!1,n?r.updateModelWithLastMessage(e,n,2,n.sendingState):r.updateModelWithLastMessage(e,void 0,2,0))}))},e}(),IM={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","4_22":"v2SyncSessionsWithMoreRoaming","4_25":"v2SyncSessionReliableInfo","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},TM="V2NIMConversationService",SM={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},bM={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},CM={v2ConversationCreate:{sid:28,cid:1,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationDelete:{sid:28,cid:2,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationUpdate:{sid:28,cid:3,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationSetTop:{sid:28,cid:4,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationGet:{sid:28,cid:6,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:gf(SM)}]},v2ConversationGetByIds:{sid:28,cid:7,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:TM,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:TM,response:[{type:"Property",name:"info",reflectMapper:gf(bM)},{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:TM,response:[{type:"Property",name:"info",reflectMapper:gf(bM)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:gf(bM)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:TM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:gf(bM)}]},syncConversationReadTime:{sid:4,cid:14,service:TM,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:TM,response:[{type:"LongLongMap",name:"superTeam"}]},v2SyncSessionsWithMoreRoaming:{sid:4,cid:22,service:TM,response:[]},v2SyncSessionReliableInfo:{sid:4,cid:25,service:TM,response:[]},v2MarkConversationReadTime:{sid:30,cid:16,service:TM,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:TM,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:TM,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:TM,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}},_M=function(){function e(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function(){var e,t=Tl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0),r=this.totalUnreadCount;return void 0!==r&&r===t||(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),t},t.digestUnreadCountChange=function(){this._digest()},t._digest=function(){var e,t=this,r=this.totalUnreadCount,n=Tl(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+n),r!==n&&(this.totalUnreadCount=n,this.service.emit("onTotalUnreadCountChanged",n));var i=fr(this.unreadCountByFilter);jn(i).call(i,(function(e){var r=JSON.parse(e),n=t.getUnreadCountByFilter(r),i=t.unreadCountByFilter[e];t.unreadCountByFilter[e]=n,r.equals=tr(kM).call(kM,r),i!==n&&t.service.emit("onUnreadCountChangedByFilter",r,n)}))},t.getUnreadCountByIds=function(e){var t=this;return Tl(e).call(e,(function(e,r){var n=t.service.model.getById(r);return e+(n&&n.unreadCount||0)}),0)},t.getUnreadCountByFilter=function(e){var t,r=this.service.model.count(),n=this.service.model.getByOption(0,r,{conversationTypes:e.conversationTypes,conversationGroupIds:e.conversationGroupId?[e.conversationGroupId]:void 0,ignoreMuted:e.ignoreMuted});return Tl(t=n.conversationList).call(t,(function(e,t){return e+(t.unreadCount||0)}),0)},t.addFilter=function(e){var t=EM(e);if(void 0!==this.unreadCountByFilter[t])throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(t),n=this.getUnreadCountByFilter(r);this.unreadCountByFilter[t]=n,this.service.emit("onUnreadCountChangedByFilter",r,n)},t.deleteFilter=function(e){var t=EM(e);if(void 0===this.unreadCountByFilter[t])throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]},e}();function EM(e){var t=e.conversationTypes;return t&&(t=Dm(t).call(t)),Ei({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function kM(e){return Ei(this)===EM(e)}var wM={createTime:{type:"number"},updateTime:{type:"number"}};function RM(e){return e&&e.length>0?lu(e).call(e,(function(e){return AM(e)})):[]}function AM(e){return Uh(wM,e)}function xM(e){var t,r=JSON.parse(e);return lu(t=fr(r)).call(t,(function(e){return{conversationId:e,error:new kl({code:r[e]})}}))}var NM,OM={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function PM(e){return Uh(OM,e)}!function(e){e[e.createConversationGroup=1]="createConversationGroup",e[e.deleteConversationGroup=2]="deleteConversationGroup",e[e.updateConversationGroup=3]="updateConversationGroup",e[e.addConversationToGroup=4]="addConversationToGroup",e[e.removeConversationFromGroup=5]="removeConversationFromGroup"}(NM||(NM={}));var LM=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.computeConvs=function(e){var t=this;return lu(e).call(e,(function(e){return t.computeConv(e)}))},t.computeConv=function(e){var t,r,n,i,o;if(0===e.type)return e;var a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c={};if((null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(c.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===a&&this.hasUserService){var u,d=this.core.V2NIMUserService.model.getUser(s),l=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(s):void 0;e.conversationId!==(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.conversationId)||0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.lastMessageState)&&2!==(null===(i=e.lastMessage)||void 0===i?void 0:i.lastMessageState)||(u=null===(o=e.lastMessage)||void 0===o?void 0:o.senderName),c.name=(null==l?void 0:l.alias)||(null==d?void 0:d.name)||u||s,c.avatar=(null==d?void 0:d.avatar)||""}else if(2===a&&this.hasTeamService){var p=this.core.V2NIMTeamService.model.getById(s,1);c.name=(null==p?void 0:p.name)||s,c.avatar=(null==p?void 0:p.avatar)||""}else if(3===a&&this.hasTeamService){var m=this.core.V2NIMTeamService.model.getById(s,2);c.name=(null==m?void 0:m.name)||s,c.avatar=(null==m?void 0:m.avatar)||""}return dr(e,c),e},t.computeReadTimeForMark=function(e){var t,r,n,i=e.conversationId,o=this.service.model.getReadTime(i);if(null===(r=null===(t=null==e?void 0:e.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===r?void 0:r.createTime)n=e.lastMessage.messageRefer.createTime;else{if(!this.core.timeOrigin.checkNodeReliable())return o||0;n=this.core.timeOrigin.getNTPTime()}return n},ct(e,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasFriendService",get:function(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}},{key:"hasMessageService",get:function(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}}]),e}(),VM=Ts.entries;nt({target:"Object",stat:!0},{entries:function(e){return VM(e)}});var UM,DM,qM,BM,FM=B.Object.entries,GM=function(){function e(e,t){this.core=e,this.service=t,this.model=this.service.model,this.logger=this.core.logger}var t=e.prototype;return t.v2ConversationNotifySyncHandler=function(e){this.ifEnabled&&this.service.versionCache.recvConversationFromSyncAction(e)},t.v2ConversationNotifySyncOnlineHandler=function(e){this.ifEnabled&&this.service.versionCache.recvConversation(e)},t.syncConversationReadTimeHandler=function(e){var t,r,n;if(this.ifEnabled){if(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.p2p)for(var i=0,o=FM(e.content.p2p);i<o.length;i++){var a=o[i],s=a[0],c=a[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(s),c),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(s),c)}if(null===(n=null===(r=null==e?void 0:e.content)||void 0===r?void 0:r.team)||void 0===n?void 0:n.m_map)for(var u=0,d=FM(e.content.team.m_map);u<d.length;u++){var l=d[u],p=l[0],m=l[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(p),m),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(p),m)}}},t.syncSuperTeamReadTimeHandler=function(e){var t,r;if(this.ifEnabled&&(null===(r=null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.superTeam)||void 0===r?void 0:r.m_map))for(var n=0,i=FM(e.content.superTeam.m_map);n<i.length;n++){var o=i[n],a=o[0],s=o[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s)}},t.v2MultiDeviceConversationReadTimeHandler=function(e){var t;this.ifEnabled&&(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(0===e.content.scene?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag)))},t.v2MultiDeviceSuperTeamReadTimeHandler=function(e){var t;this.ifEnabled&&(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag),this.service.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag))},ct(e,[{key:"ifEnabled",get:function(){return!0===this.core.options.enableV2CloudConversation}}]),e}(),jM=function(){function e(e,t){this.core=e,this.service=t,this.model=this.service.model,this.versionCache=this.service.versionCache,this.logger=this.core.logger}var t=e.prototype;return t.setListener=function(){var e,t,r,n,i,o,a,s=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){return s.versionCache.doSync()})),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",tr(e=this.conversationOnlineSyncNotify).call(e,this)),this.core.eventBus.on("V2NIMMessageService/sendMessage",tr(t=this.sendMessage).call(t,this)),this.core.eventBus.on("V2NIMMessageService/deleteMessages",tr(r=this.deleteMessages).call(r,this)),this.core.eventBus.on("V2NIMMessageService/revokeMessages",tr(n=this.revokeMessages).call(n,this)),this.core.eventBus.on("V2NIMMessageService/roamingMsgs",tr(i=this.roamingOrOfflineMsgs).call(i,this)),this.core.eventBus.on("V2NIMMessageService/offlineMsgs",tr(o=this.roamingOrOfflineMsgs).call(o,this)),this.core.eventBus.on("V2NIMSettingService/setMute",tr(a=this.setMute).call(a,this))},t.beforeEmit=function(e){for(var t,r,n=this.service.name+"::emit "+e.toString(),i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if("onConversationCreated"===e){var s=o[0];this.logger.log(""+n,"id:"+s.conversationId+";unread:"+s.unreadCount+";lastMsg:"+(null===(t=s.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)+"/"+(null===(r=s.lastMessage)||void 0===r?void 0:r.messageRefer.messageServerId))}else if("onConversationChanged"===e){var c=o[0];this.logger.log(""+n,lu(c).call(c,(function(e){var t,r;return"id:"+e.conversationId+";unread:"+e.unreadCount+";lastMsg:"+(null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)+"/"+(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.messageServerId)})))}else{var u,d;(u=this.logger).log.apply(u,Os(d=[""+n]).call(d,o))}},t.conversationOnlineSyncNotify=function(e,t){var r;!1!==(null===(r=null==t?void 0:t.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled)&&(e.content.info=Th(e.content.info,gf(bM)),e.content.data=Th(e.content.data,gf(SM)),t&&(e.content.data.lastMessage=tM(this.core,t,0)),e.content.datas=[e.content.data],this.service.handler.v2ConversationNotifySyncOnlineHandler.call(this,e))},t.sendMessage=function(e,t){var r,n;1===t&&!0===(null===(r=e.messageConfig)||void 0===r?void 0:r.historyEnabled)||!1!==(null===(n=null==e?void 0:e.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)&&this.versionCache.updateModelWithLastMessage(e.conversationId,e,2,t)},t.deleteMessages=function(e){var t=lu(e).call(e,(function(e){return e.messageRefer.conversationId}));this.versionCache.backfillLastMsg(t,!0)},t.revokeMessages=function(e){this.versionCache.updateModelByRevoke(e)},t.roamingOrOfflineMsgs=function(e){var t=Zh(lu(e).call(e,(function(e){return e.conversationId})));this.versionCache.backfillLastMsg(t,!1)},t.setMute=function(e,t){var r=this.model.getById(e);r&&r.mute!==t&&(r.mute=t,this.model.upsert(r),this.service.triggerConversationChanged([r]))},e}(),HM=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationService",t)||this).config={},n.model=new vM,n.versionCache=new MM(n.core,ut(n)),n.unread=new _M(n.core,ut(n)),n.compute=new LM(n.core,ut(n)),n.event=new jM(n.core,ut(n)),n.handler=new GM(n.core,ut(n)),n.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion||!0!==n.core.options.enableV2CloudConversation?ut(n):(Sh({cmdMap:IM,cmdConfig:CM}),n.setOptions(r),n.setListener(),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=dr(this.config,e)},r.setListener=function(){this.event.setListener()},r.reset=function(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},r.emit=function(t){for(var r,n,i,o,a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return(r=this.event).beforeEmit.apply(r,Os(n=[t]).call(n,s)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,s))},r.checkEnable=function(){if(!0!==this.core.options.enableV2CloudConversation)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})},r.getConversationList=function(e,t){this.checkEnable(),this.checkV2(),Vl({offset:{type:"number",min:0}},{offset:e},"",!0),Vl({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var r=this.model.getByOption(e,t,{});return r.conversationList=this.compute.computeConvs(r.conversationList),gs.resolve(r)},r.getConversationListByOption=function(e,t,r){this.checkEnable(),this.checkV2(),Vl({offset:{type:"number",min:0}},{offset:e},"",!0),Vl({limit:{type:"number",min:1}},{limit:t},"",!0),Vl({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:r},"",!0),this.core.V2NIMLoginService.checkIllegalState();var n=this.model.getByOption(e,t,r);return n.conversationList=this.compute.computeConvs(n.conversationList),gs.resolve(n)},r.getConversation=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkEnable(),this.checkV2(),Dl(this.core.account,e),!(r=this.model.getById(e))){t.next=8;break}return t.abrupt("return",this.compute.computeConv(r));case 8:throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return t.stop()}}),t,this)})))},r.getConversationListByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),n=gu(r=lu(e).call(e,(function(e){return i.model.getById(e)}))).call(r,(function(e){return!!e})),n=this.compute.computeConvs(n),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})))},r.createConversation=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Dl(this.core.account,e),t.next=5,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:e}});case 5:if(r=t.sent,n=tm(r,"content.data"),i=rM(this.core,n),this.versionCache.compareAndUpdateModel([i]),!(o=this.model.getById(e))){t.next=14;break}return t.abrupt("return",this.compute.computeConv(o));case 14:throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 15:case"end":return t.stop()}}),t,this)})))},r.deleteConversation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Dl(this.core.account,e),Vl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.prev=4,r.next=7,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:e,clearMessage:Number(t||!1)}});case 7:r.next=12;break;case 9:r.prev=9,r.t0=r.catch(4),this.logger.warn("V2NIMConversationService:deleteConversation: delete conversation failed: "+e);case 12:this.model.getById(e)&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[e]),this.versionCache.compareAndDeleteModel([e]));case 13:case"end":return r.stop()}}),r,this,[[4,9]])})))},r.deleteConversationListByIds=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Vl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.next=6,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:Ei(e),clearMessage:Number(t||!1)}});case 6:return n=r.sent,i=xM(tm(n,"content.info.failedMap")),(o=gu(i).call(i,(function(e){return e.error.code!==Cl.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!a.model.getById(e.conversationId)}))).length<e.length&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",e),this.versionCache.compareAndDeleteModel(e)),r.abrupt("return",o);case 11:case"end":return r.stop()}}),r,this)})))},r.stickTopConversation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Dl(this.core.account,e),Vl({stickTop:{type:"boolean"}},{stickTop:t},"",!0),r.next=6,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:e,stickTop:Number(t)}});case 6:n=r.sent,i=tm(n,"content.data"),o=rM(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 10:case"end":return r.stop()}}),r,this)})))},r.updateConversation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Dl(this.core.account,e),Vl({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:t},"",!0),r.next=6,this.core.sendCmd("v2ConversationUpdate",{tag:dr({conversationId:e},t)});case 6:n=r.sent,i=tm(n,"content.data"),o=rM(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 10:case"end":return r.stop()}}),r,this)})))},r.updateConversationLocalExtension=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkEnable(),this.checkV2(),Dl(this.core.account,e),Vl({localExtension:{type:"string"}},{localExtension:t},"",!0),n=this.model.getById(e)){r.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 7:if(n.localExtension!==t){r.next=9;break}return r.abrupt("return");case 9:i=dr(dr({},n),{localExtension:t}),this.model.upsert(i),this.triggerConversationChanged([i]);case 12:case"end":return r.stop()}}),r,this)})))},r.getTotalUnreadCount=function(){return this.checkEnable(),this.checkV2(),this.unread.getTotalUnreadCount()||0},r.getUnreadCountByIds=function(e){this.checkEnable(),this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return gs.resolve(t)},r.getUnreadCountByFilter=function(e){this.checkEnable(),this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return gs.resolve(t)},r.clearTotalUnreadCount=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkEnable(),this.checkV2(),e.next=4,this.core.sendCmd("v2ConversationClearTotalUnread");case 4:t=e.sent,r=oM(tm(t,"content.info")),this.versionCache.compareAndClearUnreadInModel(r.oneClickClearUnreadVersion,r.oneClickClearUnreadType);case 7:case"end":return e.stop()}}),e,this)})))},r.clearUnreadCountByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:Ei(e)}});case 5:return r=t.sent,n=eM(this.core,tm(r,"content.datas")),i=xM(tm(r,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(n),t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByGroupId=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string"}},{groupId:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:e}});case 5:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByTypes=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({types:fM},{types:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:Ei(e)}});case 5:r=t.sent,n=oM(tm(r,"content.info")),this.versionCache.compareAndClearUnreadInModel(n.oneClickClearUnreadVersion,n.oneClickClearUnreadType,{conversationTypes:n.oneClickClearUnreadConversationType});case 8:case"end":return t.stop()}}),t,this)})))},r.markConversationRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkEnable(),this.checkV2(),this.checkLogin(),Dl(this.core.account,e),r=this.model.getById(e)){t.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});case 7:if(n=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.model.getReadTime(e),a=this.compute.computeReadTimeForMark(r),!(o>=a)){t.next=14;break}return this.logger.log("V2Conv::markConversationRead currentReadTime >= readTime "+e+","+o+","+a),t.abrupt("return",o);case 14:if(3!==i){t.next=19;break}return t.next=17,this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:a,to:n});case 17:t.next=21;break;case 19:return t.next=21,this.core.sendCmd("v2MarkConversationReadTime",{scene:1===i?0:2===i?1:2,timetag:a,to:n});case 21:return this.model.updateReadTime(e,a),t.abrupt("return",a);case 23:case"end":return t.stop()}}),t,this)})))},r.getConversationReadTime=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Dl(this.core.account,e),t.abrupt("return",this.model.getReadTime(e));case 4:case"end":return t.stop()}}),t,this)})))},r.subscribeUnreadCountByFilter=function(e){var t;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)},r.unsubscribeUnreadCountByFilter=function(e){var t;this.checkEnable(),this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)},r.valiteFilter=function(e){if(Vl({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&void 0===e.conversationGroupId&&!0!==e.ignoreMuted)throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},r.triggerConversationChanged=function(e){e=this.compute.computeConvs(e),e=JSON.parse(Ei(e)),jn(e).call(e,(function(e){e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState})),this.emit("onConversationChanged",e)},r.triggerConversationCreated=function(e){e=this.compute.computeConv(e),delete(e=JSON.parse(Ei(e))).lastMessageState,this.emit("onConversationCreated",e)},t}(af),WM={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},YM="V2NIMConversationGroupService",KM={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},QM={v2ConversationGroupCreate:{sid:28,cid:9,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:gf(KM)},{type:"PropertyArray",name:"conversations",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:gf(KM)}]},v2ConversationGroupGet:{sid:28,cid:12,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:gf(KM)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(KM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:YM,response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(KM)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:YM,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:gf(SM)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:YM,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:gf(KM)}]}},$M=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationGroupService",t)||this).config={},n.core._registerDep(HM,"V2NIMConversationService"),"v2"!==n.core.options.apiVersion||!0!==n.core.options.enableV2CloudConversation?ut(n):(Sh({cmdMap:WM,cmdConfig:QM}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onConversationsAddedToGroup"===t){var c=a[0],u=a[1];this.logger.log(""+i,"groupId:"+c,"conversations:"+lu(u).call(u,(function(e){return e.conversationId})).join(","))}else{var d,l;(d=this.logger).log.apply(d,Os(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},r.checkEnable=function(){if(!0!==this.core.options.enableV2CloudConversation)throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2CloudConversation is not enabled"}})},r.createConversationGroup=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c,u=this;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkEnable(),this.checkV2(),Vl({name:{type:"string",allowEmpty:!1}},{name:e},"",!0),Vl({serverExtension:{type:"string",required:!1}},{serverExtension:t},"",!0),Vl({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:r},"",!0),n.next=7,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:e,serverExtension:t||"",conversationIds:r&&Ei(r)}});case 7:return i=n.sent,o=AM(tm(i,"content.data")),a=eM(this.core,tm(i,"content.conversations")),s=xM(tm(i,"content.info.failedMap")),this.emit("onConversationGroupCreated",o),a.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsAddedToGroup",o.groupId,gu(c=lu(a).call(a,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(c,(function(e){return!!e})))),n.abrupt("return",{group:o,failedList:s});case 14:case"end":return n.stop()}}),n,this)})))},r.deleteConversationGroup=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:e}});case 5:r=t.sent,n=PM(tm(r,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(n.deleteVersion,e),this.emit("onConversationGroupDeleted",e);case 9:case"end":return t.stop()}}),t,this)})))},r.updateConversationGroup=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Vl({name:{type:"string",required:!1}},{name:t},"",!0),Vl({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),void 0!==t||void 0!==r){n.next=7;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 7:return n.next=9,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:e,name:t,serverExtension:r}});case 9:i=n.sent,o=AM(tm(i,"content.data")),this.emit("onConversationGroupChanged",o);case 12:case"end":return n.stop()}}),n,this)})))},r.addConversationsToGroup=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Vl({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=6,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:e,conversationIds:Ei(t)}});case 6:return i=r.sent,o=tm(i,"content.info.failedMap")||"",a=[],o&&(a=xM(o)),s=eM(this.core,tm(i,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(s),(c=gu(n=lu(s).call(s,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(n,(function(e){return!!e}))).length>0&&this.emit("onConversationsAddedToGroup",e,c),r.abrupt("return",a);case 15:case"end":return r.stop()}}),r,this)})))},r.removeConversationsFromGroup=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Vl({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=6,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:e,conversationIds:Ei(t)}});case 6:return n=r.sent,i=tm(n,"content.info.failedMap")||"",o=[],i&&(o=xM(i)),a=eM(this.core,tm(n,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsRemovedFromGroup",e,lu(a).call(a,(function(e){return e.conversationId}))),r.abrupt("return",o);case 14:case"end":return r.stop()}}),r,this)})))},r.getConversationGroup=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:e}});case 5:return r=t.sent,t.abrupt("return",AM(tm(r,"content.data")));case 7:case"end":return t.stop()}}),t,this)})))},r.getConversationGroupList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkEnable(),this.checkV2(),e.next=4,this.core.sendCmd("v2ConversationGroupListGet");case 4:return t=e.sent,e.abrupt("return",RM(tm(t,"content.datas")));case 6:case"end":return e.stop()}}),e,this)})))},r.getConversationGroupListByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkEnable(),this.checkV2(),Vl({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:e},"",!0),t.next=5,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:e&&Ei(e)}});case 5:return n=t.sent,i=RM(tm(n,"content.datas")),t.abrupt("return",gu(r=lu(e).call(e,(function(e){return gu(i).call(i,(function(t){return t.groupId===e}))[0]}))).call(r,(function(e){return!!e})));case 8:case"end":return t.stop()}}),t,this)})))},r.v2ConversationGroupNotifySyncOnlineHandler=function(e){var t=this;if(this.ifEnabled){var r,n=PM(tm(e,"content.info")),i=n.type,o=n.deleteVersion,a=n.conversationIds,s=AM(tm(e,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",n,s),1===i)this.emit("onConversationGroupCreated",s),a&&a.length>0&&this.emit("onConversationsAddedToGroup",s.groupId,gu(r=lu(a).call(a,(function(e){return t.core.V2NIMConversationService.model.getById(e)}))).call(r,(function(e){return!!e})));else if(2===i)this.emit("onConversationGroupDeleted",s.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(o,s.groupId);else if(3===i)this.emit("onConversationGroupChanged",s);else if(4===i){var c,u=gu(c=lu(a).call(a,(function(e){return t.core.V2NIMConversationService.model.getById(e)}))).call(c,(function(e){return!!e}));this.emit("onConversationsAddedToGroup",s.groupId,u)}else 5===i&&this.emit("onConversationsRemovedFromGroup",s.groupId,a)}},ct(t,[{key:"ifEnabled",get:function(){return!0===this.core.options.enableV2CloudConversation}}]),t}(af),zM="V2NIMMessageLogUtil",JM={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},XM={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:_h},teamId:3,onlineSync:{id:4,converter:_h},deleteTime:{id:6,retType:"number"},serverExtension:7},ZM=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],eI={v2GetMessageList:{sid:30,cid:6,service:zM,params:Os(UM=[{type:"String",name:"to"}]).call(UM,ZM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ch(Ov)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:zM,params:[{type:"PropertyArray",name:"tag",reflectMapper:Ov,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ch(Ov)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:zM,params:[{type:"Property",name:"tag",reflectMapper:XM}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:zM,params:Os(DM=[{type:"Long",name:"to"}]).call(DM,ZM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ch(Ov)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:zM,params:Os(qM=[{type:"Long",name:"to"}]).call(qM,ZM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ch(Ov)}]},onClearHistoryMessage:{sid:7,cid:118,service:zM,response:[{type:"Property",name:"data",reflectMapper:Ch(XM)}]},syncClearHistoryMessage:{sid:4,cid:24,service:zM,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(XM)}]}},tI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageLogUtil",t)||this).clearHistoryMessageFn=function(e){var t=_v(r.core,e);r.emitClearHistoryMessage([t])},r.core=t,r.service=r.core.V2NIMMessageService,"v2"!==r.core.options.apiVersion?ut(r):(Sh({cmdMap:JM,cmdConfig:eI}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageFn)},r.getMessageListByRefers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Vl(Dg,{messageRefers:e},"",!0),0!==e.length){t.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(i=[],o=lu(e).call(e,(function(e){var t=c.service.model.getMessageById(e.messageClientId);return!t&&e.messageServerId&&"0"!==e.messageServerId&&i.push(e),t})),a=[],!(i.length>0)){t.next=12;break}return t.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:i});case 10:s=t.sent,a=s.content.msgs;case 12:return t.abrupt("return",lu(r=gu(n=lu(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=ch(a).call(a,(function(e){return e.messageServerId===n.messageServerId}));return i?Tv(c.core,i):void 0}))).call(n,(function(e){return void 0!==e}))).call(r,(function(e){return kv(e,c.core)})));case 13:case"end":return t.stop()}}),t,this)})))},r.getMessageList=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){r.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(Vl(Vg,e,"",!0),Dl(this.core.account,e.conversationId),a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c=1===a?"v2GetMessageList":2===a?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",u=e.beginTime||0,d=e.endTime||0,!(0!==u&&0!==d&&u>d)){r.next=12;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(l=void 0===e.direction?0:e.direction,!e.anchorMessage){r.next=29;break}if(0!==e.direction){r.next=23;break}if(0!==d){r.next=19;break}d=e.anchorMessage.createTime,r.next=21;break;case 19:if(d===e.anchorMessage.createTime){r.next=21;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:r.next=29;break;case 23:if(0!==u){r.next=27;break}u=e.anchorMessage.createTime,r.next=29;break;case 27:if(u===e.anchorMessage.createTime){r.next=29;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return p=null===(t=e.anchorMessage)||void 0===t?void 0:t.messageServerId,r.next=32,this.core.sendCmd(c,{beginTime:u,endTime:d,lastMsgId:p||0,limit:e.limit||50,direction:l,msgTypes:e.messageTypes?Yc(n=e.messageTypes).call(n):[],to:s});case 32:return m=r.sent,h=m.content,f=[],f=lu(i=h.msgs).call(i,(function(e){return Tv(g.core,e)})),p&&(f=gu(f).call(f,(function(e){return e.messageServerId!==p}))),r.abrupt("return",lu(o=this.getMessageListMonkeyPatch(f,e)).call(o,(function(e){return kv(e,g.core)})));case 38:case"end":return r.stop()}}),r,this)})))},r.getMessageListMonkeyPatch=function(e,t){var r=t.conversationId,n=e,i=Tl(n).call(n,(function(e,t){return e[t.messageClientId]=!0,e}),{}),o=this.service.model.getMessagesByConversationId(r);o=Dm(o).call(o,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime}));var a=0,s=t.beginTime||0,c=t.endTime||0;t.anchorMessage&&(0===t.direction?c=t.anchorMessage.createTime:s=t.anchorMessage.createTime,a=$n(o).call(o,(function(e){var r;return e.messageClientId===(null===(r=t.anchorMessage)||void 0===r?void 0:r.messageClientId)})),a+=1);for(var u=a;u<o.length;u++){var d,l=o[u],p=!i[l.messageClientId],m=void 0===l.sendingState||1===l.sendingState,h=l.conversationId===r,f=l.createTime>s&&(l.createTime<c||0===c),g=!t.messageTypes||au(d=t.messageTypes).call(d,l.messageType);p&&m&&h&&f&&g&&n.push(o[u])}return n=Dm(n).call(n,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime})),Yc(n).call(n,0,t.limit||50)},r.clearHistoryMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(Fg,e,"",!0),Dl(this.core.account,e.conversationId),r=e.conversationId,n=e.deleteRoam,i=e.onlineSync,o=e.serverExtension,a=this.core.V2NIMConversationIdUtil.parseConversationType(r),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(r),c={deleteRoam:n,onlineSync:i,serverExtension:o,conversationType:a},1===a?c.receiverId=s:c.teamId=s,u=this.core.timeOrigin.getNTPTime(),t.next=11,this.core.sendCmd("v2ClearHistoryMessage",{tag:c});case 11:d=t.sent,u=d.content.timetag,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",dr(dr({},c),{deleteTime:u})),this.emitClearHistoryMessage([{deleteTime:u,serverExtension:o,conversationId:r}]);case 15:case"end":return t.stop()}}),t,this)})))},r.syncClearHistoryMessageHandler=function(e){var t,r=this,n=lu(t=e.content.data).call(t,(function(e){return _v(r.core,e)}));this.emitClearHistoryMessage(n)},r.onClearHistoryMessageHandler=function(e){var t=_v(this.core,e.content.data);this.emitClearHistoryMessage([t])},r.emitClearHistoryMessage=function(e){var t=this;jn(e).call(e,(function(e){t.service.model.deleteMessages(e.conversationId,e.deleteTime)})),this.core.eventBus.emit("V2NIMMessageLogUtil/onClearHistoryNotifications",e),this.service.emit("onClearHistoryNotifications",e)},t}(af),rI="V2NIMMessageExtendUtil",nI={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","33_1":"v2GetThreadMessageList"},iI={conversationType:{id:1,converter:Bv,retConverter:Fv,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},oI={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:Fv},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:_h,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:_h,retType:"number"},updateTime:{id:10,converter:_h,retType:"number"}},aI={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:_h},needBadge:{id:6,access:"pushConfig.needBadge",converter:_h},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},sI={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},cI={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},uI={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function(e){return 0===e?2:1}},p2pAccountIds:{id:7,converter:function(e){return e.join(",")}},teamIds:{id:8,converter:function(e){return e.join(",")}},senderAccountIds:{id:9,converter:function(e){return e.join(",")}},messageTypes:{id:10,converter:function(e){return e.join(",")}},messageSubtypes:{id:11,converter:function(e){return e.join(",")}}},dI=dr(dr({},uI),{conversationLimit:4}),lI={v2PinMessage:{sid:33,cid:15,service:rI,params:[{type:"Property",name:"msg",reflectMapper:Ov,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:sI}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:rI,params:[{type:"Property",name:"msg",reflectMapper:Ov,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:sI}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:rI,params:[{type:"Property",name:"msg",reflectMapper:Ov,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:sI}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:rI,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:Ch(oI)}]},v2VoiceToText:{sid:29,cid:5,service:rI,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:rI,params:[{type:"Property",name:"message",reflectMapper:Ov,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:aI}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:rI,params:[{type:"Property",name:"message",reflectMapper:Ov,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:aI}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:rI,response:[{type:"Property",name:"message",reflectMapper:Ch(Ov)},{type:"Property",name:"quickComment",reflectMapper:Ch(aI)}]},onRemoveQuickComment:{sid:23,cid:6,service:rI,response:[{type:"Property",name:"message",reflectMapper:Ch(Ov)},{type:"Property",name:"quickComment",reflectMapper:Ch(aI)}]},v2GetQuickComment:{sid:33,cid:7,service:rI,params:[{type:"PropertyArray",name:"tag",reflectMapper:iI}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(iI)}]},onPinMessage:{sid:23,cid:18,service:rI,response:[{type:"Property",name:"msg",reflectMapper:Ch(Ov)},{type:"Property",name:"pinInfo",reflectMapper:Ch(sI)}]},onUpdatePinMessage:{sid:23,cid:19,service:rI,response:[{type:"Property",name:"msg",reflectMapper:Ch(Ov)},{type:"Property",name:"pinInfo",reflectMapper:Ch(sI)}]},onUnpinMessage:{sid:23,cid:20,service:rI,response:[{type:"Property",name:"msg",reflectMapper:Ch(Ov)},{type:"Property",name:"pinInfo",reflectMapper:Ch(sI)}]},v2AddCollection:{sid:33,cid:8,service:rI,params:[{type:"Property",name:"tag",reflectMapper:cI}],response:[{type:"Property",name:"data",reflectMapper:Ch(cI)}]},v2RemoveCollections:{sid:33,cid:9,service:rI,params:[{type:"PropertyArray",name:"tag",reflectMapper:cI,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:rI,params:[{type:"Property",name:"tag",reflectMapper:cI}],response:[{type:"Property",name:"data",reflectMapper:Ch(cI)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:rI,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:Ch(cI)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:rI,params:[{type:"Property",name:"tag",reflectMapper:dI}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Ov)}]},v2SearchCloudMessages:{sid:30,cid:27,service:rI,params:[{type:"Property",name:"tag",reflectMapper:uI}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Ov)}]},v2GetThreadMessageList:{sid:33,cid:1,service:rI,params:[{type:"Property",name:"messageRefer",reflectMapper:Ov},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:Ch(Ov)},{type:"Property",name:"replyResult",reflectMapper:Ch({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:Ch(Ov)}]}},pI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageExtendUtil",t)||this).core=t,"v2"!==r.core.options.apiVersion?ut(r):(Sh({cmdMap:nI,cmdConfig:lI}),r)}nr(t,e);var r=t.prototype;return r.pinMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(Ug,e,"message",!0),Vl(Gg,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2PinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:1,message:e,serverExtension:t,createTime:n.content.timetag,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.unpinMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(Ug,e,"messageRefer",!0),Vl(Gg,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UnpinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:0,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.updatePinMessage=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(Ug,e,"message",!0),Vl(Gg,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:2,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.getPinnedMessageList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){t.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return Dl(this.core.account,e),i=(i=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(e)).replace("superTeam","super_team"),t.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:i,timetag:0}});case 8:return o=t.sent,t.abrupt("return",Dm(r=lu(n=o.content.data).call(n,(function(e){return dr(dr({},e),{messageRefer:dr(dr({},e.messageRefer),{conversationId:a.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)})})}))).call(r,(function(e,t){return t.updateTime-e.updateTime})));case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl(Yg,{message:e,index:t,serverExtension:r,pushConfig:n},"",!0),i.next=4,this.core.sendCmd("v2AddQuickComment",{message:e,quickComment:{index:t,serverExtension:r,pushConfig:n}});case 4:o=i.sent,a={operationType:1,quickComment:{messageRefer:bv(this.core,e),createTime:o.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",a);case 7:case"end":return i.stop()}}),i,this)})))},r.removeQuickComment=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(Ug,e,"messageRefer",!0),Vl({index:{type:"number",min:1}},{index:t},"",!0),Vl({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),n.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:e,quickComment:{index:t,serverExtension:r}});case 6:i=n.sent,o={operationType:2,quickComment:{messageRefer:bv(this.core,e),createTime:i.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",o);case 9:case"end":return n.stop()}}),n,this)})))},r.getQuickCommentList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(Kg,{messages:e},"",!0),n={},t.next=5,this.core.sendCmd("v2GetQuickComment",{tag:lu(e).call(e,(function(e){return{messageRefer:e}}))});case 5:return i=t.sent,jn(r=i.content.data).call(r,(function(e){var t,r;try{if(!e.detail)return void(n[t=e.messageRefer.messageClientId]||(n[t]=[]));var i=JSON.parse(e.detail);n[r=e.messageRefer.messageClientId]||(n[r]=[]),jn(i).call(i,(function(t){n[e.messageRefer.messageClientId].push({messageRefer:dr(dr({},e.messageRefer),{conversationId:o.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)}),operatorId:t[1],index:em(t[2]),createTime:em(t[3]),serverExtension:t[4]})}))}catch(t){o.logger.error("getQuickCommentList JSON Parse Error",e.detail,t)}})),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.voiceToText=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Vl(Wg,e,"",!0),e.voicePath||e.voiceUrl||e.file){t.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePathvoiceUrlfile cannot be empty at the same time"}});case 4:if(r=e.voicePath,n=e.file,i=e.mimeType,o=e.sampleRate,a=e.duration,s=e.sceneName,c=s?this.core.V2NIMStorageService.getStorageScene(s):null,u=e.voiceUrl){t.next=14;break}return d={},n?d.file=n:0===(null==r?void 0:wu(r).call(r,"nim-external"))?d.fileInput=r:d.filePath=r,t.next=12,this.core.cloudStorage.uploadFile(dr({type:"audio",nosScenes:c?c.sceneName:void 0,nosSurvivalTime:c?c.expireTime:void 0},d));case 12:l=t.sent,u=l.url;case 14:return t.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:u,mimeType:i,sampleRate:o,duration:a}},{timeout:3e4});case 16:return p=t.sent,t.abrupt("return",p.content.data);case 18:case"end":return t.stop()}}),t,this)})))},r.onPinMessageHandler=function(e){return this.pinMessageChangeHandler(e,1)},r.onUnpinMessageHandler=function(e){return this.pinMessageChangeHandler(e,0)},r.onUpdatePinMessageHandler=function(e){return this.pinMessageChangeHandler(e,2)},r.pinMessageChangeHandler=function(e,t){var r=e.content.msg,n=e.content.pinInfo;r.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(r),this.emitPinNotification({pinState:t,message:r,serverExtension:n.serverExtension,createTime:n.createTime,updateTime:n.updateTime,operatorId:n.accid})},r.emitPinNotification=function(e){var t={pinState:e.pinState,pin:dr(dr({serverExtension:e.serverExtension||"",operatorId:e.operatorId},e.createTime?{createTime:e.createTime}:{}),{updateTime:e.updateTime,messageRefer:bv(this.core,e.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",t)},r.onAddQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,1)},r.onRemoveQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,2)},r.onQuickCommentNotificationHandler=function(e,t){var r={operationType:t,quickComment:dr({messageRefer:dr(dr({},e.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.content.message)})},e.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",r)},r.addCollection=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(Qg,{params:e},"",!0),t.next=4,this.core.sendCmd("v2AddCollection",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.removeCollections=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl($g,{collections:e},"",!0),t.next=4,this.core.sendCmd("v2RemoveCollections",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.updateCollectionExtension=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(zg,{collection:e,serverExtension:t},"",!0),r.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:dr(dr({},e),{serverExtension:t})});case 4:return n=r.sent,r.abrupt("return",n.content.data);case 6:case"end":return r.stop()}}),r,this)})))},r.getCollectionListByOption=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(Jg,e,"",!0),t.next=4,this.getCollectionListExByOption(e);case 4:return r=t.sent,t.abrupt("return",r.collectionList);case 6:case"end":return t.stop()}}),t,this)})))},r.getCollectionListExByOption=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Vl(Jg,e,"",!0),i=e.beginTime||0,o=e.endTime||0,a=void 0===e.direction?0:e.direction,void 0===(null===(t=e.anchorCollection)||void 0===t?void 0:t.collectionId)){n.next=21;break}if(0!==e.direction){n.next=15;break}if(0!==o){n.next=11;break}o=e.anchorCollection.createTime,n.next=13;break;case 11:if(o===e.anchorCollection.createTime){n.next=13;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 13:n.next=21;break;case 15:if(0!==i){n.next=19;break}i=e.anchorCollection.createTime,n.next=21;break;case 19:if(i===e.anchorCollection.createTime){n.next=21;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 21:if(!(0!==i&&0!==o&&i>=o)){n.next=23;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: beginTime cannot be greater than endTime"}});case 23:return(s={beginTime:i,endTime:o,direction:a,limit:e.limit,collectionType:e.collectionType,excludeId:(null===(r=e.anchorCollection)||void 0===r?void 0:r.collectionId)?e.anchorCollection.collectionId:0}).collectionType||delete s.collectionType,n.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:s});case 27:return c=n.sent,n.abrupt("return",{totalCount:c.content.total,collectionList:c.content.data});case 29:case"end":return n.stop()}}),n,this)})))},r.searchCloudMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Vl(Xg,e,"",!0),n=e.beginTime||0,i=e.endTime||0,!(0!==n&&0!==i&&n>i)){t.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return o=void 0===e.sortOrder?0:e.sortOrder,a=e.conversationLimit||0,s=e.messageLimit||10,c=a>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",t.next=12,this.core.sendCmd(c,{tag:dr(dr({},e),{beginTime:n,endTime:i,sortOrder:o,conversationLimit:a,messageLimit:s})});case 12:return u=t.sent,t.abrupt("return",lu(r=u.content.data).call(r,(function(e){return Tv(d.core,e)})));case 14:case"end":return t.stop()}}),t,this)})))},r.getThreadMessageList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(ov,e,"getThreadMessageList",!0),e.beginTime=e.beginTime||0,!(e.endTime&&e.beginTime>e.endTime)){t.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return t.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:e.messageRefer,tag:{beginTime:e.beginTime,endTime:e.endTime,limit:e.limit,reverse:1===e.direction?1:0,excludeMessageServerId:e.excludeMessageServerId}});case 6:return r=t.sent,n=r.content,i=n.message,o=n.replyResult,a=n.replyList,t.abrupt("return",{message:Tv(this.core,i),timestamp:o.timestamp,replyCount:o.total,replyList:lu(a).call(a,(function(e){return Tv(s.core,e)}))});case 9:case"end":return t.stop()}}),t,this)})))},t}(af),mI={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}},hI={type:"object",required:!0,rules:dr({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},mI)},fI={type:"array",min:1,itemType:"string"},gI={type:"boolean"},vI={type:"string"},yI={type:"string",allowEmpty:!1},MI={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},II={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},TI={teamIds:{type:"array",itemRules:{type:"string",allowEmpty:!1,regExp:/^[1-9]\d*$/},min:1}},SI={teamType:{type:"enum",values:[1,2]}},bI={teamTypes:{type:"array",itemType:"enum",values:[1,2],required:!1}},CI={inviteeParams:{type:"object",required:!0,rules:{inviteeAccountIds:fI,postscript:dr(dr({},vI),{required:!1}),serverExtension:dr(dr({},vI),{required:!1})}}},_I={updateTeamInfoParams:{type:"object",required:!0,rules:dr({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},mI)}},EI={type:"enum",values:[0,2]},kI={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}},wI={chatBannedMode:{type:"enum",values:[0,1]}},RI={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:[0,2,1]},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:[1,0],required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},AI={teamId:II.teamId,teamType:{type:"enum",values:[1,2]},operatorAccountId:{type:"string",allowEmpty:!1}},xI={actionType:{type:"enum",values:[2,0,1,3]}},NI={actionType:{type:"enum",values:[2]}},OI={actionType:{type:"enum",values:[0]}},PI={types:{type:"array",itemType:"enum",values:[0,2,1,3],required:!1},status:{type:"array",itemType:"enum",values:[1,3,0,2],required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},LI={teamId:II.teamId,teamType:SI.teamType,accountIds:fI},VI=function(){function e(){this.teamMap=new sd,this.superTeamMap=new sd}var t=e.prototype;return t.set=function(e){var t=this;jn(e).call(e,(function(e){t.chooseMap(e.teamType).set(e.teamId,e)}))},t.reset=function(){this.teamMap.clear(),this.superTeamMap.clear()},t.count=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=0;return jn(r).call(r,(function(e){t&&e.isValidTeam&&n++,t||n++})),n},t.chooseMap=function(e){return 2===e?this.superTeamMap:1===e?this.teamMap:new sd},t.getById=function(e,t,r){void 0===r&&(r=!0);var n=this.chooseMap(t).get(e);if(n){if(r&&n.isValidTeam)return n;if(!r)return n}},t.getAll=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=Gl(Tu(r).call(r)),i=gu(n).call(n,(function(e){return!(!t||!e.isValidTeam)||!t||void 0}));return Dm(i).call(i,(function(e,t){return t.updateTime-e.updateTime}))},t.upsert=function(e){var t=e.teamId,r=e.teamType,n=this.chooseMap(r),i=n.get(t)||{},o=dr({},i,e);return n.set(t,o),o},t.deleteById=function(e,t){var r=this.getById(e,t);if(r)return r.isValidTeam=!1,r},t.searchTeamByKeyword=function(e){var t,r,n=[];return jn(t=this.teamMap).call(t,(function(t){var r;au(r=t.name).call(r,e)&&n.push(t)})),jn(r=this.superTeamMap).call(r,(function(t){var r;au(r=t.name).call(r,e)&&n.push(t)})),n},e}(),UI=function(){function e(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var t=e.prototype;return t.reset=function(){this.teamMembers=[],this.superTeamMembers=[]},t.setData=function(e){var t=this;jn(e).call(e,(function(e){t.chooseList(e.teamType).push(e)}))},t.chooseList=function(e){return 2===e?this.superTeamMembers:1===e?this.teamMembers:[]},t.getById=function(e,t,r){var n=this.chooseList(t);return ch(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}))},t.upsert=function(e){var t=e.teamType,r=e.teamId,n=this.chooseList(t),i=$n(n).call(n,(function(t){return t.teamId===r&&t.accountId===e.accountId}));-1===i?n.push(e):n[i]=dr(dr({},n[i]),e),n.length>this.maxSize&&n.shift()},t.deleteByAccount=function(e,t,r){var n=this.chooseList(t),i=$n(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}));if(-1!==i){var o=n[i];return o.inTeam=!1,li(n).call(n,i,1),o}},t.deleteByTeamId=function(e,t){var r=this.chooseList(t),n=gu(r).call(r,(function(t){return t.teamId!==e}));2===t?this.superTeamMembers=n:this.teamMembers=n},e}(),DI=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.processNotification=function(e){var t=this,r=e.attachment,n=e.senderId,i=e.receiverId,o=e.createTime,a=r.id,s=r.data,c=a>400?2:1,u=vv(s,c),d=u.id,l=u.ids,p=u.tinfo,m=u.mute,h=this.service.model.getById(i,c);switch(this.core.logger.log("v2Team::processNotification, notificationType:"+a+", teamId:"+i,s),a){case BM.SUPER_TEAM_INVITATION:case BM.TEAM_INVITATION:au(l).call(l,this.core.account)&&this.onTeamJoined(p),this.onTeamMembersJoined(p,gu(l).call(l,(function(e){return e!==t.core.account})));break;case BM.SUPER_TEAM_INVITE_ACCEPT:case BM.TEAM_INVITE_ACCEPT:n===this.core.account?this.onTeamJoined(p):this.onTeamMemberJoined(p,n);break;case BM.SUPER_TEAM_APPLY_ACCEPT:case BM.TEAM_APPLY_ACCEPT:d===this.core.account?this.onTeamJoined(p):this.onTeamMemberJoined(p,d);break;case BM.SUPER_TEAM_ADD_MANAGER:case BM.TEAM_ADD_MANAGER:this.updateTeamMemberRole(i,c,l,{memberRole:2,updateTime:o});break;case BM.SUPER_TEAM_REMOVE_MANAGER:case BM.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(i,c,l,{memberRole:0,updateTime:o});break;case BM.SUPER_TEAM_KICK:case BM.TEAM_KICK:this.onTeamInfoUpdated(p),jn(l).call(l,(function(e){e===t.core.account?t.onTeamLeft(i,c,!0):t.onTeamMemberKicked(n,p.teamId,p.teamType,e)}));break;case BM.SUPER_TEAM_LEAVE:case BM.TEAM_LEAVE:p?this.onTeamInfoUpdated(p):h&&n===this.core.account&&(h.isValidTeam=!1,this.onTeamInfoUpdated(h)),n===this.core.account?this.onTeamLeft(i,c,!1):this.onTeamMemberLeft(i,c,n);break;case BM.SUPER_TEAM_DISMISS:case BM.TEAM_DISMISS:this.onTeamDismissed(i,c);break;case BM.SUPER_TEAM_UPDATE:case BM.TEAM_UPDATED:this.onTeamInfoUpdated(p);break;case BM.SUPER_TEAM_TRANSFER_OWNER:case BM.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(p),this.updateTeamMemberRole(i,c,[n,p.ownerAccountId],[{memberRole:0,updateTime:o},{memberRole:1,updateTime:o}]);break;case BM.SUPER_TEAM_MEMBER_MUTE:case BM.TEAM_MEMBER_MUTE:this.service.model.upsert(p),this.updateTeamMemberRole(i,c,d?[d]:l,{chatBanned:0!==m,updateTime:o})}},t.onTeamJoined=function(e){var t=this;this.service.model.upsert(e),this.service.emit("onTeamJoined",e),this.service.getTeamMemberListByIds(e.teamId,e.teamType,[this.core.account]).catch((function(e){t.core.logger.error("Get Member error after onTeamJoined",e)}))},t.onTeamLeft=function(e,t,r){var n=this.service.model.deleteById(e,t)||yv(e,t,{isValidTeam:!1});this.service.memberModel.deleteByAccount(e,t,this.core.account),this.service.emit("onTeamLeft",n,r)},t.onTeamDismissed=function(e,t){var r=this.service.model.deleteById(e,t);r||(r=yv(e,t,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(e,t),this.service.emit("onTeamDismissed",r)},t.onTeamInfoUpdated=function(e){var t=this.service.model.upsert(e);this.service.emit("onTeamInfoUpdated",t)},t.onTeamMemberJoined=function(e,t){this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e);var r=e.updateTime||e.createTime,n=Mv(e.teamId,e.teamType,t,{joinTime:r,updateTime:r});this.service.emit("onTeamMemberJoined",[n])},t.onTeamMembersJoined=function(e,t){var r=e.updateTime||e.createTime,n=lu(t).call(t,(function(t){return Mv(e.teamId,e.teamType,t,{joinTime:r,updateTime:r})}));0!==n.length&&(this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e),this.service.emit("onTeamMemberJoined",n))},t.onTeamMemberLeft=function(e,t,r){var n=this.service.memberModel.deleteByAccount(e,t,r);n||(n=Mv(e,t,r,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[n])},t.onTeamMemberKicked=function(e,t,r,n){var i=this.service.memberModel.deleteByAccount(t,r,n);i||(i=Mv(t,r,n,{inTeam:!1})),this.service.emit("onTeamMemberKicked",e,[i])},t.onTeamMemberInfoUpdated=function(e){var t=this;jn(e).call(e,(function(e){if(e.accountId===t.core.account&&t.core.V2NIMSettingService.name&&t.core.V2NIMConversationIdUtil.name){var r=1===e.teamType?t.core.V2NIMConversationIdUtil.teamConversationId(e.teamId):t.core.V2NIMConversationIdUtil.superTeamConversationId(e.teamId),n=t.core.V2NIMSettingService.getConversationMuteStatus(r);t.core.eventBus.emit("V2NIMSettingService/setMute",r,n)}})),this.service.emit("onTeamMemberInfoUpdated",e)},t.updateTeamMemberRole=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c,u=this;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!((a=gu(r).call(r,(function(r,i){var o=u.service.memberModel.getById(e,t,r);return o&&u.service.memberModel.upsert(dr(dr({},o),ki(n)?n[i]:n)),!o}))).length>0)){i.next=12;break}return i.prev=2,i.next=5,this.service.getTeamMemberListByIds(e,t,a);case 5:s=i.sent,jn(s).call(s,(function(e){return u.service.memberModel.upsert(e)})),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",i.t0);case 12:(c=gu(o=lu(r).call(r,(function(r){return u.service.memberModel.getById(e,t,r)}))).call(o,(function(e){return!!e}))).length>0&&this.onTeamMemberInfoUpdated(c);case 14:case"end":return i.stop()}}),i,this,[[2,9]])})))},t.processSysNotification=function(e){var t=e.receiverId,r=e.postscript,n=e.senderId,i=e.timestamp,o=e.content,a={};try{a=JSON.parse(o)}catch(e){this.core.logger.warn("v2Team::processSysNotification, parse content failed",o)}var s={actionType:{0:0,1:1,2:2,3:3,15:0,16:1,17:2,18:3}[e.type],teamId:t,teamType:e.type>=15?2:1,operatorAccountId:n,postscript:r,timestamp:i,actionStatus:0};a.attach&&(s.serverExtension=a.attach),this.core.logger.log("v2Team::processSysNotification, type:",e.type,s),this.service.notificationModel.create(s),this.service.emit("onReceiveTeamJoinActionInfo",s)},t.updateTeamActionStatus=function(e,t){this.service.notificationModel.update({teamId:e.teamId,teamType:e.teamType,operatorAccountId:e.operatorAccountId,actionType:e.actionType,actionStatus:t})},t.checkIfExpired=function(e){return!!e&&(509===e||!(e>=500&&e<=599)&&!(e>=19e4))},e}();!function(e){e[e.TEAM_INVITATION=0]="TEAM_INVITATION",e[e.TEAM_KICK=1]="TEAM_KICK",e[e.TEAM_LEAVE=2]="TEAM_LEAVE",e[e.TEAM_UPDATED=3]="TEAM_UPDATED",e[e.TEAM_DISMISS=4]="TEAM_DISMISS",e[e.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",e[e.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",e[e.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",e[e.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",e[e.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",e[e.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",e[e.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",e[e.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",e[e.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",e[e.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",e[e.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",e[e.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",e[e.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",e[e.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",e[e.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(BM||(BM={}));var qI=function(){function e(){this.list=[],this.maxCount=1e3}var t=e.prototype;return t.reset=function(){this.list=[]},t.create=function(e){this.list.push(e),this.list.length>this.maxCount&&this.list.shift()},t.update=function(e){var t;jn(t=this.list).call(t,(function(t){t.teamId===e.teamId&&t.teamType===e.teamType&&t.actionType===e.actionType&&t.operatorAccountId===e.operatorAccountId&&0===t.actionStatus&&dr(t,e)}))},t.delete=function(e){var t,r;this.list=gu(t=lu(r=this.list).call(r,(function(t){if(t.teamId!==e.teamId||t.teamType!==e.teamType||t.operatorAccountId!==e.operatorAccountId||t.actionType!==e.actionType||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.getByOption=function(e){var t,r=e.types,n=e.status,i=e.offset,o=void 0===i?0:i,a=e.limit,s=void 0===a?50:a,c=[];jn(t=this.list).call(t,(function(e){r&&r.length>0&&!au(r).call(r,e.actionType)||n&&n.length>0&&!au(n).call(n,e.actionStatus)||c.push(e)})),c=Dm(c).call(c,(function(e,t){return t.timestamp-e.timestamp}));var u=0;o>0&&(u=Up(c,"timestamp",o),c[u]&&c[u].timestamp===o&&(u+=1));var d=Yc(c).call(c,u).length;return(c=Yc(c).call(c,u,u+s)).length>0?{offset:d>s?c[c.length-1].timestamp:0,finished:!(d>s),infos:c}:{offset:0,finished:!0,infos:c}},e}(),BI=function(){function e(e,t){this.core=e,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.notification=t.notification,this.logger=this.core.logger}var t=e.prototype;return t.setListener=function(){var e,t,r,n=this;this.core.eventBus.on("V2NIMTeamService/onSyncStarted",(function(){n.service.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",(function(){n.service.emit("onSyncFinished")})),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",(function(e){n.service.emit("onSyncFailed",e)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",(function(e){n.model.upsert(e);var t=Mv(e.teamId,e.teamType,n.core.account,{memberRole:1});n.memberModel.upsert(t),n.service.emit("onTeamCreated",e)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",(function(e){n.memberModel.upsert(e),n.service.emit("onTeamInfoUpdated",[e])})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",tr(e=this.notification.updateTeamActionStatus).call(e,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",tr(t=this.notification.processSysNotification).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",tr(r=this.notification.processNotification).call(r,this.notification))},t.beforeEmit=function(e){for(var t=this.service.name+"::emit "+e.toString(),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];if("onTeamCreated"===e||"onTeamDismissed"===e||"onTeamJoined"===e||"onTeamLeft"===e||"onTeamInfoUpdated"===e){var o=n[0];this.logger.log(""+t,"team:"+o.teamId+"_"+o.teamType+";updateTime:"+o.updateTime)}else if("onTeamMemberJoined"===e||"onTeamMemberLeft"===e||"onTeamMemberInfoUpdated"===e){var a=n[0];this.logger.log(""+t,lu(a).call(a,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else if("onTeamMemberKicked"===e){var s=n[0],c=n[1];this.logger.log(""+t,"operator"+s,lu(c).call(c,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else{var u,d;(u=this.logger).log.apply(u,Os(d=[""+t]).call(d,n))}},t.onSyncDone=function(e){e?this.service.emit("onSyncFailed",e):this.service.emit("onSyncFinished")},e}(),FI=function(){function e(e,t){this.core=e,this.service=t,this.model=t.model,this.memberModel=t.memberModel,this.logger=this.core.logger}var t=e.prototype;return t.v2TeamSyncHandler=function(e){this.model.set(e.content.datas)},t.v2SuperTeamSyncHandler=function(e){this.model.set(e.content.datas)},t.v2TeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=Mv(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.service.emit("onTeamCreated",t)},t.v2SuperTeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=Mv(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.service.emit("onTeamCreated",t)},t.v2TeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=1;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.service.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},t.v2SuperTeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=2;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.service.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},t.v2TeamMembersOfSelfInSyncHandler=function(e){var t=this,r=e.content.datas;jn(r).call(r,(function(e){e.teamType=1,t.memberModel.upsert(e)}))},t.v2SuperTeamMembersOfSelfInSyncHandler=function(e){var t=this,r=e.content.datas;jn(r).call(r,(function(e){e.teamType=2,t.memberModel.upsert(e)}))},e}(),GI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMTeamService",t)||this).core._registerDep(Mg,"V2NIMConversationIdUtil"),r.model=new VI,r.memberModel=new UI,r.notificationModel=new qI,r.notification=new DI(t,ut(r)),r.event=new BI(t,ut(r)),r.handler=new FI(t,ut(r)),"v2"!==r.core.options.apiVersion?ut(r):(Sh({cmdMap:uv,cmdConfig:gv}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){this.event.setListener()},r.reset=function(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},r.emit=function(t){for(var r,n,i,o,a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return(r=this.event).beforeEmit.apply(r,Os(n=[t]).call(n,s)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,s))},r.createTeam=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a,s,c=this;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl({createTeamParams:hI},{createTeamParams:e},"",!0),Vl({inviteeAccountIds:dr(dr({},fI),{min:0,required:!1})},{inviteeAccountIds:t},"",!0),Vl({antispamConfig:MI},{antispamConfig:n},"",!0),o=2===e.teamType?"v2SuperTeamCreate":"v2TeamCreate",i.next=7,this.core.sendCmd(o,{team:e,inviteeAccountIds:t||[],postscript:r||"",antispamConfig:n});case 7:return a=i.sent,s=a.content.team,this.model.upsert(s),this.getTeamMemberListByIds(s.teamId,s.teamType,[this.core.account]).catch((function(e){c.core.logger.error("Get Member error after createTeam",e)})),this.emit("onTeamCreated",s),i.abrupt("return",{team:s,failedList:a.content.failedList});case 13:case"end":return i.stop()}}),i,this)})))},r.updateTeamInfo=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(_I,{updateTeamInfoParams:r},"",!0),Vl({antispamConfig:MI},{antispamConfig:n},"",!0),o=dr({teamId:e,teamType:t},r),a=2===t?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",i.next=9,this.core.sendCmd(a,{team:o,antispamConfig:n});case 9:this.model.upsert(o);case 10:case"end":return i.stop()}}),i,this)})))},r.leaveTeam=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),n=2===t?"v2SuperTeamLeave":"v2TeamLeave",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:this.model.deleteById(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getTeamInfo=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),n=2===t?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(i=this.model.getById(e,t,!1))){r.next=7;break}return r.abrupt("return",i);case 7:return r.next=9,this.core.sendCmd(n,{teamId:e});case 9:return o=r.sent,a=o.content.team,this.model.upsert(a),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getJoinedTeamList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(bI,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]),r=[],jn(e).call(e,(function(e){r=Os(r).call(r,n.model.getAll(e))})),t.abrupt("return",Dm(r).call(r,(function(e,t){return e.createTime-t.createTime})));case 7:case"end":return t.stop()}}),t,this)})))},r.getJoinedTeamCount=function(e){var t=this;this.checkV2(),Vl(bI,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var r=0;return jn(e).call(e,(function(e){r+=t.model.count(e)})),r},r.getTeamInfoByIds=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(TI,{teamIds:e},"",!0),Vl(SI,{teamType:t},"",!0),i=2===t?"v2SuperTeamGetByIds":"v2TeamGetByIds",o=lu(e).call(e,(function(e){return u.model.getById(e,t,!1)})),0!==(a=gu(e).call(e,(function(e,t){return!o[t]}))).length){r.next=8;break}return r.abrupt("return",o);case 8:return r.next=10,this.core.sendCmd(i,{teamIds:a});case 10:return s=r.sent,c=s.content.teams,r.abrupt("return",gu(n=lu(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=ch(c).call(c,(function(e){return e.teamId===n}));return i&&u.model.upsert(i),i}))).call(n,(function(e){return!!e})));case 13:case"end":return r.stop()}}),r,this)})))},r.dismissTeam=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),n=2===t?"v2SuperTeamDismiss":"v2TeamDismiss",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:case"end":return r.stop()}}),r,this)})))},r.inviteMember=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({inviteeAccountIds:fI},{inviteeAccountIds:r},"",!0),Vl({postscript:dr(dr({},vI),{required:!1})},{postscript:n},"",!0),o=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",i.next=8,this.core.sendCmd(o,{teamId:e,accounts:r,ps:n||""});case 8:return a=i.sent,i.abrupt("return",a.content.abortedAccidList);case 10:case"end":return i.stop()}}),i,this)})))},r.inviteMemberEx=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(CI,{inviteeParams:r},"",!0),i=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r.inviteeAccountIds,ps:r.postscript||"",attach:r.serverExtension});case 7:return o=n.sent,n.abrupt("return",o.content.abortedAccidList);case 9:case"end":return n.stop()}}),n,this)})))},r.acceptInvitation=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(AI,e,"invitationInfo",!0),Vl(NI,e,"invitationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:return a=t.sent,this.notification.updateTeamActionStatus(e,1),t.abrupt("return",a.content.team);case 13:throw t.prev=13,t.t0=t.catch(5),s=t.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 18:case"end":return t.stop()}}),t,this,[[5,13]])})))},r.rejectInvitation=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(AI,e,"invitationInfo",!0),Vl(NI,e,"invitationInfo",!0),Vl({postscript:dr(dr({},vI),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.kickMember=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({memberAccountIds:fI},{memberAccountIds:r},"",!0),i=2===t?"v2SuperTeamKickMembers":"v2TeamKickMembers",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:case"end":return n.stop()}}),n,this)})))},r.applyJoinTeam=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),i=2===t?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",n.next=6,this.core.sendCmd(i,{teamId:e,ps:r||""});case 6:return o=n.sent,a=o.content.team,s=o.content.isInTeam,a.isValidTeam=!!a.isValidTeam&&!!s,n.abrupt("return",a);case 11:case"end":return n.stop()}}),n,this)})))},r.acceptJoinApplication=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(AI,e,"applicationInfo",!0),Vl(OI,e,"applicationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:this.notification.updateTeamActionStatus(e,1),t.next=16;break;case 11:throw t.prev=11,t.t0=t.catch(5),a=t.t0,this.notification.checkIfExpired(a.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.rejectJoinApplication=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(AI,e,"applicationInfo",!0),Vl(OI,e,"applicationInfo",!0),Vl({postscript:dr(dr({},vI),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.updateTeamMemberRole=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({memberAccountIds:fI},{memberAccountIds:r},"",!0),Vl({memberRole:EI},{memberRole:n},"",!0),o=2===n?"AddManagers":"RemoveManagers",o=2===t?"v2SuperTeam"+o:"v2Team"+o,i.next=9,this.core.sendCmd(o,{teamId:e,accounts:Zh(r)});case 9:case"end":return i.stop()}}),i,this)})))},r.transferTeamOwner=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o,a;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({accountId:yI},{accountId:r},"",!0),Vl({leave:{type:"boolean",required:!1}},{leave:n},"",!0),!(o=this.model.getById(e,t))||o.ownerAccountId!==r){i.next=8;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Transfer to self is not allowed"}});case 8:return a=2===t?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",i.next=11,this.core.sendCmd(a,{teamId:e,account:r,leave:n||!1});case 11:case"end":return i.stop()}}),i,this)})))},r.updateSelfTeamMemberInfo=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(kI,{memberInfoParams:r},"",!0),void 0!==r.teamNick||void 0!==r.serverExtension){n.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o=dr(dr({},r),{teamId:e,accountId:this.core.account}),n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:return n.next=12,this.notification.updateTeamMemberRole(e,t,[this.core.account],o);case 12:a=this.memberModel.getById(e,t,this.core.account),this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name&&(s=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),c=this.core.V2NIMSettingService.getConversationMuteStatus(s),this.core.eventBus.emit("V2NIMSettingService/setMute",s,c)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",a);case 15:case"end":return n.stop()}}),n,this)})))},r.updateTeamMemberNick=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({accountId:yI},{accountId:r},"",!0),Vl({nick:vI},{nick:n},"",!0),r!==this.core.account){i.next=7;break}return i.abrupt("return",this.updateSelfTeamMemberInfo(e,t,{teamNick:n}));case 7:return o=2===t?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",i.next=10,this.core.sendCmd(o,{teamMember:{teamNick:n,teamId:e,accountId:r}});case 10:case"end":return i.stop()}}),i,this)})))},r.setTeamChatBannedMode=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(wI,{chatBannedMode:r},"",!0),i=2===t?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",n.next=7,this.core.sendCmd(i,{teamId:e,chatBannedMode:r});case 7:this.model.upsert({teamId:e,teamType:t,chatBannedMode:r});case 8:case"end":return n.stop()}}),n,this)})))},r.setTeamMemberChatBannedStatus=function(e,t,r,n){return Xl(this,void 0,void 0,zl.mark((function i(){var o;return zl.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({accountId:yI},{accountId:r},"",!0),Vl({chatBanned:gI},{chatBanned:n},"",!0),o=2===t?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",i.next=8,this.core.sendCmd(o,{teamId:e,accountId:2===t?[r]:r,chatBanned:n?1:0});case 8:case"end":return i.stop()}}),i,this)})))},r.getTeamMemberList=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(RI,{queryOption:r},"",!0),i=0===(i=void 0===r.direction?0:r.direction)?1:0,n.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:dr(dr({teamId:e,teamType:t,onlyChatBanned:!1,nextToken:"",limit:100},r),{direction:i})});case 8:return o=n.sent,a=o.content.datas,s=tm(o,"raw.r.0"),2===t&&s&&lu(s)&&(a=lu(s).call(s,(function(e){return Th(e,Ch(hv))}))),n.abrupt("return",{nextToken:o.content.pageInfo.nextToken||"",finished:!+o.content.pageInfo.hasMore,memberList:Iv(a,t)});case 13:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberListByIds=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c,u,d=this;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({accountIds:fI},{accountIds:r},"",!0),i=2===t?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",o=lu(r).call(r,(function(t){return e+"|"+t})),a=[],s=0;case 8:if(!(s<o.length)){n.next=18;break}return n.next=11,this.core.sendCmd(i,{tag:Yc(o).call(o,s,s+20)});case 11:c=n.sent,u=Iv(c.content.datas,t),a=Os(a).call(a,u),jn(u).call(u,(function(e){return d.memberModel.upsert(e)}));case 15:s+=20,n.next=8;break;case 18:return n.abrupt("return",a);case 19:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberInvitor=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl({accountIds:fI},{accountIds:r},"",!0),i=2===t?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:return o=n.sent,n.abrupt("return",o.content.accountsMap);case 9:case"end":return n.stop()}}),n,this)})))},r.searchTeamByKeyword=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.checkLogin(),Vl({keyword:yI},{keyword:e},"",!0),t.abrupt("return",this.model.searchTeamByKeyword(e));case 4:case"end":return t.stop()}}),t,this)})))},r.addTeamMembersFollow=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(LI,{teamId:e,teamType:t,accountIds:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=5,this.getTeamMemberListByIds(e,t,[this.core.account]);case 5:return o=n.sent,a=o[0],n.next=9,this.core.sendCmd(i,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:1}});case 9:s=n.sent,c=s.content.data,fr(c).length>0&&(dr(a,c),this.emit("onTeamMemberInfoUpdated",[a]),this.memberModel.upsert(a));case 12:case"end":return n.stop()}}),n,this)})))},r.removeTeamMembersFollow=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(LI,{teamId:e,teamType:t,accountIds:r},"",!0),n.next=4,this.getTeamMemberListByIds(e,t,[this.core.account]);case 4:return i=n.sent,o=i[0],a=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=9,this.core.sendCmd(a,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:0}});case 9:s=n.sent,c=s.content.data,fr(c).length>0&&(dr(o,c),this.emit("onTeamMemberInfoUpdated",[o]),this.memberModel.upsert(o));case 12:case"end":return n.stop()}}),n,this)})))},r.getTeamJoinActionInfoList=function(e){return this.checkV2(),Vl(PI,e,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),gs.resolve(this.notificationModel.getByOption(e))},r.clearAllTeamJoinActionInfo=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.reset();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteTeamJoinActionInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl(AI,e,"",!0),Vl(xI,e,"",!0),Vl({timestamp:{type:"number",min:1}},e,"",!0),this.notificationModel.delete(e);case 6:case"end":return t.stop()}}),t,this)})))},t}(af),jI="V2NIMUserService",HI={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},WI={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},YI={v2UpdateBlockList:{sid:34,cid:3,service:jI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:jI,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(WI)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:jI,params:[{type:"Property",name:"tag",reflectMapper:WI}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:jI,response:[{type:"Property",name:"data",reflectMapper:Ch(WI)}]},onUpdateBlockList:{sid:3,cid:103,service:jI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:jI,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:jI,response:[{type:"Property",name:"user",reflectMapper:Ch(WI)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:jI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:jI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}},KI=function(){function e(){this.muteList=new mM,this.userMap=new sd,this.blockList=[]}var t=e.prototype;return t.reset=function(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},t.setAccountMuteMode=function(e,t){1===t?this.muteList.add(e):this.muteList.delete(e)},t.setUser=function(e){this.userMap.set(e.accountId,e)},t.getUser=function(e){return this.userMap.get(e)},t.getUserListBySearchOption=function(e){var t,r;return gu(t=Gl(Tu(r=this.userMap).call(r))).call(t,(function(t){var r,n,i;return!(void 0!==e.searchName&&!e.searchName||!au(r=t.name).call(r,e.keyword))||!(!e.searchAccountId||!au(n=t.accountId).call(n,e.keyword))||!!(t.mobile&&e.searchMobile&&au(i=t.mobile).call(i,e.keyword))}))},t.addToBlockList=function(e){var t=this;jn(e).call(e,(function(e){var r;au(r=t.blockList).call(r,e)||t.blockList.push(e)}))},t.removeFromBlockList=function(e){var t=this;jn(e).call(e,(function(e){var r,n,i=wu(r=t.blockList).call(r,e);-1!==i&&li(n=t.blockList).call(n,i,1)}))},e}(),QI={type:"string",required:!0,allowEmpty:!1},$I={type:"string",required:!1,allowEmpty:!0},zI={name:{type:"string",required:!1,allowEmpty:!0},avatar:$I,sign:$I,email:$I,birthday:$I,mobile:$I,gender:{type:"number",required:!1},serverExtension:$I};function JI(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return XI(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?XI(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function XI(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ZI=function(e){function t(t){var r;return r=e.call(this,"V2NIMUserService",t)||this,Sh({cmdMap:HI,cmdConfig:YI}),r.model=new KI,"v2"!==r.core.options.apiVersion?ut(r):(r.setListener(),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e=this;this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(function(t,r){r?e.model.addToBlockList([t]):e.model.removeFromBlockList([t]),r?e.emitBlockListAdded(t):e.emit("onBlockListRemoved",t)})),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",(function(t){e.updateUserProfileInMemory(t)}))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onUserProfileChanged"===t){var c=a[0];this.logger.log(""+i,lu(c).call(c,(function(e){return"id:"+e.accountId+";name:"+e.name+";updateTime:"+e.updateTime})))}else if("onBlockListAdded"===t){var u=a[0];this.logger.log(""+i,"id:"+u.accountId+";name:"+u.name+";updateTime:"+u.updateTime)}else{var d,l;(d=this.logger).log.apply(d,Os(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},r.getUserList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this._getUserList(e));case 2:case"end":return t.stop()}}),t,this)})))},r._getUserList=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({accountIds:fI},{accountIds:e},"",!0),n=[],jn(e).call(e,(function(e){s.model.getUser(e)||n.push(e)})),i=null,!(n.length>0)){r.next=8;break}return r.next=7,this.core.sendCmd("v2GetUserList",{accountIds:n});case 7:i=r.sent;case 8:return o=(null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.data)||[],jn(o).call(o,(function(e){s.model.setUser(e)})),a=[],jn(e).call(e,(function(e){var t=s.model.getUser(e);t&&a.push(t)})),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getUserListFromCloud=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:e},"",!0),t.next=4,this.core.sendCmd("v2GetUserList",{accountIds:e});case 4:return r=t.sent,n=r.content.data||[],i=[],jn(n).call(n,(function(e){var t=a.model.getUser(e.accountId);a.compareUserForUpdate(t,e)&&i.push(e),a.model.setUser(e)})),o=Tl(e).call(e,(function(e,t){var r=a.model.getUser(t);return r&&e.push(r),e}),[]),i.length>0&&this.emit("onUserProfileChanged",i),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)})))},r.compareUserForUpdate=function(e,t){return!e||!("number"==typeof e.updateTime&&"number"==typeof t.updateTime&&e.updateTime>=t.updateTime)},r.updateSelfUserProfile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(zI,e,"",!0),t.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:dr(dr({},e),{accountId:this.core.account})});case 4:return r=t.sent,t.next=7,this.updateUserProfileInMemory(dr(dr({},e),{updateTime:r.content.updateTime}));case 7:case"end":return t.stop()}}),t,this)})))},r.addUserToBlockList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return Vl({accountId:QI},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!0});case 6:this.model.addToBlockList([e]),this.emitBlockListAdded(e);case 8:case"end":return t.stop()}}),t,this)})))},r.removeUserFromBlockList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return Vl({accountId:QI},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!1});case 6:this.model.removeFromBlockList([e]),this.emit("onBlockListRemoved",e);case 8:case"end":return t.stop()}}),t,this)})))},r.searchUserByOption=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},e,"",!0),!1!==(void 0===e.searchName||e.searchName)||e.searchAccountId||e.searchMobile){t.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return t.abrupt("return",this.model.getUserListBySearchOption(e));case 7:case"end":return t.stop()}}),t,this)})))},r.getBlockList=function(){return this.checkV2(),gs.resolve(this.model.blockList)},r.updateUserProfileInMemory=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this.model.getUser(this.core.account))){t.next=6;break}dr(r,e),this.model.setUser(r),t.next=10;break;case 6:return t.next=8,this._getUserList([this.core.account]);case 8:n=t.sent,r=n[0];case 10:r&&this.emit("onUserProfileChanged",[r]);case 11:case"end":return t.stop()}}),t,this)})))},r.onUpdateUserProfileHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.content.data,t.next=3,this.updateUserProfileInMemory(r);case 3:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlockListHandler=function(e){var t=e.content.accountId;e.content.addToBlockList?(this.model.addToBlockList([t]),this.emitBlockListAdded(t)):(this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t))},r.syncBlockAndMuteListHandler=function(e){var t=this,r=e.content.data;jn(r).call(r,(function(e){e.isBlock?t.model.addToBlockList([e.accountId]):t.model.setAccountMuteMode(e.accountId,e.isMute?1:0)}))},r.v2SyncSelfUserInfoHandler=function(e){var t=e.content.user;this.model.setUser(t)},r.checkUserUpdate=function(e,t){var r=e.senderId;r!==this.core.account&&this.refreshUserInfo(r,t)},r.refreshUserInfo=function(e,t){return void 0===t&&(t=0),Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&"string"==typeof e){r.next=2;break}return r.abrupt("return");case 2:if(n=this.model.getUser(e),i=[],!(!n||n&&"number"==typeof n.updateTime&&"number"==typeof t&&!isNaN(n.updateTime)&&!isNaN(t)&&n.updateTime<t)){r.next=16;break}return r.prev=5,r.next=8,this.core.sendCmd("v2GetUserList",{accountIds:[e]});case 8:o=r.sent,i=o.content.data,r.next=16;break;case 12:return r.prev=12,r.t0=r.catch(5),this.logger.warn("V2NIMUserService:refreshUserInfo: failed for "+e),r.abrupt("return");case 16:for(a=JI(i);!(s=a()).done;)c=s.value,this.model.setUser(c),this.emit("onUserProfileChanged",[c]);case 17:case"end":return r.stop()}}),r,this,[[5,12]])})))},r.emitBlockListAdded=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getUserList([e]);case 2:1===(r=t.sent).length&&this.emit("onBlockListAdded",r[0]);case 4:case"end":return t.stop()}}),t,this)})))},r.v2OnUpdateMuteListHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.content,n=r.accountId,i=r.mute,o=i?1:0,this.core.eventBus.emit("v2NIMUserService/updateMuteList",n,o);case 3:case"end":return t.stop()}}),t,this)})))},t}(af),eT="V2NIMFriendService",tT={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},rT={accountId:4,relationShip:{id:5,retType:"number"},source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},nT={v2AddFriend:{sid:35,cid:1,service:eT,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:eT,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:_h}}}]},v2SetFriendInfo:{sid:35,cid:3,service:eT,params:[{type:"Property",name:"tag",reflectMapper:rT}]},v2OnAddFriend:{sid:12,cid:101,service:eT,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:Ch({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:eT,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:eT,response:[{type:"Property",name:"data",reflectMapper:Ch(rT)}]},v2SyncFriendList:{sid:12,cid:5,service:eT,response:[{type:"PropertyArray",name:"friends",reflectMapper:Ch(rT)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:eT,response:[{type:"PropertyArray",name:"users",reflectMapper:Ch(WI)}]},v2IncFriendInfo:{sid:35,cid:4,service:eT,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Ch(rT)},{type:"Long",name:"timetag"}]}},iT={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:[1,2]},postscript:{type:"string",required:!1,allowEmpty:!0}}}},oT={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},aT={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},sT={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!1,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:[1,4,3,0,2]},timestamp:{type:"number",min:1}},cT={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:[1,4,3,0,2]}},uT=function(){function e(e,t){this.core=e,this.service=t}return e.prototype.processSysNotification=function(e){if(6===e.type){var t=e.senderId;this.core.V2NIMFriendService.handleDeleteFriend(t,2)}else if(5===e.type)try{var r=JSON.parse(e.content);if(1===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var n={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:4,read:!0};this.service.model.appendFriendAddApplication(n),this.service.model.updateFriendAddApplicationStatus(n.applicantAccountId,4,n.applicantAccountId)}else if(2===(null==r?void 0:r.vt)){var i={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:0,read:!1};this.service.handleApplyFriend(i),this.service.model.appendFriendAddApplication(i)}else if(3===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var o={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:1,read:!0};this.service.model.appendFriendAddApplication(o)}else if(4===(null==r?void 0:r.vt)){var a={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:2,read:!0};this.service.model.appendFriendAddApplication(a),this.service.emit("onFriendAddRejected",a)}}catch(e){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",e)}},e}();function dT(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return lT(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lT(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function lT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var pT=function(){function e(){this.validFriendIds=new mM,this.friendMap=new sd,this.applicationInfoList=[],this.friendTimetag=0}var t=e.prototype;return t.getAddApplicationList=function(e){var t,r,n=void 0===e.offset?0:e.offset,i=qc(t=gu(r=this.applicationInfoList).call(r,(function(t){var r=e.status||[];return 0===r.length||!!au(r).call(r,t.status)}))).call(t),o=e.limit||50,a=Yc(i).call(i,n,n+o),s=n+o>=i.length;return{infos:a,finished:s,offset:s?0:n+o}},t.reset=function(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},t.setAddApplicationRead=function(){for(var e,t=dT(this.applicationInfoList);!(e=t()).done;)e.value.read=!0},t.getAddApplicationUnreadCount=function(){for(var e,t=new mM,r=dT(this.applicationInfoList);!(e=r()).done;){var n=e.value;n.read||0!==n.status||t.add(n.applicantAccountId)}return t.size},t.appendFriendAddApplication=function(e){this.applicationInfoList.push(e)},t.clearApplicationList=function(){this.applicationInfoList=[]},t.deleteApplication=function(e){var t,r;this.applicationInfoList=gu(t=lu(r=this.applicationInfoList).call(r,(function(t){if(t.applicantAccountId!==e.applicantAccountId||t.recipientAccountId!==e.recipientAccountId||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.updateFriendAddApplicationStatus=function(e,t,r){if(0!==t)for(var n,i=dT(this.applicationInfoList);!(n=i()).done;){var o=n.value;o.applicantAccountId===e&&0===o.status&&(o.status=t,o.operatorAccountId=r,o.read=!0)}},t.upsertFriend=function(e,t){delete t.relationShip;var r=this.friendMap.get(e)||{},n=dr({accountId:e},r,t);return this.friendMap.set(e,n),this.validFriendIds.add(e),n},t.addFriend=function(e){this.validFriendIds.add(e)},t.deleteFriend=function(e){this.validFriendIds.delete(e)},t.getFriend=function(e){return this.validFriendIds.has(e)?this.friendMap.get(e):void 0},t.getFriendList=function(){var e,t,r,n=this;return gu(e=lu(t=Gl(Tu(r=this.validFriendIds).call(r))).call(t,(function(e){return n.getFriend(e)}))).call(e,(function(e){return!!e}))},t.getFriendListBySearchOption=function(e){var t,r,n,i=this;return gu(t=lu(r=Gl(Tu(n=this.validFriendIds).call(n))).call(r,(function(e){return i.getFriend(e)}))).call(t,(function(t){var r,n,i=void 0===e.searchAlias||e.searchAlias;return void 0!==t&&(!!(i&&t.alias&&au(r=t.alias).call(r,e.keyword))||!(!e.searchAccountId||!au(n=t.accountId).call(n,e.keyword)))}))},t.getFriendByIds=function(e){var t,r=this;return gu(t=lu(e).call(e,(function(e){return r.getFriend(e)}))).call(t,(function(e){return!!e}))},t.setFriendTimetag=function(e){this.friendTimetag=e},t.getFriendTimetag=function(){return this.friendTimetag},e}(),mT=function(e){function t(t){var r;return(r=e.call(this,"V2NIMFriendService",t)||this).notification=new uT(r.core,ut(r)),r.model=new pT,r.core._registerDep(ZI,"V2NIMUserService"),"v2"!==r.core.options.apiVersion?ut(r):(Sh({cmdMap:tT,cmdConfig:nT}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e,t,r,n,i,o;this.core.eventBus.on("V2NIMFriendService/sysNotification",tr(e=this.notification.processSysNotification).call(e,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",tr(t=this.handleAddFriend).call(t,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",tr(r=this.handleDeleteFriend).call(r,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",tr(n=this.handleSetFriendInfo).call(n,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",tr(i=this.handlePassFriendApply).call(i,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",tr(o=this.handleRejectFriendApply).call(o,this))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onFriendAdded"===t||"onFriendInfoChanged"===t){var c=a[0];this.logger.log(""+i,c.accountId+";updateTime:"+c.updateTime)}else{var u,d;(u=this.logger).log.apply(u,Os(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},r.addFriend=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return Vl(iT,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2AddFriend",{accountId:e,verifyType:t.addMode,postscript:t.postscript||""});case 6:if(1!==t.addMode){r.next=9;break}return r.next=9,this.handleAddFriend(e);case 9:case"end":return r.stop()}}),r,this)})))},r.deleteFriend=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return Vl(oT,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:e,params:t});case 6:t.deleteAlias&&this.model.upsertFriend(e,{alias:""}),this.handleDeleteFriend(e);case 8:case"end":return r.stop()}}),r,this)})))},r.acceptAddApplication=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(sT,e,"",!0),t.prev=2,t.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:3,postscript:""});case 5:this.handlePassFriendApply(e.applicantAccountId),t.next=12;break;case 8:throw t.prev=8,t.t0=t.catch(2),this.handlePassFriendApply(e.applicantAccountId,t.t0),t.t0;case 12:case"end":return t.stop()}}),t,this,[[2,8]])})))},r.rejectAddApplication=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(sT,e,"",!0),r.prev=2,r.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:4,postscript:t||""});case 5:this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:2}),r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(2),this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:3},r.t0),r.t0;case 12:case"end":return r.stop()}}),r,this,[[2,8]])})))},r.setFriendInfo=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(aT,{accountId:e,params:t},"",!0),e!==this.core.account){r.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:dr({accountId:e},t)});case 6:this.handleSetFriendInfo(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getFriendList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.computedFields(this.model.getFriendList()));case 3:case"end":return e.stop()}}),e,this)})))},r.getFriendByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),t.abrupt("return",this.computedFields(this.model.getFriendByIds(e)));case 4:case"end":return t.stop()}}),t,this)})))},r.checkFriend=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),r={},jn(e).call(e,(function(e){r[e]=!!n.model.getFriend(e)})),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})))},r.getAddApplicationList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl(cT,e,"",!0),t.abrupt("return",this.model.getAddApplicationList(e));case 4:case"end":return t.stop()}}),t,this)})))},r.setAddApplicationRead=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return e.stop()}}),e,this)})))},r.getAddApplicationUnreadCount=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.model.getAddApplicationUnreadCount());case 3:case"end":return e.stop()}}),e,this)})))},r.clearAllAddApplication=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.clearApplicationList();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteAddApplication=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl(sT,e,"",!0),e.applicantAccountId===this.core.account||e.recipientAccountId===this.core.account){t.next=5;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"The applicant and recipient are not youself"}});case 5:this.model.deleteApplication(e);case 6:case"end":return t.stop()}}),t,this)})))},r.searchFriendByOption=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Vl({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},e,"",!0),void 0===e.searchAlias||e.searchAlias||e.searchAccountId){t.next=6;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return t.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(e)));case 7:case"end":return t.stop()}}),t,this)})))},r.v2OnAddFriendHandler=function(e){var t=e.content,r=t.accountId,n=t.verifyType,i=t.postscript;if(1===n)this.handleAddFriend(r);else if(2===n){var o={applicantAccountId:this.core.account,recipientAccountId:r,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:0,read:!1};this.handleApplyFriend(o)}else if(3===n)this.handlePassFriendApply(r);else if(4===n){var a={applicantAccountId:r,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:2,read:!0};this.handleRejectFriendApply(a)}},r.v2OnDeleteFriendHandler=function(e){var t=e.content.accountId;this.handleDeleteFriend(t)},r.v2OnUpdateFriendInfoHandler=function(e){var t=e.content.data,r=this.model.upsertFriend(t.accountId,t);this.emit("onFriendInfoChanged",this.computedField(r))},r.v2SyncFriendListHandler=function(e){var t=this,r=e.content,n=r.friends,i=r.timetag;this.model.setFriendTimetag(i),jn(n).call(n,(function(e){e.serverExtension||(e.serverExtension=""),e.customerExtension||(e.customerExtension=""),0===e.relationShip?t.model.deleteFriend(e.accountId):t.model.upsertFriend(e.accountId,e)}))},r.v2SyncFriendUserListHandler=function(e){var t=this,r=e.content.users;this.hasUserService&&jn(r).call(r,(function(e){t.core.V2NIMUserService.model.setUser(e)}))},r.handleApplyFriend=function(e){this.emit("onFriendAddApplication",e)},r.handleAddFriend=function(e,t){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.model.addFriend(e),t.next=3,this.incrementSyncFriend();case 3:return t.next=5,this.core.V2NIMUserService.refreshUserInfo(e);case 5:(r=this.model.getFriend(e))&&this.emit("onFriendAdded",this.computedField(r));case 7:case"end":return t.stop()}}),t,this)})))},r.handleDeleteFriend=function(e,t){t=void 0===t?1:t,this.emit("onFriendDeleted",e,t),this.model.deleteFriend(e)},r.handleSetFriendInfo=function(e,t){var r=this.model.upsertFriend(e,t);this.emit("onFriendInfoChanged",this.computedField(r))},r.handlePassFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===Cl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r||r===Cl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e,1,this.core.account),this.handleAddFriend(e);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e,3,this.core.account)}},r.handleRejectFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===Cl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r)this.emit("onFriendAddRejected",e),this.model.updateFriendAddApplicationStatus(e.applicantAccountId,2,this.core.account);else if(r===Cl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e.applicantAccountId,1,this.core.account);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e.applicantAccountId,3,this.core.account)}},r.incrementSyncFriend=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o=this;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:t=e.sent,r=t.content,n=r.friends,i=r.timetag,this.model.setFriendTimetag(i),jn(n).call(n,(function(e){o.model.upsertFriend(e.accountId,e)}));case 6:case"end":return e.stop()}}),e,this)})))},r.computedFields=function(e){var t=this;return lu(e).call(e,(function(e){return t.computedField(e)}))},r.computedField=function(e){var t,r,n=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(e.accountId);return n?dr({},e,{userProfile:n}):e},ct(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}}]),t}(af),hT={muteMode:{type:"enum",values:[2,0,1]}},fT={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:[2,0,1]}},gT={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},vT={config:{type:"object",required:!0,rules:{apns:gT,hwPush:gT,miPush:gT,vivoPush:gT,oppoPush:gT,honorPush:gT,fcmPush:gT,mzPush:gT}}},yT="V2NIMSettingService",MT={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},IT={v2SetDeviceToken:{sid:34,cid:1,service:yT,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:yT,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:yT,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function(e){return e?2:1}}}}]}},TT=TT||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),void 0!==Gs&&Gs.crypto&&(t=Gs.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&"undefined"!=typeof r.g&&r.g.crypto&&(t=r.g.crypto);var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Bt||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},a=o.lib={},s=a.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e,t=s.clone.call(this);return t.words=Yc(e=this.words).call(e,0),t},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),u=o.enc={},d=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=em(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},l=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},m=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){var t;"string"==typeof e&&(e=p.parse(e)),Os(t=this._data).call(t,e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,d=e.min(4*u,o);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(i,l);r=li(i).call(i,0,u),n.sigBytes-=d}return new c.init(r,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=m.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=o.algo={};return o}(Math),ST=TT.enc.Utf8,bT=TT,CT=bT.lib,_T=CT.Base,ET=CT.WordArray,kT=bT.algo,wT=kT.MD5,RT=kT.EvpKDF=_T.extend({cfg:_T.extend({keySize:4,hasher:wT,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=ET.create(),a=o.words,s=n.keySize,c=n.iterations;a.length<s;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var u=1;u<c;u++)r=i.finalize(r),i.reset();Os(o).call(o,r)}return o.sigBytes=4*s,o}});bT.EvpKDF=function(e,t,r){return RT.create(r).compute(e,t)},TT.EvpKDF;var AT=TT,xT=AT.lib.WordArray;AT.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var a=wu(e).call(e,o);-1!==a&&(t=a)}return function(e,t,r){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var a=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=a<<24-i%4*8,i++}return xT.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},TT.enc.Base64,function(e){e.lib.Cipher||function(){var t=e,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var s=a.Base64,c=t.algo.EvpKDF,u=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:g}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},l=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=d.CBC=function(){var e=l.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=Yc(e).call(e,r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=Yc(e).call(e,r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),m=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var c=i.create(a,n);Os(e).call(e,c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:p,padding:m}),reset:function(){var e;u.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var h=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t,r,n,o=e.ciphertext,a=e.salt;return t=a?Os(r=Os(n=i.create([1398893684,1701076831])).call(n,a)).call(r,o):o,t.toString(s)},parse:function(e){var t,r=s.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(Yc(n).call(n,2,4)),li(n).call(n,0,4),r.sigBytes-=16),h.create({ciphertext:r,salt:t})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:f}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return h.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){var o;n||(n=i.random(8));var a=c.create({keySize:t+r}).compute(e,n),s=i.create(Yc(o=a.words).call(o,t),4*r);return a.sigBytes=4*t,h.create({key:a,iv:s,salt:n})}},y=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:v}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,g.decrypt.call(this,e,t,i.key,n)}})}()}(TT);var NT=TT,OT=NT.lib.StreamCipher,PT=NT.algo,LT=PT.RC4=OT.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var a=i%r,s=t[a>>>2]>>>24-a%4*8&255;o=(o+n[i]+s)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=VT.call(this)},keySize:8,ivSize:0});function VT(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}NT.RC4=OT._createHelper(LT);var UT=PT.RC4Drop=LT.extend({cfg:LT.cfg.extend({drop:192}),_doReset:function(){LT._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)VT.call(this)}});NT.RC4Drop=OT._createHelper(UT);var DT=TT.RC4,qT=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSettingService",t)||this).offlinePushPlugin=void 0,r.offlinePushConfig=void 0,r.authConfig=void 0,r.aosPushInfo=void 0,r.appBackgroundOptions={badge:0,isBackground:!1},r.p2pMessageMuteModeChangeHandler=function(e,t){r.emit("onP2PMessageMuteModeChanged",e,t),r.hasUserService&&r.core.V2NIMUserService.model.setAccountMuteMode(e,t);var n=r.core.V2NIMConversationIdUtil.p2pConversationId(e),i=1===t;r.core.eventBus.emit("V2NIMSettingService/setMute",n,i)},r.setTokenAndBackgroundStateAfterLogin=function(e){r.aosPushInfo=e,r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),r.offlinePushPlugin&&(r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",e&&e.pushType),r.regToken(),r.core.sendCmd("v2SetAppBackground",{isBackground:r.appBackgroundOptions.isBackground,badge:r.appBackgroundOptions.badge||0}))},r.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==r.core.options.apiVersion?ut(r):(r.setListener(),Sh({cmdMap:MT,cmdConfig:IT}),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMSettingService/updateBits",(function(t,r,n){e.emit("onTeamMessageMuteModeChanged",t,r,n)})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Os(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,c))},r.getConversationMuteStatus=function(e){if("string"!=typeof e)return!1;var t=this.core.V2NIMConversationIdUtil.parseConversationType(e),r=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return 3===t?0!==this.getTeamMessageMuteMode(r,2):2===t?0!==this.getTeamMessageMuteMode(r,1):!(1!==t||!this.hasUserService)&&!!this.core.V2NIMUserService.model.muteList.has(r)},r.setTeamMessageMuteMode=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.hasTeamService){n.next=2;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"setTeamMessageMuteMode: no team service"}});case 2:return this.checkV2(),Vl(II,{teamId:e},"",!0),Vl(SI,{teamType:t},"",!0),Vl(hT,{muteMode:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o={teamId:e,teamType:t,accountId:this.core.account,bits:r},n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:this.core.V2NIMTeamService.memberModel.upsert(o),this.emit("onTeamMessageMuteModeChanged",e,t,r),a=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),s=this.getConversationMuteStatus(a),this.core.eventBus.emit("V2NIMSettingService/setMute",a,s);case 15:case"end":return n.stop()}}),n,this)})))},r.getTeamMessageMuteMode=function(e,t){var r;return"string"!=typeof e||"number"!=typeof t?0:this.hasTeamService?3&((null===(r=this.core.V2NIMTeamService.memberModel.getById(e,t,this.core.account))||void 0===r?void 0:r.bits)||0):0},r.setP2PMessageMuteMode=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(fT,{accountId:e,muteMode:t},"",!0),e!==this.core.account){r.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return r.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:e,muteMode:1===t});case 6:this.p2pMessageMuteModeChangeHandler(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getP2PMessageMuteMode=function(e){return Vl({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:e},"",!0),this.hasUserService&&this.core.V2NIMUserService.model.muteList.has(e)?1:0},r.getRNDeviceInfo=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("OfflinePushService:getDeviceInfo start"),null===(e=this.offlinePushPlugin)||void 0===e||e.init(Ei(this.authConfig),(function(e,t,n){if(r.logger.log("OfflinePushService:: type: "+e+", tokenName: "+t+", token: "+n),n){var i="",o=tp.getSystemInfo()||{},a=o.os?o.os.toLowerCase():"";r.aosPushInfo&&r.aosPushInfo.pushType?i=r.aosPushInfo.pushType:"ios"===a?i="":"android"===a&&(i="8"),r.pushTokenToServer(i,n)}else r.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})),t.abrupt("return",new gs((function(e,t){var n;null===(n=r.offlinePushPlugin)||void 0===n||n.getDeviceInfo((function(n){try{r.logger.log("OfflinePushService:getDeviceInfo result "+(n?Ei(n):"")),e(JSON.parse(n))}catch(e){t(new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo error"}}))}})),Bs((function(){t(new kl({code:Cl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo timeout"}}))}),2e3)})));case 3:case"end":return t.stop()}}),t,this)})))},r.getP2PMessageMuteList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasUserService){e.next=4;break}return e.abrupt("return",gs.resolve(Gl(this.core.V2NIMUserService.model.muteList)));case 4:return e.abrupt("return",gs.resolve([]));case 5:case"end":return e.stop()}}),e,this)})))},r.setAppBackground=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:e,badge:t},"",!0),this.appBackgroundOptions={isBackground:e,badge:t||0},r.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:e,badge:t||0});case 5:case"end":return r.stop()}}),r,this)})))},r.setPushMobileOnDesktopOnline=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl({need:{type:"boolean",required:!1}},{need:e},"",!0),e=void 0===e||e,t.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:e}});case 5:case"end":return t.stop()}}),t,this)})))},r.setOfflinePushConfig=function(e,t){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,M,I,T,S,b,C,_,E,k,w,R,A,x,N,O,P,L,V,U;Vl(vT,{config:t},"",!0),this.logger.log("setOfflinePushConfig","plugin",e,"config",t),this.offlinePushPlugin=e,this.offlinePushConfig=t,this.authConfig={xmAppId:null===(n=null===(r=this.offlinePushConfig)||void 0===r?void 0:r.miPush)||void 0===n?void 0:n.appId,xmAppKey:null===(o=null===(i=this.offlinePushConfig)||void 0===i?void 0:i.miPush)||void 0===o?void 0:o.appKey,xmCertificateName:null===(s=null===(a=this.offlinePushConfig)||void 0===a?void 0:a.miPush)||void 0===s?void 0:s.certificateName,hwAppId:null===(u=null===(c=this.offlinePushConfig)||void 0===c?void 0:c.hwPush)||void 0===u?void 0:u.appId,hwCertificateName:null===(l=null===(d=this.offlinePushConfig)||void 0===d?void 0:d.hwPush)||void 0===l?void 0:l.certificateName,oppoAppId:null===(m=null===(p=this.offlinePushConfig)||void 0===p?void 0:p.oppoPush)||void 0===m?void 0:m.appId,oppoAppKey:null===(f=null===(h=this.offlinePushConfig)||void 0===h?void 0:h.oppoPush)||void 0===f?void 0:f.appKey,oppoAppSecret:null===(v=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.oppoPush)||void 0===v?void 0:v.secret,oppoCertificateName:null===(M=null===(y=this.offlinePushConfig)||void 0===y?void 0:y.oppoPush)||void 0===M?void 0:M.certificateName,vivoAppId:null===(T=null===(I=this.offlinePushConfig)||void 0===I?void 0:I.vivoPush)||void 0===T?void 0:T.appId,vivoAppKey:null===(b=null===(S=this.offlinePushConfig)||void 0===S?void 0:S.vivoPush)||void 0===b?void 0:b.appKey,vivoCertificateName:null===(_=null===(C=this.offlinePushConfig)||void 0===C?void 0:C.vivoPush)||void 0===_?void 0:_.certificateName,fcmCertificateName:null===(k=null===(E=this.offlinePushConfig)||void 0===E?void 0:E.fcmPush)||void 0===k?void 0:k.certificateName,mzAppId:null===(R=null===(w=this.offlinePushConfig)||void 0===w?void 0:w.mzPush)||void 0===R?void 0:R.appId,mzAppKey:null===(x=null===(A=this.offlinePushConfig)||void 0===A?void 0:A.mzPush)||void 0===x?void 0:x.appKey,mzCertificateName:null===(O=null===(N=this.offlinePushConfig)||void 0===N?void 0:N.mzPush)||void 0===O?void 0:O.certificateName,apnsCertificateName:null===(L=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.apns)||void 0===L?void 0:L.certificateName,honorCertificateName:null===(U=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.honorPush)||void 0===U?void 0:U.certificateName}},r.regToken=function(){var e=this,t=tp.getSystemInfo()||{},r=t.os?t.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",r),"ios"===r||"android"===r)if(!this.offlinePushPlugin||"UNIAPP"===tp.platform&&"function"!=typeof this.offlinePushPlugin.getDeviceToken||"React Native"===tp.platform&&"android"===r&&"function"!=typeof this.offlinePushPlugin.init||"React Native"===tp.platform&&"ios"===r&&"function"!=typeof this.offlinePushPlugin.checkPermissions)this.logger.warn("OfflinePushService: plugin is not correct, please check your plugin according to Yunxin Official Documentation");else{var n;"React Native"===tp.platform&&tp.envPayload.AppState&&tp.envPayload.AppState.addEventListener("change",tr(n=this.handleRNAppStateChange).call(n,this));var i="";this.aosPushInfo&&this.aosPushInfo.pushType?i=this.aosPushInfo.pushType:"ios"===r?i="":"android"===r&&(i="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+i),this.logger.log("OfflinePushService push config",Ei(this.authConfig,null,2),"platform",tp.platform),"UNIAPP"===tp.platform?this.offlinePushPlugin.getDeviceToken({suggestPushType:i,config:this.authConfig},(function(t){t?(e.logger.log("OfflinePushService:: token is :"+t),e.pushTokenToServer(i,t)):e.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})):"React Native"===tp.platform&&"android"===r?(this.logger.log("OfflinePushService:: onLogin",this.core.account,typeof i,i),this.offlinePushPlugin.onLogin(this.core.account,em(i),!1,"")):"React Native"===tp.platform&&"ios"===r?this.offlinePushPlugin.checkPermissions((function(){e.logger.log("OfflinePushService addEventListener requestPermissions");try{e.offlinePushPlugin.requestPermissions()}catch(t){e.logger.log("OfflinePushService:: requestPermissions error",t)}e.offlinePushPlugin.addEventListener("register",(function(t){e.logger.log("OfflinePushService:: ios token: "+t),e.pushTokenToServer(i,t)})),e.offlinePushPlugin.addEventListener("registrationError",(function(t){e.logger.log("OfflinePushService:: ios registerError",t)}))})):this.logger.error("OfflinePushService:: platform is not supported. Please check your parameters. Platform: "+tp.platform+". os: "+r)}else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},r.pushTokenToServer=function(e,t){var r,n,i,o,a,s,c,u,d="",l=this.offlinePushConfig;switch(e){case"5":d=null===(r=null==l?void 0:l.miPush)||void 0===r?void 0:r.certificateName;break;case"6":d=null===(n=null==l?void 0:l.hwPush)||void 0===n?void 0:n.certificateName;break;case"7":d=null===(i=null==l?void 0:l.mzPush)||void 0===i?void 0:i.certificateName;break;case"8":d=null===(o=null==l?void 0:l.fcmPush)||void 0===o?void 0:o.certificateName;break;case"9":d=null===(a=null==l?void 0:l.vivoPush)||void 0===a?void 0:a.certificateName;break;case"10":d=null===(s=null==l?void 0:l.oppoPush)||void 0===s?void 0:s.certificateName;break;case"11":d=null===(c=null==l?void 0:l.honorPush)||void 0===c?void 0:c.certificateName;break;default:d=null===(u=null==l?void 0:l.apns)||void 0===u?void 0:u.certificateName}if(""===d||void 0===d)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e);else try{if("UNIAPP"===tp.platform){var p=ST.parse("557d1e3cafa43e2589a588270c53d56f"),m=ST.stringify(DT.decrypt(t,p));this.logger.log("OfflinePushService:: token",m),this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:m,pushkit:0})}else this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:t,pushkit:0})}catch(e){return this.logger.log("OfflinePushService:: decrypt error",e),void this.logger.warn("OfflinePushService:: token before decrypt",t)}},r.handleRNAppStateChange=function(e){this.logger.log("push::handleAppStateChange: pushConfig ios/aos; state: "+e),this.appBackgroundOptions={badge:this.core.V2NIMConversationService.getTotalUnreadCount(),isBackground:"background"===e||"inactive"===e},this.setAppBackground(this.appBackgroundOptions.isBackground,this.appBackgroundOptions.badge)},ct(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}}]),t}(af);nt({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var BT,FT=B.Number.isNaN,GT=gf({none:0,normal:1,all:3}),jT={normal:0,advanced:1},HT=gf(jT),WT=gf({normal:0,owner:1,manager:2}),YT={noVerify:0,needVerify:1,rejectAll:2},KT=gf(YT),QT={needVerify:0,noVerify:1},$T=gf(QT),zT={manager:0,all:1},JT=gf(zT),XT={manager:0,all:1},ZT=gf(XT),eS={manager:0,all:1},tS=gf(eS);function rS(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:HT,muteType:GT,joinMode:KT,beInviteMode:$T,inviteMode:JT,updateTeamMode:ZT,updateExtMode:tS};e.bits;var a=Jl(e,["bits"]);return jn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),jn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=em(a[e]))})),jn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===em(a[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function nS(e){return e&&e.length>0?lu(e).call(e,(function(e){return rS(e)})):[]}function iS(e){var t,r=dr({},e),n=["avatar","name","intro","announcement","ext"],i={type:jT,joinMode:YT,beInviteMode:QT,inviteMode:zT,updateTeamMode:XT,updateExtMode:eS};return jn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),jn(t=fr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function oS(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=em(e.bitConfigMask)),jn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function aS(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:WT},a=e.bits,s=Jl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===em(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,jn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),jn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=em(s[e]))})),jn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===em(s[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function sS(e){return e&&e.length>0?lu(e).call(e,(function(e){return aS(e)})):[]}function cS(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function uS(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?lu(t).call(t,(function(t){return cS(e,t,r)})):[]}function dS(e){var t=dr({},e);return t.createTime&&(t.createTime=+t.createTime),t.updateTime&&(t.updateTime=+t.updateTime),t.gender&&(t.gender=BT[+t.gender]),t}!function(e){e[e.unknown=0]="unknown",e[e.male=1]="male",e[e.female=2]="female"}(BT||(BT={}));var lS={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},pS={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},mS=bh(pS),hS={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:mS.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:mS.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:pS.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:mS.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:pS.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:mS.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:pS.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:mS.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:pS.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:mS.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:mS.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:pS.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:mS.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:mS.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:mS.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:mS.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:pS.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:pS.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:mS.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:mS.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:mS.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:mS.teamMember},{type:"Long",name:"timetag"}]}},fS={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},gS={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},vS=bh(gS),yS={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:vS.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:vS.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:vS.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:gS.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:vS.user}]}},MS={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},IS={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function TS(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return SS(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?SS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function SS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var bS={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:MS,robotInfo:IS,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},CS={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function _S(e,t){return Rh[e.scene]+"-"+(e.to===t?e.from:e.to)}function ES(e,t){return e.from===t?e.to===t?"in":"out":"in"}function kS(e,t){var r=t.account,n=t.featureValue,i=t.statusValue,o=t.sessionAck,a=t.msgReceiptTime,s=Rh[e.scene],c=e.to===r?e.from:e.to,u=Nh.default,d=xh.unread;em(e.isInBlackList)>0?(d=xh.refused,delete e.isInBlackList):d=e.from===r?a&&a>=+e.time?xh.receipt:xh.sent:o&&o>=+e.time?xh.read:xh.unread;var l=dr(dr({},Uh(bS,e)),{scene:s,type:wh[e.type],fromClientType:Ah[e.fromClientType],flow:ES(e,r),target:c,to:e.to,from:e.from,time:e.time?+e.time:void 0,userUpdateTime:e.userUpdateTime?+e.userUpdateTime:void 0,idClient:e.idClient,sessionId:s+"-"+c,status:xh[i||d],feature:Nh[n||u]});if("string"==typeof l.attach)try{l.attach=JSON.parse(l.attach)}catch(e){}return"notification"===l.type&&(l.attach=l.attach?function(e){var t,r={};if(r.type=CS[e.id]||e.id,!e.data)return r;var n,i={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},o=e.data;return jn(t=fr(i)).call(t,(function(e){void 0!==o[e]&&(r[i[e]]=o[e])})),o.tinfo&&(r.team=rS(Th(o.tinfo,mS.team))),o.uinfos&&(r.users=lu(n=o.uinfos).call(n,(function(e){return dS(Th(e,vS.user))}))),void 0!==o.mute&&(r.mute=1===em(o.mute)),r}(l.attach):{}),l}function wS(e,t){return e&&e.length>0?RS(lu(e).call(e,(function(e){return kS(e,t)}))):[]}function RS(e){for(var t,r,n={},i=TS(e);!(r=i()).done;){var o=r.value,a=n[o.idClient];a&&a.time>o.time||(n[o.idClient]=o)}return lu(t=fr(n)).call(t,(function(e){return n[e]}))}function AS(e,t){void 0===t&&(t=!0);var r=dr({},e);if(r.pushInfo&&t){for(var n in r.pushInfo)"boolean"==typeof r.pushInfo[n]?r[n]=r.pushInfo[n]?1:0:r[n]=r.pushInfo[n];delete r.pushInfo}return r.scene===Rh.team&&r.needForcePush&&(r.forcePushContent=r.forcePushContent||r.pushContent,r.forcePushIDsList=r.forcePushIDsList?r.forcePushIDsList:"#%@all@%#"),r}function xS(e,t,r,n){e.onSendBefore,e.onUploadStart,e.onUploadDone;var i=e.replyMsg,o=Jl(e,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),a=dr(dr({},Bh(bS,o)),{scene:Rh[e.scene],type:wh[e.type],from:t,fromClientType:16,fromDeviceId:r,fromNick:null==n?void 0:n.nick,userUpdateTime:null==n?void 0:n.updateTime,status:xh[xh.sending]});if(a.idClient=a.resendFlag?e.idClient:wp(),!a.idClient)throw new Al("idClient is required to resend a message","idClient","required");return a=AS(a,!1),i&&(a.replyMsgFromAccount=i.from,a.replyMsgToAccount=i.to,a.replyMsgTime=+i.time,a.replyMsgIdServer=i.idServer,a.replyMsgIdClient=i.idClient,a.threadMsgFromAccount=i.from,a.threadMsgToAccount=i.to,a.threadMsgTime=+i.time,a.threadMsgIdServer=i.idServer,a.threadMsgIdClient=i.idClient,i.threadMessageInfo&&i.threadMessageInfo.threadMsgIdServer&&(a.threadMsgFromAccount=i.threadMessageInfo.threadMsgFromAccount,a.threadMsgToAccount=i.threadMessageInfo.threadMsgToAccount,a.threadMsgTime=i.threadMessageInfo.threadMsgTime,a.threadMsgIdServer=i.threadMessageInfo.threadMsgIdServer,a.threadMsgIdClient=i.threadMessageInfo.threadMsgIdClient)),a}function NS(e,t){return lu(e).call(e,(function(e){var r;return r=t||(FT(em(e.scene))?e.scene:1===em(e.scene)?"p2p":"team"),{deletedTime:em(e.time),from:e.from,idClient:e.deletedIdClient||e.idClient,idServer:e.deletedIdServer||e.idServer,scene:r,time:em(e.deletedMsgCreateTime),to:e.to,ext:"string"==typeof e.ext?e.ext:null}}))}function OS(e){for(var t=[],r=(e=e||[]).length-1;r>=0;r--)t.push(e[r]);return t}var PS,LS,VS,US=function(){function e(e){this.core=e}return e.prototype.processBroadcastMsg=function(e){var t=lu(e).call(e,(function(e){return dr(dr({},e),{time:em(e.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:lu(t).call(t,(function(e){return e.id}))}),t},e}(),DS={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},qS={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},BS={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},FS=dr(dr({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:Eh,retConverter:kh},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),GS={msg:FS,recallMsgTag:dr({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},qS),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},jS=bh(GS),HS={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:GS.msg}],response:[{type:"Property",name:"msg",reflectMapper:jS.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:GS.msg}],response:[{type:"Property",name:"msg",reflectMapper:jS.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:GS.msg}],response:[{type:"Property",name:"msg",reflectMapper:jS.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:jS.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:jS.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:jS.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:jS.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:GS.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:GS.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:GS.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:GS.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:jS.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:jS.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:jS.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:jS.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:jS.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:jS.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:jS.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:jS.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:jS.deleteSelfMsgTag}]}};!function(e){e[e.none=0]="none",e[e.pass=1]="pass",e[e.decline=2]="decline",e[e.read=3]="read",e[e.deleted=4]="deleted",e[e.invalid=5]="invalid"}(PS||(PS={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(LS||(LS={})),function(e){e[e.applyTeam=0]="applyTeam",e[e.rejectTeamApply=1]="rejectTeamApply",e[e.teamInvite=2]="teamInvite",e[e.rejectTeamInvite=3]="rejectTeamInvite",e[e.friendRequest=5]="friendRequest",e[e.deleteFriend=6]="deleteFriend",e[e.recallMsgP2p=7]="recallMsgP2p",e[e.recallMsgTeam=8]="recallMsgTeam",e[e.recallMsgSuperTeam=12]="recallMsgSuperTeam",e[e.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",e[e.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",e[e.applySuperTeam=15]="applySuperTeam",e[e.rejectSuperTeamApply=16]="rejectSuperTeamApply",e[e.superTeamInvite=17]="superTeamInvite",e[e.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",e[e.customP2p=100]="customP2p",e[e.customTeam=101]="customTeam",e[e.customSuperTeam=103]="customSuperTeam"}(VS||(VS={}));var WS={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},YS={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:DS,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function KS(e,t,r){var n=+e.type,i=Ap(VS,n);r=r||LS.default;var o=dr(dr({},Uh(YS,e)),{type:i,time:+e.time,to:e.to,from:e.from,idServer:e.idServer,state:PS[PS.none],feature:LS[r]});if("0"===o.idServer&&o.setting&&(o.setting.needSaveOffline=!1),"string"==typeof o.attach)try{o.attach=JSON.parse(o.attach)}catch(e){t.error("formatSystemMessage: "+o.idServer+" parse attach error",e&&e.message)}return 5===n&&o.attach?(o.attach.type=WS[+o.attach.vt],"passFriendApply"===o.attach.type?o.state=PS[PS.pass]:"rejectFriendApply"===o.attach.type&&(o.state=PS[PS.decline])):n<=3&&o.attach&&(o.attach=function(e){var t=e.attach,r=e.tinfo,n=Jl(e,["attach","tinfo"]);return n.ext=t,void 0!==r&&(n.team=rS(Th(e.tinfo,mS.team))),n}(o.attach)),o}function QS(e){var t=dr({},e);return dr(dr({},Bh(YS,t)),{type:VS[t.type],to:t.to,attach:t.attach})}function $S(e){return e===VS.recallMsgP2p?"p2p":e===VS.recallMsgTeam?"team":e===VS.recallMsgSuperTeam?"superTeam":""}var zS=function(e){function t(t){var r;return(r=e.call(this,"msg",t)||this).onV2SendMessage=function(e){var t=kS(e,{account:r.core.account,featureValue:Nh.default});t.status=e.status,r.core.eventBus.emit("session/updateForNewMsg",t)},r.onV2ModifyMessage=function(e){var t,n=Rh[e.scene]+"-"+(e.to===r.core.account?e.from:e.to),i=null===(t=r.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n}),o=kS(e,i?{account:r.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:r.core.account});r.core.eventBus.emit("session/updateForModifyMsg",o)},r.onV2RecallMsg=function(e){var t=NS([e],$S(+e.type));r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.onV2DeleteSelfMsgs=function(e){var t=NS(e);r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.service=new US(t),Sh({cmdMap:BS,cmdConfig:HS}),r.registerListener(),r}nr(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},r.sendTextMsg=function(e){return Vl({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"text"}))},r.sendTipMsg=function(e){return Vl({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"tip"}))},r.sendGeoLocationMsg=function(e){return Vl({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(dr(dr({},e),{type:"geo",attach:Ei(e.attach)}))},r.sendCustomMsg=function(e){return Vl({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"custom"}))},r.sendMsg=function(e){var t,r=this;if(Vl({scene:{type:"enum",values:Rp(Rh)},type:{type:"enum",values:Rp(wh)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:MS},robotInfo:{type:"object",required:!1,rules:IS},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},e),"team"===e.scene&&e.robotInfo&&!e.robotInfo.account)throw new wl('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var n,i="p2p"===e.scene?"sendMsg":"team"===e.scene?"sendTeamMsg":"sendSuperTeamMsg",o=xS(e,this.core.account,this.core.config.deviceId,null===(t=this.core.user)||void 0===t?void 0:t.myInfo),a=kS(dr(dr({},o),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Nh.default,statusValue:xh.sending});try{e.onSendBefore&&e.onSendBefore(a)}catch(e){this.logger.error("sendMsg: options.onSendBefore error",e)}return this.core.eventBus.emit("session/updateForNewMsg",a),this.core.eventBus.emit("forwardSend/msg/sendMsg",o),this.core.sendCmd(i,{msg:o}).then((function(t){var i=t.content,s=t.error;if(n=i.msg,s)throw s;var c=kS(dr(dr({},o),i.msg),{account:r.core.account,featureValue:Nh.default,statusValue:xh.sent});return c.from===c.to&&r.markMsgsAck([c]),r.core.eventBus.emit("session/updateForNewMsg",c),r.core.eventBus.emit("forwardSend/msg/sendMsg",dr(dr({},xS(c,c.from,c.fromDeviceId)),{idClient:c.idClient,status:"sent"})),r.core.reporter.report("msgSend",{msgId:c.idServer,clientId:c.idClient,msgTime:c.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:c.to,type:Rh[c.scene],roomId:"",tid:"p2p"===e.scene?"":c.to,result:200,failReason:"",rt:Es()-a.time}),c})).catch((function(t){var i=kS(dr(dr(dr({},o),{time:(new Date).getTime()}),n),{account:r.core.account,featureValue:Nh.default,statusValue:7101===t.code?xh.refused:xh.sendFailed});throw t.msg=i,r.core.eventBus.emit("session/updateForNewMsg",i),r.core.eventBus.emit("forwardSend/msg/sendMsg",dr(dr({},xS(i,i.from,i.fromDeviceId)),{status:"sendFailed"})),r.core.reporter.report("msgSend",{msgId:i.idServer,clientId:i.idClient,msgTime:i.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:i.to,type:Rh[i.scene],roomId:"",tid:"p2p"===e.scene?"":i.to,result:null==t?void 0:t.code,failReason:(null==t?void 0:t.message)||"",rt:Es()-a.time}),t}))},r.resendMsg=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e),r=e.msg,n=dr(dr({},r),{attach:r.attach?Ei(r.attach):void 0,setting:{resendFlag:!0}}),r.from===this.core.account){t.next=5;break}throw new Error("You can only resend messages that you sent: "+r.idClient);case 5:return t.abrupt("return",this.sendMsg(n));case 6:case"end":return t.stop()}}),t,this)})))},r.forwardMsg=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:Rp(Rh)},to:{type:"string",allowEmpty:!1}},e),r=e.msg,n=dr(dr({},r),{scene:e.scene,to:e.to,attach:r.attach?Ei(r.attach):void 0}),t.abrupt("return",this.sendMsg(n));case 4:case"end":return t.stop()}}),t,this)})))},r.sendImageMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"image"}))},r.sendFileMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"file"}))},r.sendAudioMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"audio"}))},r.sendVideoMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"video"}))},r.doSendFile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({scene:{type:"enum",values:Rp(Rh)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",this.sendMsg(dr(dr({},e),{attach:Ei(r),type:e.type})));case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.recallMsg=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:Rp(Rh)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:DS},ps:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msg,n={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},i={p2p:7,team:8,superTeam:12},o=AS({time:r.time,type:i[r.scene],to:r.to,from:r.from,ps:e.ps,attach:e.attach,deletedIdClient:r.idClient,deletedIdServer:r.idServer,opeAccount:r.from,env:e.env,pushInfo:e.pushInfo}),t.next=7,this.core.sendCmd(n[r.scene],{recallMsgTag:o});case 7:return a=dr({},r,{deletedMsgCreateTime:r.time}),s=NS([a]),this.core.eventBus.emit("session/updateForDeletedMsg",s),this.core.eventBus.emit("forwardSend/msg/recallMsg",o),t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,this)})))},r.deleteSelfMsgs=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msgs,n=lu(r).call(r,(function(t){return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,idServer:t.idServer,idClient:t.idClient,deletedMsgCreateTime:t.time,ext:e.ext}})),t.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:n});case 5:return i=t.sent,o=lu(n).call(n,(function(e){var t;return dr({},e,{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})})),a=NS(o),this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",lu(n).call(n,(function(e){var t;return dr(dr({},e),{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})}))),t.abrupt("return",a);case 11:case"end":return t.stop()}}),t,this)})))},r.sendMsgReceipt=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Vl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),"p2p"===(i=e.msg).scene&&"in"===i.flow){n.next=5;break}return this.logger.warn("Msg scene: "+i.scene+", flow: "+i.flow+" is not allowed to send msg receipt"),n.abrupt("return",void 0);case 5:return o={to:i.target,idClient:i.idClient,time:i.time},n.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:o});case 8:return a=n.sent,s=em(null===(r=null===(t=a.content)||void 0===t?void 0:t.msgReceiptTag)||void 0===r?void 0:r.time),n.abrupt("return",dr(dr({},o),{time:s?Math.min(s,o.time):o.time}));case 11:case"end":return n.stop()}}),n,this)})))},r.sendTeamMsgReceipt=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e),r=e.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:r}),t.abrupt("return",void 0);case 4:case"end":return t.stop()}}),t,this)})))},r.getTeamMsgReads=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),n=e.teamMsgReceipts,r.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:n});case 4:return i=r.sent,o=(o=null===(t=i.content)||void 0===t?void 0:t.teamMsgReceipts)?lu(o).call(o,(function(e){return dr(dr({},e),{read:em(e.read),unread:em(e.unread)})})):[],r.abrupt("return",o);case 8:case"end":return r.stop()}}),r,this)})))},r.getTeamMsgReadAccounts=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),r=e.teamMsgReceipt,t.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:r});case 4:return n=t.sent,t.abrupt("return",n.content);case 6:case"end":return t.stop()}}),t,this)})))},r.markMsgsAck=function(e){if(e&&e.length>0){var t=[],r=[];jn(e).call(e,(function(e){"p2p"===e.scene&&"in"===e.flow?t.push(e):"team"===e.scene&&"in"===e.flow&&r.push(e)})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:lu(t).call(t,(function(e){return e.idServer}))}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:lu(r).call(r,(function(e){return e.idServer}))})}},r.onMsgHandler=function(e){var t;if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var r="number"==typeof tm(e,"raw.r[0]")?""+e.raw.r[0]:void 0,n=e.content.msg;n.idServer=n.idServer||r;var i=_S(n,this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=kS(n,o?{account:this.core.account,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",a.idClient,a.idServer,a):this.logger.log("msgHandler::recvMsg",a.idClient,a.idServer),this.markMsgsAck([a]),this.core.eventBus.emit("session/updateForNewMsg",a),"superTeam"===a.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a.time}),this.core.emit("msg",a),"notification"===a.type?this.core.eventBus.emit("team/onNotification",a):"out"!==a.flow&&this.doMsgReceiveReport(a,e),"notification"!==a.type&&this.core.user.checkUserUpdate(a)}},r.doMsgReceiveReport=function(e,t){if(e.from!==this.core.account){var r="p2p"===e.scene,n=tm(e,"__clientExt.statistics.apiCallingTime")||0,i=tm(e,"__clientExt.statistics.sendTime")||0,o=tm(e,"__clientExt.statistics.attachUploadDuration")||0,a=this.core.timeOrigin.getNTPTime(),s=e.time,c=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):a;this.core.reporter.report("msgReceive",{msgId:e.idServer,clientId:e.idClient,serverTime:s,receiveTime:c,fromAccid:r?e.from:"",toAccid:e.to,type:Rh[e.scene],tid:r?"":e.to,apiCallingTime:n,sendTime:i,attachUploadDuration:o,callbackTime:a,preHandleTime:a,result:200,failReason:"",rt:a-s})}},r.nimOnTeamMsgsHandler=function(e){var t,r=this;jn(t=e.content.datas).call(t,(function(t){r.onMsgHandler(dr({},e,{content:{msg:t}}))}))},r.syncRoamingMsgsHandler=function(e){var t,r,n=e.content.msgs||[];if(0!==n.length){var i=_S(n[0],this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=(n=wS(n,o?{account:this.core.account,featureValue:Nh.roam,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account,featureValue:Nh.roam}))[0].time,s={timetag:a,sessionId:i,msgs:OS(n)};"function"!=typeof(null===(r=this.core.sync)||void 0===r?void 0:r.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",s),this.core.emit("syncRoamingMsgs",s),"superTeam"===n[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a})}},r.syncOfflineMsgsHandler=function(e){var t,r=this,n=e.content.msgs||[];if(0!==n.length){var i={},o=[];jn(n).call(n,(function(e){var t=_S(e,r.core.account),n=r.core.session.getSessionWithUncomplete({id:t}),a=kS(e,n?{account:r.core.account,featureValue:Nh.leave,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:r.core.account,featureValue:Nh.leave});o.push(a),i[a.sessionId]?i[a.sessionId].push(a):i[a.sessionId]=[a]})),this.markMsgsAck(o);var a=0;jn(t=fr(i)).call(t,(function(e){var t,n=Dm(t=i[e]).call(t,(function(e,t){return t.time-e.time}));(n=RS(n))[0].time>a&&(a=n[0].time);var o={timetag:n[0].time,sessionId:e,msgs:n};r.core.eventBus.emit("session/syncMsgs",o),r.core.emit("syncOfflineMsgs",o)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:a})}},r.syncDeleteSelfMsgsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.deletedMsgs;r&&r.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var n=r[r.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:n})},r.onDeleteSelfMsgHandler=function(e){var t=NS([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onDeleteSelfMsgsHandler=function(e){var t=NS(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.msg,r=this.service.processBroadcastMsg([t]);this.core.emit("broadcastMsgs",r)},r.syncBroadcastMsgHandler=function(e){var t=e.content.msgs,r=this.service.processBroadcastMsg(t);this.core.emit("broadcastMsgs",r)},t}(sf),JS={"5_1":"sync"},XS={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},ZS=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"sync",t)||this).syncDoneFlag=!1,n.config={myInfo:!!t.user.name,offlineMsgs:!!t.msg.name,teams:!!t.team.name,myTeamMembers:!!t.team.name,roamingMsgs:!!t.msg.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.msg.name,broadcastMsgs:!!t.msg.name,recallMsg:!!t.msg.name,sessionAck:!!t.session.name,superTeamSessionAck:!!t.session.name,superTeams:!!t.superTeam.name,mySuperTeamMembers:!!t.superTeam.name,superTeamRoamingMsgs:!!t.superTeam.name,deleteSuperTeamMsg:!!t.superTeam.name,deleteSelfMsgs:!!t.msg.name,sessionHistoryMsgsDelete:!!t.msgLog.name,avSignal:!!t.signaling.name},n.setOptions(r),n.timetags={},n.initEventListeners(),Sh({cmdMap:JS,cmdConfig:XS}),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){dr(this.config,e)},r.reset=function(){this.timetags={},this.syncDoneFlag=!1},r.getSyncDoneFlag=function(){return this.syncDoneFlag},r.doSync=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",r),t.prev=2,t.next=5,this.core.clientSocket.sendCmd("sync",{sync:r});case 5:n=t.sent,this.core.logger.log("sync::doSyncV1 done in",null===(e=n.content)||void 0===e?void 0:e.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(2),this.core.logger.error("sync::doSyncV1 error",t.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.abrupt("return");case 17:case"end":return t.stop()}}),t,this,[[2,11]])})))},r.initEventListeners=function(){var e=this;this.core.eventBus.on("logined",(function(){e.syncDoneFlag=!1,e.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(t){var r;jn(r=fr(t)).call(r,(function(r){t[r]>(e.timetags[r]||0)&&(e.timetags[r]=t[r])}))}))},r.genSyncParams=function(){var e,t,r=this;return Tl(e=gu(t=fr(this.config)).call(t,(function(e){var t=e;return r.config[t]}))).call(e,(function(e,t){var n=t;return e[n]=r.timetags[n]||0,e}),{})},r.handleImmediate=function(e){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),gs.resolve(e)},r.delaySyncDone=function(e){var t=this;return"ALI"===Np()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new gs((function(r){Bs((function(){t.handleImmediate(e).then((function(){r(e)}))}),100)}))):this.handleImmediate(e)},r.syncHandler=function(e){return this.delaySyncDone(e)},t}(sf);function eb(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return tb(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tb(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tb(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var rb=function(e){function t(t){var r;return(r=e.call(this,"user",t)||this).userInfoMap=new sd,r.myInfo=dS({}),Sh({cmdMap:fS,cmdConfig:yS}),r}nr(t,e);var r=t.prototype;return r.setBlack=function(e){var t=this;return Vl({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then((function(){t.core.eventBus.emit("forwardSend/user/updateBlackList",e.account,e.isAdd)}))},r.setMute=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),t.next=3,this.core.sendCmd("setMute",e).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",e.account,e.isAdd);case 4:case"end":return t.stop()}}),t,this)})))},r.getRelations=function(){return this.core.sendCmd("syncRelations",{timetag:0})},r.getBlackList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.blackList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.getMuteList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.muteList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.updatePushToken=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.updateAppBackground=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.getUsersNameCardFromServer=function(e){var t=this;return Vl({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",cg(e,["accounts"])).then((function(r){var n,i=r.content;return t.logger.log("user:: getUsers done",e.accounts),i&&i.users?lu(n=i.users).call(n,(function(e){return dS(e)})):[]}))},r.updateMyNameCard=function(e){var t=this;if(Vl({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:Rp(BT),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),0===fr(e).length)return gs.resolve(this.myInfo);var r=cg(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(r.gender=BT[e.gender]),this.core.sendCmd("updateMyNameCard",{user:r}).then((function(n){var i=n.content;return i&&i.timetag&&t.core.eventBus.emit("sync/updateTimetag",{myInfo:+i.timetag}),e.gender&&(r.gender=e.gender),t.myInfo=dr({},t.myInfo,r),t.core.eventBus.emit("forwardSend/user/updateUserInfo",r),t.myInfo}))},r.checkUserUpdate=function(e){var t=e.from;if(t!==this.core.account){var r=this.userInfoMap.get(t);if(r){var n=r.updateTime,i=e.userUpdateTime;!isNaN(n)&&!isNaN(i)&&"number"==typeof n&&"number"==typeof i&&n<i&&this.refreshUserInfo(t)}else this.refreshUserInfo(t)}},r.refreshUserInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getUsersNameCardFromServer({accounts:[e]});case 2:for(r=t.sent,n=eb(r);!(i=n()).done;)o=i.value,this.userInfoMap.set(o.account,o),this.core.emit("updateUserInfo",o);case 4:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlackListHandler=function(e){var t=e.content;t.account?this.core.emit("updateBlackList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.onUpdateMuteListHandler=function(e){var t=e.content;t.account?this.core.emit("updateMuteList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.syncRelationsHandler=function(e){var t=e.content,r=t.list,n=t.timetag,i={blackList:[],muteList:[]};return n&&this.core.eventBus.emit("sync/updateTimetag",{relations:n}),r&&r.length&&jn(r).call(r,(function(e){var t=function(e){var t={account:e.account,updateTime:+e.updateTime,createTime:+e.createTime};return"1"===e.isMuted&&(t.isMuted=!0),"1"===e.isBlack&&(t.isBlack=!0),t}(e);t.isBlack&&i.blackList.push(t),t.isMuted&&i.muteList.push(t)})),this.core.emit("relations",i),gs.resolve(i)},r.syncMyNameCardHandler=function(e){e.content.user&&(this.myInfo=dS(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))},r.onUpdateMyNameCardHandler=function(e){var t=e.content.user;t?(dr(this.myInfo,dS(t)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},t}(sf),nb={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},ib={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},ob=bh(ib),ab={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:ob.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:ob.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:ib.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:ib.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:ob.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:ib.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:ib.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:ob.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:ob.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:ob.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:ob.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:ob.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:ib.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},sb={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function cb(e,t,r){void 0===r&&(r=!0);var n=Uh(sb,e);n.isStickOnTop=r,n.id=t.id,r||(n.ext="");var i=dr(dr({},t),{stickTopInfo:t.stickTopInfo?dr({},t.stickTopInfo,n):n});return void 0===i.lastMsg&&(i.lastMsg=null),i}var ub=function(){function e(e){this.core=e}var t=e.prototype;return t.getSession=function(e){return this.core.session.getSessionWithUncomplete({id:e})||this.core.session.createSession(e)},t.addStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=xp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=cb(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.deleteStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({id:{type:"string",allowEmpty:!1}},e),r=xp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i}});case 4:return o=t.sent,a=this.getSession(e.id),s=cb({updateTime:o.content.timetag,ext:""},a,!1),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.updateStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=xp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=cb(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.stickTopSessionHandler=function(e,t){void 0===t&&(t=!0);var r=xp(e.id,"|"),n=r.scene+"-"+r.accid;return cb(e,this.getSession(n),t)},e}(),db=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.canSessionResetUnreadCount=function(e){var t=e.id;if(void 0===e.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+t+" is not completly, lastMsg undefined");return null!==e.lastMsg||e.unread>0?!(e.ack&&e.lastMsg&&e.ack>=e.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function(e){var t=this,r={cmd:"markMultSuperTeamSessionsAck",params:[]},n={cmd:"markMultSessionsAck",params:[]};return jn(e).call(e,(function(e){var i;try{if(!t.canSessionResetUnreadCount(e))return;var o=xp(e.id),a=o.accid,s=o.scene,c={to:a,sessionId:e.id,timetag:(null===(i=null==e?void 0:e.lastMsg)||void 0===i?void 0:i.time)||e.updateTime||0},u=function(e){return Bh({scene:{type:"enum",values:Rh}},e)}({scene:s});"superTeam"===s?r.params.push(c):n.params.push(dr(dr({},c),u))}catch(e){t.logger.warn(e)}})),{superTeam:r,p2pOrTeam:n}},e}();function lb(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return pb(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pb(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function pb(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var mb=function(e){function t(t,r){var n;return(n=e.call(this,"session",t)||this).list=new sd,n.unreadCountFilterFn=function(e){return!0},n.lastMessageFilterFn=function(e){return!0},n.initEventListeners(),Sh({cmdMap:nb,cmdConfig:ab}),n.stickTopService=new ub(t),n.unreadModule=new db(t),r&&n.setOptions(r),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){"function"==typeof(null==e?void 0:e.unreadCountFilterFn)&&(this.unreadCountFilterFn=e.unreadCountFilterFn),"function"==typeof(null==e?void 0:e.lastMessageFilterFn)&&(this.lastMessageFilterFn=e.lastMessageFilterFn)},r.reset=function(){var e;jn(e=this.list).call(e,(function(e){e.unreadMsgs=[]})),this.list.clear()},r.initEventListeners=function(){var e,t,r,n,i=this;this.core.eventBus.on("session/syncMsgs",tr(e=this.onSyncMsgs).call(e,this)),this.core.eventBus.on("session/updateForNewMsg",tr(t=this.updateSessionWithMsg).call(t,this)),this.core.eventBus.on("session/updateForModifyMsg",tr(r=this.updateSessionByModifyMsg).call(r,this)),this.core.eventBus.on("session/updateForClearMsg",(function(e,t){void 0===t&&(t=!0),e&&e.length>0&&jn(e).call(e,(function(e){i.updateSession({id:e.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},t)}))})),this.core.eventBus.on("session/updateForDeletedMsg",tr(n=this.updateSessionForDeletedMsg).call(n,this))},r.createSession=function(e,t){try{var r=xp(e);return{id:e,scene:r.scene,to:r.accid,lastMsg:t,updateTime:t?t.time:0,unread:0,unreadMsgs:[],ack:0}}catch(t){throw this.logger.error("Failed to create session with "+e,t),new Error("Failed to create session with "+e)}},r.getSession=function(e){Vl({id:{type:"string",allowEmpty:!1}},e);var t=this.list.get(e.id);if(this.isSessionComplete(t))return t},r.getSessionWithUncomplete=function(e){return this.list.get(e.id)},r.getAllSessions=function(){for(var e,t=[],r=lb(this.list);!(e=r()).done;){var n=e.value;n[0];var i=n[1];this.isSessionComplete(i)&&t.push(i)}return t},r.getSessions=function(e){Vl({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var t=[],r=e.limit,n=void 0===r?100:r,i=e.desc,o=void 0===i||i,a=e.lastSessionId,s=0;if(o){for(var c,u,d=lb(this.list);!(u=d()).done;){var l=u.value,p=l[0],m=l[1];if(a===p)break;this.isSessionComplete(m)&&t.push(m)}return qc(c=Yc(t).call(t,-n)).call(c)}for(var h,f=lb(this.list);!(h=f()).done;){var g=h.value,v=g[0],y=g[1];if(a)v===a&&(a=void 0);else if(this.isSessionComplete(y)){if(++s>n)break;t.push(y)}}return t},r.resetSessionUnreadCount=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u,d,l=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({id:{type:"string",allowEmpty:!1}},e),Vl({id:{type:"string",allowEmpty:!1}},e),n=e.id,i=this.list.get(n)){r.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+n),new Error("Session::canSessionResetUnreadCount: can not find session "+n);case 7:o=!1;try{o=this.unreadModule.canSessionResetUnreadCount(i)}catch(e){this.logger.warn(e)}if(!1!==o){r.next=11;break}return r.abrupt("return");case 11:return a=xp(n),s=a.accid,c=a.scene,u={to:s,timetag:(null===(t=null==i?void 0:i.lastMsg)||void 0===t?void 0:t.time)||i.updateTime||0},d="markSuperTeamSessionAck","superTeam"!==c&&(u.scene="p2p"===c?0:1,d="markSessionAck"),r.abrupt("return",this.core.sendCmd(d,u).then((function(){var e=l.storeUnreadByAck(n,u.timetag);e&&l.core.emit("updateSession",e)})));case 16:case"end":return r.stop()}}),r,this)})))},r.resetMultiSessionUnreadCount=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Vl({ids:{type:"array",itemType:"string",min:1}},e),i=gu(r=lu(n=e.ids).call(n,(function(e){return g.list.get(e)}))).call(r,(function(t,r){return!!t||(g.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[r]),!1)})),o=this.unreadModule.filterSessionForResetUnreadCount(i),a=o.superTeam,s=o.p2pOrTeam,c=Yy(a.params,50),u=Yy(s.params,50),d=lb(c);case 6:if((l=d()).done){t.next=13;break}return p=l.value,t.next=10,this.core.sendCmd(a.cmd,{datas:p});case 10:jn(p).call(p,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 11:t.next=6;break;case 13:m=lb(u);case 14:if((h=m()).done){t.next=21;break}return f=h.value,t.next=18,this.core.sendCmd(s.cmd,{datas:f});case 18:jn(f).call(f,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 19:t.next=14;break;case 21:case"end":return t.stop()}}),t,this)})))},r.resetAllSessionsUnreadCount=function(){var e,t=[];return jn(e=this.list).call(e,(function(e){t.push(e.id)})),0===t.length?gs.resolve():this.resetMultiSessionUnreadCount({ids:t})},r.deleteSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),!this.core.msgLog||!e.isSyncToServer){t.next=5;break}return t.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[e.id]});case 5:case"end":return t.stop()}}),t,this)})))},r.deleteAllSessionsFromLocal=function(){this.list.clear()},r.addStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.addStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.deleteStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.deleteStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.updateStickTopSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.updateStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncAddStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncDeleteStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag,ext:""},!1);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncUpdateStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimSyncStickTopSessionsHandler=function(e){var t,r=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:e.content.timetag}),e.content.isThereAnyChange){var n=e.content.datas,i=[];jn(t=this.list).call(t,(function(e){var t;e&&(null===(t=null==e?void 0:e.stickTopInfo)||void 0===t?void 0:t.isStickOnTop)&&i.push(e)})),jn(i).call(i,(function(e){var t=e.id;if(!ch(n).call(n,(function(e){var r=xp(e.id,"|");return r.scene+"-"+r.accid===t}))){var r={},i=xp(t,"-"),o=i.scene,a=i.accid;r.id=o+"|"+a,r.ext="",r.isTop=!1,n.push(r)}})),jn(n).call(n,(function(e){var t;!1===e.isTop?(delete e.isTop,t=r.stickTopService.stickTopSessionHandler(e,!1)):t=r.stickTopService.stickTopSessionHandler(e),r.list.set(t.id,t)}))}},r.updateSessionWithMsg=function(e){var t,r,n=!0,i=!0,o="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(r=e.pushInfo)||void 0===r?void 0:r.needPushBadge);try{n=!!this.unreadCountFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",e)}try{i=!!this.lastMessageFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",e)}var a=this.list.get(e.sessionId)||this.createSession(e.sessionId),s=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,i,n),i&&(!a.lastMsg||a.lastMsg.time<e.time||e.status===xh[xh.sending]||a.lastMsg.status===xh[xh.sending])&&(a.lastMsg=e,a.updateTime=e.time,s=!0),n&&o&&e.status===xh[xh.unread]&&e.time>(a.ack||0)){a.unread++;var c=a.unreadMsgs||[];c.unshift(e),Dm(c).call(c,(function(e,t){return t.time-e.time})),a.unreadMsgs=c,s=!0}s&&(this.logger.log("session:updateSessionWithMsg updating ",a.id,a.unread,a.lastMsg&&a.lastMsg.idClient),this.list.set(a.id,a),this.core.emit("updateSession",a))},r.updateSessionByModifyMsg=function(e){var t=this.list.get(e.sessionId)||this.createSession(e.sessionId),r=t.unreadMsgs||[],n=$n(r).call(r,(function(t){return t.idClient===e.idClient}));n>-1&&(r[n]=e),t.unreadMsgs=r,this.list.set(t.id,t);var i=!0;try{i=!!this.lastMessageFilterFn(e)}catch(e){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",e)}i&&(t.lastMsg&&t.lastMsg.idClient!==e.idClient||(t.lastMsg=e,t.updateTime=e.time,this.logger.log("session:updateSessionByModifyMsg updating ",t.id,t.unread,t.lastMsg&&t.lastMsg.idClient),this.list.set(t.id,t),this.core.emit("updateSession",t)))},r.storeUnreadByAck=function(e,t){var r=this.list.get(e)||this.createSession(e);if(!(r.ack&&t<r.ack)){var n=r.unreadMsgs||[],i=[],o=[],a=0;return r.unreadMsgs=[],n.length>0&&(jn(n).call(n,(function(e){au(o).call(o,e.idClient)||e.time>t&&(a++,o.push(e.idClient),i.push(e))})),r.unreadMsgs=Dm(i).call(i,(function(e,t){return t.time-e.time}))),r.ack=t,r.unread=a,r.lastMsg&&"unread"===r.lastMsg.status&&t>=r.lastMsg.time&&(r.lastMsg.status="read"),this.list.set(e,r),r}this.logger.warn("storeUnreadByAck: not need update ack",e,t,r.ack)},r.updateSession=function(e,t){void 0===t&&(t=!0);var r=e.id,n=this.list.get(r)||this.createSession(e.id),i=dr(n,e);return this.list.set(r,i),this.logger.log("updateSession: update",t,cg(e,["id","ack","unread"]),i.lastMsg&&i.lastMsg.idClient),t&&this.core.emit("updateSession",i),i},r.isSessionComplete=function(e){return!!e&&!!(e.id&&e.scene&&e.to)&&void 0!==e.lastMsg},r.syncSessionAckHandler=function(e){var t,r,n=this,i=e.content.p2p||{},o=e.content.team.m_map||{};this.logger.log("syncSessionAck::",i,o),jn(t=fr(i)).call(t,(function(e){n.updateSession({id:"p2p-"+e,ack:i[e]},!1)})),jn(r=fr(o)).call(r,(function(e){n.updateSession({id:"team-"+e,ack:o[e]},!1)}))},r.syncSuperTeamSessionAckHandler=function(e){var t,r=this,n=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",n),jn(t=fr(n)).call(t,(function(e){r.updateSession({id:"superTeam-"+e,ack:n[e]},!1)}))},r.syncMarkSessionAckHandler=function(e){var t=e.content,r=(0===t.scene?"p2p":1===t.scene?"team":"superTeam")+"-"+t.to,n=this.list.get(r);if(n&&n.ack&&t.timetag<n.ack)this.logger.warn("syncMarkSessionAckHandler: "+r+" do not need update ack",n.ack,t.timetag);else{var i=this.storeUnreadByAck(r,t.timetag);i&&this.core.emit("updateSession",i)}},r.syncMarkSuperTeamSessionAckHandler=function(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)},r.onSyncDone=function(){var e,t,r,n=this,i=[];jn(e=this.list).call(e,(function(e,t){i.push(n.storeUnreadByAck(t,e.ack||0))})),this.list.clear(),jn(t=Dm(i).call(i,(function(e,t){return e.updateTime-t.updateTime}))).call(t,(function(e){n.list.set(e.id,e)})),(i=Dm(r=gu(i).call(i,(function(e){return n.isSessionComplete(e)}))).call(r,(function(e,t){return t.updateTime-e.updateTime}))).length>0&&this.core.emit("sessions",i)},r.onSyncMsgs=function(e){var t,r=this,n=this.list.get(e.sessionId),i=[];try{var o;i=gu(o=e.msgs).call(o,(function(e){var t,n,i="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(n=e.pushInfo)||void 0===n?void 0:n.needPushBadge);return r.unreadCountFilterFn(JSON.parse(Ei(e)))&&i}))}catch(e){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",e)}var a,s=[];try{var c;s=gu(c=e.msgs).call(c,(function(e){return r.lastMessageFilterFn(JSON.parse(Ei(e)))}))}catch(e){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",e)}s&&s.length>0&&(a=s[s.length-1],a=s[0].time>a.time?s[0]:a);var u=a?a.time:0;n||(n=a?this.createSession(e.sessionId,a):this.createSession(e.sessionId)),n.unreadMsgs=n.unreadMsgs?gu(t=Os(i).call(i,n.unreadMsgs)).call(t,(function(e){return e.status===xh[xh.unread]})):gu(i).call(i,(function(e){return e.status===xh[xh.unread]})),n.updateTime&&n.updateTime>=u||(n.updateTime=u),n.lastMsg&&n.lastMsg.time>=u||(n.lastMsg=a),this.list.set(n.id,n)},r.updateSessionForDeletedMsg=function(e){var t,r=this,n={};jn(e).call(e,(function(e){var t,i=e.to===r.core.account?e.from:e.to,o=e.scene+"-"+i,a=r.list.get(o);if(a){var s=Hm(t=a.unreadMsgs).call(t,(function(t){return t.idClient===e.idClient})),c=!0;try{c=!!r.unreadCountFilterFn(e)}catch(e){r.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",e)}var u=a.ack||0;if(c&&s&&u<e.time&&e.from!==r.core.account&&a.unread>0&&(a.unread=a.unread-1,a.unreadMsgs&&a.unreadMsgs.length>0)){var d,l=function(e,t){e=e||[],t=t||{};for(var r=0;r<e.length;r++){var n=!0;for(var i in t)if(e[r][i]!==t[i]){n=!1;break}if(n)return r}return-1}(a.unreadMsgs,{idClient:e.idClient});l>=0&&li(d=a.unreadMsgs).call(d,l,1)}a.lastMsg&&a.lastMsg.idClient===e.idClient&&(a.lastMsg=null),n[a.id]=!0}})),jn(t=fr(n)).call(t,(function(e){var t=r.list.get(e);t&&r.core.emit("updateSession",t)}))},r.multiSyncMsgReceiptHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceiptTag;if(r){this.updateSessionMsgReceiptTime([r],!0),r.msgReceiptTime=r.time,r.sessionId="p2p-"+r.from,r.time,r.from;var n=Jl(r,["time","from"]);this.core.emit("msgReceipts",[n])}},r.syncMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceipts;r&&this.updateSessionMsgReceiptTime(r,!1)},r.updateSessionMsgReceiptTime=function(e,t){var r=this;void 0===t&&(t=!0),e&&e.length>0&&jn(e).call(e,(function(e){var n=r.list.get("p2p-"+e.from);n||(n=r.createSession("p2p-"+e.from));var i=em(e.time);n.msgReceiptTime&&n.msgReceiptTime>=i||(n.msgReceiptTime=i,n.lastMsg&&"sent"===n.lastMsg.status&&i>=n.lastMsg.time&&(n.lastMsg.status="receipt"),r.logger.log("session: update session "+n.id+" msgReceiptTime: "+n.msgReceiptTime),r.list.set(n.id,n),t&&r.core.emit("updateSession",n))}))},t}(sf),hb=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddTeamMembers=function(e,t){this.core.emit("addTeamMembers",{team:e,accounts:t,members:uS(e,t)})},t.notifyUpdateTeamManagers=function(e,t,r,n){this.core.emit("updateTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:lu(t).call(t,(function(t){return{id:e+"-"+t,account:t,type:r?"manager":"normal",updateTime:n}}))})},t.notifyRemoveTeamMembers=function(e,t){this.core.emit("removeTeamMembers",{team:e,accounts:t})},t.notifyTransferTeam=function(e,t,r){this.core.emit("transferTeam",{team:e,from:{id:e.teamId+"-"+t,type:"normal",account:t,updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,type:"owner",account:r,updateTime:e.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function(e,t,r){this.core.emit("updateTeamMembersMute",{team:e,accounts:t,members:lu(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}();function fb(e,t){if((t=new sd).get(e))return e;if(e instanceof RegExp)return new RegExp(e);if(e instanceof Date)return new Date(e.getTime());if(ki(e))return t.set(e,!0),lu(e).call(e,(function(e){return fb(e,t)}));if("object"==typeof e&&null!==e){var r;t.set(e,!0);var n={};return jn(r=fr(e)).call(r,(function(r){n[r]=fb(e[r],t)})),n}return e}var gb=function(e){function t(t){var r;return(r=e.call(this,"team",t)||this).myTeamMembersMap=new sd,r.service=new hb(t),r.setListeners(),Sh({cmdMap:lS,cmdConfig:hS}),r}nr(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.myTeamMembersMap.clear()},r.mergeMyTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.myTeamMembersMap.get(r),i=dr({},n,e);t.myTeamMembersMap.set(r,i)}))},r.getTeamInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.team,t.abrupt("return",rS(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getTeams=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=e.sent,r=t.content.teams,e.abrupt("return",nS(r));case 5:case"end":return e.stop()}}),e,this)})))},r.getTeamsById=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});case 3:return r=t.sent,n=nS(r.content.teams),t.abrupt("return",{teams:n,tids:r.content.tids});case 6:case"end":return t.stop()}}),t,this)})))},r.createTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=iS(e),t.next=4,this.core.sendCmd("createTeam",{team:r,accounts:e.accounts||[],ps:e.ps||""});case 4:return n=t.sent,i=rS(n.content.team),this.core.eventBus.emit("forwardSend/team/created",i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.dismissTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("dismissTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.leaveTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.transferTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateTeamInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=iS(e),t.next=4,this.core.sendCmd("updateTeamInfo",{team:r});case 4:return t.abrupt("return",rS(r));case 5:case"end":return t.stop()}}),t,this)})))},r.getTeamMembers=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e),r.next=3,this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0});case 3:if(n=r.sent,i=sS(null===(t=n.content)||void 0===t?void 0:t.teamMembers),e.accounts&&e.accounts.length>0){r.next=7;break}return r.abrupt("return",i);case 7:return r.abrupt("return",gu(i).call(i,(function(t){var r;return null===(r=e.accounts)||void 0===r?void 0:au(r).call(r,t.account)})));case 8:case"end":return r.stop()}}),r,this)})))},r.getMutedTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId});case 3:return r=t.sent,n=r.content,t.abrupt("return",sS(n.teamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.addTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.applyTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",rS(r.content.team));case 5:case"end":return t.stop()}}),t,this)})))},r.addTeamManagers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamManagers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=oS({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:r});case 4:return n=aS(dr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.emitMemberUpdate=function(e){e=aS(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=fb(this.myTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.updateMemberNick=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=oS({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:r});case 4:return n=aS(dr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.muteTeamMember=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.getTeamMemberInvitorAccid=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e),n={teamId:e.teamId},e.accounts&&e.accounts.length>0&&(n.accounts=e.accounts),r.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",n);case 5:return i=r.sent,r.abrupt("return",(null===(t=i.content)||void 0===t?void 0:t.accountsMap)||{});case 7:case"end":return r.stop()}}),r,this)})))},r.muteTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.passTeamApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptTeamInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.notifyTeamMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.teamMsgReceipts;r&&r.length>0&&(this.core.emit("teamMsgReceipts",r),this.core.emit("msgReceipts",r))},r.syncTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:em(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=nS(r);this.core.emit("teams",n)}},r.syncCreateTeamHandler=function(e){var t=e.content,r=rS(null==t?void 0:t.team),n=cS(r,r.owner,"owner");this.core.emit("createTeam",r,n)},r.syncUpdateTeamMemberHandler=function(e){var t=e.content,r=aS(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([r]),this.core.emit("updateTeamMember",r);var n=fb(this.myTeamMembersMap.get(r.teamId));this.core.emit("myTeamMembers",[n])},r.syncMyTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:em(r.timetag)});var n=null==r?void 0:lu(t=r.teamMembers).call(t,(function(e){return aS(e)}));this.mergeMyTeamMembers(n),this.core.emit("myTeamMembers",fb(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("team"===r)switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",a,s,t):this.logger.log("team::recvNotification",a,s,i,l,u,d),l){case"updateTeam":c.updateTime=o,this.core.emit("updateTeam",c);break;case"addTeamMembers":this.service.notifyAddTeamMembers(c,d);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(c,[n]);break;case"passTeamApply":this.service.notifyAddTeamMembers(c,[u]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!0,o);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!1,o);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(c,d);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(c,[n]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:i});break;case"transferTeam":this.service.notifyTransferTeam(c,n,u);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(c,[u],t.mute)}},t}(sf),vb={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},yb={sysMsg:dr({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},qS)},Mb=bh(yb),Ib={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:Mb.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:yb.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:yb.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:yb.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:Mb.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Mb.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Mb.sysMsg}]}},Tb=function(e){function t(t){var r;return(r=e.call(this,"systemMessage",t)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},r.core.eventBus.on("logined",(function(){r.initEventListeners()})),Sh({cmdMap:vb,cmdConfig:Ib}),r}nr(t,e);var r=t.prototype;return r.initEventListeners=function(){var e=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"decline",type:"friendRequest"}])}))},r.doMarkSysMsgAck=function(e){var t=[],r=[],n=["customSuperTeam"];jn(e).call(e,(function(e){e.idServer&&(au(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:r})},r.sendCustomSysMsg=function(e){var t=this;Vl({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:DS}},e);var r="customSuperTeam"===e.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(r,{sysMsg:QS(e)}).then((function(){t.logger.log("sendCustomSysMsg success")})).catch((function(e){throw t.logger.error("sendCustomSysMsg failed",e.message),e}))},r.onSysMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof tm(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=KS(r,this.logger,LS.default);this.core.emit("sysMsg",i),this.doMarkSysMsgAck([i])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncOfflineSysMsgsHandler=function(e){var t,r=this;if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var n=lu(t=e.content.sysMsgs).call(t,(function(e){return KS(e,r.logger,LS.leave)}));this.core.emit("syncSysMsgs",n),this.doMarkSysMsgAck(n)}},r.onRecallMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof tm(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=NS([r],$S(+r.type));this.core.eventBus.emit("session/updateForDeletedMsg",i);var o=KS(r,this.logger,LS.default);this.core.emit("sysMsg",o),this.doMarkSysMsgAck([o])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncRecallMsgOfflineAndRoamingHandler=function(e){var t=this,r=e.content,n=r.timetag,i=r.type,o=r.sysMsgs,a=em(i),s=1===a?LS.leave:LS.roam,c=lu(o).call(o,(function(e){return KS(e,t.logger,s)}));1===a&&this.doMarkSysMsgAck(c),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:n}),this.core.emit("syncSysMsgs",c)},t}(sf);function Sb(e){var t=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],r=dr({},e);return jn(t).call(t,(function(e){void 0!==r[e]&&(r[e]=em(r[e]))})),void 0!==r.relationShip&&(r.valid=1===r.relationShip),r}var bb={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},Cb={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},_b={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},Eb=bh(_b),kb={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Eb.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:_b.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:_b.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:Eb.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:Eb.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:Eb.friendTag}]}},wb=function(e){function t(t){var r;return r=e.call(this,"friend",t)||this,Sh({cmdMap:Cb,cmdConfig:kb}),r}nr(t,e);var r=t.prototype;return r.getFriends=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return r=t.sent,n=(null===(e=r.content)||void 0===e?void 0:e.friends)||[],n=lu(n).call(n,(function(e){return Sb(e)})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.addFriend=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});case 3:return r=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",e.account),t.abrupt("return",{account:e.account,createTime:r,updateTime:r,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return t.stop()}}),t,this)})))},r.applyFriend=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.passFriendApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/passFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectFriendApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/rejectFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.deleteFriend=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),t.next=3,this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:!0===e.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",e.account);case 4:case"end":return t.stop()}}),t,this)})))},r.updateFriend=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:e});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",e);case 4:case"end":return t.stop()}}),t,this)})))},r.syncFriendRequestHandler=function(e){var t=function(e){var t=dr({},e);try{t.ps=t.ps&&JSON.parse(t.ps)}catch(e){}if(t.type=bb[t.type],"addFriend"===t.type||"passFriendApply"===t.type){var r=(new Date).getTime();t.friend={account:e.account,alias:"",createTime:r,ext:"",updateTime:r,valid:!0}}return t}(e.content);this.core.emit("syncFriend",t)},r.syncDeleteFriendHandler=function(e){var t=e.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+t),this.core.emit("syncFriend",{type:"deleteFriend",account:t})},r.syncUpdateFriendHandler=function(e){var t=Sb(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==t?void 0:t.account),this.core.emit("syncFriend",{type:"updateFriend",friend:t})},r.syncFriendsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:em(t.timetag)});var r=null==t?void 0:t.friends;if(r&&r.length){var n=lu(r).call(r,(function(e){return Sb(e)}));this.core.emit("friends",n)}},r.syncFriendUsersHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:em(t.timetag)});var r=null==t?void 0:t.users;if(r&&r.length){var n=lu(r).call(r,(function(e){return dS(e)}));this.core.emit("users",n)}},t}(sf);function Rb(e){return e&&e.length>0?lu(e).call(e,(function(e){return function(e){var t=dr({},e),r=["subscribeTime","time"];return jn(r).call(r,(function(e){t[e]&&(t[e]=em(t[e]))})),t}(e)})):[]}function Ab(e){if(!e)return e;var t=e.serverExt,r=Jl(e,["serverExt"]),n=["time","type","value"];if(jn(n).call(n,(function(e){r[e]&&(r[e]=em(r[e]))})),r.clientType&&(r.clientType=Ap(Ah,r.clientType)||""),t)try{r.ext=JSON.parse(t),"string"==typeof r.ext[0]&&(r.ext=r.ext[0])}catch(e){}return r}var xb={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},Nb={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Ob=bh(Nb),Pb={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:Nb.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Ob.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Ob.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nb.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Ob.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Nb.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Ob.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Ob.msgEvent}]}},Lb=function(e){function t(t){var r;return r=e.call(this,"event",t)||this,Sh({cmdMap:xb,cmdConfig:Pb}),r}nr(t,e);var r=t.prototype;return r.publishEvent=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e),n=dr(dr({validTime:e.validTime||604800,broadcastType:e.broadcastType||2},e),{idClient:wp(),sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("publishEvent",{msgEvent:n});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.msgEvent)||{},r.abrupt("return",Ab(o));case 7:case"end":return r.stop()}}),r,this)})))},r.subscribeEvent=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e),n=dr(dr({subscribeTime:2592e3},e),{sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:n,accounts:e.accounts});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.accounts)||[],r.abrupt("return",{failedAccounts:o});case 7:case"end":return r.stop()}}),r,this)})))},r.unSubscribeEvents=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),n={type:e.type},!(e.accounts&&e.accounts.length>0)){r.next=9;break}return r.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:n,accounts:e.accounts});case 5:o=r.sent,i=(null===(t=o.content)||void 0===t?void 0:t.accounts)||[],r.next=12;break;case 9:return r.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:n});case 11:i=[];case 12:return r.abrupt("return",{failedAccounts:i});case 13:case"end":return r.stop()}}),r,this)})))},r.querySubscribeEvents=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),!(e.accounts&&e.accounts.length>0)){r.next=7;break}return r.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts});case 4:n=r.sent,r.next=10;break;case 7:return r.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}});case 9:n=r.sent;case 10:return r.abrupt("return",Rb(null===(t=n.content)||void 0===t?void 0:t.msgEventSubscribes));case 11:case"end":return r.stop()}}),r,this)})))},r.pushEventHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvent)||{};this.core.emit("pushEvents",[Ab(r)])},r.pushEventsHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvents)||{};this.core.emit("pushEvents",function(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return Ab(e)})):[]}(r))},t}(sf);function Vb(e){var t={scene:Rh[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===qc(e)?1:0};return e.lastMsgId&&(r.lastMsgId=e.lastMsgId),{msg:t,threadMsgReq:r}}var Ub,Db={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},qb={msg:FS,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},Bb=bh(qb),Fb={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:qb.msg},{type:"Property",name:"threadMsgReq",reflectMapper:qb.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:Bb.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:Bb.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:Bb.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:qb.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Bb.msg}]}},Gb=function(e){function t(t){var r;return r=e.call(this,"msgExtend",t)||this,Sh({cmdMap:Db,cmdConfig:Fb}),r}nr(t,e);var r=t.prototype;return r.getThreadMsgs=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({scene:{type:"enum",values:Rp(Rh)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getThreadMsgs",Vb(e));case 3:return n=r.sent,i=n.content,o=i.msgs,a=i.threadMsg,s=n.content.threadMsgsMeta,c=_S(a,this.core.account),u=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:c}),o=wS(o,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),a=kS(a,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),r.abrupt("return",{msgs:o,threadMsg:a,total:em(s.total),timetag:em(s.lastMsgTime)});case 11:case"end":return r.stop()}}),r,this)})))},r.getMsgsByIdServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:Rp(Rh)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),t.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:lu(r=e.reqMsgs).call(r,(function(e){return dr(dr({},e),{scene:Ap(Rh,e.scene)})}))});case 3:return i=t.sent,o=lu(n=i.content.msgs).call(n,(function(e){var t,r=_S(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return kS(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t,this)})))},t}(sf);!function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(Ub||(Ub={}));var jb,Hb={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},Wb={msg:FS,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},Yb=bh(Wb),Kb={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Yb.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:Wb.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:Yb.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:Yb.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Wb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Yb.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Wb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Yb.msg}]}};!function(e){e[e.p2p=1]="p2p",e[e.team=2]="team"}(jb||(jb={}));var Qb={type:{type:"enum",values:jb},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function $b(e){var t=Uh(Qb,e);return{sessionId:"p2p"===t.type?"p2p-"+t.otherAccid:"team-"+t.toTid,time:t.time}}var zb={orderRule:{type:"enum",values:Ub}};function Jb(e){var t,r=Uh(zb,e);ki(r.msgTypeList)&&(r.msgTypeList=lu(t=r.msgTypeList).call(t,(function(e){return wh[e]})).join(","));var n=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return jn(n).call(n,(function(e){ki(r[e])&&(r[e]=r[e].join(","))})),r}var Xb=function(e){function t(t){var r;return(r=e.call(this,"msgLog",t)||this).onV2ClearHistoryMessage=function(e){var t=$b(e);r.core.eventBus.emit("session/updateForClearMsg",[t],!0)},Sh({cmdMap:Hb,cmdConfig:Kb}),r.registerListener(),r}nr(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},r.deleteRoamingMsgs=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Vl({ids:{type:"array",itemType:"string"}},e),r=[],t.prev=2,r=lu(n=e.ids).call(n,(function(e){var t=xp(e);return t.scene+"|"+t.accid})),t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.logger.error("Failed to delete roaming msgs with "+e.ids,t.t0),new Error("Failed to create session with "+e.ids);case 10:return t.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:r});case 12:case"end":return t.stop()}}),t,this,[[2,6]])})))},r.getHistoryMsgs=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c,u,d;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"function"!=typeof(null===(t=this.core.sync)||void 0===t?void 0:t.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),Vl({scene:{type:"enum",values:Rp(Rh)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e),o="p2p"===e.scene?"getHistoryMsgs":"team"===e.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",n.next=5,this.core.sendCmd(o,Op({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},dr(dr({},e),{msgTypes:e.msgTypes?lu(i=e.msgTypes).call(i,(function(e){return wh[e]})):[]})));case 5:if(a=n.sent,(s=a.content).msgs&&s.msgs.length>0){n.next=9;break}return n.abrupt("return",[]);case 9:if(c=_S(s.msgs[0],this.core.account),u=null===(r=this.core.session)||void 0===r?void 0:r.getSessionWithUncomplete({id:c}),d=wS(s.msgs,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),!0!==e.asc){n.next=14;break}return n.abrupt("return",Dm(d).call(d,(function(e,t){return e.time-t.time})));case 14:return n.abrupt("return",d);case 15:case"end":return n.stop()}}),n,this)})))},r.clearHistoryMsgsFromServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e),(r=dr(dr({isDeleteRoam:1},e),{type:"team"===e.scene?2:1,isSyncSelf:!0===e.isSyncSelf?1:0}))[2===r.type?"toTid":"otherAccid"]=e.to,t.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:r});case 5:return n=t.sent,i=n.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:e.scene+"-"+e.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",dr(dr({},r),{time:i.timetag})),t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})))},r.multiSyncClearServerHistoryMsgsHandler=function(e){var t=$b(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[t],!0),this.core.emit("clearServerHistoryMsgs",[t])},r.ftsCloudMsgLogs=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs"));case 1:case"end":return t.stop()}}),t,this)})))},r.ftsCloudMsgLogsAggWithSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return t.stop()}}),t,this)})))},r.baseFtsCloudMsgLogs=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a=this;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Vl({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:Rp(Ub),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:Rp(wh),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),!(e.fromTime&&e.toTime&&e.toTime<e.fromTime)){r.next=3;break}throw new wl("Request parameter error: toTime should be greater than fromTime",e,"");case 3:return i=Jb(e),r.next=6,this.core.sendCmd(t,{tag:i});case 6:return o=r.sent,r.abrupt("return",lu(n=o.content.datas).call(n,(function(e){var t,r=_S(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return kS(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})));case 8:case"end":return r.stop()}}),r,this)})))},r.syncClearServerHistoryMsgsHandler=function(e){var t=function(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return $b(e)})):[]}(e.content.datas);this.core.emit("clearServerHistoryMsgs",t)},t}(sf),Zb={"22_1":"requestProxy","22_2":"onRequestProxy"},eC={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},tC=bh(eC),rC={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:eC.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:tC.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:tC.requestProxyMsgTag}]}},nC=function(e){function t(t){var r;return(r=e.call(this,"passThrough",t)||this).core=t,Sh({cmdMap:Zb,cmdConfig:rC}),r}nr(t,e);var r=t.prototype;return r.request=function(e){return Vl({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then((function(e){return e.content.requestProxyTag}))},r.onRequestProxyHandler=function(e){var t=e.content.proxyMsg;t&&t.time&&(t.time=+t.time),this.core.emit("proxyMsg",t)},t}(sf),iC=gf({none:0,normal:1,all:3}),oC=gf({normal:0,advanced:1}),aC=gf({normal:0,owner:1,manager:2}),sC={noVerify:0,needVerify:1,rejectAll:2},cC=gf(sC),uC={needVerify:0,noVerify:1},dC=gf(uC),lC={manager:0,all:1},pC=gf(lC),mC={manager:0,all:1},hC=gf(mC),fC={manager:0,all:1},gC=gf(fC);function vC(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:oC,muteType:iC,joinMode:cC,beInviteMode:dC,inviteMode:pC,updateTeamMode:hC,updateExtMode:gC};e.bits;var a=Jl(e,["bits"]);return jn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),jn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=em(a[e]))})),jn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===em(a[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function yC(e){return e&&e.length>0?lu(e).call(e,(function(e){return vC(e)})):[]}function MC(e){var t,r=dr({},e),n=["avatar","name","intro","announcement","ext"],i={joinMode:sC,beInviteMode:uC,inviteMode:lC,updateTeamMode:mC,updateExtMode:fC};return jn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),jn(t=fr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function IC(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=em(e.bitConfigMask)),jn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function TC(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:aC},a=e.bits,s=Jl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===em(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,jn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),jn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=em(s[e]))})),jn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===em(s[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function SC(e){return e&&e.length>0?lu(e).call(e,(function(e){return TC(e)})):[]}function bC(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function CC(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?lu(t).call(t,(function(t){return bC(e,t,r)})):[]}var _C=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddSuperTeamMembers=function(e,t){this.core.emit("addSuperTeamMembers",{team:e,accounts:t,members:CC(e,t)})},t.notifyUpdateSuperTeamManagers=function(e,t,r,n){this.core.emit("updateSuperTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:lu(t).call(t,(function(t){return{id:e+"-"+t,type:r?"manager":"normal",account:t,updateTime:n}}))})},t.notifyRemoveSuperTeamMembers=function(e,t){this.core.emit("removeSuperTeamMembers",{team:e,accounts:t})},t.notifyTransferSuperTeam=function(e,t,r){this.core.emit("transferSuperTeam",{team:e,from:{id:e.teamId+"-"+t,account:t,type:"normal",updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,account:r,type:"owner",updateTime:e.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function(e,t,r){this.core.emit("updateSuperTeamMembersMute",{team:e,accounts:t,members:lu(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}(),EC={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},kC={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},wC=bh(kC),RC={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:wC.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:wC.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:kC.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:wC.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:kC.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:kC.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:wC.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:wC.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:wC.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:wC.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:wC.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:wC.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:wC.superTeamMember},{type:"Long",name:"timetag"}]}},AC=function(e){function t(t){var r;return(r=e.call(this,"superTeam",t)||this).mySuperTeamMembersMap=new sd,r.service=new _C(t),Sh({cmdMap:EC,cmdConfig:RC}),r.setListeners(),r}nr(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.mySuperTeamMembersMap.clear()},r.mergeMySuperTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=dr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.getSuperTeamInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.superTeam,t.abrupt("return",vC(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getSuperTeams=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=e.sent,r=t.content.superTeams,e.abrupt("return",yC(r));case 5:case"end":return e.stop()}}),e,this)})))},r.updateSuperTeamInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=MC(e),t.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:r});case 4:return t.abrupt("return",vC(r));case 5:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamManagers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamManagers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applySuperTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",vC(r.content.superTeam));case 5:case"end":return t.stop()}}),t,this)})))},r.transferSuperTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferSuperTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeamMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberNick=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=IC({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:r});case 4:return n=TC(dr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=IC({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:r});case 4:return n=TC(dr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.getSuperTeamMembersByAccounts=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e),i=lu(n=e.accounts).call(n,(function(t){return e.teamId+"|"+t})),r.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:i});case 4:return o=r.sent,r.abrupt("return",SC(null===(t=o.content)||void 0===t?void 0:t.superTeamMembers));case 6:case"end":return r.stop()}}),r,this)})))},r.getSuperTeamMembers=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getSuperTeamMembers",dr({joinTime:0,limit:100,reverse:!1},e));case 3:return n=r.sent,r.abrupt("return",SC(null===(t=n.content)||void 0===t?void 0:t.superTeamMembers));case 5:case"end":return r.stop()}}),r,this)})))},r.queryMuteMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",dr({limit:100,joinTime:0,reverse:!1},e));case 3:return r=t.sent,n=r.content,t.abrupt("return",SC(n.superTeamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.leaveSuperTeam=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.passSuperTeamApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passSuperTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptSuperTeamInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptSuperTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.emitMemberUpdate=function(e){e=TC(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=fb(this.mySuperTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.mergeMyTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=dr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.syncSuperTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:em(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=yC(r);this.core.emit("superTeams",n)}},r.syncCreateSuperTeamHandler=function(e){var t=e.content,r=vC(null==t?void 0:t.superTeam),n=bC(r,r.owner,"owner");this.core.emit("createSuperTeam",r,n)},r.syncUpdateSuperTeamMemberHandler=function(e){var t=e.content,r=TC(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([r]),this.core.emit("updateSuperTeamMember",r);var n=fb(this.mySuperTeamMembersMap.get(r.teamId));this.core.emit("mySuperTeamMembers",[n])},r.syncMySuperTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:em(r.timetag)});var n=null==r?void 0:lu(t=r.teamMembers).call(t,(function(e){return TC(e)}));this.mergeMySuperTeamMembers(n),this.core.emit("mySuperTeamMembers",fb(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("superTeam"===r)switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",a,s,t):this.logger.log("superTeam::recvNotification",a,s,i,l,u,d),l){case"updateSuperTeam":c.updateTime=o,this.core.emit("updateSuperTeam",c);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(c,d);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(c,[n]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(c,[u]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!0,o);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!1,o);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(c,d);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(c,[n]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:i});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(c,n,u);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(c,d,t.mute)}},t}(sf),xC={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},NC={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},OC=function(e){function t(t){var r;return(r=e.call(this,"plugin",t)||this).core=t,Sh({cmdMap:xC,cmdConfig:NC}),r}nr(t,e);var r=t.prototype;return r.getChatroomAddress=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:"WXAPP"===tp.platform,ipType:e.ipType||0});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},r.getQChatAddress=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==e?void 0:e.ipType)||0}});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},t}(sf),PC={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},LC={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},VC=bh(LC),UC={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:LC.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:VC.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:VC.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:LC.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:VC.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:LC.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:LC.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:VC.sessionTag}]}},DC={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function qC(e,t,r){var n=Uh(DC,e),i=xp(n.sessionId,"|"),o=i.accid,a=i.scene;if(n.sessionId=a+"-"+o,n.lastMsg){var s=1===n.lastMsgType;n.lastMsgInfo=s?{isLastMsgRecalled:s,revokedMsg:KS(Th(n.lastMsg,Mb.sysMsg),r)}:{isLastMsgRecalled:s,lastMsg:kS(Th(n.lastMsg,jS.msg),{account:t})}}return delete n.lastMsg,delete n.lastMsgType,n}function BC(e,t,r){return e&&e.length>0?lu(e).call(e,(function(e){return qC(e,t,r)})):[]}var FC=function(e){function t(t){var r;return r=e.call(this,"cloudSession",t)||this,Sh({cmdMap:PC,cmdConfig:UC}),r}nr(t,e);var r=t.prototype;return r.queryCloudSessionList=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},e),(n=dr({limit:100,includedLastMsg:!0},e)).includedLastMsg=jh.boolean(e,"includedLastMsg"),r.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:n});case 5:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.tag)||{},a=i.content.sessions,r.abrupt("return",{hasMore:+o.hasMore>0,sessionList:BC(a,this.core.account,this.logger)});case 9:case"end":return r.stop()}}),r,this)})))},r.queryCloudSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({sessionId:{type:"string",allowEmpty:!1}},e),r=xp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n}});case 4:return o=t.sent,t.abrupt("return",qC(o.content.session,this.core.account,this.logger));case 6:case"end":return t.stop()}}),t,this)})))},r.updateCloudSession=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=xp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n,ext:e.ext}});case 4:case"end":return t.stop()}}),t,this)})))},r.deleteCloudSessionList=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({sessionIdList:{type:"array",itemType:"string"}},e),n=lu(r=e.sessionIdList).call(r,(function(e){var t=xp(e,"-"),r=t.accid,n=t.scene;return{sessionId:"superTeam"===n?"super_team|"+r:n+"|"+r}})),t.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:n});case 4:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncUpdateCloudSessionHandler=function(e){var t=qC(e.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",t)},t}(sf),GC={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},jC={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},HC={avSignalTag:dr({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},WC=bh(HC),YC={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:WC.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:WC.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:HC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:WC.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},KC={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:GC,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function QC(e){return Uh(KC,Th(e,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function $C(e){var t,r=Uh(KC,e),n=[];return r.members&&r.members.length>0&&(n=lu(t=r.members).call(t,(function(e){return QC(e)})),delete r.members),n.length>0?{channelInfo:r,memberList:n}:{channelInfo:r}}function zC(e){var t,r=Uh(KC,e),n=[];r.members&&r.members.length>0&&(n=lu(t=r.members).call(t,(function(e){return QC(e)})),delete r.members);var i=200;return e.callStatus&&(i=Number(e.callStatus)),n.length>0?{channelInfo:r,memberList:n,callStatus:i}:{channelInfo:r,callStatus:i}}function JC(e){return Bh(KC,e)}var XC,ZC,e_,t_,r_,n_,i_,o_=function(e){function t(t){var r;return(r=e.call(this)||this).timer=0,r.pollingInterval=12e4,r.name="signaling",r.logger=t.logger,r.core=t,r.channels={},Sh({cmdMap:jC,cmdConfig:YC}),r}nr(t,e);var r=t.prototype;return r.callEx=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:GC},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),r.next=3,this.core.sendCmd("signalingCallEx",{tag:JC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=zC(i),this.channels[o.channelInfo.channelId]=fb(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.joinAndAccept=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),n=e.fromAccid,(i=Jl(e,["fromAccid"])).toAccid=n,r.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:JC(i)});case 5:return o=r.sent,a=(null===(t=o.content)||void 0===t?void 0:t.data)||{},s=zC(a),this.channels[s.channelInfo.channelId]=fb(s.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(c=this.aotoDelay).call(c,this),this.pollingInterval,-1)),r.abrupt("return",s);case 11:case"end":return r.stop()}}),r,this)})))},r.create=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({type:{type:"number"},ext:{type:"string",required:!1}},e),r.next=3,this.core.sendCmd("signalingCreate",{tag:JC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",$C(i));case 6:case"end":return r.stop()}}),r,this)})))},r.close=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingClose",{tag:JC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.queryInfo=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({name:{type:"string",allowEmpty:!1}},e),r.next=3,this.core.sendCmd("signalingQueryInfo",{tag:e});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",$C(i));case 6:case"end":return r.stop()}}),r,this)})))},r.join=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("signalingJoin",{tag:JC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=$C(i),this.channels[o.channelInfo.channelId]=fb(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.aotoDelay=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=fr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("signling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=24;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:n}});case 12:i=e.sent,o=$C(i.content.data),this.channels[n]=o.channelInfo,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 21:r++,e.next=7;break;case 24:case"end":return e.stop()}}),e,this,[[9,17]])})))},r.leave=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingLeave",{tag:JC(e)});case 3:delete this.channels[e.channelId];case 4:case"end":return t.stop()}}),t,this)})))},r.invite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:GC}},e),t.next=3,this.core.sendCmd("signalingInvite",{tag:JC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.cancelInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingCancelInvite",{tag:JC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.reject=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),r=e.fromAccid,(n=Jl(e,["fromAccid"])).toAccid=r,t.next=5,this.core.sendCmd("signalingReject",{tag:JC(n)});case 5:case"end":return t.stop()}}),t,this)})))},r.accept=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},e),r=e.autoJoin,n=e.joinAttachExt,i=e.fromAccid,(o=Jl(e,["autoJoin","joinAttachExt","fromAccid"])).toAccid=i,t.next=5,this.core.sendCmd("signalingAccept",{tag:JC(o)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+e.autoJoin),!r){t.next=10;break}return a={channelId:e.channelId,needOffline:e.needOffline,attachExt:n,uid:e.uid},t.next=10,this.join(a);case 10:case"end":return t.stop()}}),t,this)})))},r.sendCustomCommand=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:JC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.signalingRecvNotificationHandler=function(e){var t="number"==typeof tm(e,"raw.r[0]")?""+e.raw.r[0]:"0";e.content.data.msgId=e.content.data.msgId||t,this.doNotify(e.content.data),t&&em(t)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[t]})},r.signalingMultiSyncNotificationHandler=function(e){this.doNotify(e.content.data,3)},r.doNotify=function(e,t){void 0===t&&(t=0);var r=function(e,t){void 0===t&&(t=0);var r=Uh(KC,e),n=r.attach,i=r.attachExt,o=r.time,a=r.msgId;r.fromAccid,r.toAccid,r.members,r.requestId,r.pushInfo;var s=Jl(r,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===n.type)try{r.member={accid:r.attach.member[1],uid:Number(r.attach.member[2]),createTime:Number(r.attach.member[3]),expireTime:Number(r.attach.member[4])}}catch(e){delete r.member}var c=n.type;return delete r.attach,{metaData:{eventType:c,channelInfo:s,feature:t,ext:i||"",time:o,msgId:a},rawData:r}}(e,t),n=r.metaData,i=r.rawData,o=i.fromAccid,a=i.toAccid,s=i.requestId,c=i.pushInfo,u=i.msgId,d=i.member;switch(n.eventType){case 1:this.emit("signalingClose",{fromAccid:o,metaData:n});break;case 2:this.emit("signalingJoin",{fromAccid:o,metaData:n,member:d});break;case 3:this.emit("signalingInvite",{fromAccid:o,toAccid:a,requestId:s,pushInfo:c,metaData:n});break;case 4:this.emit("signalingCancelInvite",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 5:this.emit("signalingReject",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 6:this.emit("signalingAccept",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 7:this.emit("signalingLeave",{fromAccid:o,metaData:n});break;case 8:this.emit("signalingCustomCommand",{fromAccid:o,metaData:n});break;default:this.logger.warn("signaling:notification, no such a type "+n.eventType,i)}return u},r.signalingSyncNotificationHandler=function(e){var t,r,n=this;if(e.content.datas&&e.content.datas.length>0){var i=gu(t=lu(r=e.content.datas).call(r,(function(e){return n.doNotify(e,1)}))).call(t,(function(e){return e}));i.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:i})}},r.singalingSyncChannelsHandler=function(e){var t,r=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var n=lu(t=e.content.datas).call(t,(function(e){return $C(e)}));jn(n).call(n,(function(e){var t=e.channelInfo.channelId;r.channels[t]=fb(e.channelInfo)})),this.emit("singalingSyncChannels",n)}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e),gs.resolve(e);var r=tm(e,"error.detail.ignore");return e.error&&!r?gs.reject(e.error):gs.resolve(e)},t}(Fs.EventEmitter),a_=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.core=r,n.name=t,n.logger=r.logger,n.core=r,n}nr(t,e);var r=t.prototype;return r.emit=function(t){var r=this;try{for(var n,i,o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var c=(n=e.prototype.emit).call.apply(n,Os(i=[this,t]).call(i,a));return c}catch(e){return Bs((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",e),e}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=tm(e,"error.detail.ignore");return e.error&&!r?gs.reject(e.error):gs.resolve(e)},t}(Fs),s_={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},c_={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},u_={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:c_,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},d_=function(){return bh(u_)},l_=function(){var e=d_();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:u_.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:u_.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:u_.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:u_.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:e.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:u_.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:u_.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:u_.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:u_.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:u_.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:u_.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:u_.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:u_.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:u_.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:u_.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:u_.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:e.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:u_.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:u_.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:u_.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:u_.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:u_.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:u_.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:u_.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:u_.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:u_.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:u_.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:e.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:u_.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:u_.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:u_.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:u_.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:u_.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:e.qchatChannelIdInfoTag}]}}};!function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime"}(XC||(XC={})),function(e){e[e.white=1]="white",e[e.black=2]="black"}(ZC||(ZC={})),function(e){e[e.add=1]="add",e[e.remove=2]="remove"}(e_||(e_={})),function(e){e[e.message=0]="message",e[e.media=1]="media",e[e.ext=100]="ext"}(t_||(t_={})),function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(r_||(r_={})),function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime",e[e.totalMember=2]="totalMember"}(n_||(n_={})),function(e){e[e.square=1]="square",e[e.person=2]="person"}(i_||(i_={}));var p_={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:t_},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},m_={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},h_={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:ZC},opeType:{type:"enum",values:e_},toAccids:{type:"object"}},f_={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:ZC},opeType:{type:"enum",values:e_},roleId:{type:"string"}},g_={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},v_={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function y_(e){return Uh(f_,e)}function M_(e){return Uh(p_,e)}function I_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return M_(e)})):[]}function T_(e){return Uh(m_,e)}function S_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return T_(e)})):[]}function b_(e){return Uh(g_,e)}function C_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return b_(e)})):[]}function __(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return function(e){return Uh(v_,e)}(e)})):[]}function E_(e){try{return JSON.parse(e)}catch(e){return[]}}var k_={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},w_={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},R_={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function A_(e){return Uh(k_,e)}function x_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return A_(e)})):[]}function N_(e){return Uh(w_,e)}function O_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return N_(e)})):[]}function P_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return function(e){return Uh(R_,e)}(e)})):[]}function L_(e){var t,r,n;if(!e.antispamTag)return{};var i=dr({},e.antispamTag);return(null===(t=e.antispamTag)||void 0===t?void 0:t.antiSpamBusinessId)&&"string"!=typeof(null===(r=e.antispamTag)||void 0===r?void 0:r.antiSpamBusinessId)&&(i.antiSpamBusinessId=Ei(null===(n=e.antispamTag)||void 0===n?void 0:n.antiSpamBusinessId)),i}var V_={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function U_(e){return Uh(V_,e)}function D_(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return U_(e)})):[]}var q_,B_,F_,G_,j_={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function H_(e){return Uh(j_,e)}!function(e){e[e.everyone=1]="everyone",e[e.custom=2]="custom"}(q_||(q_={})),function(e){e[e.normal=0]="normal",e[e.owner=1]="owner"}(B_||(B_={})),function(e){e[e.ignore=0]="ignore",e[e.deny=-1]="deny",e[e.allow=1]="allow"}(F_||(F_={})),function(e){e[e.manageServer=1]="manageServer",e[e.manageChannel=2]="manageChannel",e[e.manageRole=3]="manageRole",e[e.sendMsg=4]="sendMsg",e[e.accountInfoSelf=5]="accountInfoSelf",e[e.inviteServer=6]="inviteServer",e[e.kickServer=7]="kickServer",e[e.accountInfoOther=8]="accountInfoOther",e[e.recallMsg=9]="recallMsg",e[e.deleteMsg=10]="deleteMsg",e[e.remindOther=11]="remindOther",e[e.remindEveryone=12]="remindEveryone",e[e.manageBlackWhiteList=13]="manageBlackWhiteList",e[e.banServerMember=14]="banServerMember",e[e.RTCChannelConnect=15]="RTCChannelConnect",e[e.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",e[e.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",e[e.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",e[e.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",e[e.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",e[e.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",e[e.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",e[e.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",e[e.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",e[e.manageInviteApply=25]="manageInviteApply",e[e.manageInviteApplyHistory=26]="manageInviteApplyHistory",e[e.mentionedRole=27]="mentionedRole"}(G_||(G_={}));var W_,Y_,K_,Q_,$_,z_,J_,X_,Z_={type:{type:"enum",values:q_},memberType:{type:"enum",values:B_},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},eE={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:q_},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},tE={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:B_},joinTime:{type:"number"},inviter:{type:"string"}};function rE(e){var t=dr({},e),r=Bh(Z_,t);return r.auths&&(r.auths=function(e){var t,r=Tl(t=fr(e)).call(t,(function(t,r){var n=G_[r];return n?t[n]=F_[e[r]]:t[r]=F_[e[r]],t}),{});return Ei(r)}(r.auths)),r}function nE(e){var t;return Tl(t=fr(e)).call(t,(function(t,r){var n=Ap(G_,r);return n?t[n]=F_[e[r]]:t[em(r)]=F_[e[r]],t}),{})}function iE(e){var t=Uh(Z_,e);return e.auths&&(t.auths=nE(JSON.parse(t.auths))),t.isMember&&delete t.isMember,t}function oE(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return iE(e)})):[]}function aE(e){return e.auths&&(e.auths=nE(JSON.parse(e.auths))),Uh(eE,e)}function sE(e){return e.auths&&(e.auths=nE(JSON.parse(e.auths))),Uh(tE,e)}function cE(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}!function(e){e[e.default=1]="default",e[e.sync=2]="sync"}(W_||(W_={})),function(e){e[e.sendTime=1]="sendTime"}(Y_||(Y_={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(K_||(K_={})),function(e){e[e.sending=1]="sending",e[e.success=2]="success",e[e.failed=3]="failed"}(Q_||(Q_={})),function(e){e[e.notifyAll=1]="notifyAll",e[e.notifySubscribe=2]="notifySubscribe"}($_||($_={})),function(e){e[e.unknown=0]="unknown",e[e.server=1]="server",e[e.channel=2]="channel",e[e.serverAccids=3]="serverAccids",e[e.channelAccids=4]="channelAccids",e[e.accids=5]="accids"}(z_||(z_={})),function(e){e[e.serverMemberInvite=1]="serverMemberInvite",e[e.serverMemberInviteReject=2]="serverMemberInviteReject",e[e.serverMemberApply=3]="serverMemberApply",e[e.serverMemberApplyReject=4]="serverMemberApplyReject",e[e.serverCreate=5]="serverCreate",e[e.serverRemove=6]="serverRemove",e[e.serverUpdate=7]="serverUpdate",e[e.serverMemberInviteDone=8]="serverMemberInviteDone",e[e.serverMemberInviteAccept=9]="serverMemberInviteAccept",e[e.serverMemberApplyDone=10]="serverMemberApplyDone",e[e.serverMemberApplyAccept=11]="serverMemberApplyAccept",e[e.serverMemberKick=12]="serverMemberKick",e[e.serverMemberLeave=13]="serverMemberLeave",e[e.serverMemberUpdate=14]="serverMemberUpdate",e[e.channelCreate=15]="channelCreate",e[e.channelRemove=16]="channelRemove",e[e.channelUpdate=17]="channelUpdate",e[e.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",e[e.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",e[e.updateQuickComment=20]="updateQuickComment",e[e.channelCategoryCreate=21]="channelCategoryCreate",e[e.channelCategoryRemove=22]="channelCategoryRemove",e[e.channelCategoryUpdate=23]="channelCategoryUpdate",e[e.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",e[e.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",e[e.serverIdentifyAdd=26]="serverIdentifyAdd",e[e.serverIdentifyRemove=27]="serverIdentifyRemove",e[e.serverIdentifyUpdate=28]="serverIdentifyUpdate",e[e.channelIdentifyUpdate=29]="channelIdentifyUpdate",e[e.userIdentifyUpdate=30]="userIdentifyUpdate",e[e.channelVisibilityUpdate=31]="channelVisibilityUpdate",e[e.serverEnterLeave=32]="serverEnterLeave",e[e.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",e[e.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",e[e.myMemberInfoUpdated=35]="myMemberInfoUpdated",e[e.custom=100]="custom",e[e.msgTyping=101]="msgTyping"}(J_||(J_={})),function(e){e[e.reply=1]="reply",e[e.thread=2]="thread",e[e.all=3]="all"}(X_||(X_={}));var uE,dE=Math.max,lE=Math.min;function pE(e,t,r){var n,i,o,a,s,c,u=0,d=!1,l=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var r=n,o=i;return n=i=void 0,u=t,a=e.apply(o,r)}function h(e){return u=e,s=Bs(g,t),d?m(e):a}function f(e){var r=e-c;return void 0===c||r>=t||r<0||l&&e-u>=o}function g(){var e=Es();if(f(e))return v(e);s=Bs(g,function(e){var r=t-(e-c);return l?lE(r,o-(e-u)):r}(e))}function v(e){return s=void 0,p&&n?m(e):(n=i=void 0,a)}function y(){var e=Es(),r=f(e);if(n=arguments,i=this,c=e,r){if(void 0===s)return h(c);if(l)return clearTimeout(s),s=Bs(g,t),m(c)}return void 0===s&&(s=Bs(g,t)),a}return t=Number(t)||0,cE(r)&&(d=!!r.leading,o=(l="maxWait"in r)?dE(Number(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=c=i=s=void 0},y.flush=function(){return void 0===s?a:v(Es())},y}function mE(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return cE(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),pE(e,t,{leading:n,maxWait:t,trailing:i})}!function(e){e[e.sub=1]="sub",e[e.unSub=2]="unSub"}(uE||(uE={}));var hE=function(){function e(e){var t=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=mE((function(e){t.core.emit("serverUnreadInfo",t.getServerUnreadInfo(e)),tm(t.core,"qchatServer.emit")&&t.core.qchatServer.emit("serverUnreadInfo",t.getServerUnreadInfo(e))}),100),this.core=e}var t=e.prototype;return t.changeCacheServerRoleIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.attach.serverIdentifyInfo,i=n.serverId,o=n.roleId,this.serverRoleIdsMap[i]){t.next=4;break}return t.next=4,this.getRoleIdsByServerId([i]);case 4:if(a=this.serverRoleIdsMap[i],!(e.time<a.timeTag)){t.next=7;break}return t.abrupt("return");case 7:if(e.type===J_[J_.serverIdentifyAdd]?a.roleIds.add(o):a.roleIds.delete(o),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+i+" roleIds is",Os(r=[]).call(r,a.roleIds)),s=this.unreadServerCount[i]){t.next=12;break}return t.abrupt("return");case 12:c=Yy(fr(s),100),jn(c).call(c,(function(e){u.core.qchatChannel.getChannelUnreadInfos({channels:lu(e).call(e,(function(e){return{serverId:i,channelId:e}}))})}));case 14:case"end":return t.stop()}}),t,this)})))},t.getRoleIdsByServerId=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=gu(e).call(e,(function(e){return!a.serverRoleIdsMap[e]}))).length){t.next=3;break}return t.abrupt("return");case 3:return i={serverIdTimeTags:n},t.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:i});case 6:o=t.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",i,"result is",o),jn(r=o.content.serverRoles).call(r,(function(e){try{e.roleIds=JSON.parse(e.roleIds)}catch(e){a.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",e)}a.serverRoleIdsMap[e.serverId]={roleIds:new mM(e.roleIds),timeTag:e.timeTag}}));case 9:case"end":return t.stop()}}),t,this)})))},t._unSubscribeChannel=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e+"_"+t,i=[],this.manualSubscribeUnreadMap[n]?i.push(this.manualSubscribeUnreadMap[n]):this.autoSubscribeUnreadMap[n]&&i.push(this.autoSubscribeUnreadMap[n]),this.manualSubscribeTypingMap[n]&&i.push(this.manualSubscribeTypingMap[n]),0!==i.length){r.next=6;break}return r.abrupt("return");case 6:for(o=0,a=i;o<a.length;o++)s=a[o],this.subscribe({opeType:uE.unSub,type:s,channels:[{serverId:e,channelId:t}]});this.manualSubscribeUnreadMap[n]?this.manualSubscribeUnreadMap[n]=void 0:this.autoSubscribeUnreadMap[n]&&(this.autoSubscribeUnreadMap[n]=void 0),this.manualSubscribeTypingMap[n]&&(this.manualSubscribeTypingMap[n]=void 0);case 9:case"end":return r.stop()}}),r,this)})))},t._unSubscribeServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=this.manualSubscribeServerMap[r]||this.autoSubscribeServerMap[r]){t.next=4;break}return t.abrupt("return");case 4:this.subscribe({opeType:uE.unSub,type:n,channels:[{serverId:e,channelId:""}]}),this.manualSubscribeServerMap[r]?this.manualSubscribeServerMap[r]=void 0:this.autoSubscribeServerMap[r]&&(this.autoSubscribeServerMap[r]=void 0);case 6:case"end":return t.stop()}}),t,this)})))},t.subscribe=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),t.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:e.type,opeType:e.opeType},channels:e.channels});case 3:return n=t.sent,i=new mM,jn(r=e.channels).call(r,(function(e){return Xl(a,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.serverRoleIdsMap[e.serverId]||i.add(e.serverId);case 1:case"end":return t.stop()}}),t,this)})))})),o=Yy(Gl(i),10),jn(o).call(o,(function(e){a.getRoleIdsByServerId(e)})),t.abrupt("return",n.content);case 9:case"end":return t.stop()}}),t,this)})))},t.autoSubscribe=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c,u=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.serverRoleIdsMap={},a=100,e){t.next=6;break}return this.unreadServerCount={},this.unreadCount={},t.abrupt("return");case 6:return s={},jn(r=fr(this.manualSubscribeUnreadMap)).call(r,(function(e){var t=u.manualSubscribeUnreadMap[e];if(t){var r=e.split("_"),n={serverId:r[0],channelId:r[1]};s[t]=s[t]||[],s[t].push(n)}})),s[5]=[],jn(n=fr(this.manualSubscribeTypingMap)).call(n,(function(e){return Xl(u,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeTypingMap[e]&&(r=e.split("_"),n=r[0],i=r[1],o={serverId:n,channelId:i},s[5].push(o));case 2:case"end":return t.stop()}}),t,this)})))})),s[4]=[],jn(i=fr(this.manualSubscribeServerMap)).call(i,(function(e){return Xl(u,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeServerMap[e]&&(r={serverId:e},s[4].push(r));case 2:case"end":return t.stop()}}),t,this)})))})),c=[],jn(o=fr(s)).call(o,(function(e){var t=s[e];if(t&&0===t.length)return gs.resolve();if(t.length>a){var r=Yy(t,100);return jn(r).call(r,(function(t){c.push(u.createSubscribePromise(t,e))}))}c.push(u.createSubscribePromise(t,e))})),t.next=16,gs.all(c);case 16:case"end":return t.stop()}}),t,this)})))},t.createSubscribePromise=function(e,t){var r=this,n={type:em(t),opeType:1,channels:e};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",n),this.subscribe(n).then((function(e){var t=e.unreadInfos;t&&t.length>0&&(t=S_(t),r.updateUnreads(t))})).catch((function(e){r.core.logger.error("qchatChannel:: autoSubscribeUnread error ",e)}))},t.cacheSubscribe=function(e){var t,r=this;jn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=5===e.type?r.manualSubscribeTypingMap:4===e.type?r.manualSubscribeServerMap:r.manualSubscribeUnreadMap;e.opeType===uE.sub?i[n]=e.type:e.opeType===uE.unSub&&(i[n]=void 0)}))},t.cacheAutoSubscribe=function(e){var t,r=this;jn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=4===e.type?r.autoSubscribeServerMap:r.autoSubscribeUnreadMap;e.opeType===uE.sub?i[n]=e.type:e.opeType===uE.unSub&&(i[n]=void 0)}))},t.cacheUnreadCount=function(e){var t=this;jn(e).call(e,(function(e){var r=e.serverId+"_"+e.channelId;t.unreadCount[r]=dr({},e),t.unreadServerCount[e.serverId]||(t.unreadServerCount[e.serverId]={}),t.unreadServerCount[e.serverId][e.channelId]=!0}))},t.getServerUnreadInfo=function(e){var t,r=this,n={serverId:e,unreadCount:0,mentionedCount:0,maxCount:0},i=this.unreadServerCount[e];return i&&(jn(t=fr(i)).call(t,(function(t){var i=e+"_"+t,o=r.unreadCount[i];n.unreadCount+=o.unreadCount,n.mentionedCount+=o.mentionedCount,void 0!==o.maxCount&&(n.maxCount=o.maxCount)})),n.unreadCount=n.unreadCount>n.maxCount?n.maxCount:n.unreadCount,n.mentionedCount=n.mentionedCount>n.maxCount?n.maxCount:n.mentionedCount),n},t.getUnreadInfo=function(e){Vl({serverId:{type:"string"},channelId:{type:"string"}},e);var t=e.serverId+"_"+e.channelId;return this.unreadCount[t]?this.unreadCount[t]:null},t.shouldChangeUnread=function(e,t){if(!e.serverId||!e.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(e.serverId,e.channelId))return!1;if(!1===e.historyEnable)return!1;if(!1===e.needBadge)return!1;if(e.fromAccount===this.core.account)return!1;if(t&&2!==(null==e?void 0:e.status))return!1;if(e.notifyReason&&e.notifyReason===Ap($_,$_.notifySubscribe)){if(!e.serverId||!e.channelId)return!1;var r=this.getUnreadInfo({serverId:e.serverId,channelId:e.channelId}),n=t?"ackTimestamp":"lastMsgTime";if(!r)return!1;if(e.time&&r[n]&&r[n]>e.time)return!1}return!0},t.shouldChangeMentionedUnread=function(e,t){return void 0===t&&(t=!1),Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.accidsOfMentionedRoles||!au(n=e.accidsOfMentionedRoles).call(n,this.core.account)){r.next=2;break}return r.abrupt("return",!0);case 2:if(!e.mentionRoleIds||!e.serverId){r.next=16;break}if(this.serverRoleIdsMap[e.serverId]){r.next=9;break}if(t){r.next=7;break}return this.handledRoleMsg(e),r.abrupt("return",!1);case 7:return r.next=9,this.getRoleIdsByServerId([e.serverId]);case 9:i=0;case 10:if(!(i<e.mentionRoleIds.length)){r.next=16;break}if(!this.serverRoleIdsMap[e.serverId].roleIds.has(e.mentionRoleIds[i])){r.next=13;break}return r.abrupt("return",!0);case 13:i++,r.next=10;break;case 16:return r.abrupt("return",!1);case 17:case"end":return r.stop()}}),r,this)})))},t.handledRoleMsg=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.mentionRoleIds){t.next=2;break}return t.abrupt("return");case 2:if(this.serverRoleIdsMap[e.serverId]){t.next=5;break}return t.next=5,this.getRoleIdsByServerId([e.serverId]);case 5:if(this.serverRoleIdsMap[e.serverId]){t.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",e.serverId),t.abrupt("return");case 8:if(n=!1,jn(r=e.mentionRoleIds).call(r,(function(t){s.serverRoleIdsMap[e.serverId].roleIds.has(t)&&(n=!0,s.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCountmessage is ",e))})),n){t.next=12;break}return t.abrupt("return");case 12:if(i=this.unreadCount[e.serverId+"_"+e.channelId],o=2===(null==e?void 0:e.status),i.mentionedCount=o?i.mentionedCount?i.mentionedCount-1:0:i.mentionedCount?i.mentionedCount+1:1,"number"!=typeof i.maxCount){t.next=25;break}if(!((a=(a=i.mentionedCount)>i.maxCount?i.maxCount:a)>i.maxCount)){t.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),t.abrupt("return");case 21:this.core.emit("unreadInfo",dr(dr({},i),{mentionedCount:a})),this.core.emit("unreadInfos",[dr(dr({},i),{mentionedCount:a})]),this.core.qchatChannel.emit("unreadInfos",[dr(dr({},i),{mentionedCount:a})]),this._serverUnreadInfo(e.serverId);case 25:case"end":return t.stop()}}),t,this)})))},t.getMentionedFlag=function(e,t){return void 0===t&&(t=!1),Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.mentionAll){r.next=4;break}return r.abrupt("return",!0);case 4:if(!e.mentionRoleIds&&!e.accidsOfMentionedRoles){r.next=10;break}return r.next=7,this.shouldChangeMentionedUnread(e,t);case 7:return r.abrupt("return",r.sent);case 10:if(!e.mentionAccids||!au(n=e.mentionAccids).call(n,this.core.account)){r.next=12;break}return r.abrupt("return",!0);case 12:return r.abrupt("return",!1);case 13:case"end":return r.stop()}}),r,this)})))},t.changeUnread=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c,u;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.serverId,i=e.channelId,o=n+"_"+i,this.shouldChangeUnread(e,t)){r.next=6;break}return this.core.logger.debug("changeUnread: "+o+" does not need to update unreadInfo"),r.abrupt("return");case 6:if(this.unreadCount[o]){r.next=11;break}return r.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:n,channelId:i}]});case 9:return!this.serverRoleIdsMap[n]&&e.mentionRoleIds&&this.getRoleIdsByServerId([n]),r.abrupt("return");case 11:return a=this.unreadCount[o],s=2===(null==e?void 0:e.status),r.next=15,this.getMentionedFlag(e);case 15:if(c=r.sent,s?(a.unreadCount=a.unreadCount?a.unreadCount-1:0,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount-1:0),delete a.lastMsgTime,this.core.logger.debug("changeUnread: "+o+" unread reduce ",a)):(a.unreadCount=a.unreadCount?a.unreadCount+1:1,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount+1:1),e.time&&(a.lastMsgTime=e.time),this.core.logger.debug("changeUnread: "+o+" unread add ",a)),u="number"==typeof a.maxCount?a.maxCount:100,!(a.unreadCount>u)){r.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),r.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})),this.core.emit("unreadInfos",[dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this._serverUnreadInfo(n);case 26:case"end":return r.stop()}}),r,this)})))},t.updateUnreads=function(e){var t,r,n=this;if(e&&e.length>0){var i=[],o=[],a=lu(t=gu(e).call(e,(function(e){var t=e.serverId+"_"+e.channelId,r=n.unreadCount[t],i=tm(r,"ackTimestamp"),o=tm(e,"ackTimestamp");return!(i&&o&&o<i)&&(tm(r,"unreadCount")!==tm(e,"unreadCount")||tm(r,"mentionedCount")!==tm(e,"mentionedCount"))}))).call(t,(function(e){i.push(n.getServerUnreadInfo(e.serverId)),o.push(n.unreadServerCount[e.serverId]);var t=e.serverId,r=e.channelId,a=t+"_"+r;return n.core.logger.debug("qchat channel updateUnread: ",e),n.unreadCount[a]=dr({},e),n.unreadServerCount[t]||(n.unreadServerCount[t]={}),n.unreadServerCount[t][r]=!0,e}));if(0!==a.length){this.core.emit("unreadInfos",a),this.core.qchatChannel.emit("unreadInfos",a);var s={};jn(a).call(a,(function(e,t){n.core.emit("unreadInfo",e);var r=i[t],a=o[t],c=n.getServerUnreadInfo(e.serverId),u=n.unreadServerCount[e.serverId],d=r.unreadCount!==c.unreadCount,l=!a||0===fr(a).length,p=u&&fr(u).length>0,m=r.mentionedCount!==c.mentionedCount;(d||m||l&&p)&&(s[e.serverId]=!0)})),jn(r=fr(s)).call(r,(function(e){n.core.emit("serverUnreadInfo",n.getServerUnreadInfo(e)),tm(n.core,"qchatServer.emit")&&n.core.qchatServer.emit("serverUnreadInfo",n.getServerUnreadInfo(e))}))}}},t.clearUnreadCountByServers=function(e,t){var r=this,n=[];jn(e).call(e,(function(e){var t;r.unreadServerCount[e]&&jn(t=fr(r.unreadServerCount[e])).call(t,(function(t){n.push(e+"_"+t)}))}));var i=[];jn(n).call(n,(function(e){i.push(dr(dr({},r.unreadCount[e]),{unreadCount:0,mentionedCount:0,ackTimestamp:t}))})),this.updateUnreads(i)},e}(),fE=function(){function e(e){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new mM,this.autoVisitorSubscribeServer=new mM,this.autoVisitorSubscribeChannel=new mM,this.core=e}var t=e.prototype;return t.subscribeChannelAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||6,opeType:e.opeType},datas:e.channels});case 2:return n=t.sent,i=n.content.failedArr,o=gu(r=e.channels).call(r,(function(e){return!Hm(i).call(i,(function(t){return t.channelId===e.channelId&&t.serverId===e.serverId}))})),jn(o).call(o,(function(t){1===e.opeType?a.autoVisitorSubscribeChannel.add(t.serverId+"&"+t.channelId):a.autoVisitorSubscribeChannel.delete(t.serverId+"&"+t.channelId)})),t.abrupt("return",{failedChannels:i});case 7:case"end":return t.stop()}}),t,this)})))},t.subscribeServerAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s,c=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||7,opeType:e.opeType},datas:lu(r=e.serverIds).call(r,(function(e){return{serverId:e}}))});case 2:return o=t.sent,a=o.content.failedArr,s=gu(n=e.serverIds).call(n,(function(e){return!Hm(a).call(a,(function(t){return t.serverId===e}))})),jn(s).call(s,(function(t){1===e.opeType?c.autoVisitorSubscribeServer.add(t):c.autoVisitorSubscribeServer.delete(t)})),t.abrupt("return",{failedServers:lu(i=o.content.failedArr).call(i,(function(e){return e.serverId}))});case 7:case"end":return t.stop()}}),t,this)})))},t.deleteServer=function(e){var t;this.autoServers.delete(e),this.autoVisitorSubscribeServer.has(e)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[e]});var r=[];jn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){if(0===wu(t).call(t,e)){var n=t.replace(e+"&","");r.push({serverId:e,channelId:n})}})),r.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:r})},t.deleteAutoSetInServerId=function(e){var t,r=this;this.autoServers.delete(e),this.autoVisitorSubscribeServer.delete(e),jn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){0===wu(t).call(t,e)&&r.autoVisitorSubscribeChannel.delete(t)}))},t.deleteAutoSetInChannel=function(e,t){this.autoVisitorSubscribeChannel.delete(e+"&"+t)},t.unSubscribeChannel=function(e,t){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:e,channelId:t}]})},t.isInSubscribeChannels=function(e,t){return this.autoVisitorSubscribeChannel.has(e+"&"+t)},t.isInAutoServers=function(e){return this.autoServers.has(e)},t.doAutoSubscribe=function(){var e=this,t=[],r=Yy(Gl(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);jn(r).call(r,(function(r){t.push(e.subscribeServerAsVisitor({opeType:1,serverIds:r}))}));var n=Yy(Gl(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return jn(n).call(n,(function(r){t.push(e.subscribeChannelAsVisitor({opeType:1,channels:lu(r).call(r,(function(e){var t=wu(e).call(e,"&");return{serverId:Yc(e).call(e,0,t),channelId:Yc(e).call(e,t+1)}}))}))})),gs.all(t)},t.doAutoEnterServer=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i=this;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Yy(Gl(this.autoServers),this.limitForBatchEnter),r=[],jn(t).call(t,(function(e){r.push(i.core.qchatServer.enterAsVisitor({serverIds:e}))})),e.next=5,gs.all(r);case 5:n=e.sent,jn(n).call(n,(function(e){var t;jn(t=e.failedServers).call(t,(function(e){i.deleteAutoSetInServerId(e)}))}));case 7:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return t.next=3,this.doAutoEnterServer();case 3:return t.next=5,this.doAutoSubscribe();case 5:t.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return t.stop()}}),t,this)})))},t.cacheServer=function(e){var t=this;jn(e).call(e,(function(e){return t.autoServers.add(e)}))},e}();function gE(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return vE(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vE(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function vE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var yE=function(e){function t(t,r){var n;return(n=e.call(this,"qchatChannel",t)||this).config={autoSubscribe:!1},n.core=t,Sh({cmdMap:s_,cmdConfig:l_()}),r&&n.setOptions(r),n.subscribeModuleService=new hE(t),n.subscribeForVisitorService=new fE(t),n.setListener(),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=dr(this.config,e))},r.setListener=function(){var e,t,r,n,i,o=this;this.core.eventBus.on("logined",(function(e){o.subscribeModuleService.resumeSubscribe(e.isAutoReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isAutoReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(e){o.subscribeModuleService.resumeSubscribe(e.isReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",tr(e=this.subscribeModuleService.changeUnread).call(e,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",tr(t=this.subscribeModuleService.updateUnreads).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",tr(r=this.subscribeModuleService.cacheSubscribe).call(r,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",tr(n=this.subscribeModuleService.clearUnreadCountByServers).call(n,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",tr(i=this.subscribeModuleService.getRoleIdsByServerId).call(i,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(e){if(o.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",e),e.type===J_[J_.channelVisibilityUpdate])o.logger.log("QChatChannel::begin autoUnSubscribe channel key is",e.serverId+"_"+e.channelId),o.subscribeModuleService._unSubscribeChannel(e.serverId,e.channelId),o.logger.log("QChatChannel::autoUnSubscribe channel done key is",e.serverId+"_"+e.channelId);else if(e.type===J_[J_.serverEnterLeave]){var t;(o.subscribeModuleService.manualSubscribeServerMap[e.serverId]||o.subscribeModuleService.autoSubscribeServerMap[e.serverId])&&(o.logger.log("QChatChannel::begin autoUnSubscribe server key is",e.serverId),o.subscribeModuleService._unSubscribeServer(e.serverId),o.logger.log("QChatChannel::autoUnSubscribe server done key is",e.serverId));var r=o.subscribeModuleService.unreadServerCount[e.serverId];if(!r)return;o.logger.log("QChatChannel::begin autoUnSubscribe channels key is",fr(r)),jn(t=fr(r)).call(t,(function(t){o.subscribeModuleService._unSubscribeChannel(e.serverId,t)})),o.logger.log("QChatChannel::autoUnSubscribe channels done key is",fr(r))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(e){o.subscribeModuleService.changeCacheServerRoleIds(e)}))},r.createChannel=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},type:{type:"enum",values:Rp(t_)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:dr(dr({},e),{type:t_[e.type]}),antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",M_(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteChannel=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteChannel",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannel=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:Rp(t_),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),r=e,e.type&&(r.type=t_[e.type]),t.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:r,antispamTag:L_(e)});case 5:return n=t.sent,t.abrupt("return",M_(n.content.channelInfo));case 7:case"end":return t.stop()}}),t,this)})))},r.getChannels=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannels",e);case 3:return r=t.sent,t.abrupt("return",I_(r.content.channelList));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelsByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:dr({limit:100},e)});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:I_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getMembersByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:O_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},opeType:{type:"enum",values:Rp(e_)}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:dr(dr({},e),{type:ZC[e.type],opeType:e_[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackRolesPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:dr(dr({},e),{type:ZC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:oE(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},opeType:{type:"enum",values:Rp(e_)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:dr(dr({},e),{type:ZC[e.type],opeType:e_[e.opeType],toAccids:Ei(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackMembersPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:dr(dr({limit:100},e),{type:ZC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:O_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:dr(dr({},e),{type:ZC[e.type],roleIds:Ei(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:oE(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:Rp(ZC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:dr(dr({},e),{type:ZC[e.type],accids:Ei(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:O_(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateCategoryInfoOfChannel=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:e});case 3:return r=t.sent,t.abrupt("return",M_(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.createChannelCategory=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",b_(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategory=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategory",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategory=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",b_(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesByID=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",e);case 3:return r=t.sent,t.abrupt("return",C_(r.content.channelCategoryList));case 5:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},opeType:{type:"enum",values:Rp(e_)},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:dr(dr({},e),{type:ZC[e.type],opeType:e_[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRolesPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:dr(dr({},e),{type:ZC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:oE(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},opeType:{type:"enum",values:Rp(e_)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:dr(dr({},e),{type:ZC[e.type],opeType:e_[e.opeType],toAccids:Ei(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembersPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:dr(dr({},e),{type:ZC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:O_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:dr(dr({},e),{type:ZC[e.type],roleIds:Ei(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",oE(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(ZC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:dr(dr({},e),{type:ZC[e.type],accids:Ei(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",O_(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:C_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryChannelsPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:I_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeChannel=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),!this.config.autoSubscribe||e.isInternalTrigger||5===e.type){t.next=3;break}throw new Nl("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return t.next=5,this.subscribeModuleService.subscribe(e);case 5:if((r=t.sent).unreadInfos=S_(r.unreadInfos),5!==e.type){t.next=10;break}return this.subscribeModuleService.cacheSubscribe(e),t.abrupt("return");case 10:return 1===e.opeType&&(e.channels=lu(n=r.unreadInfos).call(n,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",e),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(e):this.subscribeModuleService.cacheSubscribe(e),this.subscribeModuleService.updateUnreads(r.unreadInfos),t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)})))},r.getChannelUnreadInfos=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetUnreadInfo",e);case 2:return r=t.sent,n=S_(r.content.unreadInfos),this.subscribeModuleService.updateUnreads(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelSearchByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:Rp(r_),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:Rp(XC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new wl("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:dr(dr({},e),{order:e.order&&r_[e.order],sort:Dm(e)&&XC[Dm(e)]})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag),cursor:o.cursor},datas:I_(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.channelMemberSearch=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:e});case 3:return r=t.sent,t.abrupt("return",__(r.content.datas));case 5:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatAutoSubscribeNotificationHandler=function(e){var t=S_(e.content.unreadInfos),r=e.content.serverIds;this.subscribeModuleService.updateUnreads(t);var n=[];if(r.length){var i={opeType:1};i.channels=lu(r).call(r,(function(e){return{serverId:e.serverId,channelId:""}})),i.type=4,n.push(i)}if(t.length){var o={opeType:1};o.channels=lu(t).call(t,(function(e){return{serverId:e.serverId,channelId:e.channelId}})),o.type=1,n.push(o)}if(n.length)for(var a,s=gE(n);!(a=s()).done;){var c=a.value;this.subscribeModuleService.cacheAutoSubscribe(c)}},t}(a_),ME={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},IE={limit:{type:"number"}};function TE(e){return ki(e)&&e.length>0?lu(e).call(e,(function(e){return function(e){return Uh(ME,e)}(e)})):[]}function SE(e){try{e.audio&&(e.audio=JSON.parse(e.audio))}catch(e){throw new wl('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{e.video&&(e.video=JSON.parse(e.video))}catch(e){throw new wl('result "video" JSON parse error',{key:"video"},"JSON parse error")}return Uh(IE,e)}var bE,CE={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},_E={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},EE=function(){var e=function(){return bh(_E)}();return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:_E.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:e.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:_E.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:_E.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:e.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:_E.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:e.memberInfo}]}}},kE=function(e){function t(t,r){var n;return(n=e.call(this,"qchatMedia",t)||this).config={},n.tokenExpireTime=24e4,n.getTokenState=!1,n.core=t,Sh({cmdMap:CE,cmdConfig:EE()}),r&&n.setOptions(r),n.setListener(),n.tokenExpireTime=24e4,n.channelId="",n.serverId="",n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=dr(this.config,e),(null==e?void 0:e.neroom)&&this.setNeroom(e.neroom))},r.setNeroom=function(e){this.neroom=new e},r.setListener=function(){var e,t,r,n,i=this;this.core.eventBus.on("disconnect",tr(e=this._existRomm).call(e,this)),this.core.eventBus.on("kicked",tr(t=this._existRomm).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",tr(r=this._existRomm).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",tr(n=this._existRomm).call(n,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(e){return Xl(i,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.type===J_[J_.channelVisibilityUpdate]&&e.channelId===this.channelId||e.type===J_[J_.serverEnterLeave]&&e.serverId===this.serverId)){t.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){t.next=4;break}return t.next=4,this.disconnectChannel();case 4:case"end":return t.stop()}}),t,this)})))}))},r._existRomm=function(){return Xl(this,void 0,void 0,zl.mark((function e(){return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.roomContext){e.next=3;break}return e.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return e.stop()}}),e,this)})))},r._checkPermission=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.qchatRole.checkPermission(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))},r._checkConnectState=function(){if("connect"!==this.state)throw new Nl("QChatMedia::you should connect first")},r.kickMemberOut=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,r.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.kickMemberOut(e.accid);case 5:r.next=11;break;case 7:throw r.prev=7,r.t0=r.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+Ei(e),r.t0),new Nl("QChatMedia::kickMemberOut error",r.t0);case 11:case"end":return r.stop()}}),r,this,[[2,7]])})))},r.disconnectChannel=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),t.prev=1,t.next=4,null===(e=this.roomContext)||void 0===e?void 0:e.leaveRoom();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),this.logger.error("QChatMedia::disconnect error",t.t0);case 9:if(!this.authService){t.next=12;break}return t.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return t.stop()}}),t,this,[[1,6]])})))},r._setStateInit=function(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},r.muteAudio=function(e){var t,r,n,i,o;return Xl(this,void 0,void 0,zl.mark((function a(){var s;return zl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyAudio();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteAudio error",a.t0),new Nl("QChatMedia::muteAudio error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+Ei(e),a.t1),new Nl("QChatMedia::muteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteAudio=function(e){var t,r,n,i,o;return Xl(this,void 0,void 0,zl.mark((function a(){var s;return zl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyAudio();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteAudio error",a.t0),new Nl("QChatMedia::unMuteAudio error",a.t0);case 20:case 25:a.next=31;break;case 22:return a.prev=22,a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.unmuteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+Ei(e),a.t1),new Nl("QChatMedia::unMuteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[11,16],[22,27]])})))},r.muteVideo=function(e){var t,r,n,i,o;return Xl(this,void 0,void 0,zl.mark((function a(){var s;return zl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyVideo();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteVideo error",a.t0),new Nl("QChatMedia::muteVideo error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberVideo(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+Ei(e),a.t1),new Nl("QChatMedia::muteVideo error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteVideo=function(e){var t,r,n,i,o;return Xl(this,void 0,void 0,zl.mark((function a(){var s;return zl.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyVideo();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteVideo error",a.t0),new Nl("QChatMedia::unMuteVideo error",a.t0);case 20:a.next=30;break;case 22:a.prev=22,null===(o=this.rtcController)||void 0===o||o.unmuteMemberVideo(e.accid),a.next=30;break;case 26:throw a.prev=26,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteVideo error",a.t1),new Nl("QChatMedia::unMuteVideo error",a.t1);case 30:case"end":return a.stop()}}),a,this,[[11,16],[22,26]])})))},r.startScreenShare=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.startScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::startScreenShare error",t.t0),new Nl("QChatMedia::startScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopScreenShare=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.stopScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::stopScreenShare error",t.t0),new Nl("QChatMedia::stopScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopMemberScreenShare=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.stopMemberScreenShare(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",r.t0),new Nl("QChatMedia::stopMemberScreenShare error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.subscribeRemoteVideoStream=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",r.t0),new Nl("QChatMedia::subscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unSubscribeRemoteVideoStream=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",r.t0),new Nl("QChatMedia::unSubscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.setupVideoCanvas=function(e){var t;if(this._checkConnectState(),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{return this.rtcController.setupLocalVideoCanvas(e.videoView)}catch(e){throw this.logger.error("QChatMedia::setupVideoCanvas error",e),new Nl("QChatMedia::setupVideoCanvas error",e)}else try{return this.rtcController.setupRemoteVideoCanvas(e.videoView,e.accid)}catch(e){throw this.logger.error("QChatMedia::setupVideoCanvas error",e),new Nl("QChatMedia::setupVideoCanvas error",e)}},r.setupRemoteVideoSubStreamCanvas=function(e){this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(e.videoView,e.accid)}catch(e){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",e),new Nl("QChatMedia::setupRemoteVideoSubStreamCanvas error",e)}},r.getScreenSharingUserUuid=function(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(e){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",e),new Nl("QChatMedia::getScreenSharingUserUuid error",e)}},r.initQChatMedia=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.neroom){t.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),t.abrupt("return");case 3:if(void 0===this.state){t.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),t.abrupt("return");case 6:t.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:e.serverConfig}),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(6),this.logger.error("QChatMedia::initQChatMedia error",t.t0),new Nl("QChatMedia::initQChatMedia error",t.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return t.stop()}}),t,this,[[6,10]])})))},r.loginByIM=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("init"===this.state){t.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),t.abrupt("return");case 3:return t.next=5,this._getToken();case 5:return r=t.sent,n=tm(this.core,"options.token")||tm(this.core,"V2NIMLoginService.token"),t.prev=7,t.next=10,null===(e=this.authService)||void 0===e?void 0:e.loginByIM(this.core.account,r,n);case 10:t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(7),this.logger.error("QChatMedia::loginByIM error",t.t0),new Nl("QChatMedia::loginByIM error",t.t0);case 16:this.state="login";case 17:case"end":return t.stop()}}),t,this,[[7,12]])})))},r._getToken=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),t.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(e=this.neroom)||void 0===e?void 0:e.deviceId}});case 3:return r=t.sent,n=r.content.neroomToken,i=n.token,o=n.expire,this.logger.log("QChatMedia::getToken success token is "+i+",expire is "+o+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*o-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return Xl(a,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,e.next=4,this._getToken();case 4:t=e.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return e.stop()}}),e,this)})))}),1e3*o-this.tokenExpireTime)),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.connectChannel=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==this.state){n.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),n.abrupt("return");case 3:if("init"!==this.state){n.next=6;break}return n.next=6,this.loginByIM();case 6:return this.serverId=e.serverId,this.channelId=e.channelId,n.prev=8,n.next=11,null===(t=this.roomService)||void 0===t?void 0:t.joinRoom({roomUuid:e.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:n.next=17;break;case 13:throw n.prev=13,n.t0=n.catch(8),this.logger.error("QChatMedia::connectChannel error",n.t0),new Nl("QChatMedia::connectChannel error",n.t0);case 17:if(!(i=null===(r=this.roomService)||void 0===r?void 0:r.getRoomContext(e.channelId))){n.next=28;break}return this.roomContext=i,this.rtcController=this.roomContext.rtcController,this.state="connect",n.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),n.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return n.stop()}}),n,this,[[8,13]])})))},r.updateRTCChannelInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:dr(dr({},e),{audio:Ei(e.audio),video:Ei(e.video)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:e});case 3:return r=t.sent,t.abrupt("return",SE(r.content.RTCChannelConfig));case 5:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelOnlineMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:e});case 3:return r=t.sent,t.abrupt("return",TE(r.content.memberList));case 5:case"end":return t.stop()}}),t,this)})))},r.addRTCChannelListener=function(){var e,t,r=this;this._checkConnectState();try{null===(e=this.authService)||void 0===e||e.addAuthListener({onAuthEvent:function(e){return Xl(r,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1026!==e||this.getTokenState){t.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,t.next=5,this._getToken();case 5:if(r=t.sent,!this.authService){t.next=9;break}return t.next=9,this.authService.renewToken(r);case 9:this.getTokenState=!1;case 10:case"end":return t.stop()}}),t,this)})))}})}catch(e){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",e),new Nl("QChatMedia::loginByIM addAuthListener error",e)}null===(t=this.roomContext)||void 0===t||t.addRoomListener({onRoomPropertiesChanged:function(e){var t,n,i,o,a,s;if(r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",e),e.audioOff){var c=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];"offNotAllowSelfOn"!==c&&"offAllowSelfOn"!==c||(null===(n=r.roomContext)||void 0===n?void 0:n.localMember.isAudioOn)&&(null===(i=r.rtcController)||void 0===i||i.muteMyAudio())}else if(e.videoOff){var u=null===(o=e.videoOff.value)||void 0===o?void 0:o.split("_")[0];"offNotAllowSelfOn"!==u&&"offAllowSelfOn"!==u||(null===(a=r.roomContext)||void 0===a?void 0:a.localMember.isVideoOn)&&(null===(s=r.rtcController)||void 0===s||s.muteMyVideo())}},onRoomPropertiesDeleted:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",e)},onMemberJoinRtcChannel:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",e);var t=lu(e).call(e,(function(e){return e.uuid}));r.core.emit("memberJoinRTCChannel",t),r.core.qchatMedia.emit("memberJoinRTCChannel",t)},onMemberLeaveRoom:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",e);var t=lu(e).call(e,(function(e){return e.uuid}));r.core.emit("memberLeaveRTCChannel",t),r.core.qchatMedia.emit("memberLeaveRTCChannel",t)},onRoomEnded:function(e){r.authService&&r.authService.logout(),r._setStateInit(),r.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",e),r.core.emit("RTCChannelEnded",e),r.core.qchatMedia.emit("RTCChannelEnded",e)},onRtcChannelError:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",e),"SOCKET_ERROR"===e&&r.disconnectChannel(),r.core.emit("RTCChannelError",e),r.core.qchatMedia.emit("RTCChannelError",e)},onRtcAudioVolumeIndication:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",e),r.core.emit("onRtcAudioVolumeIndication",e),r.core.qchatMedia.emit("onRtcAudioVolumeIndication",e)},onMemberAudioMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",e,t),r.core.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})},onMemberScreenShareStateChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",e,t),r.core.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid})},onMemberVideoMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",e,t),r.core.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})}})},r.enumCameraDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumCameraDevices error",t),new Nl("QChatMedia::enumCameraDevices error",t)}))},r.enumPlayoutDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumPlayoutDevices error",t),new Nl("QChatMedia::enumPlayoutDevices error",t)}))},r.enumRecordDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumRecordDevices error",t),new Nl("QChatMedia::enumRecordDevices error",t)}))},r.removeRTCChannelListener=function(){var e,t;this._checkConnectState(),null===(e=this.roomContext)||void 0===e||e.removeRoomListener({}),null===(t=this.authService)||void 0===t||t.removeAuthListener({})},r.setSelectedCameraDevice=function(e){var t=this;return this._checkConnectState(),Vl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedCameraDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedCameraDevice error",e),new Nl("QChatMedia::setSelectedCameraDevice error",e)}))},r.setSelectedPlayoutDevice=function(e){var t=this;return this._checkConnectState(),Vl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedPlayoutDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedPlayoutDevice error",e),new Nl("QChatMedia::setSelectedPlayoutDevice error",e)}))},r.setSelectedRecordDevice=function(e){var t=this;return this._checkConnectState(),Vl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedRecordDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedRecordDevice error",e),new Nl("QChatMedia::setSelectedRecordDevice error",e)}))},r.getRTCMembers=function(){var e,t;return this._checkConnectState(),lu(e=gu(t=this.roomContext.remoteMembers).call(t,(function(e){return e.isInRtcChannel}))).call(e,(function(e){return{accid:e.uuid,isAudioOn:!!e.isAudioOn,isVideoOn:!!e.isVideoOn,isSharingScreen:!!e.isSharingScreen,properties:e.properties}}))},r.subscribeRemoteVideoSubStream=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",r.t0),new Nl("QChatMedia::subscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unsubscribeRemoteVideoSubStream=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Vl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0),new Nl("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.muteAllAudio=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",Ei({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllAudio error",t.t0),new Nl("QChatMedia::muteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.muteAllVideo=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",Ei({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllVideo error",t.t0),new Nl("QChatMedia::muteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllAudio=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",Ei({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",t.t0),new Nl("QChatMedia::unMuteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllVideo=function(){var e;return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",Ei({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",t.t0),new Nl("QChatMedia::unMuteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},t}(a_),wE={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},RE={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:c_},AE=function(){return bh(RE)},xE=function(){var e=AE();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:RE.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:RE.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:RE.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:RE.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:RE.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:RE.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:RE.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:RE.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:e.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:RE.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:RE.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:RE.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:RE.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:e.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:RE.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:RE.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:RE.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:e.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:e.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]}}};!function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(bE||(bE={}));var NE,OE={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},PE={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:c_},LE=function(){return bh(PE)},VE=function(){var e=LE();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:PE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:PE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:PE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:PE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:e.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:PE.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:PE.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:PE.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:PE.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:PE.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:PE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:PE.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:PE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:e.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:PE.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:e.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},UE={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},DE={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},qE=function(){return bh(DE)},BE=function(){var e=qE();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:DE.serverRole},{type:"Property",name:"antispamTag",reflectMapper:DE.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:DE.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:DE.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:DE.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:DE.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:DE.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:DE.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:DE.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:DE.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:DE.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:DE.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:DE.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:DE.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},FE=["image","audio","video","file"],GE={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:J_},fromClientType:{type:"enum",values:bE},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function jE(e,t){var r=dr({},e),n=dr({type:t||J_.custom},Bh(GE,r));return n.serverId&&n.channelId&&n.toAccids?n.toType=4:n.serverId&&n.toAccids?n.toType=3:n.serverId&&n.channelId?n.toType=2:n.serverId?n.toType=1:n.toAccids?n.toType=5:n.toType=0,n}function HE(e){var t=cg(e,["msgIdServer","type"]);return Bh(GE,t)}var WE=((NE={})[J_.channelUpdateWhiteBlackIdentify]=function(e){var t=d_();return e.notify=y_(Th(e.notify,t.qchatUpdateWhiteBlackRoleTag)),e},NE[J_.channelUpdateWhiteBlackIdentifyUser]=function(e){var t=d_();return e.notify=function(e){return Uh(h_,e)}(Th(e.notify,t.qchatUpdateWhiteBlackMembersTag)),e},NE[J_.updateQuickComment]=function(e){var t=AE();return e.notify=function(e){return Uh(tk,e)}(Th(e.notify,t.qchatQuickCommentRequestTag)),e},NE[J_.channelCategoryCreate]=function(e){var t=d_();return e.categoryInfo=b_(Th(e.categoryInfo,t.QChatChannelCategoryInfo)),e},NE[J_.channelCategoryUpdate]=function(e){var t=d_();return e.categoryInfo=b_(Th(e.categoryInfo,t.QChatChannelCategoryInfo)),e},NE[J_.channelCategoryUpdateWhiteBlackIdentify]=function(e){var t=d_();return e.notify=y_(Th(e.notify,t.qchatUpdateChannelCategoryWhiteBlackRoleTag)),e},NE[J_.channelCategoryUpdateWhiteBlackIdentifyUser]=function(e){var t=d_();return e.notify=y_(Th(e.notify,t.qchatUpdateChannelCategoryWhiteBlackMembersTag)),e},NE[J_.serverIdentifyAdd]=function(e){var t=qE();return e.serverIdentifyInfo=iE(Th(e.serverIdentifyInfo,t.serverRole)),e},NE[J_.serverIdentifyRemove]=function(e){var t=qE();return e.serverIdentifyInfo=iE(Th(e.serverIdentifyInfo,t.serverRole)),e},NE[J_.serverIdentifyUpdate]=function(e){var t=qE();return e.serverIdentifyInfo=iE(Th(e.serverIdentifyInfo,t.serverRole)),e},NE[J_.channelIdentifyUpdate]=function(e){var t=qE();return e.channelIdentifyInfo=iE(Th(e.channelIdentifyInfo,t.channelRole)),e},NE[J_.userIdentifyUpdate]=function(e){var t=qE();return e.userIdentifyInfo=iE(Th(e.userIdentifyInfo,t.memberRole)),e},NE[J_.myMemberInfoUpdated]=function(e){var t,r=tm(e,"userInfo.name"),n=tm(e,"userInfo.icon");return e.updatedInfos=lu(t=e.reuseServers).call(t,(function(e){var t={serverId:e.serverId};return 1==(1&e.bits)&&"string"==typeof r&&dr(t,{nickChanged:!0,nick:r}),2==(2&e.bits)&&"string"==typeof n&&dr(t,{avatarChanged:!0,avatar:n}),t})),delete e.userInfo,delete e.reuseServers,e},NE);function YE(e,t){var r=Uh(GE,e);if(!r.attach)return r;var n=LE(),i=d_();if(r.attach.serverInfo&&(r.attach.serverInfo=A_(Th(r.attach.serverInfo,n.serverInfo))),r.attach.channelInfo&&(r.attach.channelInfo=M_(Th(r.attach.channelInfo,i.channelInfo))),r.attach.serverMember&&(r.attach.serverMember=N_(Th(r.attach.serverMember,n.memberInfo))),WE[r.attach.type]&&(r.attach=WE[r.attach.type](r.attach)),r.attach.updateAuths)try{r.attach.updateAuths=nE(JSON.parse(r.attach.updateAuths))}catch(e){t.error("formatSystemNotification:JSON parse updateAuths error: ",e)}return r.attach.type&&(r.attach.rawType=r.attach.type,r.attach.type=J_[r.attach.type]),r}var KE={type:{type:"enum",values:K_},fromClientType:{type:"enum",values:bE},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:$_},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function QE(e){e.onSendBefore,e.onUploadStart,e.onUploadDone,e.onUploadProgress;var t=Jl(e,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),r=Bh(KE,t);if(r.msgIdClient=e.resendFlag?e.msgIdClient:wp(),!r.msgIdClient)throw new Al("msgIdClient is required for resend a message","msgIdClient","required");return e.replyMessage&&e.replyMessage.msgIdServer&&(r.replyMsgFromAccount=e.replyMessage.fromAccount,r.replyMsgTime=+e.replyMessage.time,r.replyMsgIdServer=e.replyMessage.msgIdServer,r.replyMsgIdClient=e.replyMessage.msgIdClient,e.replyMessage.threadRefer&&e.replyMessage.threadRefer.msgIdServer?(r.threadMsgFromAccount=e.replyMessage.threadRefer.fromAccount,r.threadMsgTime=+e.replyMessage.threadRefer.time,r.threadMsgIdServer=e.replyMessage.threadRefer.msgIdServer,r.threadMsgIdClient=e.replyMessage.threadRefer.msgIdClient):(r.threadMsgFromAccount=e.replyMessage.fromAccount,r.threadMsgTime=+e.replyMessage.time,r.threadMsgIdServer=e.replyMessage.msgIdServer,r.threadMsgIdClient=e.replyMessage.msgIdClient),delete r.replyMessage),r}function $E(e){return Uh({operatorClientType:{type:"enum",values:bE},pushPayload:{type:"object"}},e)}function zE(e,t,r){var n,i;return void 0===t&&(t={}),Xl(this,void 0,void 0,zl.mark((function o(){var a,s,c,u;return zl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return(a=Uh(KE,e)).deliveryStatus=t.deliveryStatus?Q_[t.deliveryStatus]:Q_[Q_.success],t.time&&(a.time=t.time),s=AE(),a.updateContent&&(c=Uh({status:{type:"number"}},c=Th(c=JSON.parse(a.updateContent),s.qchatMsgTag)),a.updateContent=c),a.updateOperatorInfo&&(u=$E(Th(u=JSON.parse(a.updateOperatorInfo),s.qchatMsgUpdateTag)),a.updateOperatorInfo=u),""===(null===(n=null==a?void 0:a.threadRefer)||void 0===n?void 0:n.fromAccount)&&delete a.threadRefer,""===(null===(i=null==a?void 0:a.replyRefer)||void 0===i?void 0:i.fromAccount)&&delete a.replyRefer,a.attach&&t.attachUrl&&(a.attach.url=t.attachUrl),o.next=11,JE(a,r);case 11:return o.abrupt("return",o.sent);case 12:case"end":return o.stop()}}),o)})))}function JE(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(au(FE).call(FE,e.type)&&e.attach&&e.attach.url){r.next=2;break}return r.abrupt("return",e);case 2:if(t&&t.cloudStorage&&"function"==typeof t.cloudStorage.getPrivateUrl&&"function"==typeof t.cloudStorage.getOriginUrl){r.next=4;break}return r.abrupt("return",e);case 4:if(!(wu(n=e.attach.url).call(n,"_im_url=1")<0)){r.next=7;break}return e.attach.url=t.cloudStorage.getPrivateUrl(e.attach.url),r.abrupt("return",e);case 7:return r.prev=7,r.next=10,t.cloudStorage.getOriginUrl(e.attach.url);case 10:e.attach.url=r.sent,r.next=16;break;case 13:throw r.prev=13,r.t0=r.catch(7),new Al('url "'+e.attach.url+'" parse error',"message.attach.url","parse error");case 16:return r.abrupt("return",e);case 17:case"end":return r.stop()}}),r,null,[[7,13]])})))}function XE(e,t,r){return void 0===t&&(t={}),Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(ki(e)&&e.length>0){n.next=2;break}return n.abrupt("return",[]);case 2:return i=lu(e).call(e,(function(e){return zE(e,t,r)})),n.next=5,gs.all(i);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))}var ZE={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function ek(e){var t=lu(e).call(e,(function(e){var t,r=Uh(ZE,e);return r.details=lu(t=r.details).call(t,(function(e){var t=e.createTime?em(e.createTime):0;return t=isNaN(t)?0:t,{count:e.count,hasSelf:e.self,severalAccids:e.topN,type:e.type,createTime:t}})),r})),r={};return jn(t).call(t,(function(e){return r[e.msgIdServer]=e})),r}var tk={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}},rk={includeSelf:{type:"number"},order:{type:"enum",values:r_},sort:{type:"enum",values:Y_},msgTypes:{type:"object"},subTypes:{type:"object"}},nk={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}},ik={6:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(e.serverId),!0},16:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(e.serverId,e.channelId),!0},26:function(e){var t=tm(e,"attach.addAccids");return t&&au(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},27:function(e){var t=tm(e,"attach.deleteAccids");return t&&au(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},31:function(e){var t,r;return 1===e.attach.event?(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:e.serverId,channelId:e.channelId}],isInternalTrigger:!0}):2===e.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)),!0},32:function(e){var t,r;return 2===e.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)):1===e.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(e.serverId),(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:e.serverId}],isInternalTrigger:!0})),!0},34:function(e){return 2===e.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(e.serverId,e.channelId),!0},101:function(e){var t=cg(e,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",t),this.core.emit("recvTypingEvent",t),this.core.qchatMsg.emit("recvTypingEvent",t),!1}},ok=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendSystemNotification=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:jE(e)});case 2:return r=t.sent,n=YE(r.content.sysMsg,this.logger),this.logger.getDebugMode()?this.logger.debug("sendCustomSysMsg success",n):this.logger.log("sendCustomSysMsg success",n.serverId,n.channelId,n.msgIdServer),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},t.updateSystemNotification=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.systemNotification,n=Jl(e,["systemNotification"]),i=cg(r,["msgIdServer","type","body","ext","status"]),o=jE(i),t.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:o,qchatMsgUpdateTag:dr(dr({},n),{operatorAccount:this.core.account,operatorClientType:bE.Web,pushPayload:Ei(e.pushPayload),routeEnable:jh.boolean(e,"routeEnable")})});case 5:return a=t.sent,t.abrupt("return",YE(a.content.sysMsg,this.logger));case 7:case"end":return t.stop()}}),t,this)})))},t.markSystemNotificationsRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:lu(r=e.systemNotifications).call(r,(function(e){return HE(e)}))});case 2:case"end":return t.stop()}}),t,this)})))},t.onSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=YE(t,this.core.logger),n=ik[J_[r.type]];if(n&&!1===n.call(this,r))return;var i={feature:"default",systemNotifications:[r]};this.logger.log("qchat on systemNotification: ",i),this.core.emit("systemNotification",i),this.core.qchatMsg.emit("systemNotification",i)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=YE(t,this.logger);this.core.emit("systemNotificationUpdate",r),this.core.qchatMsg.emit("systemNotificationUpdate",r)}},t.onSyncSysMsg=function(e){var t=this,r=e.content.systemNotifications;if(r&&r.length>0){var n=lu(r).call(r,(function(e){return YE(e,t.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:n}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:n})}else this.logger.warn("sync system notification not exist")},e}(),ak=["image","audio","video","file"],sk=function(){function e(e){var t=this;this.markMessageRead=mE((function(e){return Xl(t,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:e});case 2:r=t.sent,n=T_(r.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[n]);case 5:case"end":return t.stop()}}),t,this)})))}),200),this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendMessage=function(e){var t,r,n,i;return Xl(this,void 0,void 0,zl.mark((function o(){var a,s,c,u,d,l;return zl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!(wu(ak).call(ak,e.type)>-1)){o.next=4;break}return o.next=3,this.doSendFile(e);case 3:e.attach=o.sent;case 4:return a=QE(dr({fromAccount:this.core.account},e)),o.next=7,zE(a,{time:(new Date).getTime(),deliveryStatus:Q_.sending},this.core);case 7:s=o.sent;try{e.onSendBefore&&e.onSendBefore(s)}catch(e){this.logger.error("sendMsg: options.onSendBefore error",e)}return o.prev=9,o.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:a});case 12:c=o.sent,o.next=22;break;case 15:return o.prev=15,o.t0=o.catch(9),o.next=19,zE(a,{time:(new Date).getTime(),deliveryStatus:Q_.failed,attachUrl:null===(t=s.attach)||void 0===t?void 0:t.url},this.core);case 19:throw u=o.sent,o.t0.msg=u,o.t0;case 22:return d=c.content,o.next=25,zE(dr({},d.qchatMsg),{deliveryStatus:Q_.success,attachUrl:null===(r=s.attach)||void 0===r?void 0:r.url},this.core);case 25:if(!(l=o.sent).isAntispam){o.next=29;break}throw{code:10403,msg:l,message:(null===(n=null==l?void 0:l.antiSpamInfo)||void 0===n?void 0:n.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(i=null==l?void 0:l.antiSpamInfo)||void 0===i?void 0:i.yidunAntiSpamRes)||""};case 29:return o.abrupt("return",l);case 30:case"end":return o.stop()}}),o,this,[[9,15]])})))},t.doSendFile=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},t.resendMessage=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(i=QE(dr(dr({},e),{resendFlag:!0}))).deliveryStatus=Q_.sending,n.prev=2,n.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:i});case 5:o=n.sent,n.next=15;break;case 8:return n.prev=8,n.t0=n.catch(2),n.next=12,zE(i,{time:(new Date).getTime(),deliveryStatus:Q_.failed},this.core);case 12:throw a=n.sent,n.t0.msg=a,n.t0;case 15:return s=o.content,n.next=18,zE(dr({},s.qchatMsg),{deliveryStatus:Q_.success},this.core);case 18:if(!(c=n.sent).isAntispam){n.next=22;break}throw{code:10403,msg:c,message:(null===(t=null==c?void 0:c.antiSpamInfo)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=null==c?void 0:c.antiSpamInfo)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 22:return n.abrupt("return",c);case 23:case"end":return n.stop()}}),n,this,[[2,8]])})))},t.doUpdateMessage=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a,s,c;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.message,o=Jl(e,["message"]),(a=QE(i)).msgIdClient=void 0,a.time=i.time,n.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:a,qchatMsgUpdateTag:dr(dr({},o),{operatorAccount:this.core.account,operatorClientType:bE.Web,pushPayload:Ei(e.pushPayload),routeEnable:jh.boolean(e,"routeEnable")})});case 6:return s=n.sent,n.next=9,zE(s.content.qchatMsg,{},this.core);case 9:if(c=n.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!0),!s.content.qchatMsg.isAntispam){n.next=14;break}throw{code:10403,msg:a,message:(null===(t=s.content.qchatMsg)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=s.content.qchatMsg)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 14:return n.abrupt("return",c);case 15:case"end":return n.stop()}}),n,this)})))},t.getHistoryMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:dr(dr({},e),{reverse:qc(e)?1:0})});case 2:return n=t.sent,i=n.content,t.next=6,gs.all(lu(r=i.qchatMsgs).call(r,(function(e){return zE(e,{},o.core)})));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},t.getMentionedMeMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:e});case 2:return n=t.sent,i=n.content,c=i.page,o=Uh(nk,c),t.next=7,gs.all(lu(r=i.datas).call(r,(function(e){return zE(e,{},s.core)})));case 7:return a=t.sent,t.abrupt("return",{pageInfo:o,messages:a});case 9:case"end":return t.stop()}var c}),t,this)})))},t.areMentionedMeMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={},n=0;case 2:if(!(n<e.length)){t.next=13;break}if((i=e[n]).fromAccount!==this.core.account){t.next=7;break}return r[i.msgIdClient]=!1,t.abrupt("continue",10);case 7:return t.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(i,!0);case 9:r[i.msgIdClient]=t.sent;case 10:n++,t.next=2;break;case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)})))},t.getLastMessageOfChannels=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:e});case 2:return r=t.sent,n=r.content.msgs,t.next=6,XE(n,{},this.core);case 6:return i=t.sent,t.abrupt("return",Tl(i).call(i,(function(e,t){return e[t.channelId]=t,e}),{}));case 8:case"end":return t.stop()}}),t,this)})))},t.messageSearchByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:dr(dr({},(s=e,Bh(rk,s))),{includeSelf:e.includeSelf?1:""})});case 2:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.next=6,XE(i,{},this.core);case 6:return a=t.sent,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:o.nextTimetag?em(o.nextTimetag):0,cursor:o.cursor},datas:a});case 8:case"end":return t.stop()}var s}),t,this)})))},t.onMsg=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),t.abrupt("return");case 4:return t.next=6,zE(r,{},this.core);case 6:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1),this.core.emit("message",n),this.core.qchatMsg.emit("message",n);case 10:case"end":return t.stop()}}),t,this)})))},t.onRecvUnreadInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,zE(r);case 5:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1);case 7:case"end":return t.stop()}}),t,this)})))},t.onMultiSyncRead=function(e){var t=e.content.unreadInfo;if(t){var r=T_(t);this.core.eventBus.emit("qchatChannel/updateUnreads",[r])}},t.onMultiSyncServersRead=function(e){var t=e.content.qchatMultiSyncServersMessageReadTag;if(t){var r=H_(t),n=r.successServerIds,i=r.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",n,i)}},t.onRecvMsgUpdate=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg,n=e.content.qchatMsgUpdateInfo,r){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,zE(r,{},this.core);case 6:i=t.sent,o=$E(n),this.core.eventBus.emit("qchatChannel/changeUnread",i,!0),this.core.emit("messageUpdate",i,o),this.core.qchatMsg.emit("messageUpdate",i,o);case 11:case"end":return t.stop()}}),t,this)})))},e}(),ck=function(){function e(e){var t=this;this._sendTypingEvent=mE((function(e){return Xl(t,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:jE(dr(dr({},e),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),J_.msgTyping)});case 2:case"end":return t.stop()}}),t,this)})))}),3e3),this.core=e,this.logger=e.logger,this.lastChannelIdInTyping=""}var t=e.prototype;return t.getMessageHistoryByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:e.serverId,channelId:e.channelId},messageReferList:e.messageReferList});case 2:return n=t.sent,t.abrupt("return",gs.all(lu(r=n.content.qchatMsgs).call(r,(function(e){return zE(e)}))));case 4:case"end":return t.stop()}}),t,this)})))},t.getReferMessages=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null===(t=e.message.replyRefer)||void 0===t?void 0:t.msgIdServer)&&(null===(r=e.message.threadRefer)||void 0===r?void 0:r.msgIdServer)){n.next=2;break}throw new Error("Message has no reply");case 2:return n.next=4,this.getMessageHistoryByIds({serverId:e.message.serverId,channelId:e.message.channelId,messageReferList:[e.message.replyRefer,e.message.threadRefer]});case 4:if(i=n.sent,e.referType!==X_[X_.all]){n.next=9;break}return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 9:if(e.referType!==X_[X_.reply]){n.next=13;break}return n.abrupt("return",{replyMessage:i[0]});case 13:if(e.referType!==X_[X_.thread]){n.next=15;break}return n.abrupt("return",{threadMessage:i[1]});case 15:return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 16:case"end":return n.stop()}}),n,this)})))},t.getThreadMessages=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=(null===(t=e.message.threadRefer)||void 0===t?void 0:t.msgIdServer)?dr({serverId:e.message.serverId,channelId:e.message.channelId},e.message.threadRefer):e.message,r.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:i,getThreadHistoryMsgTag:dr(dr({},e.messageQueryOption),{reverse:jh.boolean(e.messageQueryOption,"reverse")})});case 3:return o=r.sent,r.next=6,zE(o.content.thread);case 6:return a=r.sent,r.next=9,gs.all(lu(n=o.content.qchatMsgs).call(n,(function(e){return zE(e)})));case 9:return s=r.sent,r.abrupt("return",{thread:a,threadInfo:{messageCount:+o.content.threadInfo.messageCount,lastMessageTimestamp:+o.content.threadInfo.lastMessageTimestamp},messages:s});case 11:case"end":return r.stop()}}),r,this)})))},t.getThreadRootMessagesMeta=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.threadRootMessages,n=Jl(e,["threadRootMessages"]),t.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:r,tag:n});case 3:if(i=t.sent,!((o=i.content.metas)&&o.length>0)){t.next=7;break}return t.abrupt("return",lu(o).call(o,(function(e){return dr(dr({},e),{total:em(e.total),timestamp:em(e.timestamp),msgTime:em(e.msgTime)})})));case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t,this)})))},t.getQuickComments=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:e.serverId,channelId:e.channelId,msgIdServerList:Ei(lu(r=e.msgList).call(r,(function(e){return e.msgIdServer})))}});case 2:return n=t.sent,i=n.content.quickCommentResponse,t.abrupt("return",ek(i));case 5:case"end":return t.stop()}}),t,this)})))},t.updateQuickComment=function(e,t){return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Vl({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e),n=e.commentMessage,i=n.serverId,o=n.channelId,a=n.fromAccount,s=n.msgIdServer,c=n.time,r.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:i,channelId:o,fromAccount:a,msgIdServer:s,time:c,type:e.type,opeType:t,opeAccid:this.core.account}});case 4:case"end":return r.stop()}}),r,this)})))},t.sendTypingEvent=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.channelId!==this.lastChannelIdInTyping){t.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(e),t.abrupt("return");case 4:this.lastChannelIdInTyping=e.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(e);case 7:case"end":return t.stop()}}),t,this)})))},e}(),uk=function(e){function t(t){var r;return(r=e.call(this,"qchatMsg",t)||this).core=t,r.lastChannelIdInMark="",Sh({cmdMap:wE,cmdConfig:xE()}),r.notificationModuleService=new ok(t),r.messageModuleService=new sk(t),r.extendModuleService=new ck(t),r}nr(t,e);var r=t.prototype;return r.sendMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(K_)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.sendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},e),!("number"==typeof e.message.status&&e.message.status<1e4)){t.next=3;break}throw new Nl("Status should be greater than or equal to 10000");case 3:return t.next=5,this.messageModuleService.doUpdateMessage(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.resendMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},e),t.next=3,this.messageModuleService.resendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.deleteMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(Ei(e))).message.status=2,t.next=5,this.messageModuleService.doUpdateMessage(r);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.revokeMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(Ei(e))).message=cg(r.message,["serverId","channelId","msgIdServer","time"]),r.message.status=1,t.next=6,this.messageModuleService.doUpdateMessage(r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},r.markMessageRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Vl({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},e),e.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=e.channelId,this.messageModuleService.markMessageRead(e);case 4:case"end":return t.stop()}}),t,this)})))},r.replyMessage=function(e){Vl({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var t=e.replyMessage;if(e.serverId!==t.serverId||e.channelId!==t.channelId)throw new Nl("Forbid replying to message from other server, channel");return this.sendMessage(e)},r.getMessageHistoryByIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getMessageHistoryByIds(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getReferMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:Rp(X_),required:!1}},e),t.next=3,this.extendModuleService.getReferMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},e),t.next=3,this.extendModuleService.getThreadMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadRootMessagesMeta=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getThreadRootMessagesMeta(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendSystemNotification=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},e),t.next=3,this.notificationModuleService.sendSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateSystemNotification=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:Rp(J_)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},e),t.next=3,this.notificationModuleService.updateSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.markSystemNotificationsRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.notificationModuleService.markSystemNotificationsRead(e);case 3:case"end":return t.stop()}}),t,this)})))},r.getHistoryMessage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.getHistoryMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getMentionedMeMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.messageModuleService.getMentionedMeMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.areMentionedMeMessages=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),Ou(r=e.messages).call(r,(function(t){return e.messages[0].serverId===t.serverId}))){t.next=4;break}throw new Nl("Different serverId",e,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(e.messages[0].serverId)){t.next=7;break}throw new Nl("Not allowed for visitor",e,10403);case 7:return t.next=9,this.messageModuleService.areMentionedMeMessages(e.messages);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,1);case 2:case"end":return t.stop()}}),t,this)})))},r.removeQuickComment=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,2);case 2:case"end":return t.stop()}}),t,this)})))},r.getQuickComments=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.extendModuleService.getQuickComments(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendTypingEvent=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.extendModuleService.sendTypingEvent(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getLastMessageOfChannels=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},e),t.next=3,this.messageModuleService.getLastMessageOfChannels(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatOnMsgHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onMsg(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnRecvUnreadInfoHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvUnreadInfo(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnSysMsgHandler=function(e){this.notificationModuleService.onSysMsg(e)},r.qchatMultiSyncMessageReadHandler=function(e){this.messageModuleService.onMultiSyncRead(e)},r.qchatMultiSyncSystemNotificationUpdateHandler=function(e){this.notificationModuleService.onMultiSysMsg(e)},r.qchatSyncSystemNotificationHandler=function(e){this.notificationModuleService.onSyncSysMsg(e)},r.qchatRecvMessageUpdateHandler=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvMsgUpdate(e);case 1:case"end":return t.stop()}}),t,this)})))},r.searchMsgByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:Rp(r_),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:Rp(Y_),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.messageModuleService.messageSearchByPage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatMultiSyncServersMessageReadHandler=function(e){this.messageModuleService.onMultiSyncServersRead(e)},t}(a_),dk=function(){function e(e){this.core=e}var t=e.prototype;return t.addChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",aE(r.content.channelCategoryRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:rE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Nl("No update required",{},406);case 6:return t.abrupt("return",aE(r.content.channelCategoryRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,ki(n)&&n.length>0?lu(n).call(n,(function(e){return aE(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},t.addChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",sE(r.content.channelCategoryMemberRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:rE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Nl("No update required",{},406);case 6:return t.abrupt("return",sE(r.content.channelCategoryMemberRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,ki(n)&&n.length>0?lu(n).call(n,(function(e){return sE(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},e}(),lk=function(e){function t(t){var r;return(r=e.call(this,"qchatRole",t)||this).core=t,Sh({cmdMap:UE,cmdConfig:BE()}),r.category=new dk(t),r}nr(t,e);var r=t.prototype;return r.createServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:dr(dr({},rE(e)),{type:q_.custom}),antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",iE(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:rE(e),antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",iE(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteServerRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.getServerRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:rE(e)});case 3:return n=t.sent,i=gu(r=n.content.serverRoles).call(r,(function(e){return 1===em(e.isMember)})),i=lu(i).call(i,(function(e){return e.roleId})),t.abrupt("return",{roles:oE(n.content.serverRoles),isMemberRoles:i});case 7:case"end":return t.stop()}}),t,this)})))},r.addChannelRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:rE(e)});case 3:return r=t.sent,t.abrupt("return",iE(r.content.channelRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:e});case 3:return r=t.sent,t.abrupt("return",oE(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:rE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Nl("No update required",{},406);case 6:return t.abrupt("return",iE(r.content.channelRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:e});case 3:return r=t.sent,t.abrupt("return",iE(r.content.memberRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getMemberRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:e});case 3:return r=t.sent,t.abrupt("return",oE(r.content.memberRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:e});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:rE(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Nl("No update required",{},406);case 6:return t.abrupt("return",iE(r.content.memberRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMembersToServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatAddMembersToServerRole",dr(dr({},e),{accids:Ei(e.accids)}));case 3:return r=t.sent,n=tm(r,"content.accids.successAccids"),i=tm(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.removeMembersFromServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",dr(dr({},e),{accids:Ei(e.accids)}));case 3:return r=t.sent,n=tm(r,"content.accids.successAccids"),i=tm(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.getMembersFromServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:e});case 3:return r=t.sent,t.abrupt("return",oE(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerRolesByAccid=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:e});case 3:return r=t.sent,t.abrupt("return",oE(r.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingServerRolesByAccids=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:e.serverId,accids:Ei(e.accids)});case 3:return r=t.sent,t.prev=4,i=JSON.parse(r.content.serverRoles),jn(n=fr(i)).call(n,(function(e){var t;jn(t=i[e]).call(t,(function(t,r){i[e][r]=Th(t,qE().serverRole)})),i[e]=oE(i[e])})),t.abrupt("return",i);case 10:throw t.prev=10,t.t0=t.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+e.serverId+" and "+e.accids,r.content.serverRoles),t.t0;case 14:case"end":return t.stop()}}),t,this,[[4,10]])})))},r.getExistingChannelRolesByServerRoleIds=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:e.serverId,channelId:e.channelId,roleIds:Ei(e.roleIds)});case 3:return r=t.sent,t.abrupt("return",oE(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsOfMemberRoles=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:e.serverId,channelId:e.channelId,accids:Ei(e.accids)});case 3:return r=t.sent,n=r.content.memberRoles,t.abrupt("return",n&&n.length>0?lu(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsInServerRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:e.serverId,roleId:e.roleId,accids:Ei(e.accids)});case 3:return r=t.sent,n=r.content.members,t.abrupt("return",n&&n.length>0?lu(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.updateServerRolePriorities=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:e.serverId,serverRoles:lu(r=e.serverRoles).call(r,(function(e){return{serverId:e.serverId,roleId:e.roleId,priority:e.priority}}))});case 3:return n=t.sent,t.abrupt("return",oE(n.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.checkPermission=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},e),t.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:dr(dr({},e),{auth:G_[e.auth]||e.auth})});case 3:return r=t.sent,t.abrupt("return",r.content.checked);case 5:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryMemberRole=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.checkPermissions=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},e),this.core.logger.log("qchatRole::checkPermission options is",e),t.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:dr(dr({},e),{auths:Ei(lu(r=e.auths).call(r,(function(e){return G_[e]||e})))})});case 4:return i=t.sent,this.core.logger.log("qchatRole::checkPermission result is",i.content),o={},jn(n=i.content.checkPermissionsResult).call(n,(function(e){o[e.auth]=e.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",o),t.abrupt("return",nE(o));case 10:case"end":return t.stop()}}),t,this)})))},t}(a_);function pk(e,t){var r,n=void 0!==Nc&&jl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(ki(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return mk(e,t);var n=Yc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Gl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mk(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mk(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var hk=function(e){function t(t){var r;return(r=e.call(this,"qchatServer",t)||this).core=t,Sh({cmdMap:OE,cmdConfig:VE()}),r}nr(t,e);var r=t.prototype;return r.createServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:dr(dr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",A_(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatDeleteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:dr(dr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",A_(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetServers",e);case 3:return r=t.sent,t.abrupt("return",x_(r.content.serverList));case 5:case"end":return t.stop()}}),t,this)})))},r.getServersByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:x_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.inviteServerMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatInviteServerMembers",e);case 3:return r=t.sent,n=r.content.record||{},t.abrupt("return",{failByOverAccids:r.content.failByOverAccids,failByBanAccids:r.content.failByBanAccids,recordInfo:U_(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.acceptServerInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerInvite",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectInviteServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectInviteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applyServerJoin=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatApplyServerJoin",e);case 3:return r=t.sent,t.abrupt("return",U_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.acceptServerApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectServerApply=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.kickServerMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatKickServerMembers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.leaveServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:e,antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",N_(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerMemberInfo=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:e,antispamTag:L_(e)});case 3:return r=t.sent,t.abrupt("return",N_(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerMembers=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({accids:{type:"array"}},e),r=[],e.accids.length)for(n=pk(e.accids);!(i=n()).done;)o=i.value,r.push(o.serverId+"|"+o.accid);return t.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:r});case 5:return a=t.sent,t.abrupt("return",O_(a.content.accidList));case 7:case"end":return t.stop()}}),t,this)})))},r.getServerMembersByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:O_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeServer=function(e){var t,r,n,i;return Xl(this,void 0,void 0,zl.mark((function o(){var a,s,c,u;return zl.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(Vl({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)||e.isInternalTrigger){o.next=3;break}throw new Nl("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(e.type||(e.type=4),!e.servers.length){o.next=12;break}return s=dr(dr({},e),{channels:lu(a=e.servers).call(a,(function(e){return{serverId:e.serverId,channelId:""}}))}),o.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(s);case 8:return c=o.sent,u=c.failedChannels,(null===(i=null===(n=this.core.qchatChannel)||void 0===n?void 0:n.config)||void 0===i?void 0:i.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(s):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(s),o.abrupt("return",{failedServers:u});case 12:case"end":return o.stop()}}),o,this)})))},r.banServerMember=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:dr(dr({},e),{opeType:1})});case 3:case"end":return t.stop()}}),t,this)})))},r.unbanServerMember=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:dr(dr({},e),{opeType:2})});case 3:case"end":return t.stop()}}),t,this)})))},r.getBannedMembersByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag)},datas:P_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.serverSearchByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:Rp(r_),required:!1},searchType:{type:"enum",values:Rp(i_)},sort:{type:"enum",values:Rp(n_),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new wl("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:dr(dr({},e),{order:e.order&&r_[e.order],searchType:i_[e.searchType],sort:Dm(e)&&n_[Dm(e)],serverType:Ei(e.serverType)})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:em(o.nextTimetag),cursor:o.cursor},datas:x_(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.serverMemberSearchByPage=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:e});case 3:return r=t.sent,t.abrupt("return",O_(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.generateInviteCode=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},e),t.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:e});case 3:return r=t.sent,t.abrupt("return",Uh({expireTime:{type:"number"}},r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.joinByInviteCode=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfServer=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:dr(dr({},e),{reverse:qc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",D_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfSelf=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:dr(dr({},e),{reverse:qc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",D_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.markRead=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverIds:{type:"array",itemType:"string",required:!0}},e),t.next=3,this.core.sendCmd("qchatClearServersUnread",e);case 3:return r=t.sent,n=H_(r.content.clearServersUnreadTag),i=n.successServerIds,o=n.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",i,o),t.abrupt("return",n);case 9:case"end":return t.stop()}}),t,this)})))},r.subscribeAllChannel=function(e){var t,r;return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Vl({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)){n.next=3;break}throw new Nl("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return n.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",e,{timeout:3e4});case 5:return(o=n.sent).content.unreadInfos=S_(o.content.unreadInfos),o.content.failServerIds=E_(o.content.failServerIds),a={type:e.type,opeType:1,channels:lu(i=o.content.unreadInfos).call(i,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",a),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",e.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",o.content.unreadInfos),n.abrupt("return",o.content);case 13:case"end":return n.stop()}}),n,this)})))},r.enterAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:Ei(e.serverIds)}});case 3:return r=t.sent,n=E_(r.content.failServerIds),i=Pl(e.serverIds,n),this.core.qchatChannel.subscribeForVisitorService.cacheServer(i),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.leaveAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o=this;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:Ei(e.serverIds)}});case 3:return r=t.sent,n=E_(r.content.failServerIds),i=Pl(e.serverIds,n),jn(i).call(i,(function(e){o.core.qchatChannel.subscribeForVisitorService.deleteServer(e)})),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},e),!e.serverIds.length){t.next=5;break}return t.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(e);case 4:return t.abrupt("return",t.sent);case 5:return t.abrupt("return",{failedServers:[]});case 6:case"end":return t.stop()}}),t,this)})))},t}(a_),fk=function(e){function t(t,r){var n;return(n=e.call(this,"V2NIMNotificationService",t)||this).config={compatibleWithV1:!0},n.notificationUtil=new Jv(n.core),n.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion?ut(n):(Sh({cmdMap:jv,cmdConfig:Yv}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.systemMessage)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onReceiveCustomNotifications"===t){var c=a[0];this.logger.log(""+i,lu(c).call(c,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else if("onReceiveBroadcastNotifications"===t){var u=a[0];this.logger.log(""+i,lu(u).call(u,(function(e){return"id:"+e.id+";sender:"+e.senderId+";time:"+e.time})))}else{var d,l;(d=this.logger).log.apply(d,Os(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},r.sendCustomNotification=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i,o,a;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Dl(this.core.account,e),Vl(zv,{content:t,params:r},"",!0),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=3===i?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",a=this.notificationUtil.generateNotificationTag(e,t,r),n.next=8,this.core.sendCmd(o,{tag:a});case 8:case"end":return n.stop()}}),n,this)})))},r.processSystemNotification=function(e){var t=[0,1,2,3,4,15,16,17,18],r=[5,6],n=e.type;if(au(t).call(t,n))this.core.eventBus.emit("V2NIMTeamService/sysNotification",e);else{if(!au(r).call(r,n)){var i=dr(dr({},e),{conversationType:{100:1,101:2,102:1,103:3}[n]});return delete i.type,i}this.core.eventBus.emit("V2NIMFriendService/sysNotification",e)}},r.markBroadcastMsgAck=function(e){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:lu(e).call(e,(function(e){return e.id}))})},r.syncBroadcastMsgHandler=function(e){var t=e.content.datas;this.markBroadcastMsgAck(t),this.emit("onReceiveBroadcastNotifications",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.data;this.markBroadcastMsgAck([t]),this.emit("onReceiveBroadcastNotifications",[t])},r.onSysNotificationHandler=function(e){this.markSysNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.v2SyncOfflineSysNotificationsHandler=function(e){var t,r,n,i=this;this.markSysNotificationAck(e.content.datas);var o=gu(t=lu(r=Dm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},r.v2NotificationRevokeHandler=function(e){this.markSysNotificationAck([e.content.data])},r.v2NotificationSyncRevokeHandler=function(e){var t=e.content.type;1===em(t)&&this.markSysNotificationAck(e.content.datas)},r.markSysNotificationAck=function(e){if(!this.config.compatibleWithV1){var t=[],r=[],n=[15,16,17,18,103];jn(e).call(e,(function(e){e.idServer&&(au(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:r})}},t}(af),gk={"27_1":"v2NIMSync","27_10":"v2QChatSync"},vk={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},yk=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSyncService",t)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],r.config={},r.timetags={},"v2"!==r.core.options.apiVersion?ut(r):(r.initEventListeners(),Sh({cmdMap:gk,cmdConfig:vk}),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.timetags={}},r.setOptions=function(e){var t=this.core;return this.config=dr({myInfo:!!t.V2NIMUserService.name,offlineMsgs:!!t.V2NIMMessageService.name,roamingMsgs:!!t.V2NIMMessageService.name,relations:!!t.V2NIMUserService.name,friends:!!t.V2NIMFriendService.name,friendUsers:!!t.V2NIMUserService.name,msgReceipts:!!t.V2NIMMessageService.name,broadcastMsgs:!!t.V2NIMNotificationService.name,recallMsg:!!t.V2NIMMessageService.name,sessionAck:!!t.V2NIMConversationService.name,superTeamSessionAck:!!t.V2NIMConversationService.name,superTeamRoamingMsgs:!!t.V2NIMTeamService.name,deleteSuperTeamMsg:!!t.V2NIMTeamService.name,deleteSelfMsgs:!!t.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!t.V2NIMMessageService.name,avSignal:!!t.V2NIMSignallingService.name,teams:!!t.V2NIMTeamService.name,superTeams:!!t.V2NIMTeamService.name,myTeamMembers:!!t.V2NIMTeamService.name,mySuperTeamMembers:!!t.V2NIMTeamService.name,p2pTeamModifyMessage:!!t.V2NIMMessageService.name,superTeamModifyMessage:!!t.V2NIMMessageService.name,stickTopSessions:!!t.V2NIMLocalConversationService.name},e),this.config},r.doBasicSync=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o,a=this;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=fr(this.config),r=gu(t).call(t,(function(e){var t;return!au(t=a.teamKey).call(t,e)&&a.config[e]})),n=this.genSyncParams(r),this.logger.log("V2Sync:basic",n),e.next=6,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 6:return i=e.sent,o=i.content.timetag,this.setTimetags(o,r),e.next=11,this.delaySyncDone();case 11:return e.next=13,this.handleImmediate();case 13:this.core.logger.log("sync::basic sync complete in",o);case 14:case"end":return e.stop()}}),e,this)})))},r.doTeamSync=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i,o,a=this;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=gu(t=this.teamKey).call(t,(function(e){return a.config[e]}))).length){e.next=3;break}return e.abrupt("return");case 3:return n=this.genSyncParams(r),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",n),i=null,e.prev=7,e.next=10,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 10:i=e.sent,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",e.t0),e.t0;case 17:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),o=i.content.timetag,this.setTimetags(o,this.teamKey),this.core.logger.log("sync::team sync complete in",o);case 21:case"end":return e.stop()}}),e,this,[[7,13]])})))},r.doQchatSync=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:t=e.sent,this.core.logger.log("sync::qchat sync complete in",t.content.timetag);case 4:case"end":return e.stop()}}),e,this)})))},r.doSync=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=tm(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))){e.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),e.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2,subType:"mainSync"}),1!==t){e.next=20;break}return e.prev=7,e.next=10,this.doBasicSync();case 10:return e.next=12,this.doTeamSync();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),this.doSyncComplete(e.t0),e.abrupt("return");case 18:e.next=49;break;case 20:if(2!==t){e.next=32;break}return e.prev=21,e.next=24,this.doQchatSync();case 24:e.next=30;break;case 26:return e.prev=26,e.t1=e.catch(21),this.doSyncComplete(e.t1),e.abrupt("return");case 30:e.next=49;break;case 32:if(3!==t){e.next=48;break}return e.prev=33,e.next=36,this.doBasicSync();case 36:return e.next=38,this.doTeamSync();case 38:return e.next=40,this.doQchatSync();case 40:e.next=46;break;case 42:return e.prev=42,e.t2=e.catch(33),this.doSyncComplete(e.t2),e.abrupt("return");case 46:e.next=49;break;case 48:return e.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return e.stop()}}),e,this,[[7,14],[21,26],[33,42]])})))},r.doSyncComplete=function(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})},r.initEventListeners=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.doSync()}))},r.genSyncParams=function(e){var t=this;return Tl(e).call(e,(function(e,r){var n=r;return e[n]=t.timetags[n]||0,e}),{})},r.setTimetags=function(e,t){var r=this;jn(t).call(t,(function(t){r.timetags[t]=e}))},r.handleImmediate=function(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),gs.resolve()},r.delaySyncDone=function(){return"ALI"===Np()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new gs((function(e){Bs((function(){e()}),100)}))):gs.resolve()},t}(af),Mk="V2NIMAIService",Ik={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList"},Tk={accountId:1,messages:{id:2,converter:Eh,retConverter:kh},requestId:3,content:{id:4,converter:Eh,retConverter:kh},promptVariables:5,modelConfigParams:{id:6,converter:Eh,retConverter:kh},antispamBusinessId:7,antispamEnabled:{id:8,converter:_h}},Sk={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:function(e){if(e=kh(e)){var t=fr(e),r=Tl(t).call(t,(function(t,r){var n=function(e){var t;return lu(t=(e=e||"").split("_")).call(t,(function(e,t){return 0===t?e:e[0].toUpperCase()+Yc(e).call(e,1)})).join("")}(r);return t[n]=e[r],t}),{});if("string"==typeof r.promptKeys)try{r.promptKeys=JSON.parse(r.promptKeys)}catch(e){}return r}}},yunxinConfig:{id:13,retConverter:function(e){if(e=kh(e))return e}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}},bk={v2AIChatNotify:{sid:4,cid:26,service:Mk,response:[{type:"Property",name:"data",reflectMapper:Ch({code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:kh}})}]},v2AIProxyModelCall:{sid:29,cid:35,service:Mk,params:[{type:"Property",name:"tag",reflectMapper:Tk}]},v2AIGetUserList:{sid:29,cid:36,service:Mk,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(Sk)},{type:"Property",name:"queryTag",reflectMapper:Ch({hasMore:{id:16,retType:"boolean"},nextToken:2})}]}},Ck=function(e){function t(t){var r;return r=e.call(this,"V2NIMAIService",t)||this,Sh({cmdMap:Ik,cmdConfig:bk}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onProxyAIModelCall"===t){var c=a[0];this.logger.log(""+i,"code:"+c.code+";accountId:"+c.accountId+";requestId:"+c.requestId)}else{var u,d;(u=this.logger).log.apply(u,Os(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,Os(n=[this,t]).call(n,a))},r.getAIUserList=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2AIGetUserList",{tag:{}});case 3:return t=e.sent,e.abrupt("return",t.content.datas);case 5:case"end":return e.stop()}}),e,this)})))},r.proxyAIModelCall=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl(Eg,e,"",!0),t.next=3,this.core.sendCmd("v2AIProxyModelCall",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.v2AIChatNotifyHandler=function(e){var t=e.content.data;t&&t.requestId?this.emit("onProxyAIModelCall",{code:t.code||200,accountId:t.accountId,requestId:t.requestId,content:t.content}):this.logger.warn("v2AIChatNotifyHandler: invalid data",t)},t}(af),_k={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},Ek="V2NIMSignallingService",kk={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},wk={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},channelValid:{id:8,retDef:!0,retAccess:"channelInfo.channelValid",retConverter:function(e){return 1!==em(e)}},fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:_h,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:_h,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:function(e){try{var t=JSON.parse(e);return lu(t).call(t,(function(e){return Th(e,Ch(kk))}))}catch(e){return}}},attach:{id:19,retConverter:kh},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:_h,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},Rk={v2SignallingCall:{sid:18,cid:16,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingCallSetup:{sid:18,cid:17,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingInvite:{sid:18,cid:6,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}]},v2SignallingSendControl:{sid:18,cid:10,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:Ek,response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:Ek,response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:Ek,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(wk)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:Ek,response:[{type:"PropertyArray",name:"datas",reflectMapper:Ch(wk)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:Ek,params:[{type:"Property",name:"tag",reflectMapper:wk}],response:[{type:"Property",name:"data",reflectMapper:Ch(wk)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:Ek,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},Ak={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},xk={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},Nk={channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},Ok={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},Pk={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},Lk={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},Vk={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},Uk={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},Dk={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},qk={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},Bk=qk;function Fk(e){var t,r=e.attach,n={eventType:r.type,channelInfo:e.channelInfo,operatorAccountId:e.fromAccid,time:e.time,serverExtension:e.serverExtension,requestId:e.requestId,pushConfig:e.pushConfig,unreadEnabled:null===(t=e.signallingConfig)||void 0===t?void 0:t.unreadEnabled},i=e.fromAccid,o=e.toAccid;switch(n.eventType){case 1:break;case 2:n.member={accountId:r.member[1],uid:Number(r.member[2]),joinTime:Number(r.member[3]),expireTime:Number(r.member[4]),deviceId:r.member[5]};break;case 3:case 4:n.operatorAccountId=i,n.inviteeAccountId=o,n.inviterAccountId=i;break;case 5:case 6:n.operatorAccountId=i,n.inviterAccountId=o,n.inviteeAccountId=i}return JSON.parse(Ei(n))}var Gk,jk=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMSignallingService",t)||this).config={compatibleWithV1:!0},n.channels={},n.timer=0,n.pollingInterval=12e4,"v2"!==n.core.options.apiVersion?ut(n):(Sh({cmdMap:_k,cmdConfig:Rk}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.reset=function(){this.timer=0,this.channels={}},r.setOptions=function(e){var t;(null===(t=this.core.signaling)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Os(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,c))},r.call=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(Ak,e,"",!0),e.calleeAccountId!==this.core.account){r.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingCall",{tag:dr(dr({},e),{toAccid:e.calleeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:dr(dr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,o=i.content.data,this.channels[o.channelInfo.channelId]=fb(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:o.callStatus,rtcInfo:o.rtcInfo,roomInfo:{channelInfo:o.channelInfo,members:o.members}});case 12:case"end":return r.stop()}}),r,this)})))},r.callSetup=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(xk,e,"",!0),e.callerAccountId!==this.core.account){r.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SignallingCallSetup",{tag:dr(dr({},e),{toAccid:e.callerAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 6:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=fb(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:i.callStatus,rtcInfo:i.rtcInfo,roomInfo:{channelInfo:i.channelInfo,members:i.members}});case 11:case"end":return r.stop()}}),r,this)})))},r.createRoom=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){var i;return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(Nk,{channelType:e,channelName:t,channelExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:e,channelName:t,channelExtension:r}});case 4:return i=n.sent,n.abrupt("return",i.content.data.channelInfo);case 6:case"end":return n.stop()}}),n,this)})))},r.delayRoom=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:e}});case 3:return r=t.sent,t.abrupt("return",{channelInfo:r.content.data.channelInfo,members:r.content.data.members});case 5:case"end":return t.stop()}}),t,this)})))},r.closeRoom=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(Ok,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:case"end":return n.stop()}}),n,this)})))},r.joinRoom=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i,o,a,s,c;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(Pk,e,"",!0),r.next=4,this.core.sendCmd("v2SignallingJoinRoom",{tag:dr(dr({},e),{offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 4:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=fb(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),a=i.channelInfo,s=i.members,c=i.rtcInfo,r.abrupt("return",{roomInfo:{channelInfo:a,members:s},rtcInfo:c});case 10:case"end":return r.stop()}}),r,this)})))},r.leaveRoom=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(Lk,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:delete this.channels[e];case 5:case"end":return n.stop()}}),n,this)})))},r.invite=function(e){var t;return Xl(this,void 0,void 0,zl.mark((function r(){var n,i;return zl.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(Vk,e,"",!0),e.inviteeAccountId!==this.core.account){r.next=4;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingInvite",{tag:dr(dr({},e),{toAccid:e.inviteeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:dr(dr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,r.abrupt("return",i.content.data);case 9:case"end":return r.stop()}}),r,this)})))},r.cancelInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(Uk,e,"",!0),t.next=4,this.core.sendCmd("v2SignallingCancelInvite",{tag:dr(dr({},e),{toAccid:e.inviteeAccountId})});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.rejectInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(qk,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingRejectInvite",{tag:dr(dr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.acceptInvite=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(Bk,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingAcceptInvite",{tag:dr(dr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.sendControl=function(e,t,r){return Xl(this,void 0,void 0,zl.mark((function n(){return zl.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Vl(Dk,{channelId:e,receiverAccountId:t,serverExtension:r},"",!0),n.next=3,this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:e,toAccid:t,serverExtension:r}});case 3:case"end":return n.stop()}}),n,this)})))},r.getRoomInfoByChannelName=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vl({channelName:{type:"string",allowEmpty:!1}},{channelName:e},"",!0),t.next=3,this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:e}});case 3:return r=t.sent,n=r.content.data,i=n.members,o=n.channelInfo,t.abrupt("return",{channelInfo:o,members:i||[]});case 6:case"end":return t.stop()}}),t,this)})))},r.aotoDelay=function(){return Xl(this,void 0,void 0,zl.mark((function e(){var t,r,n,i;return zl.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=fr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("v2Signlling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=23;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:n}});case 12:i=e.sent,this.channels[n]=i.content.data.channelInfo,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 20:r++,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,16]])})))},r.v2SignallingOnlineEventHandler=function(e){var t=e.content.data,r="number"==typeof tm(e,"raw.r[0]")?""+e.raw.r[0]:"0";!this.config.compatibleWithV1&&r&&em(r)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[r]}),this.emit("onOnlineEvent",Fk(t))},r.v2SignallingMultiClientEventHandler=function(e){this.emit("onMultiClientEvent",Fk(e.content.data))},r.v2SignallingOfflineEventHandler=function(e){var t;if(e.content.datas&&e.content.datas.length>0){if(!this.config.compatibleWithV1){var r,n=lu(r=e.content.datas).call(r,(function(e){return e.msgId}));n.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:n})}var i=lu(t=e.content.datas).call(t,(function(e){return Fk(e)}));this.emit("onOfflineEvent",i)}},r.v2SignallingSyncChannelsHandler=function(e){var t=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var r,n=e.content.datas;jn(n).call(n,(function(e){var r=e.channelInfo.channelId;t.channels[r]=fb(e.channelInfo)})),this.timer||(this.timer=this.core.timerManager.addTimer(tr(r=this.aotoDelay).call(r,this),this.pollingInterval,-1)),this.emit("onSyncRoomInfoList",n)}},t}(af),Hk={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},Wk="V2NIMSubscriptionService",Yk={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:function(e){return e?1:2}},multiSync:{id:7,retType:"boolean",converter:_h},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},Kk={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:_h},accountId:102,subscribeTime:{id:105,retType:"number"}},Qk={v2PublishEvent:{sid:19,cid:1,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Yk}],response:[{type:"Property",name:"data",reflectMapper:Ch(Yk)}]},v2OnUserStatusChange:{sid:14,cid:2,service:Wk,response:[{type:"Property",name:"data",reflectMapper:Ch(Yk)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Kk},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Kk},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Kk}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Kk},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Kk)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:Wk,params:[{type:"Property",name:"tag",reflectMapper:Kk}],response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Kk)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:Wk,response:[{type:"PropertyArray",name:"data",reflectMapper:Ch(Yk)}]}},$k={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},zk={accountIds:{type:"array",required:!1,itemType:"string",max:100}},Jk={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}},Xk=function(e){function t(t){var r;return"v2"!==(r=e.call(this,"V2NIMSubscriptionService",t)||this).core.options.apiVersion?ut(r):(Sh({cmdMap:Hk,cmdConfig:Qk}),r)}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Os(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,c))},r.subscribeUserStatus=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Vl($k,e,"",!0),t.next=5,this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:e.duration||60,immediateSync:void 0!==e.immediateSync&&e.immediateSync},accountIds:e.accountIds});case 5:return r=t.sent,t.abrupt("return",r.content.failedList);case 7:case"end":return t.stop()}}),t,this)})))},r.unsubscribeUserStatus=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Vl(zk,e,"",!0),r=[],!(e.accountIds.length>0)){t.next=11;break}return t.next=7,this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:e.accountIds});case 7:n=t.sent,r=n.content.failedList,t.next=15;break;case 11:return t.next=14,this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}});case 14:r=[];case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this)})))},r.publishCustomUserStatus=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Vl(Jk,e,"",!0),t.next=5,this.core.sendCmd("v2PublishEvent",{tag:dr(dr({},e),{eventType:1,uniqueId:wp(),duration:e.duration||60,onlineOnly:void 0===e.onlineOnly||e.onlineOnly,multiSync:void 0!==e.multiSync&&e.multiSync})});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.queryUserStatusSubscriptions=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r,n,i,o,a,s;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Vl({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:e},"",!0),r=[],!(e.length>0)){t.next=16;break}n=0;case 6:if(!(n<e.length)){t.next=14;break}return t.next=9,this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:Yc(e).call(e,n,n+100)});case 9:o=t.sent,r=Os(r).call(r,lu(i=o.content.data).call(i,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 11:n+=100,t.next=6;break;case 14:t.next=20;break;case 16:return t.next=18,this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});case 18:s=t.sent,r=Os(r).call(r,lu(a=s.content.data).call(a,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 20:return t.abrupt("return",r);case 21:case"end":return t.stop()}}),t,this)})))},r.v2OnUserStatusChangeHandler=function(e){var t=e.content.data,r=t.eventType,n=t.extensionReceived,i=Jl(t,["eventType","extensionReceived"]);1===r?this.emit("onUserStatusChanged",[dr(dr({},i),{extension:n})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",r,"msgEvent = ",t)},r.v2OnMultiUserStatusChangeHandler=function(e){var t,r=e.content.data,n=lu(t=gu(r).call(r,(function(e){return 1===e.eventType}))).call(t,(function(e){e.eventType;var t=e.extensionReceived,r=Jl(e,["eventType","extensionReceived"]);return dr(dr({},r),{extension:t})}));n.length>0&&this.emit("onUserStatusChanged",n)},t}(af);!function(e){e[e.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",e[e.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",e[e.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",e[e.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"}(Gk||(Gk={}));var Zk="V2NIMPassthroughService",ew={"22_1":"v2ProxyRequest","22_2":"v2ProxyOnRequest"},tw={zone:1,path:2,method:3,header:4,body:5},rw={v2ProxyRequest:{sid:22,cid:1,service:Zk,params:[{type:"Property",name:"tag",reflectMapper:tw}],response:[{type:"Property",name:"data",reflectMapper:Ch(tw)}]},v2ProxyOnRequest:{sid:22,cid:2,service:Zk,response:[{type:"Property",name:"data",reflectMapper:Ch({fromAccountId:1,body:2,time:{id:3,retType:"number"}})}]}},nw={path:{type:"string",allowEmpty:!1},zone:{type:"string",required:!1},method:{type:"enum",values:[Gk.V2NIM_PROXY_REQUEST_METHOD_DELETE,Gk.V2NIM_PROXY_REQUEST_METHOD_GET,Gk.V2NIM_PROXY_REQUEST_METHOD_POST,Gk.V2NIM_PROXY_REQUEST_METHOD_PUT],required:!1},header:{type:"jsonstr",required:!1},body:{type:"string",required:!1}},iw=function(e){function t(t){var r;return r=e.call(this,"V2NIMPassthroughService",t)||this,Sh({cmdMap:ew,cmdConfig:rw}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,Os(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,Os(o=[this,t]).call(o,c))},r.httpProxy=function(e){return Xl(this,void 0,void 0,zl.mark((function t(){var r;return zl.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(nw,e,"",!0),!(e.method===Gk.V2NIM_PROXY_REQUEST_METHOD_GET&&e.body||e.method===Gk.V2NIM_PROXY_REQUEST_METHOD_POST&&!e.body||e.method===Gk.V2NIM_PROXY_REQUEST_METHOD_PUT&&!e.body)){t.next=3;break}throw new kl({code:Cl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"method "+e.method+", incorrect body"}});case 3:return t.next=5,this.core.sendCmd("v2ProxyRequest",{tag:e});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.v2ProxyOnRequestHandler=function(e){var t=e.content.data;this.emit("onProxyNotify",t)},t}(af),ow=i((function(e,t){e.exports=function(e){var t=function(e,t){return e+t&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,r,n,i,o,a){return r=t(t(r,e),t(i,a)),t(r<<o|r>>>32-o,n)}function i(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function c(e,r){var n=e[0],c=e[1],u=e[2],d=e[3];n=i(n,c,u,d,r[0],7,-680876936),d=i(d,n,c,u,r[1],12,-389564586),u=i(u,d,n,c,r[2],17,606105819),c=i(c,u,d,n,r[3],22,-1044525330),n=i(n,c,u,d,r[4],7,-176418897),d=i(d,n,c,u,r[5],12,1200080426),u=i(u,d,n,c,r[6],17,-1473231341),c=i(c,u,d,n,r[7],22,-45705983),n=i(n,c,u,d,r[8],7,1770035416),d=i(d,n,c,u,r[9],12,-1958414417),u=i(u,d,n,c,r[10],17,-42063),c=i(c,u,d,n,r[11],22,-1990404162),n=i(n,c,u,d,r[12],7,1804603682),d=i(d,n,c,u,r[13],12,-40341101),u=i(u,d,n,c,r[14],17,-1502002290),n=o(n,c=i(c,u,d,n,r[15],22,1236535329),u,d,r[1],5,-165796510),d=o(d,n,c,u,r[6],9,-1069501632),u=o(u,d,n,c,r[11],14,643717713),c=o(c,u,d,n,r[0],20,-373897302),n=o(n,c,u,d,r[5],5,-701558691),d=o(d,n,c,u,r[10],9,38016083),u=o(u,d,n,c,r[15],14,-660478335),c=o(c,u,d,n,r[4],20,-405537848),n=o(n,c,u,d,r[9],5,568446438),d=o(d,n,c,u,r[14],9,-1019803690),u=o(u,d,n,c,r[3],14,-187363961),c=o(c,u,d,n,r[8],20,1163531501),n=o(n,c,u,d,r[13],5,-1444681467),d=o(d,n,c,u,r[2],9,-51403784),u=o(u,d,n,c,r[7],14,1735328473),n=a(n,c=o(c,u,d,n,r[12],20,-1926607734),u,d,r[5],4,-378558),d=a(d,n,c,u,r[8],11,-2022574463),u=a(u,d,n,c,r[11],16,1839030562),c=a(c,u,d,n,r[14],23,-35309556),n=a(n,c,u,d,r[1],4,-1530992060),d=a(d,n,c,u,r[4],11,1272893353),u=a(u,d,n,c,r[7],16,-155497632),c=a(c,u,d,n,r[10],23,-1094730640),n=a(n,c,u,d,r[13],4,681279174),d=a(d,n,c,u,r[0],11,-358537222),u=a(u,d,n,c,r[3],16,-722521979),c=a(c,u,d,n,r[6],23,76029189),n=a(n,c,u,d,r[9],4,-640364487),d=a(d,n,c,u,r[12],11,-421815835),u=a(u,d,n,c,r[15],16,530742520),n=s(n,c=a(c,u,d,n,r[2],23,-995338651),u,d,r[0],6,-198630844),d=s(d,n,c,u,r[7],10,1126891415),u=s(u,d,n,c,r[14],15,-1416354905),c=s(c,u,d,n,r[5],21,-57434055),n=s(n,c,u,d,r[12],6,1700485571),d=s(d,n,c,u,r[3],10,-1894986606),u=s(u,d,n,c,r[10],15,-1051523),c=s(c,u,d,n,r[1],21,-2054922799),n=s(n,c,u,d,r[8],6,1873313359),d=s(d,n,c,u,r[15],10,-30611744),u=s(u,d,n,c,r[6],15,-1560198380),c=s(c,u,d,n,r[13],21,1309151649),n=s(n,c,u,d,r[4],6,-145523070),d=s(d,n,c,u,r[11],10,-1120210379),u=s(u,d,n,c,r[2],15,718787259),c=s(c,u,d,n,r[9],21,-343485551),e[0]=t(n,e[0]),e[1]=t(c,e[1]),e[2]=t(u,e[2]),e[3]=t(d,e[3])}function u(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function d(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function l(e){var t,r,n,i,o,a,s=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(d,u(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(d,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(d,n),d}function p(e){var t,r,n,i,o,a,s=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(u,d(e.subarray(t-64,t)));for(r=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(u,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(u,n),u}function m(e){var t,n="";for(t=0;t<4;t+=1)n+=r[e>>8*t+4&15]+r[e>>8*t&15];return n}function h(e){var t;for(t=0;t<e.length;t+=1)e[t]=m(e[t]);return e.join("")}function f(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function g(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function v(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function y(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function M(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function I(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==h(l("hello"))&&(t=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,c=this.byteLength,u=t(r,c),d=c;return n!==e&&(d=t(n,c)),u>d?new ArrayBuffer(0):(i=d-u,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,u,i),a.set(s),o)}}(),I.prototype.append=function(e){return this.appendBinary(f(e)),this},I.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)c(this._hash,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},I.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=M(r)),this.reset(),r},I.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},I.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},I.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},I.prototype._finish=function(e,t){var r,n,i,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(c(this._hash,e),o=0;o<16;o+=1)e[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),i=parseInt(r[1],16)||0,e[14]=n,e[15]=i,c(this._hash,e)},I.hash=function(e,t){return I.hashBinary(f(e),t)},I.hashBinary=function(e,t){var r=h(l(e));return t?M(r):r},I.ArrayBuffer=function(){this.reset()},I.ArrayBuffer.prototype.append=function(e){var t,r=y(this._buff.buffer,e,!0),n=r.length;for(this._length+=e.byteLength,t=64;t<=n;t+=64)c(this._hash,d(r.subarray(t-64,t)));return this._buff=t-64<n?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},I.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=M(r)),this.reset(),r},I.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.ArrayBuffer.prototype.getState=function(){var e=I.prototype.getState.call(this);return e.buff=v(e.buff),e},I.ArrayBuffer.prototype.setState=function(e){return e.buff=g(e.buff,!0),I.prototype.setState.call(this,e)},I.ArrayBuffer.prototype.destroy=I.prototype.destroy,I.ArrayBuffer.prototype._finish=I.prototype._finish,I.ArrayBuffer.hash=function(e,t){var r=h(p(new Uint8Array(e)));return t?M(r):r},I}()})),aw=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(ow),sw=class{md5(e,t,r){this.aborted=!1,this.progress=0;let n=0;const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,a=Math.ceil(e.size/o),s=new aw.ArrayBuffer,c=new FileReader;function u(){const t=n*o,r=t+o>=e.size?e.size:t+o;c.readAsArrayBuffer(i.call(e,t,r))}u(),c.onloadend=e=>{s.append(e.target.result),n++,this.progress=n/a,r&&"function"==typeof r&&r(this.progress),this.aborted?t("aborted"):n<a?u():t(null,s.end())}}abort(){this.aborted=!0}},cw=function(){function e(e){this.name="DataStructureConverter",this.core=e}var t=e.prototype;return t.messageConvertToV1=function(e){var t,r=Th(Ih(e,Ov),gf(FS)),n=_S(r,this.core.account),i=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n});return kS(r,i?{account:this.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account})},t.messageConvertToV2=function(e){var t=Th(Ih(xS(e,e.from,e.fromDeviceId),FS),Pv);return(t=Tv(this.core,t)).sendingState="sending"===e.status?3:"sendFailed"===e.status?2:1,t},e}(),uw=function(){function e(e){this.name="V2NIMMessageConverter",this.core=e}var t=e.prototype;return t.messageSerialization=function(e){if(!e)return null;var t=Ih(e,Ov);return Ei(t)},t.messageDeserialization=function(e){var t,r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,M,I,T,S,b;if(!e)return null;try{var C,_,E,k,w=Th(JSON.parse(e),Pv);return w.sendingState=0,1!==w.conversationType||w.senderId!==this.core.account&&w.receiverId!==this.core.account?2===w.conversationType?w.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(w.receiverId):3===w.conversationType&&(w.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(w.receiverId)):w.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(w.senderId===this.core.account?w.receiverId:w.senderId),w.threadReply&&(w.threadReply.conversationType=w.conversationType,w.threadReply=Sv(this.core,w.threadReply)),w.threadRoot&&(w.threadRoot.conversationType=w.conversationType,w.threadRoot=Sv(this.core,w.threadRoot)),au(C=[1,3,2,0]).call(C,w.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+w.conversationType),w.senderId&&"string"!=typeof w.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+w.senderId),w.receiverId&&"string"!=typeof w.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+w.receiverId),"createTime"in w&&isNaN(w.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+w.createTime),au(_=[2,7,12,100,6,1,-1,4,5,11,0,10,3]).call(_,w.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+w.messageType),"subType"in w&&isNaN(w.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+w.subType),w.messageClientId&&"string"!=typeof w.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+w.messageClientId),w.messageServerId&&"string"!=typeof w.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+w.messageServerId),w.attachment&&"object"!=typeof w.attachment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+w.attachment),w.text&&"string"!=typeof w.text&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+w.text),w.serverExtension&&"string"!=typeof w.serverExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+w.serverExtension),w.callbackExtension&&"string"!=typeof w.callbackExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+w.callbackExtension),(null===(t=w.pushConfig)||void 0===t?void 0:t.pushContent)&&"string"!=typeof w.pushConfig.pushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+w.pushConfig.pushContent),(null===(r=w.pushConfig)||void 0===r?void 0:r.pushPayload)&&"string"!=typeof w.pushConfig.pushPayload&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+w.pushConfig.pushPayload),(null===(n=w.pushConfig)||void 0===n?void 0:n.forcePushContent)&&"string"!=typeof w.pushConfig.forcePushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+w.pushConfig.forcePushContent),(null===(i=w.pushConfig)||void 0===i?void 0:i.forcePushAccountIds)&&!ki(w.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+w.pushConfig.forcePushAccountIds),(null===(o=w.routeConfig)||void 0===o?void 0:o.routeEnvironment)&&"string"!=typeof w.routeConfig.routeEnvironment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+w.routeConfig.routeEnvironment),(null===(a=w.antispamConfig)||void 0===a?void 0:a.antispamBusinessId)&&"string"!=typeof w.antispamConfig.antispamBusinessId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+w.antispamConfig.antispamBusinessId),(null===(s=w.antispamConfig)||void 0===s?void 0:s.antispamCustomMessage)&&"string"!=typeof w.antispamConfig.antispamCustomMessage&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+w.antispamConfig.antispamCustomMessage),(null===(c=w.antispamConfig)||void 0===c?void 0:c.antispamCheating)&&"string"!=typeof w.antispamConfig.antispamCheating&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+w.antispamConfig.antispamCheating),(null===(u=w.antispamConfig)||void 0===u?void 0:u.antispamExtension)&&"string"!=typeof w.antispamConfig.antispamExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+w.antispamConfig.antispamExtension),(null===(d=w.robotConfig)||void 0===d?void 0:d.accountId)&&"string"!=typeof w.robotConfig.accountId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+w.robotConfig.accountId),(null===(l=w.robotConfig)||void 0===l?void 0:l.topic)&&"string"!=typeof w.robotConfig.topic&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+w.robotConfig.topic),(null===(p=w.robotConfig)||void 0===p?void 0:p.function)&&"string"!=typeof w.robotConfig.function&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+w.robotConfig.function),(null===(m=w.robotConfig)||void 0===m?void 0:m.customContent)&&"string"!=typeof w.robotConfig.customContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+w.robotConfig.customContent),(null===(h=w.threadRoot)||void 0===h?void 0:h.senderId)&&"string"!=typeof w.threadRoot.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+w.threadRoot.senderId),(null===(f=w.threadRoot)||void 0===f?void 0:f.receiverId)&&"string"!=typeof w.threadRoot.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+w.threadRoot.receiverId),(null===(g=w.threadRoot)||void 0===g?void 0:g.messageClientId)&&"string"!=typeof w.threadRoot.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+w.threadRoot.messageClientId),(null===(v=w.threadRoot)||void 0===v?void 0:v.messageServerId)&&"string"!=typeof w.threadRoot.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+w.threadRoot.messageServerId),w.threadRoot&&"createTime"in w.threadRoot&&isNaN(w.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+w.threadRoot.createTime),w.threadRoot&&!au(E=[1,3,2,0]).call(E,w.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+w.threadRoot.conversationType),(null===(y=w.threadRoot)||void 0===y?void 0:y.conversationId)&&"string"!=typeof w.threadRoot.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+w.threadRoot.conversationId),(null===(M=w.threadReply)||void 0===M?void 0:M.senderId)&&"string"!=typeof w.threadReply.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+w.threadReply.senderId),(null===(I=w.threadReply)||void 0===I?void 0:I.receiverId)&&"string"!=typeof w.threadReply.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+w.threadReply.receiverId),(null===(T=w.threadReply)||void 0===T?void 0:T.messageClientId)&&"string"!=typeof w.threadReply.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+w.threadReply.messageClientId),(null===(S=w.threadReply)||void 0===S?void 0:S.messageServerId)&&"string"!=typeof w.threadReply.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+w.threadReply.messageServerId),w.threadReply&&"createTime"in w.threadReply&&isNaN(w.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+w.threadReply.createTime),w.threadReply&&!au(k=[1,3,2,0]).call(k,w.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+w.threadReply.conversationType),(null===(b=w.threadReply)||void 0===b?void 0:b.conversationId)&&"string"!=typeof w.threadReply.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+w.threadReply.conversationId),delete w.__clientExt,delete w.userUpdateTime,w}catch(t){return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+e),null}},e}();!function(e){ep(tp,e())}((function(){return{setLogger:Ym,platform:"BROWSER",localStorage:window.localStorage,request:ym,WebSocket:window.WebSocket,uploadFile:zm,getFileUploadInformation:Jm,getSystemInfo:Zm,net:rh,logStorage:ph}})),vm.registerService(hf,"V1NIMLoginService"),vm.registerService(zS,"msg"),vm.registerService(rb,"user"),vm.registerService(mb,"session"),vm.registerService(gb,"team"),vm.registerService(Tb,"systemMessage"),vm.registerService(wb,"friend"),vm.registerService(Lb,"event"),vm.registerService(Gb,"msgExtend"),vm.registerService(Xb,"msgLog"),vm.registerService(nC,"passThrough"),vm.registerService(Cy,"cloudStorage"),vm.registerService(AC,"superTeam"),vm.registerService(ZS,"sync"),vm.registerService(OC,"plugin"),vm.registerService(FC,"cloudSession"),vm.registerService(o_,"signaling"),vm.registerService(lg,"V2NIMLoginService"),vm.registerService(gM,"V2NIMLocalConversationService"),vm.registerService(HM,"V2NIMConversationService"),vm.registerService(Ly,"V2NIMMessageService"),vm.registerService(fk,"V2NIMNotificationService"),vm.registerService(_y,"V2NIMStorageService"),vm.registerService(ry,"V2NIMStorageUtil"),vm.registerService($M,"V2NIMConversationGroupService"),vm.registerService(GI,"V2NIMTeamService"),vm.registerService(ZI,"V2NIMUserService"),vm.registerService(mT,"V2NIMFriendService"),vm.registerService(qT,"V2NIMSettingService"),vm.registerService(yk,"V2NIMSyncService"),vm.registerService(Ck,"V2NIMAIService"),vm.registerService(cw,"DataStructureConverter"),vm.registerService(uw,"V2NIMMessageConverter"),vm.registerService(tI,"V2NIMMessageLogUtil"),vm.registerService(pI,"V2NIMMessageExtendUtil"),vm.registerService(jk,"V2NIMSignallingService"),vm.registerService(Xk,"V2NIMSubscriptionService"),vm.registerService(iw,"V2NIMPassthroughService"),vm.registerService(Ry,"YSFService"),vm.registerService(yE,"qchatChannel"),vm.registerService(kE,"qchatMedia"),vm.registerService(uk,"qchatMsg"),vm.registerService(lk,"qchatRole"),vm.registerService(hk,"qchatServer"),vm.registerPlugin(sw,"browser-md5-file"),vm.registerPrivateService((function(e){var t=this;this.bindEvents=function(){t.core.eventBus.on("forwardSend/msg/sendMsg",t.onV1SendMsg),t.core.eventBus.on("forwardSend/msg/recallMsg",t.onV1RecallMsg),t.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",t.onV1DeleteSelfMsgs),t.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",t.onV1ClearHistoryMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",t.onV2SendMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",t.onV2ModifyMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",t.onV2RevokeMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",t.onV2DeleteSelfMsgs),t.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",t.onV2ClearHistoryMessage),t.core.eventBus.on("forwardSend/team/created",t.onV1TeamCreated),t.core.eventBus.on("forwardSend/team/updateMyMemberInfo",t.onV1TeamMemberUpdate),t.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",t.onV1SuperTeamMemberUpdate),t.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",t.onV2TeamMemberUpdate),t.core.eventBus.on("forwardSend/team/passTeamApply",(function(e,r){return t.onV1TeamApply(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamApply",(function(e,r){t.onV1TeamApply(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,2,r)})),t.core.eventBus.on("forwardSend/team/acceptTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,2,r)})),t.core.eventBus.on("forwardSend/user/updateBlackList",t.onV1UpdateBlackList),t.core.eventBus.on("forwardSend/user/updateUserInfo",t.onV1UpdateUserInfo),t.core.eventBus.on("forwardSend/user/setMute",t.onV1SetMute),t.core.eventBus.on("forwardSend/friend/addFriend",t.onV1AddFriend),t.core.eventBus.on("forwardSend/friend/deleteFriend",t.onV1DeleteFriend),t.core.eventBus.on("forwardSend/friend/updateFriend",t.onV1UpdateFriend),t.core.eventBus.on("forwardSend/friend/passFriendApply",t.onV1PassFriendApply),t.core.eventBus.on("forwardSend/friend/rejectFriendApply",t.onV1RejectFriendApply)},this.onV1TeamApply=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:0},n)},this.onV1TeamInvite=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i.code))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:2},n)},this.onV1PassFriendApply=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",e,r)},this.onV1RejectFriendApply=function(e,r,n){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:e,recipientAccountId:t.core.account,operatorAccountId:t.core.account,postscript:r||"",timestamp:t.core.timeOrigin.getNTPTime(),read:!0,status:3},n)},this.onV1SetMute=function(e,r){t.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",e,r?1:0)},this.onV1UpdateFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",e.account,dr(dr({},"alias"in e?{alias:e.alias}:{}),"ext"in e?{serverExtension:e.ext}:{}))},this.onV1AddFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",e)},this.onV1DeleteFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",e)},this.onV1UpdateUserInfo=function(e){var r=Th(Ih(e,gS.user),Ch(WI));t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",r)},this.onV1UpdateBlackList=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",e,r)},this.onV1TeamCreated=function(e){var r=Th(Ih(iS(e),pS.team),Ch(pv));t.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",r)},this.onV1TeamMemberUpdate=function(e){(e=dr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=Th(Ih(e,pS.teamMember),Ch(mv));r.teamType=1,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV1SuperTeamMemberUpdate=function(e){(e=dr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=Th(Ih(e,kC.superTeamMember),Ch(hv));r.teamType=2,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV2TeamMemberUpdate=function(e){var r=e.teamType,n=Ih(e,mv);if(2===r){var i=Th(n,Ch(kC.superTeamMember));t.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",i)}else{var o=Th(n,Ch(pS.teamMember));t.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",o)}},this.onV1SendMsg=function(e){var r=Th(Ih(e,FS),Pv);(r=Tv(t.core,r)).sendingState="sending"===e.status?3:"sent"===e.status?1:2,t.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",r)},this.onV2SendMsg=function(e){var r=Th(Ih(e,Ov),gf(FS));r.status=3===e.sendingState?"sending":1===e.sendingState?"sent":"sendFailed",t.core.eventBus.emit("forwardReceive/msg/sendMsg",r)},this.onV2ModifyMsg=function(e){var r=Th(Ih(e,Ov),gf(FS));t.core.eventBus.emit("forwardReceive/msg/modifyMsg",r)},this.onV1RecallMsg=function(e){e.deleteMsgCreatetime=e.time;var r=Th(Ih(e,GS.recallMsgTag),Ch(Uv));t.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[r])},this.onV2RevokeMessage=function(e){var r=Th(Ih(e,Uv),jS.recallMsgTag);t.core.eventBus.emit("forwardReceive/msg/recallMsg",r)},this.onV1DeleteSelfMsgs=function(e){var r=lu(e).call(e,(function(e){return Th(Ih(e,GS.deleteSelfMsgTag),Ch(Lv))}));jn(r).call(r,(function(e){e.messageRefer=bv(t.core,e.messageRefer)})),t.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",r)},this.onV2DeleteSelfMsgs=function(e){var r=lu(e).call(e,(function(e){return Th(Ih(e,Lv),jS.deleteSelfMsgTag)}));t.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",r)},this.onV1ClearHistoryMessage=function(e){var r=Th(Ih(e,Wb.clearHistoryMsgsFromServerReqTag),Ch(XM));t.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",r)},this.onV2ClearHistoryMessage=function(e){var r=Th(Ih(e,XM),Yb.clearHistoryMsgsFromServerReqTag);t.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",r)},this.core=e,this.bindEvents()}),"eventForwardCenter"),e.V2NIMConst=El,e.default=vm,Object.defineProperty(e,"__esModule",{value:!0})}))},5170:function(e,t,r){"use strict";var n=r(6706),i=r(4402);e.exports=n(i.proto,"size","get")||function(e){return e.size}},5220:function(e,t,r){"use strict";r.d(t,{LA:function(){return ce},aE:function(){return it}});var n=r(641),i=r(953);
/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */
const o="undefined"!==typeof document;function a(e){return"object"===typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}function s(e){return e.__esModule||"Module"===e[Symbol.toStringTag]||e.default&&a(e.default)}const c=Object.assign;function u(e,t){const r={};for(const n in t){const i=t[n];r[n]=l(i)?i.map(e):e(i)}return r}const d=()=>{},l=Array.isArray;const p=/#/g,m=/&/g,h=/\//g,f=/=/g,g=/\?/g,v=/\+/g,y=/%5B/g,M=/%5D/g,I=/%5E/g,T=/%60/g,S=/%7B/g,b=/%7C/g,C=/%7D/g,_=/%20/g;function E(e){return encodeURI(""+e).replace(b,"|").replace(y,"[").replace(M,"]")}function k(e){return E(e).replace(S,"{").replace(C,"}").replace(I,"^")}function w(e){return E(e).replace(v,"%2B").replace(_,"+").replace(p,"%23").replace(m,"%26").replace(T,"`").replace(S,"{").replace(C,"}").replace(I,"^")}function R(e){return w(e).replace(f,"%3D")}function A(e){return E(e).replace(p,"%23").replace(g,"%3F")}function x(e){return null==e?"":A(e).replace(h,"%2F")}function N(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const O=/\/$/,P=e=>e.replace(O,"");function L(e,t,r="/"){let n,i={},o="",a="";const s=t.indexOf("#");let c=t.indexOf("?");return s<c&&s>=0&&(c=-1),c>-1&&(n=t.slice(0,c),o=t.slice(c+1,s>-1?s:t.length),i=e(o)),s>-1&&(n=n||t.slice(0,s),a=t.slice(s,t.length)),n=j(null!=n?n:t,r),{fullPath:n+(o&&"?")+o+a,path:n,query:i,hash:N(a)}}function V(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}function U(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function D(e,t,r){const n=t.matched.length-1,i=r.matched.length-1;return n>-1&&n===i&&q(t.matched[n],r.matched[i])&&B(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function q(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function B(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!F(e[r],t[r]))return!1;return!0}function F(e,t){return l(e)?G(e,t):l(t)?G(t,e):e===t}function G(e,t){return l(t)?e.length===t.length&&e.every(((e,r)=>e===t[r])):1===e.length&&e[0]===t}function j(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),n=e.split("/"),i=n[n.length-1];".."!==i&&"."!==i||n.push("");let o,a,s=r.length-1;for(o=0;o<n.length;o++)if(a=n[o],"."!==a){if(".."!==a)break;s>1&&s--}return r.slice(0,s).join("/")+"/"+n.slice(o).join("/")}const H={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var W,Y;(function(e){e["pop"]="pop",e["push"]="push"})(W||(W={})),function(e){e["back"]="back",e["forward"]="forward",e["unknown"]=""}(Y||(Y={}));function K(e){if(!e)if(o){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),P(e)}const Q=/^[^#]+#/;function $(e,t){return e.replace(Q,"#")+t}function z(e,t){const r=document.documentElement.getBoundingClientRect(),n=e.getBoundingClientRect();return{behavior:t.behavior,left:n.left-r.left-(t.left||0),top:n.top-r.top-(t.top||0)}}const J=()=>({left:window.scrollX,top:window.scrollY});function X(e){let t;if("el"in e){const r=e.el,n="string"===typeof r&&r.startsWith("#");0;const i="string"===typeof r?n?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!i)return;t=z(i,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function Z(e,t){const r=history.state?history.state.position-t:-1;return r+e}const ee=new Map;function te(e,t){ee.set(e,t)}function re(e){const t=ee.get(e);return ee.delete(e),t}let ne=()=>location.protocol+"//"+location.host;function ie(e,t){const{pathname:r,search:n,hash:i}=t,o=e.indexOf("#");if(o>-1){let t=i.includes(e.slice(o))?e.slice(o).length:1,r=i.slice(t);return"/"!==r[0]&&(r="/"+r),U(r,"")}const a=U(r,e);return a+n+i}function oe(e,t,r,n){let i=[],o=[],a=null;const s=({state:o})=>{const s=ie(e,location),c=r.value,u=t.value;let d=0;if(o){if(r.value=s,t.value=o,a&&a===c)return void(a=null);d=u?o.position-u.position:0}else n(s);i.forEach((e=>{e(r.value,c,{delta:d,type:W.pop,direction:d?d>0?Y.forward:Y.back:Y.unknown})}))};function u(){a=r.value}function d(e){i.push(e);const t=()=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)};return o.push(t),t}function l(){const{history:e}=window;e.state&&e.replaceState(c({},e.state,{scroll:J()}),"")}function p(){for(const e of o)e();o=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",l)}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:u,listen:d,destroy:p}}function ae(e,t,r,n=!1,i=!1){return{back:e,current:t,forward:r,replaced:n,position:window.history.length,scroll:i?J():null}}function se(e){const{history:t,location:r}=window,n={value:ie(e,r)},i={value:t.state};function o(n,o,a){const s=e.indexOf("#"),c=s>-1?(r.host&&document.querySelector("base")?e:e.slice(s))+n:ne()+e+n;try{t[a?"replaceState":"pushState"](o,"",c),i.value=o}catch(u){console.error(u),r[a?"replace":"assign"](c)}}function a(e,r){const a=c({},t.state,ae(i.value.back,e,i.value.forward,!0),r,{position:i.value.position});o(e,a,!0),n.value=e}function s(e,r){const a=c({},i.value,t.state,{forward:e,scroll:J()});o(a.current,a,!0);const s=c({},ae(n.value,e,null),{position:a.position+1},r);o(e,s,!1),n.value=e}return i.value||o(n.value,{back:null,current:n.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:n,state:i,push:s,replace:a}}function ce(e){e=K(e);const t=se(e),r=oe(e,t.state,t.location,t.replace);function n(e,t=!0){t||r.pauseListeners(),history.go(e)}const i=c({location:"",base:e,go:n,createHref:$.bind(null,e)},t,r);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>t.state.value}),i}function ue(e){return"string"===typeof e||e&&"object"===typeof e}function de(e){return"string"===typeof e||"symbol"===typeof e}const le=Symbol("");var pe;(function(e){e[e["aborted"]=4]="aborted",e[e["cancelled"]=8]="cancelled",e[e["duplicated"]=16]="duplicated"})(pe||(pe={}));function me(e,t){return c(new Error,{type:e,[le]:!0},t)}function he(e,t){return e instanceof Error&&le in e&&(null==t||!!(e.type&t))}const fe="[^/]+?",ge={sensitive:!1,strict:!1,start:!0,end:!0},ve=/[.+*?^${}()[\]/\\]/g;function ye(e,t){const r=c({},ge,t),n=[];let i=r.start?"^":"";const o=[];for(const c of e){const e=c.length?[]:[90];r.strict&&!c.length&&(i+="/");for(let t=0;t<c.length;t++){const n=c[t];let a=40+(r.sensitive?.25:0);if(0===n.type)t||(i+="/"),i+=n.value.replace(ve,"\\$&"),a+=40;else if(1===n.type){const{value:e,repeatable:r,optional:s,regexp:u}=n;o.push({name:e,repeatable:r,optional:s});const l=u||fe;if(l!==fe){a+=10;try{new RegExp(`(${l})`)}catch(d){throw new Error(`Invalid custom RegExp for param "${e}" (${l}): `+d.message)}}let p=r?`((?:${l})(?:/(?:${l}))*)`:`(${l})`;t||(p=s&&c.length<2?`(?:/${p})`:"/"+p),s&&(p+="?"),i+=p,a+=20,s&&(a+=-8),r&&(a+=-20),".*"===l&&(a+=-50)}e.push(a)}n.push(e)}if(r.strict&&r.end){const e=n.length-1;n[e][n[e].length-1]+=.7000000000000001}r.strict||(i+="/?"),r.end?i+="$":r.strict&&!i.endsWith("/")&&(i+="(?:/|$)");const a=new RegExp(i,r.sensitive?"":"i");function s(e){const t=e.match(a),r={};if(!t)return null;for(let n=1;n<t.length;n++){const e=t[n]||"",i=o[n-1];r[i.name]=e&&i.repeatable?e.split("/"):e}return r}function u(t){let r="",n=!1;for(const i of e){n&&r.endsWith("/")||(r+="/"),n=!1;for(const e of i)if(0===e.type)r+=e.value;else if(1===e.type){const{value:o,repeatable:a,optional:s}=e,c=o in t?t[o]:"";if(l(c)&&!a)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const u=l(c)?c.join("/"):c;if(!u){if(!s)throw new Error(`Missing required param "${o}"`);i.length<2&&(r.endsWith("/")?r=r.slice(0,-1):n=!0)}r+=u}}return r||"/"}return{re:a,score:n,keys:o,parse:s,stringify:u}}function Me(e,t){let r=0;while(r<e.length&&r<t.length){const n=t[r]-e[r];if(n)return n;r++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function Ie(e,t){let r=0;const n=e.score,i=t.score;while(r<n.length&&r<i.length){const e=Me(n[r],i[r]);if(e)return e;r++}if(1===Math.abs(i.length-n.length)){if(Te(n))return 1;if(Te(i))return-1}return i.length-n.length}function Te(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Se={type:0,value:""},be=/[a-zA-Z0-9_]/;function Ce(e){if(!e)return[[]];if("/"===e)return[[Se]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${r})/"${u}": ${e}`)}let r=0,n=r;const i=[];let o;function a(){o&&i.push(o),o=[]}let s,c=0,u="",d="";function l(){u&&(0===r?o.push({type:0,value:u}):1===r||2===r||3===r?(o.length>1&&("*"===s||"+"===s)&&t(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:u,regexp:d,repeatable:"*"===s||"+"===s,optional:"*"===s||"?"===s})):t("Invalid state to consume buffer"),u="")}function p(){u+=s}while(c<e.length)if(s=e[c++],"\\"!==s||2===r)switch(r){case 0:"/"===s?(u&&l(),a()):":"===s?(l(),r=1):p();break;case 4:p(),r=n;break;case 1:"("===s?r=2:be.test(s)?p():(l(),r=0,"*"!==s&&"?"!==s&&"+"!==s&&c--);break;case 2:")"===s?"\\"==d[d.length-1]?d=d.slice(0,-1)+s:r=3:d+=s;break;case 3:l(),r=0,"*"!==s&&"?"!==s&&"+"!==s&&c--,d="";break;default:t("Unknown state");break}else n=r,r=4;return 2===r&&t(`Unfinished custom RegExp for param "${u}"`),l(),a(),i}function _e(e,t,r){const n=ye(Ce(e.path),r);const i=c(n,{record:e,parent:t,children:[],alias:[]});return t&&!i.record.aliasOf===!t.record.aliasOf&&t.children.push(i),i}function Ee(e,t){const r=[],n=new Map;function i(e){return n.get(e)}function o(e,r,n){const i=!n,s=we(e);s.aliasOf=n&&n.record;const l=Ne(t,e),p=[s];if("alias"in e){const t="string"===typeof e.alias?[e.alias]:e.alias;for(const e of t)p.push(we(c({},s,{components:n?n.record.components:s.components,path:e,aliasOf:n?n.record:s})))}let m,h;for(const t of p){const{path:c}=t;if(r&&"/"!==c[0]){const e=r.record.path,n="/"===e[e.length-1]?"":"/";t.path=r.record.path+(c&&n+c)}if(m=_e(t,r,l),n?n.alias.push(m):(h=h||m,h!==m&&h.alias.push(m),i&&e.name&&!Ae(m)&&a(e.name)),Le(m)&&u(m),s.children){const e=s.children;for(let t=0;t<e.length;t++)o(e[t],m,n&&n.children[t])}n=n||m}return h?()=>{a(h)}:d}function a(e){if(de(e)){const t=n.get(e);t&&(n.delete(e),r.splice(r.indexOf(t),1),t.children.forEach(a),t.alias.forEach(a))}else{const t=r.indexOf(e);t>-1&&(r.splice(t,1),e.record.name&&n.delete(e.record.name),e.children.forEach(a),e.alias.forEach(a))}}function s(){return r}function u(e){const t=Oe(e,r);r.splice(t,0,e),e.record.name&&!Ae(e)&&n.set(e.record.name,e)}function l(e,t){let i,o,a,s={};if("name"in e&&e.name){if(i=n.get(e.name),!i)throw me(1,{location:e});0,a=i.record.name,s=c(ke(t.params,i.keys.filter((e=>!e.optional)).concat(i.parent?i.parent.keys.filter((e=>e.optional)):[]).map((e=>e.name))),e.params&&ke(e.params,i.keys.map((e=>e.name)))),o=i.stringify(s)}else if(null!=e.path)o=e.path,i=r.find((e=>e.re.test(o))),i&&(s=i.parse(o),a=i.record.name);else{if(i=t.name?n.get(t.name):r.find((e=>e.re.test(t.path))),!i)throw me(1,{location:e,currentLocation:t});a=i.record.name,s=c({},t.params,e.params),o=i.stringify(s)}const u=[];let d=i;while(d)u.unshift(d.record),d=d.parent;return{name:a,path:o,params:s,matched:u,meta:xe(u)}}function p(){r.length=0,n.clear()}return t=Ne({strict:!1,end:!0,sensitive:!1},t),e.forEach((e=>o(e))),{addRoute:o,resolve:l,removeRoute:a,clearRoutes:p,getRoutes:s,getRecordMatcher:i}}function ke(e,t){const r={};for(const n of t)n in e&&(r[n]=e[n]);return r}function we(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Re(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function Re(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const n in e.components)t[n]="object"===typeof r?r[n]:r;return t}function Ae(e){while(e){if(e.record.aliasOf)return!0;e=e.parent}return!1}function xe(e){return e.reduce(((e,t)=>c(e,t.meta)),{})}function Ne(e,t){const r={};for(const n in e)r[n]=n in t?t[n]:e[n];return r}function Oe(e,t){let r=0,n=t.length;while(r!==n){const i=r+n>>1,o=Ie(e,t[i]);o<0?n=i:r=i+1}const i=Pe(e);return i&&(n=t.lastIndexOf(i,n-1)),n}function Pe(e){let t=e;while(t=t.parent)if(Le(t)&&0===Ie(e,t))return t}function Le({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Ve(e){const t={};if(""===e||"?"===e)return t;const r="?"===e[0],n=(r?e.slice(1):e).split("&");for(let i=0;i<n.length;++i){const e=n[i].replace(v," "),r=e.indexOf("="),o=N(r<0?e:e.slice(0,r)),a=r<0?null:N(e.slice(r+1));if(o in t){let e=t[o];l(e)||(e=t[o]=[e]),e.push(a)}else t[o]=a}return t}function Ue(e){let t="";for(let r in e){const n=e[r];if(r=R(r),null==n){void 0!==n&&(t+=(t.length?"&":"")+r);continue}const i=l(n)?n.map((e=>e&&w(e))):[n&&w(n)];i.forEach((e=>{void 0!==e&&(t+=(t.length?"&":"")+r,null!=e&&(t+="="+e))}))}return t}function De(e){const t={};for(const r in e){const n=e[r];void 0!==n&&(t[r]=l(n)?n.map((e=>null==e?null:""+e)):null==n?n:""+n)}return t}const qe=Symbol(""),Be=Symbol(""),Fe=Symbol(""),Ge=Symbol(""),je=Symbol("");function He(){let e=[];function t(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}}function r(){e=[]}return{add:t,list:()=>e.slice(),reset:r}}function We(e,t,r,n,i,o=e=>e()){const a=n&&(n.enterCallbacks[i]=n.enterCallbacks[i]||[]);return()=>new Promise(((s,c)=>{const u=e=>{!1===e?c(me(4,{from:r,to:t})):e instanceof Error?c(e):ue(e)?c(me(2,{from:t,to:e})):(a&&n.enterCallbacks[i]===a&&"function"===typeof e&&a.push(e),s())},d=o((()=>e.call(n&&n.instances[i],t,r,u)));let l=Promise.resolve(d);e.length<3&&(l=l.then(u)),l.catch((e=>c(e)))}))}function Ye(e,t,r,n,i=e=>e()){const o=[];for(const c of e){0;for(const e in c.components){let u=c.components[e];if("beforeRouteEnter"===t||c.instances[e])if(a(u)){const a=u.__vccOpts||u,s=a[t];s&&o.push(We(s,r,n,c,e,i))}else{let a=u();0,o.push((()=>a.then((o=>{if(!o)throw new Error(`Couldn't resolve component "${e}" at "${c.path}"`);const a=s(o)?o.default:o;c.mods[e]=o,c.components[e]=a;const u=a.__vccOpts||a,d=u[t];return d&&We(d,r,n,c,e,i)()}))))}}}return o}function Ke(e){const t=(0,n.WQ)(Fe),r=(0,n.WQ)(Ge);const o=(0,n.EW)((()=>{const r=(0,i.R1)(e.to);return t.resolve(r)})),a=(0,n.EW)((()=>{const{matched:e}=o.value,{length:t}=e,n=e[t-1],i=r.matched;if(!n||!i.length)return-1;const a=i.findIndex(q.bind(null,n));if(a>-1)return a;const s=Ze(e[t-2]);return t>1&&Ze(n)===s&&i[i.length-1].path!==s?i.findIndex(q.bind(null,e[t-2])):a})),s=(0,n.EW)((()=>a.value>-1&&Xe(r.params,o.value.params))),c=(0,n.EW)((()=>a.value>-1&&a.value===r.matched.length-1&&B(r.params,o.value.params)));function u(r={}){if(Je(r)){const r=t[(0,i.R1)(e.replace)?"replace":"push"]((0,i.R1)(e.to)).catch(d);return e.viewTransition&&"undefined"!==typeof document&&"startViewTransition"in document&&document.startViewTransition((()=>r)),r}return Promise.resolve()}return{route:o,href:(0,n.EW)((()=>o.value.href)),isActive:s,isExactActive:c,navigate:u}}function Qe(e){return 1===e.length?e[0]:e}const $e=(0,n.pM)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ke,setup(e,{slots:t}){const r=(0,i.Kh)(Ke(e)),{options:o}=(0,n.WQ)(Fe),a=(0,n.EW)((()=>({[et(e.activeClass,o.linkActiveClass,"router-link-active")]:r.isActive,[et(e.exactActiveClass,o.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive})));return()=>{const i=t.default&&Qe(t.default(r));return e.custom?i:(0,n.h)("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:a.value},i)}}}),ze=$e;function Je(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&(void 0===e.button||0===e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Xe(e,t){for(const r in t){const n=t[r],i=e[r];if("string"===typeof n){if(n!==i)return!1}else if(!l(i)||i.length!==n.length||n.some(((e,t)=>e!==i[t])))return!1}return!0}function Ze(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const et=(e,t,r)=>null!=e?e:null!=t?t:r,tt=(0,n.pM)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const o=(0,n.WQ)(je),a=(0,n.EW)((()=>e.route||o.value)),s=(0,n.WQ)(Be,0),u=(0,n.EW)((()=>{let e=(0,i.R1)(s);const{matched:t}=a.value;let r;while((r=t[e])&&!r.components)e++;return e})),d=(0,n.EW)((()=>a.value.matched[u.value]));(0,n.Gt)(Be,(0,n.EW)((()=>u.value+1))),(0,n.Gt)(qe,d),(0,n.Gt)(je,a);const l=(0,i.KR)();return(0,n.wB)((()=>[l.value,d.value,e.name]),(([e,t,r],[n,i,o])=>{t&&(t.instances[r]=e,i&&i!==t&&e&&e===n&&(t.leaveGuards.size||(t.leaveGuards=i.leaveGuards),t.updateGuards.size||(t.updateGuards=i.updateGuards))),!e||!t||i&&q(t,i)&&n||(t.enterCallbacks[r]||[]).forEach((t=>t(e)))}),{flush:"post"}),()=>{const i=a.value,o=e.name,s=d.value,u=s&&s.components[o];if(!u)return rt(r.default,{Component:u,route:i});const p=s.props[o],m=p?!0===p?i.params:"function"===typeof p?p(i):p:null,h=e=>{e.component.isUnmounted&&(s.instances[o]=null)},f=(0,n.h)(u,c({},m,t,{onVnodeUnmounted:h,ref:l}));return rt(r.default,{Component:f,route:i})||f}}});function rt(e,t){if(!e)return null;const r=e(t);return 1===r.length?r[0]:r}const nt=tt;function it(e){const t=Ee(e.routes,e),r=e.parseQuery||Ve,a=e.stringifyQuery||Ue,s=e.history;const p=He(),m=He(),h=He(),f=(0,i.IJ)(H);let g=H;o&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const v=u.bind(null,(e=>""+e)),y=u.bind(null,x),M=u.bind(null,N);function I(e,r){let n,i;return de(e)?(n=t.getRecordMatcher(e),i=r):i=e,t.addRoute(i,n)}function T(e){const r=t.getRecordMatcher(e);r&&t.removeRoute(r)}function S(){return t.getRoutes().map((e=>e.record))}function b(e){return!!t.getRecordMatcher(e)}function C(e,n){if(n=c({},n||f.value),"string"===typeof e){const i=L(r,e,n.path),o=t.resolve({path:i.path},n),a=s.createHref(i.fullPath);return c(i,o,{params:M(o.params),hash:N(i.hash),redirectedFrom:void 0,href:a})}let i;if(null!=e.path)i=c({},e,{path:L(r,e.path,n.path).path});else{const t=c({},e.params);for(const e in t)null==t[e]&&delete t[e];i=c({},e,{params:y(t)}),n.params=y(n.params)}const o=t.resolve(i,n),u=e.hash||"";o.params=v(M(o.params));const d=V(a,c({},e,{hash:k(u),path:o.path})),l=s.createHref(d);return c({fullPath:d,hash:u,query:a===Ue?De(e.query):e.query||{}},o,{redirectedFrom:void 0,href:l})}function _(e){return"string"===typeof e?L(r,e,f.value.path):c({},e)}function E(e,t){if(g!==e)return me(8,{from:t,to:e})}function w(e){return O(e)}function R(e){return w(c(_(e),{replace:!0}))}function A(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:r}=t;let n="function"===typeof r?r(e):r;return"string"===typeof n&&(n=n.includes("?")||n.includes("#")?n=_(n):{path:n},n.params={}),c({query:e.query,hash:e.hash,params:null!=n.path?{}:e.params},n)}}function O(e,t){const r=g=C(e),n=f.value,i=e.state,o=e.force,s=!0===e.replace,u=A(r);if(u)return O(c(_(u),{state:"object"===typeof u?c({},i,u.state):i,force:o,replace:s}),t||r);const d=r;let l;return d.redirectedFrom=t,!o&&D(a,n,r)&&(l=me(16,{to:d,from:n}),ne(n,n,!0,!1)),(l?Promise.resolve(l):q(d,n)).catch((e=>he(e)?he(e,2)?e:ee(e):$(e,d,n))).then((e=>{if(e){if(he(e,2))return O(c({replace:s},_(e.to),{state:"object"===typeof e.to?c({},i,e.to.state):i,force:o}),t||d)}else e=F(d,n,!0,s,i);return B(d,n,e),e}))}function P(e,t){const r=E(e,t);return r?Promise.reject(r):Promise.resolve()}function U(e){const t=ae.values().next().value;return t&&"function"===typeof t.runWithContext?t.runWithContext(e):e()}function q(e,t){let r;const[n,i,o]=ot(e,t);r=Ye(n.reverse(),"beforeRouteLeave",e,t);for(const s of n)s.leaveGuards.forEach((n=>{r.push(We(n,e,t))}));const a=P.bind(null,e,t);return r.push(a),ce(r).then((()=>{r=[];for(const n of p.list())r.push(We(n,e,t));return r.push(a),ce(r)})).then((()=>{r=Ye(i,"beforeRouteUpdate",e,t);for(const n of i)n.updateGuards.forEach((n=>{r.push(We(n,e,t))}));return r.push(a),ce(r)})).then((()=>{r=[];for(const n of o)if(n.beforeEnter)if(l(n.beforeEnter))for(const i of n.beforeEnter)r.push(We(i,e,t));else r.push(We(n.beforeEnter,e,t));return r.push(a),ce(r)})).then((()=>(e.matched.forEach((e=>e.enterCallbacks={})),r=Ye(o,"beforeRouteEnter",e,t,U),r.push(a),ce(r)))).then((()=>{r=[];for(const n of m.list())r.push(We(n,e,t));return r.push(a),ce(r)})).catch((e=>he(e,8)?e:Promise.reject(e)))}function B(e,t,r){h.list().forEach((n=>U((()=>n(e,t,r)))))}function F(e,t,r,n,i){const a=E(e,t);if(a)return a;const u=t===H,d=o?history.state:{};r&&(n||u?s.replace(e.fullPath,c({scroll:u&&d&&d.scroll},i)):s.push(e.fullPath,i)),f.value=e,ne(e,t,r,u),ee()}let G;function j(){G||(G=s.listen(((e,t,r)=>{if(!se.listening)return;const n=C(e),i=A(n);if(i)return void O(c(i,{replace:!0,force:!0}),n).catch(d);g=n;const a=f.value;o&&te(Z(a.fullPath,r.delta),J()),q(n,a).catch((e=>he(e,12)?e:he(e,2)?(O(c(_(e.to),{force:!0}),n).then((e=>{he(e,20)&&!r.delta&&r.type===W.pop&&s.go(-1,!1)})).catch(d),Promise.reject()):(r.delta&&s.go(-r.delta,!1),$(e,n,a)))).then((e=>{e=e||F(n,a,!1),e&&(r.delta&&!he(e,8)?s.go(-r.delta,!1):r.type===W.pop&&he(e,20)&&s.go(-1,!1)),B(n,a,e)})).catch(d)})))}let Y,K=He(),Q=He();function $(e,t,r){ee(e);const n=Q.list();return n.length?n.forEach((n=>n(e,t,r))):console.error(e),Promise.reject(e)}function z(){return Y&&f.value!==H?Promise.resolve():new Promise(((e,t)=>{K.add([e,t])}))}function ee(e){return Y||(Y=!e,j(),K.list().forEach((([t,r])=>e?r(e):t())),K.reset()),e}function ne(t,r,i,a){const{scrollBehavior:s}=e;if(!o||!s)return Promise.resolve();const c=!i&&re(Z(t.fullPath,0))||(a||!i)&&history.state&&history.state.scroll||null;return(0,n.dY)().then((()=>s(t,r,c))).then((e=>e&&X(e))).catch((e=>$(e,t,r)))}const ie=e=>s.go(e);let oe;const ae=new Set,se={currentRoute:f,listening:!0,addRoute:I,removeRoute:T,clearRoutes:t.clearRoutes,hasRoute:b,getRoutes:S,resolve:C,options:e,push:w,replace:R,go:ie,back:()=>ie(-1),forward:()=>ie(1),beforeEach:p.add,beforeResolve:m.add,afterEach:h.add,onError:Q.add,isReady:z,install(e){const t=this;e.component("RouterLink",ze),e.component("RouterView",nt),e.config.globalProperties.$router=t,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,i.R1)(f)}),o&&!oe&&f.value===H&&(oe=!0,w(s.location).catch((e=>{0})));const r={};for(const i in H)Object.defineProperty(r,i,{get:()=>f.value[i],enumerable:!0});e.provide(Fe,t),e.provide(Ge,(0,i.Gc)(r)),e.provide(je,f);const n=e.unmount;ae.add(e),e.unmount=function(){ae.delete(e),ae.size<1&&(g=H,G&&G(),G=null,f.value=H,oe=!1,Y=!1),n()}}};function ce(e){return e.reduce(((e,t)=>e.then((()=>U(t)))),Promise.resolve())}return se}function ot(e,t){const r=[],n=[],i=[],o=Math.max(t.matched.length,e.matched.length);for(let a=0;a<o;a++){const o=t.matched[a];o&&(e.matched.find((e=>q(e,o)))?n.push(o):r.push(o));const s=e.matched[a];s&&(t.matched.find((e=>q(e,s)))||i.push(s))}return[r,n,i]}},5397:function(e,t,r){"use strict";var n=r(7055),i=r(7750);e.exports=function(e){return n(i(e))}},5610:function(e,t,r){"use strict";var n=r(1291),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},5745:function(e,t,r){"use strict";var n=r(7629);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},5876:function(e,t,r){"use strict";var n=r(6518),i=r(3838),o=r(4916),a=!o("isSubsetOf",(function(e){return e}));n({target:"Set",proto:!0,real:!0,forced:a},{isSubsetOf:i})},5917:function(e,t,r){"use strict";var n=r(3724),i=r(9039),o=r(4055);e.exports=!n&&!i((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},5966:function(e,t,r){"use strict";var n=r(9306),i=r(4117);e.exports=function(e,t){var r=e[t];return i(r)?void 0:n(r)}},6119:function(e,t,r){"use strict";var n=r(5745),i=r(3392),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},6198:function(e,t,r){"use strict";var n=r(8014);e.exports=function(e){return n(e.length)}},6262:function(e,t){"use strict";t.A=(e,t)=>{const r=e.__vccOpts||e;for(const[n,i]of t)r[n]=i;return r}},6278:function(e,t,r){"use strict";r.d(t,{y$:function(){return te},Pj:function(){return v}});var n=r(641),i=r(953);function o(){return a().__VUE_DEVTOOLS_GLOBAL_HOOK__}function a(){return"undefined"!==typeof navigator&&"undefined"!==typeof window?window:"undefined"!==typeof globalThis?globalThis:{}}const s="function"===typeof Proxy,c="devtools-plugin:setup",u="plugin:settings:set";let d,l;function p(){var e;return void 0!==d||("undefined"!==typeof window&&window.performance?(d=!0,l=window.performance):"undefined"!==typeof globalThis&&(null===(e=globalThis.perf_hooks)||void 0===e?void 0:e.performance)?(d=!0,l=globalThis.perf_hooks.performance):d=!1),d}function m(){return p()?l.now():Date.now()}class h{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const r={};if(e.settings)for(const a in e.settings){const t=e.settings[a];r[a]=t.defaultValue}const n=`__vue-devtools-plugin-settings__${e.id}`;let i=Object.assign({},r);try{const e=localStorage.getItem(n),t=JSON.parse(e);Object.assign(i,t)}catch(o){}this.fallbacks={getSettings(){return i},setSettings(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(o){}i=e},now(){return m()}},t&&t.on(u,((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((r=>{this.targetQueue.push({method:t,args:e,resolve:r})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function f(e,t){const r=e,n=a(),i=o(),u=s&&r.enableEarlyProxy;if(!i||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&u){const e=u?new h(r,i):null,o=n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[];o.push({pluginDescriptor:r,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else i.emit(c,e,t)}
/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */
var g="store";function v(e){return void 0===e&&(e=null),(0,n.WQ)(null!==e?e:g)}function y(e,t){Object.keys(e).forEach((function(r){return t(e[r],r)}))}function M(e){return null!==e&&"object"===typeof e}function I(e){return e&&"function"===typeof e.then}function T(e,t){return function(){return e(t)}}function S(e,t,r){return t.indexOf(e)<0&&(r&&r.prepend?t.unshift(e):t.push(e)),function(){var r=t.indexOf(e);r>-1&&t.splice(r,1)}}function b(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var r=e.state;_(e,r,[],e._modules.root,!0),C(e,r,t)}function C(e,t,r){var o=e._state,a=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var s=e._wrappedGetters,c={},u={},d=(0,i.uY)(!0);d.run((function(){y(s,(function(t,r){c[r]=T(t,e),u[r]=(0,n.EW)((function(){return c[r]()})),Object.defineProperty(e.getters,r,{get:function(){return u[r].value},enumerable:!0})}))})),e._state=(0,i.Kh)({data:t}),e._scope=d,e.strict&&x(e),o&&r&&e._withCommit((function(){o.data=null})),a&&a.stop()}function _(e,t,r,n,i){var o=!r.length,a=e._modules.getNamespace(r);if(n.namespaced&&(e._modulesNamespaceMap[a],e._modulesNamespaceMap[a]=n),!o&&!i){var s=N(t,r.slice(0,-1)),c=r[r.length-1];e._withCommit((function(){s[c]=n.state}))}var u=n.context=E(e,a,r);n.forEachMutation((function(t,r){var n=a+r;w(e,n,t,u)})),n.forEachAction((function(t,r){var n=t.root?r:a+r,i=t.handler||t;R(e,n,i,u)})),n.forEachGetter((function(t,r){var n=a+r;A(e,n,t,u)})),n.forEachChild((function(n,o){_(e,t,r.concat(o),n,i)}))}function E(e,t,r){var n=""===t,i={dispatch:n?e.dispatch:function(r,n,i){var o=O(r,n,i),a=o.payload,s=o.options,c=o.type;return s&&s.root||(c=t+c),e.dispatch(c,a)},commit:n?e.commit:function(r,n,i){var o=O(r,n,i),a=o.payload,s=o.options,c=o.type;s&&s.root||(c=t+c),e.commit(c,a,s)}};return Object.defineProperties(i,{getters:{get:n?function(){return e.getters}:function(){return k(e,t)}},state:{get:function(){return N(e.state,r)}}}),i}function k(e,t){if(!e._makeLocalGettersCache[t]){var r={},n=t.length;Object.keys(e.getters).forEach((function(i){if(i.slice(0,n)===t){var o=i.slice(n);Object.defineProperty(r,o,{get:function(){return e.getters[i]},enumerable:!0})}})),e._makeLocalGettersCache[t]=r}return e._makeLocalGettersCache[t]}function w(e,t,r,n){var i=e._mutations[t]||(e._mutations[t]=[]);i.push((function(t){r.call(e,n.state,t)}))}function R(e,t,r,n){var i=e._actions[t]||(e._actions[t]=[]);i.push((function(t){var i=r.call(e,{dispatch:n.dispatch,commit:n.commit,getters:n.getters,state:n.state,rootGetters:e.getters,rootState:e.state},t);return I(i)||(i=Promise.resolve(i)),e._devtoolHook?i.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):i}))}function A(e,t,r,n){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(e){return r(n.state,n.getters,e.state,e.getters)})}function x(e){(0,n.wB)((function(){return e._state.data}),(function(){0}),{deep:!0,flush:"sync"})}function N(e,t){return t.reduce((function(e,t){return e[t]}),e)}function O(e,t,r){return M(e)&&e.type&&(r=t,t=e,e=e.type),{type:e,payload:t,options:r}}var P="vuex bindings",L="vuex:mutations",V="vuex:actions",U="vuex",D=0;function q(e,t){f({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[P]},(function(r){r.addTimelineLayer({id:L,label:"Vuex Mutations",color:B}),r.addTimelineLayer({id:V,label:"Vuex Actions",color:B}),r.addInspector({id:U,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),r.on.getInspectorTree((function(r){if(r.app===e&&r.inspectorId===U)if(r.filter){var n=[];Y(n,t._modules.root,r.filter,""),r.rootNodes=n}else r.rootNodes=[W(t._modules.root,"")]})),r.on.getInspectorState((function(r){if(r.app===e&&r.inspectorId===U){var n=r.nodeId;k(t,n),r.state=K($(t._modules,n),"root"===n?t.getters:t._makeLocalGettersCache,n)}})),r.on.editInspectorState((function(r){if(r.app===e&&r.inspectorId===U){var n=r.nodeId,i=r.path;"root"!==n&&(i=n.split("/").filter(Boolean).concat(i)),t._withCommit((function(){r.set(t._state.data,i,r.state.value)}))}})),t.subscribe((function(e,t){var n={};e.payload&&(n.payload=e.payload),n.state=t,r.notifyComponentUpdate(),r.sendInspectorTree(U),r.sendInspectorState(U),r.addTimelineEvent({layerId:L,event:{time:Date.now(),title:e.type,data:n}})})),t.subscribeAction({before:function(e,t){var n={};e.payload&&(n.payload=e.payload),e._id=D++,e._time=Date.now(),n.state=t,r.addTimelineEvent({layerId:V,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:n}})},after:function(e,t){var n={},i=Date.now()-e._time;n.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},e.payload&&(n.payload=e.payload),n.state=t,r.addTimelineEvent({layerId:V,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:n}})}})}))}var B=8702998,F=6710886,G=16777215,j={label:"namespaced",textColor:G,backgroundColor:F};function H(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function W(e,t){return{id:t||"root",label:H(t),tags:e.namespaced?[j]:[],children:Object.keys(e._children).map((function(r){return W(e._children[r],t+r+"/")}))}}function Y(e,t,r,n){n.includes(r)&&e.push({id:n||"root",label:n.endsWith("/")?n.slice(0,n.length-1):n||"Root",tags:t.namespaced?[j]:[]}),Object.keys(t._children).forEach((function(i){Y(e,t._children[i],r,n+i+"/")}))}function K(e,t,r){t="root"===r?t:t[r];var n=Object.keys(t),i={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(n.length){var o=Q(t);i.getters=Object.keys(o).map((function(e){return{key:e.endsWith("/")?H(e):e,editable:!1,value:z((function(){return o[e]}))}}))}return i}function Q(e){var t={};return Object.keys(e).forEach((function(r){var n=r.split("/");if(n.length>1){var i=t,o=n.pop();n.forEach((function(e){i[e]||(i[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),i=i[e]._custom.value})),i[o]=z((function(){return e[r]}))}else t[r]=z((function(){return e[r]}))})),t}function $(e,t){var r=t.split("/").filter((function(e){return e}));return r.reduce((function(e,n,i){var o=e[n];if(!o)throw new Error('Missing module "'+n+'" for path "'+t+'".');return i===r.length-1?o:o._children}),"root"===t?e:e.root._children)}function z(e){try{return e()}catch(t){return t}}var J=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var r=e.state;this.state=("function"===typeof r?r():r)||{}},X={namespaced:{configurable:!0}};X.namespaced.get=function(){return!!this._rawModule.namespaced},J.prototype.addChild=function(e,t){this._children[e]=t},J.prototype.removeChild=function(e){delete this._children[e]},J.prototype.getChild=function(e){return this._children[e]},J.prototype.hasChild=function(e){return e in this._children},J.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},J.prototype.forEachChild=function(e){y(this._children,e)},J.prototype.forEachGetter=function(e){this._rawModule.getters&&y(this._rawModule.getters,e)},J.prototype.forEachAction=function(e){this._rawModule.actions&&y(this._rawModule.actions,e)},J.prototype.forEachMutation=function(e){this._rawModule.mutations&&y(this._rawModule.mutations,e)},Object.defineProperties(J.prototype,X);var Z=function(e){this.register([],e,!1)};function ee(e,t,r){if(t.update(r),r.modules)for(var n in r.modules){if(!t.getChild(n))return void 0;ee(e.concat(n),t.getChild(n),r.modules[n])}}Z.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},Z.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,r){return t=t.getChild(r),e+(t.namespaced?r+"/":"")}),"")},Z.prototype.update=function(e){ee([],this.root,e)},Z.prototype.register=function(e,t,r){var n=this;void 0===r&&(r=!0);var i=new J(t,r);if(0===e.length)this.root=i;else{var o=this.get(e.slice(0,-1));o.addChild(e[e.length-1],i)}t.modules&&y(t.modules,(function(t,i){n.register(e.concat(i),t,r)}))},Z.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),r=e[e.length-1],n=t.getChild(r);n&&n.runtime&&t.removeChild(r)},Z.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),r=e[e.length-1];return!!t&&t.hasChild(r)};function te(e){return new re(e)}var re=function(e){var t=this;void 0===e&&(e={});var r=e.plugins;void 0===r&&(r=[]);var n=e.strict;void 0===n&&(n=!1);var i=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Z(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=i;var o=this,a=this,s=a.dispatch,c=a.commit;this.dispatch=function(e,t){return s.call(o,e,t)},this.commit=function(e,t,r){return c.call(o,e,t,r)},this.strict=n;var u=this._modules.root.state;_(this,u,[],this._modules.root),C(this,u),r.forEach((function(e){return e(t)}))},ne={state:{configurable:!0}};re.prototype.install=function(e,t){e.provide(t||g,this),e.config.globalProperties.$store=this;var r=void 0!==this._devtools&&this._devtools;r&&q(e,this)},ne.state.get=function(){return this._state.data},ne.state.set=function(e){0},re.prototype.commit=function(e,t,r){var n=this,i=O(e,t,r),o=i.type,a=i.payload,s=(i.options,{type:o,payload:a}),c=this._mutations[o];c&&(this._withCommit((function(){c.forEach((function(e){e(a)}))})),this._subscribers.slice().forEach((function(e){return e(s,n.state)})))},re.prototype.dispatch=function(e,t){var r=this,n=O(e,t),i=n.type,o=n.payload,a={type:i,payload:o},s=this._actions[i];if(s){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(a,r.state)}))}catch(u){0}var c=s.length>1?Promise.all(s.map((function(e){return e(o)}))):s[0](o);return new Promise((function(e,t){c.then((function(t){try{r._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(a,r.state)}))}catch(u){0}e(t)}),(function(e){try{r._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(a,r.state,e)}))}catch(u){0}t(e)}))}))}},re.prototype.subscribe=function(e,t){return S(e,this._subscribers,t)},re.prototype.subscribeAction=function(e,t){var r="function"===typeof e?{before:e}:e;return S(r,this._actionSubscribers,t)},re.prototype.watch=function(e,t,r){var i=this;return(0,n.wB)((function(){return e(i.state,i.getters)}),t,Object.assign({},r))},re.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},re.prototype.registerModule=function(e,t,r){void 0===r&&(r={}),"string"===typeof e&&(e=[e]),this._modules.register(e,t),_(this,this.state,e,this._modules.get(e),r.preserveState),C(this,this.state)},re.prototype.unregisterModule=function(e){var t=this;"string"===typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){var r=N(t.state,e.slice(0,-1));delete r[e[e.length-1]]})),b(this)},re.prototype.hasModule=function(e){return"string"===typeof e&&(e=[e]),this._modules.isRegistered(e)},re.prototype.hotUpdate=function(e){this._modules.update(e),b(this,!0)},re.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(re.prototype,ne);ae((function(e,t){var r={};return ie(t).forEach((function(t){var n=t.key,i=t.val;r[n]=function(){var t=this.$store.state,r=this.$store.getters;if(e){var n=se(this.$store,"mapState",e);if(!n)return;t=n.context.state,r=n.context.getters}return"function"===typeof i?i.call(this,t,r):t[i]},r[n].vuex=!0})),r})),ae((function(e,t){var r={};return ie(t).forEach((function(t){var n=t.key,i=t.val;r[n]=function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];var n=this.$store.commit;if(e){var o=se(this.$store,"mapMutations",e);if(!o)return;n=o.context.commit}return"function"===typeof i?i.apply(this,[n].concat(t)):n.apply(this.$store,[i].concat(t))}})),r})),ae((function(e,t){var r={};return ie(t).forEach((function(t){var n=t.key,i=t.val;i=e+i,r[n]=function(){if(!e||se(this.$store,"mapGetters",e))return this.$store.getters[i]},r[n].vuex=!0})),r})),ae((function(e,t){var r={};return ie(t).forEach((function(t){var n=t.key,i=t.val;r[n]=function(){var t=[],r=arguments.length;while(r--)t[r]=arguments[r];var n=this.$store.dispatch;if(e){var o=se(this.$store,"mapActions",e);if(!o)return;n=o.context.dispatch}return"function"===typeof i?i.apply(this,[n].concat(t)):n.apply(this.$store,[i].concat(t))}})),r}));function ie(e){return oe(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function oe(e){return Array.isArray(e)||M(e)}function ae(e){return function(t,r){return"string"!==typeof t?(r=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,r)}}function se(e,t,r){var n=e._modulesNamespaceMap[r];return n}},6279:function(e,t,r){"use strict";var n=r(6840);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},6319:function(e,t,r){"use strict";var n=r(8551),i=r(9539);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(a){i(e,"throw",a)}}},6395:function(e){"use strict";e.exports=!1},6518:function(e,t,r){"use strict";var n=r(4576),i=r(7347).f,o=r(6699),a=r(6840),s=r(9433),c=r(7740),u=r(2796);e.exports=function(e,t){var r,d,l,p,m,h,f=e.target,g=e.global,v=e.stat;if(d=g?n:v?n[f]||s(f,{}):n[f]&&n[f].prototype,d)for(l in t){if(m=t[l],e.dontCallGetSet?(h=i(d,l),p=h&&h.value):p=d[l],r=u(g?l:f+(v?".":"#")+l,e.forced),!r&&void 0!==p){if(typeof m==typeof p)continue;c(m,p)}(e.sham||p&&p.sham)&&o(m,"sham",!0),a(d,l,m,e)}}},6699:function(e,t,r){"use strict";var n=r(3724),i=r(4913),o=r(6980);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},6706:function(e,t,r){"use strict";var n=r(9504),i=r(9306);e.exports=function(e,t,r){try{return n(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(o){}}},6801:function(e,t,r){"use strict";var n=r(3724),i=r(8686),o=r(4913),a=r(8551),s=r(5397),c=r(1072);t.f=n&&!i?Object.defineProperties:function(e,t){a(e);var r,n=s(t),i=c(t),u=i.length,d=0;while(u>d)o.f(e,r=i[d++],n[r]);return e}},6823:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(r){return"Object"}}},6837:function(e){"use strict";var t=TypeError,r=9007199254740991;e.exports=function(e){if(e>r)throw t("Maximum allowed index exceeded");return e}},6840:function(e,t,r){"use strict";var n=r(4901),i=r(4913),o=r(283),a=r(9433);e.exports=function(e,t,r,s){s||(s={});var c=s.enumerable,u=void 0!==s.name?s.name:t;if(n(r)&&o(r,u,s),s.global)c?e[t]=r:a(t,r);else{try{s.unsafe?e[t]&&(c=!0):delete e[t]}catch(d){}c?e[t]=r:i.f(e,t,{value:r,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},6969:function(e,t,r){"use strict";var n=r(2777),i=r(757);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},6980:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},7040:function(e,t,r){"use strict";var n=r(4495);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:function(e,t,r){"use strict";var n=r(9504),i=r(9039),o=r(2195),a=Object,s=n("".split);e.exports=i((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?s(e,""):a(e)}:a},7080:function(e,t,r){"use strict";var n=r(4402).has;e.exports=function(e){return n(e),e}},7347:function(e,t,r){"use strict";var n=r(3724),i=r(9565),o=r(8773),a=r(6980),s=r(5397),c=r(6969),u=r(9297),d=r(5917),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=s(e),t=c(t),d)try{return l(e,t)}catch(r){}if(u(e,t))return a(!i(o.f,e,t),e[t])}},7629:function(e,t,r){"use strict";var n=r(6395),i=r(4576),o=r(9433),a="__core-js_shared__",s=e.exports=i[a]||o(a,{});(s.versions||(s.versions=[])).push({version:"3.41.0",mode:n?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:function(e,t,r){"use strict";var n=r(6518),i=r(3440),o=r(4916),a=!o("difference",(function(e){return 0===e.size}));n({target:"Set",proto:!0,real:!0,forced:a},{difference:i})},7657:function(e,t,r){"use strict";var n,i,o,a=r(9039),s=r(4901),c=r(34),u=r(2360),d=r(2787),l=r(6840),p=r(8227),m=r(6395),h=p("iterator"),f=!1;[].keys&&(o=[].keys(),"next"in o?(i=d(d(o)),i!==Object.prototype&&(n=i)):f=!0);var g=!c(n)||a((function(){var e={};return n[h].call(e)!==e}));g?n={}:m&&(n=u(n)),s(n[h])||l(n,h,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},7740:function(e,t,r){"use strict";var n=r(9297),i=r(5031),o=r(7347),a=r(4913);e.exports=function(e,t,r){for(var s=i(t),c=a.f,u=o.f,d=0;d<s.length;d++){var l=s[d];n(e,l)||r&&n(r,l)||c(e,l,u(t,l))}}},7750:function(e,t,r){"use strict";var n=r(4117),i=TypeError;e.exports=function(e){if(n(e))throw new i("Can't call method on "+e);return e}},7751:function(e,t,r){"use strict";var n=r(4576),i=r(4901),o=function(e){return i(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e]):n[e]&&n[e][t]}},8004:function(e,t,r){"use strict";var n=r(6518),i=r(9039),o=r(8750),a=r(4916),s=!a("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));n({target:"Set",proto:!0,real:!0,forced:s},{intersection:o})},8014:function(e,t,r){"use strict";var n=r(1291),i=Math.min;e.exports=function(e){var t=n(e);return t>0?i(t,9007199254740991):0}},8111:function(e,t,r){"use strict";var n=r(6518),i=r(4576),o=r(679),a=r(8551),s=r(4901),c=r(2787),u=r(2106),d=r(4659),l=r(9039),p=r(9297),m=r(8227),h=r(7657).IteratorPrototype,f=r(3724),g=r(6395),v="constructor",y="Iterator",M=m("toStringTag"),I=TypeError,T=i[y],S=g||!s(T)||T.prototype!==h||!l((function(){T({})})),b=function(){if(o(this,h),c(this)===h)throw new I("Abstract class Iterator not directly constructable")},C=function(e,t){f?u(h,e,{configurable:!0,get:function(){return t},set:function(t){if(a(this),this===h)throw new I("You can't redefine this property");p(this,e)?this[e]=t:d(this,e,t)}}):h[e]=t};p(h,M)||C(M,y),!S&&p(h,v)&&h[v]!==Object||C(v,b),b.prototype=h,n({global:!0,constructor:!0,forced:S},{Iterator:b})},8227:function(e,t,r){"use strict";var n=r(4576),i=r(5745),o=r(9297),a=r(3392),s=r(4495),c=r(7040),u=n.Symbol,d=i("wks"),l=c?u["for"]||u:u&&u.withoutSetter||a;e.exports=function(e){return o(d,e)||(d[e]=s&&o(u,e)?u[e]:l("Symbol."+e)),d[e]}},8469:function(e,t,r){"use strict";var n=r(9504),i=r(507),o=r(4402),a=o.Set,s=o.proto,c=n(s.forEach),u=n(s.keys),d=u(new a).next;e.exports=function(e,t,r){return r?i({iterator:u(e),next:d},t):c(e,t)}},8480:function(e,t,r){"use strict";var n=r(1828),i=r(8727),o=i.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},8527:function(e,t,r){"use strict";var n=r(7080),i=r(4402).has,o=r(5170),a=r(3789),s=r(507),c=r(9539);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<r.size)return!1;var u=r.getIterator();return!1!==s(u,(function(e){if(!i(t,e))return c(u,"normal",!1)}))}},8551:function(e,t,r){"use strict";var n=r(34),i=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not an object")}},8622:function(e,t,r){"use strict";var n=r(4576),i=r(4901),o=n.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},8686:function(e,t,r){"use strict";var n=r(3724),i=r(9039);e.exports=n&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8727:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8750:function(e,t,r){"use strict";var n=r(7080),i=r(4402),o=r(5170),a=r(3789),s=r(8469),c=r(507),u=i.Set,d=i.add,l=i.has;e.exports=function(e){var t=n(this),r=a(e),i=new u;return o(t)>r.size?c(r.getIterator(),(function(e){l(t,e)&&d(i,e)})):s(t,(function(e){r.includes(e)&&d(i,e)})),i}},8773:function(e,t){"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},8981:function(e,t,r){"use strict";var n=r(7750),i=Object;e.exports=function(e){return i(n(e))}},9039:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(t){return!0}}},9286:function(e,t,r){"use strict";var n=r(4402),i=r(8469),o=n.Set,a=n.add;e.exports=function(e){var t=new o;return i(e,(function(e){a(t,e)})),t}},9297:function(e,t,r){"use strict";var n=r(9504),i=r(8981),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},9306:function(e,t,r){"use strict";var n=r(4901),i=r(6823),o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not a function")}},9433:function(e,t,r){"use strict";var n=r(4576),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},9462:function(e,t,r){"use strict";var n=r(9565),i=r(2360),o=r(6699),a=r(6279),s=r(8227),c=r(1181),u=r(5966),d=r(7657).IteratorPrototype,l=r(2529),p=r(9539),m=s("toStringTag"),h="IteratorHelper",f="WrapForValidIterator",g=c.set,v=function(e){var t=c.getterFor(e?f:h);return a(i(d),{next:function(){var r=t(this);if(e)return r.nextHandler();if(r.done)return l(void 0,!0);try{var n=r.nextHandler();return r.returnHandlerResult?n:l(n,r.done)}catch(i){throw r.done=!0,i}},return:function(){var r=t(this),i=r.iterator;if(r.done=!0,e){var o=u(i,"return");return o?n(o,i):l(void 0,!0)}if(r.inner)try{p(r.inner.iterator,"normal")}catch(a){return p(i,"throw",a)}return i&&p(i,"normal"),l(void 0,!0)}})},y=v(!0),M=v(!1);o(M,m,"Iterator Helper"),e.exports=function(e,t,r){var n=function(n,i){i?(i.iterator=n.iterator,i.next=n.next):i=n,i.type=t?f:h,i.returnHandlerResult=!!r,i.nextHandler=e,i.counter=0,i.done=!1,g(this,i)};return n.prototype=t?y:M,n}},9504:function(e,t,r){"use strict";var n=r(616),i=Function.prototype,o=i.call,a=n&&i.bind.bind(o,o);e.exports=n?a:function(e){return function(){return o.apply(e,arguments)}}},9519:function(e,t,r){"use strict";var n,i,o=r(4576),a=r(2839),s=o.process,c=o.Deno,u=s&&s.versions||c&&c.version,d=u&&u.v8;d&&(n=d.split("."),i=n[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(n=a.match(/Edge\/(\d+)/),(!n||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/),n&&(i=+n[1]))),e.exports=i},9539:function(e,t,r){"use strict";var n=r(9565),i=r(8551),o=r(5966);e.exports=function(e,t,r){var a,s;i(e);try{if(a=o(e,"return"),!a){if("throw"===t)throw r;return r}a=n(a,e)}catch(c){s=!0,a=c}if("throw"===t)throw r;if(s)throw a;return i(a),r}},9565:function(e,t,r){"use strict";var n=r(616),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},9617:function(e,t,r){"use strict";var n=r(5397),i=r(5610),o=r(6198),a=function(e){return function(t,r,a){var s=n(t),c=o(s);if(0===c)return!e&&-1;var u,d=i(a,c);if(e&&r!==r){while(c>d)if(u=s[d++],u!==u)return!0}else for(;c>d;d++)if((e||d in s)&&s[d]===r)return e||d||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}}}]);
//# sourceMappingURL=chunk-vendors.b6033bb3.js.map